jQuery.fn.repeater=function(s){this.options=jQuery.extend(!0,{},{template:"",limit:5,items:[{}],saveEvents:"blur change",saveElements:"input, select",addImageSrc:"",removeImageSrc:"",callbacks:{save:function(){},beforeAdd:function(){},add:function(){},beforeAddNew:function(){},addNew:function(){},beforeRemove:function(){},remove:function(){},repeaterButtons:function(){return!1}}},s),this.elem=jQuery(this),this.items=this.options.items,this.callbacks=this.options.callbacks,this._template=this.options.template||this.elem.next("#"+this.elem.prop("id")+"-template").html();var e=this.options.saveEvents.split(" "),t=[];for(i in e)t.push(e[i]+".repeater");return this.options.saveEvents=t.join(" "),this.init=function(){for(i in this._template||(this._template=this.elem.html()),this.elem.after('<div id="'+this.elem.prop("id")+'-template" style="display:none">'+this._template+"</div>"),this.elem.addClass("repeater"),this.elem.empty(),this.items)this.addItem(this.items[i],i);var t=this;return jQuery(this.elem).off("click.repeater",'a.add-item:not(".inactive")'),jQuery(this.elem).on("click.repeater",'a.add-item:not(".inactive")',function(e){t.addNewItem(this)}),jQuery(this.elem).off("click.repeater","a.remove-item"),jQuery(this.elem).on("click.repeater","a.remove-item",function(e){t.removeItem(this)}),jQuery(this.elem).off(this.options.saveEvents,this.options.saveElements),jQuery(this.elem).on(this.options.saveEvents,this.options.saveElements,function(){t.save()}),this},this.addItem=function(e,t){var i,s=this._template;for(i in e){var s=s.replace(/{i}/g,t),a=this.callbacks.repeaterButtons(this,t)?this.callbacks.repeaterButtons(this,t):this.addRepeaterButtons(t),a=(s=s.replace("{buttons}",a),new RegExp("{"+i+"}","g"));s=s.replace(a,e[i])}var n=jQuery(s).addClass("item-"+t);this.callbacks.beforeAdd(this,n,e),this.append(n),this.callbacks.add(this,n,e)},this.addRepeaterButtons=function(e){var t=(t='<div class="repeater-buttons">')+('<a class="add-item '+(this.items.length>=s.limit&&0!==s.limit?"inactive":"")+'" data-index="'+e+'">')+('<img src="'+s.addImageSrc+'/images/add.png" alt="Add" /></a>');return 1<this.items.length&&(t+='<a class="remove-item" data-index="'+e+'"><img src="'+s.removeImageSrc+'/images/remove.png" alt="Remove" /></a>'),t},this.addNewItem=function(e){e=jQuery(e).attr("data-index");this.callbacks.beforeAddNew(this,e),this.items.splice(e+1,0,this.getBaseObject()),this.callbacks.addNew(this,e),this.refresh()},this.removeItem=function(e){e=jQuery(e).attr("data-index");this.callbacks.beforeRemove(this,e),delete this.items[e],this.callbacks.remove(this,e),this.save(),this.refresh()},this.refresh=function(){for(i in this.elem.empty(),this.items)this.addItem(this.items[i],i)},this.save=function(){var e=this.getDataKeys(),t=new Array;for(i=0;i<this.items.length;i++)if(void 0!==this.items[i]){var s={};for(j in e){var a=e[j],n="#"+a+"_"+i;s[a]=jQuery(this.elem).find(n).val()}t.push(s)}this.items=t,this.callbacks.save(this,t)},this.getDataKeys=function(){var e,t=new Array;for(e in this.items)if(void 0!==this.items[e]){for(var i in this.items[e])t[t.length]=i;break}return t},this.getBaseObject=function(){var e,t={},i=this.getDataKeys();for(e in i)t[i[e]]="";return t},this.init(!0)};
//# sourceMappingURL=repeater.js.map