/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

tribe.events=tribe.events||{},tribe.events.automatorSettingsAdmin=tribe.events.automatorSettingsAdmin||{},function($,obj,tribe_dropdowns){const $document=$(document);obj.selectors={integrationContainer:".tec-automator-settings",integrationAdd:".tec-automator-settings__add-api-key-button",messageWrap:".tec-automator-settings-message__wrap",integrationList:".tec-automator-settings-items__wrap",integrationItem:".tec-automator-settings-details__container",integrationName:".tec-automator-settings-details__name-input",integrationUser:".tec-settings-form__users-dropdown",integrationGenerate:".tec-automator-settings-details-action__generate",integrationRevoke:".tec-automator-settings-details-action__revoke",copyButton:".tec-automator-settings__copy-btn",copyButtonTxt:".tec-automator-settings__copy-btn-text",copySuccess:".copy-success",copyFail:".copy-fail",dashboardContainer:".tec-automator-dashboard",endpointContainer:".tec-settings-connection-endpoint-dashboard-details__container",endpointActionButton:".tec-settings-connection-endpoint-dashboard-details-action__button",endpointClearButton:".tec-settings-connection-endpoint-dashboard-details-actions__clear",endpointDisableButton:".tec-settings-connection-endpoint-dashboard-details-actions__disable",endpointEnableButton:".tec-settings-connection-endpoint-dashboard-details-actions__enable",automatorLoader:".tribe-common-c-loader",automatorLoaderHiddenElement:".tribe-common-a11y-hidden"},obj.scrollToBottom=function($container){let totalHeight=0;$container.find(obj.selectors.integrationItem).each((function(){totalHeight+=$(this).outerHeight()})),$(obj.selectors.integrationList).animate({scrollTop:totalHeight},500)},obj.validateFields=function($integrationItem){const integrationName=$integrationItem.find(obj.selectors.integrationName).val(),intergrationUser=$integrationItem.find(`${obj.selectors.integrationUser} option:selected`).val();return!(!integrationName||!intergrationUser)},obj.onAddApiKeyFieldsSuccess=function(html,event_target){const $container=$(event_target).closest(obj.selectors.integrationContainer),message=$(html).filter(obj.selectors.messageWrap),integrationItemWrap=$(html).filter(obj.selectors.integrationItem);if($container.find(obj.selectors.messageWrap).html(message),0===integrationItemWrap.length)return;$container.find(obj.selectors.integrationList).append(integrationItemWrap);$(obj.selectors.integrationList).find(tribe_dropdowns.selector.dropdown).not(tribe_dropdowns.selector.created).tribe_dropdowns(),obj.hide($container),obj.scrollToBottom($container)},obj.handleAddApiKey=function(event){event.preventDefault();const url=$(event.target).attr("href"),$integrationContainer=$(event.target).closest(obj.selectors.integrationContainer);obj.show($integrationContainer),$.ajax(url,{contentType:"application/json",context:$(obj.selectors.integrationList),success:html=>obj.onAddApiKeyFieldsSuccess(html,event.target)})},obj.onGenerateKeySuccess=function(html,event_target){const $container=$(event_target).closest(obj.selectors.integrationContainer),$message=$(html).filter(obj.selectors.messageWrap),$integrationItemWrap=$(html).filter(obj.selectors.integrationItem);if($container.find(obj.selectors.messageWrap).html($message),obj.hide($container),0===$integrationItemWrap.length)return;const consumerId=$integrationItemWrap.data("consumerId");$document.find(`[data-consumer-id='${consumerId}']`).replaceWith($integrationItemWrap),obj.scrollToBottom($container)},obj.handleGenerateKey=function(event){event.preventDefault();const $this=$(event.target).closest(obj.selectors.integrationGenerate),url=$this.data("ajaxGenerateUrl"),$integrationItem=$this.closest(obj.selectors.integrationItem);obj.validateFields($integrationItem)||window.alert($this.data("generateError"));const consumerId=$integrationItem.data("consumerId"),integrationName=$integrationItem.find(obj.selectors.integrationName).val(),intergrationUser=$integrationItem.find(`${obj.selectors.integrationUser} option:selected`).val(),$integrationContainer=$this.closest(obj.selectors.integrationContainer);obj.show($integrationContainer),$.ajax(url,{contentType:"application/json",context:$this.closest(obj.selectors.integrationItem),data:{consumer_id:consumerId,name:integrationName,user_id:intergrationUser,permissions:"read"},success:data=>obj.onGenerateKeySuccess(data,$this)})},obj.onRevokeSuccess=function(html){const $integrationContainer=$(obj.selectors.integrationContainer);$integrationContainer.find(obj.selectors.messageWrap).html(html),obj.hide($integrationContainer),$(`${obj.selectors.integrationItem}.to-delete`).remove()},obj.handleRevoke=function(event){event.preventDefault();const $this=$(event.target).closest(obj.selectors.integrationRevoke),url=$this.data("ajaxRevokeUrl"),$integrationItem=$this.closest(obj.selectors.integrationItem),consumerId=$integrationItem.data("consumerId");if(!confirm($this.data("confirmation")))return;const $integrationContainer=$this.closest(obj.selectors.integrationContainer);obj.show($integrationContainer),$integrationItem.addClass("to-delete"),$.ajax(url,{contentType:"application/json",context:$this.closest(obj.selectors.integrationItem),data:{consumer_id:consumerId},success:obj.onRevokeSuccess})},obj.setupClipboard=function(){$document.on("click",`${obj.selectors.copyButton}, ${obj.selectors.copySuccess}, ${obj.selectors.copyFail}`,(function(e){e.preventDefault()}));const clipboard=new ClipboardJS(obj.selectors.copyButton),button_text=tec_automator.clipboard_btn_text;clipboard.on("success",(function(event){let copyText=event.trigger.querySelector(obj.selectors.copyButtonTxt);event.clearSelection(),copyText.innerHTML=`\n\t\t\t\t<span class="${obj.selectors.copySuccess.replace(/\./g,"")}">\n\t\t\t\t\t${tec_automator.clipboard_copied_text}\n\t\t\t\t<span>`,window.setTimeout((function(){copyText.innerHTML=button_text}),5e3)})),clipboard.on("error",(function(event){let copyText=event.trigger.querySelector(obj.selectors.copyButtonTxt);copyText.innerHTML=`\n\t\t\t\t<span class="${obj.selectors.copyFail.replace(/\./g,"")}">\n\t\t\t\t\t${tec_automator.clipboard_fail_text}\n\t\t\t\t<span>`,window.setTimeout((function(){copyText.innerHTML=button_text}),5e3)}))},obj.handleEndpointAction=function(event){event.preventDefault();const $this=$(event.target).closest(obj.selectors.endpointActionButton),url=$this.data("ajaxActionUrl"),$endPointContainer=$this.closest(obj.selectors.endpointContainer),endpointId=$endPointContainer.data("endpointId");if(!confirm($this.data("confirmation")))return;const $dashboardContainer=$this.closest(obj.selectors.dashboardContainer);obj.show($dashboardContainer),$endPointContainer.addClass("to-update"),$.ajax(url,{contentType:"application/json",context:$this.closest(obj.selectors.endpointContainer),data:{endpoint_id:endpointId},success:data=>obj.onEndpointActionSuccess(data,$this)})},obj.onEndpointActionSuccess=function(html,event_target){const $dashboardContainer=$(event_target).closest(obj.selectors.dashboardContainer),$message=$(html).filter(obj.selectors.messageWrap);$dashboardContainer.find(obj.selectors.messageWrap).html($message),obj.hide($dashboardContainer);const $endpointContainer=$(html).filter(obj.selectors.endpointContainer);0!==$endpointContainer.length&&$(`${obj.selectors.endpointContainer}.to-update`).replaceWith($endpointContainer)},obj.show=function($container){const $loader=$container.find(obj.selectors.automatorLoader);$loader.length&&$loader.removeClass(obj.selectors.automatorLoaderHiddenElement.className())},obj.hide=function($container){const $loader=$container.find(obj.selectors.automatorLoader);$loader.length&&$loader.addClass(obj.selectors.automatorLoaderHiddenElement.className())},obj.bindEvents=function(){$document.on("click",obj.selectors.integrationGenerate,obj.handleGenerateKey).on("click",obj.selectors.integrationRevoke,obj.handleRevoke).on("click",obj.selectors.endpointClearButton,obj.handleEndpointAction).on("click",obj.selectors.endpointDisableButton,obj.handleEndpointAction).on("click",obj.selectors.endpointEnableButton,obj.handleEndpointAction),$(obj.selectors.integrationContainer).on("click",obj.selectors.integrationAdd,obj.handleAddApiKey)},obj.unbindEvents=function(){},obj.ready=function(){obj.setupClipboard(),obj.bindEvents()},$(obj.ready)}(jQuery,tribe.events.automatorSettingsAdmin,tribe_dropdowns);