var tribe_aggregator=tribe_aggregator||{};tribe_aggregator.notice={selector:{notice:".tribe-notice-aggregator-update-msg",progress:".progress",tracker:".tracker",created:".track-created .value",updated:".track-updated .value",skipped:".track-skipped .value",remaining:".track-remaining .value",bar:".bar"},progress:{}},function(e,r,s){r.progress.init=function(){r.progress.data={},r.progress.$={},r.progress.$.notice=e(".tribe-notice-aggregator-update-msg"),r.progress.$.spinner=r.progress.$.notice.find("img"),r.progress.$.progress=r.progress.$.notice.find(r.selector.progress),r.progress.$.tracker=r.progress.$.notice.find(r.selector.tracker),r.progress.$.created=r.progress.$.tracker.find(r.selector.created),r.progress.$.updated=r.progress.$.tracker.find(r.selector.updated),r.progress.$.skipped=r.progress.$.tracker.find(r.selector.skipped),r.progress.$.remaining=r.progress.$.tracker.find(r.selector.remaining),r.progress.$.bar=r.progress.$.notice.find(r.selector.bar),r.progress.data.time=Date.now(),r.progress.hasHeartBeat="undefined"!=typeof wp&&wp.heartbeat,r.progress.hasHeartBeat&&wp.heartbeat.interval(15),setTimeout(r.progress.start)},r.progress.start=function(){"object"==typeof tribe_aggregator_save&&(r.progress.update(tribe_aggregator_save.progress,tribe_aggregator_save.progressText),r.progress.hasHeartBeat||r.progress.send_request())},r.progress.continue=!0,e(document).on("heartbeat-send",function(e,s){"object"==typeof tribe_aggregator_save&&r.progress.continue&&(s.ea_record=tribe_aggregator_save.record_id)}),e(document).on("heartbeat-tick",function(e,s){s.ea_progress&&r.progress.handle_response(s.ea_progress)}),r.progress.handle_response=function(e){e.html&&r.progress.data.notice.html(e.html),isNaN(parseInt(e.progress,10))||r.progress.update(e),r.progress.continue=e.continue,e.continue&&!r.progress.hasHeartBeat&&setTimeout(r.progress.send_request,15e3),e.error?(r.progress.$.notice.find(".tribe-message").html(e.error_text),r.progress.$.tracker.remove(),r.progress.$.notice.find(".progress-container").remove(),r.progress.$.notice.removeClass("notice-warning").addClass("notice-error")):e.complete&&(r.progress.$.notice.find(".tribe-message").html(e.complete_text),r.progress.$.tracker.remove(),r.progress.$.notice.find(".progress-container").remove(),r.progress.$.notice.removeClass("notice-warning").addClass("notice-success"),r.progress.$.notice.show())},r.progress.send_request=function(){var s={record:tribe_aggregator_save.record_id,check:tribe_aggregator_save.check,action:"tribe_aggregator_realtime_update"};e.post(ajaxurl,s,r.progress.handle_response,"json")},r.progress.update=function(e){var s=parseInt(e.progress,10);if(!(s<0||s>100)&&void 0!==e.counts){var t=["created","updated","skipped"];for(var o in t)if(e.counts[t[o]]){var a=e.counts[t[o]],g=r.progress.$[t[o]];if("updated"===t[o]||"skipped"===t[o])a>(g?g.html():0)&&g.html(a);else g.html(a);r.progress.$.tracker.hasClass("has-"+t[o])||r.progress.$.tracker.addClass("has-"+t[o])}r.progress.$.bar.css("width",s+"%"),r.progress.$.progress.attr("title",e.progress_text)}},r.progress.remove_notice=function(){r.progress.$.notice.animate({opacity:0,height:"toggle"},1e3,function(){r.progress.$.notice.remove()})},e(document).on("tribe_aggregator_init_notice",function(){r.progress.init()}),r.progress.init()}(jQuery,tribe_aggregator.notice);