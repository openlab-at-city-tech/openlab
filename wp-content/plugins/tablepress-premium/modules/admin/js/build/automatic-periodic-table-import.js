(()=>{"use strict";const e=window.React,t=window.ReactDOM,a=window.wp.i18n,l=window.wp.components,s=window.wp.primitives,n=(0,e.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(s.Path,{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})),r={60:(0,a.__)("Once per minute","tablepress"),900:(0,a.__)("Once per 15 minutes","tablepress"),3600:(0,a.__)("Once per hour","tablepress"),43200:(0,a.__)("Twice per day","tablepress"),86400:(0,a.__)("Once per day","tablepress"),604800:(0,a.__)("Once per week","tablepress")},c=Object.entries(r).map((([t,a])=>(0,e.createElement)("option",{key:t,value:t},a)));c.push((0,e.createElement)("option",{key:"custom",value:"custom"},(0,a.__)("Custom","tablepress")));const o=({disabled:t=!1,value:s,onChange:o})=>{const[i,m]=(0,e.useState)(!1),d=!r.hasOwnProperty(s);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("select",{disabled:t,value:i||d?"custom":s,onChange:e=>{"custom"===e.target.value?m(!0):(m(!1),o(e.target.value))}},c),(i||d)&&(0,e.createElement)(e.Fragment,null," ",(0,e.createElement)("input",{type:"text",className:"code",disabled:t,value:s,onChange:e=>{o(/^\d+$/.test(e.target.value)?parseInt(e.target.value,10):e.target.value)}})," ",t?(0,e.createElement)(l.Icon,{icon:n,style:{fill:"rgba(44, 51, 56, 0.5)",verticalAlign:"middle"}}):(0,e.createElement)(l.Tooltip,{text:(0,a.__)("Interval in seconds or Cron-like schedule","tablepress")},(0,e.createElement)("span",null,(0,e.createElement)(l.Icon,{icon:n,style:{verticalAlign:"middle"}})))))},i=e=>"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e),m=window.wp.url,d=function(e,t){const a=`save-changes-${Date.now()}`,l=i("#spinner-save-changes");l.parentNode.insertAdjacentHTML("afterend",`<div id="${a}" class="ajax-alert notice notice-${e}"><p>${t}</p></div>`),l.remove();const s=i(`#${a}`);s.offsetWidth,s.style.opacity=0,s.addEventListener("transitionend",(()=>s.remove())),i(".button-save-changes").forEach((e=>e.disabled=!1)),document.body.classList.remove("wait")},p=(e,t)=>{const l=Object.fromEntries(Object.entries(t.tables).filter((([,e])=>e.active||"https://"!==e.location||86400!==e.interval)).map((([e,t])=>(delete t.selected,delete t.last_import,[e,t]))));var s;s={action:"tablepress_import",_ajax_nonce:i("#_wpnonce").value,tablepress:JSON.stringify(l)},e.insertAdjacentHTML("beforeend",`<span id="spinner-save-changes" class="spinner-save-changes spinner is-active" title="${(0,a.__)("Changes are being saved …","tablepress")}"></span>`),i(".button-save-changes").forEach((e=>e.disabled=!0)),document.body.classList.add("wait"),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:(0,m.buildQueryString)(s)}).then((e=>{if(!e.ok)throw new Error(`There was a problem with the server, HTTP response code ${e.status} (${e.statusText}).`);return e.json()})).then((e=>{if(null==e||"-1"===e||void 0===e.success)throw new Error("The JSON data returned from the server is unclear or incomplete.");if(!0!==e.success){const t=e.error_details?`</p><p>These errors were encountered:</p><pre>${e.error_details}</pre><p>`:"";throw new Error(`The data could not be saved to the database properly.${t}`)}!function(e){const t={success_save:(0,a.__)("The changes were saved successfully.","tablepress"),error_save:(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")},l=e.message.includes("error")?"error":"success";d(l,t[e.message])}(e)})).catch((e=>{return t=e.message,t=(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")+" "+t,void d("error",t);var t}))};tp.automatic_periodic_table_import.tables=Object.fromEntries(Object.keys(tp.import.tables).map((e=>[e,{selected:!1,active:!1,location:"https://",interval:86400,last_import:"-",...tp.automatic_periodic_table_import.tables[e]}])));((e,a)=>{const l=document.getElementById("tablepress-automatic-periodic-table-import-screen");l&&("function"==typeof t.createRoot?(0,t.createRoot)(l).render(a):(0,t.render)(a,l))})(0,(0,e.createElement)((()=>{const[t,s]=(0,e.useState)((()=>({tables:tp.automatic_periodic_table_import.tables,shownTableIds:Object.keys(tp.automatic_periodic_table_import.tables),lastCheckboxTableId:null,searchTerm:"",sort:{column:"",direction:1},bulkAction:"",bulkActionInterval:86400}))),n=e=>{const a={...t,...e};s(a)},r=(e,a)=>{let l=Object.entries(t.tables);return""!==e&&(e=e.toLowerCase(),l=l.filter((([t,a])=>t.toLowerCase().includes(e)||tp.import.tables[t].toLowerCase().includes(e)||a.location.toLowerCase().includes(e)))),""!==a.column&&l.sort((([e,t],[l,s])=>{let n,r;"id"===a.column?(n=e,r=l):"name"===a.column?(n=tp.import.tables[e],r=tp.import.tables[l]):(n=t[a.column].toString(),r=s[a.column].toString());const c=n.localeCompare(r,void 0,{numeric:!0,sensitivity:"base"});return a.direction*c})),l.map((([e])=>e))},c=(0,e.createElement)("p",{className:"submit"},(0,e.createElement)("input",{type:"button",className:"button button-secondary button-large button-save-changes",value:(0,a.__)("Save Automatic Import configuration","tablepress"),onClick:e=>p(e.target.parentNode,t)})),i=({column:a,text:l})=>(0,e.createElement)("th",{className:a===t.sort.column?"sorted "+(1===t.sort.direction?"asc":"desc"):"sortable desc"},(0,e.createElement)("a",{href:"",role:"button",onClick:e=>{e.preventDefault();const l={column:a,direction:e.target.closest("th").classList.contains("asc")?-1:1},s=r(t.searchTerm,l);n({shownTableIds:s,sort:l})}},(0,e.createElement)("span",null,l),(0,e.createElement)("span",{className:"sorting-indicators"},(0,e.createElement)("span",{className:"sorting-indicator asc","aria-hidden":"true"}),(0,e.createElement)("span",{className:"sorting-indicator desc","aria-hidden":"true"}))));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("To periodically import tables from files that were uploaded to a server, configure the desired interval and table source information below.","tablepress")),(0,e.createElement)("p",{className:"description"},(0,a.__)("Please note: In general, it is recommended to use a reasonably long interval, to reduce traffic on the import source server.","tablepress")+" "+(0,a.__)("In addition, it is recommended to set up a suitable server cron job that replaces the WP Cron system, for improved reliability.","tablepress")),c,(0,e.createElement)("div",{className:"tablenav top"},(0,e.createElement)("div",{className:"alignleft actions bulkactions"},(0,e.createElement)("label",{htmlFor:"bulk-action-selector-top",className:"screen-reader-text"},(0,a.__)("Select Bulk Action","tablepress")),(0,e.createElement)("select",{id:"bulk-action-selector-top",value:t.bulkAction,onChange:e=>{n({bulkAction:e.target.value})}},(0,e.createElement)("option",{value:""},(0,a.__)("Bulk Actions","tablepress")),(0,e.createElement)("option",{value:"activate"},(0,a.__)("Activate import","tablepress")),(0,e.createElement)("option",{value:"deactivate"},(0,a.__)("Deactivate import","tablepress")),(0,e.createElement)("option",{value:"set-interval"},(0,a.__)("Set import interval","tablepress"))),"set-interval"===t.bulkAction&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o,{value:t.bulkActionInterval,onChange:e=>{n({bulkActionInterval:e})}})," "),(0,e.createElement)("input",{type:"button",className:"button action",disabled:""===t.bulkAction||0===t.shownTableIds.length||!t.shownTableIds.some((e=>t.tables[e].selected)),value:(0,a.__)("Apply","tablepress"),onClick:()=>{const e=t.shownTableIds.filter((e=>t.tables[e].selected)),a={...t.tables};"activate"===t.bulkAction?e.forEach((e=>{a[e].active=!0})):"deactivate"===t.bulkAction?e.forEach((e=>{a[e].active=!1})):"set-interval"===t.bulkAction&&e.forEach((e=>{a[e].interval=t.bulkActionInterval})),n({tables:a,bulkAction:"",bulkActionInterval:86400})}})),(0,e.createElement)("p",{className:"search-box",style:{paddingBottom:"0.5em"}},(0,e.createElement)("label",{htmlFor:"tables_search-search-input"},(0,a.__)("Filter list:","tablepress")),(0,e.createElement)("input",{id:"tables_search-search-input",type:"search",value:t.searchTerm,onChange:e=>{const a=e.target.value,l=r(a,t.sort);n({shownTableIds:l,searchTerm:a})},style:{marginLeft:"0.5em"}})),(0,e.createElement)("br",{className:"clear"})),(0,e.createElement)("table",{id:"tablepress-automatic-periodic-import-tables",className:"widefat striped"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{className:"column-checkbox"},(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-thead",checked:0<t.shownTableIds.length&&t.shownTableIds.every((e=>t.tables[e].selected)),disabled:0===t.shownTableIds.length,onChange:e=>{const a={...t.tables};t.shownTableIds.forEach((t=>{a[t].selected=e.target.checked})),n({tables:a})}}),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-thead"},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.__)("Select All")))),(0,e.createElement)(i,{column:"id",text:(0,a.__)("ID","tablepress")}),(0,e.createElement)(i,{column:"name",text:(0,a.__)("Table Name","tablepress")}),(0,e.createElement)(i,{column:"active",text:(0,a.__)("Active","tablepress")}),(0,e.createElement)(i,{column:"location",text:(0,a.__)("Import File Location","tablepress")}),(0,e.createElement)(i,{column:"interval",text:(0,a.__)("Import Interval","tablepress")}),(0,e.createElement)(i,{column:"last_import",text:(0,a.__)("Last Automatic Import","tablepress")}))),(0,e.createElement)("tbody",null,0===t.shownTableIds.length?(0,e.createElement)("tr",null,(0,e.createElement)("td",{colSpan:"7"},(0,a.__)("No tables found.","tablepress"))):t.shownTableIds.map((s=>{const r=t.tables[s],c=""===tp.import.tables[s].trim()?(0,a.__)("(no name)","tablepress"):tp.import.tables[s];return(0,e.createElement)("tr",{key:s},(0,e.createElement)("th",{scope:"row",className:"column-checkbox"},(0,e.createElement)("input",{type:"checkbox",checked:r.selected,id:`cb-select-${s}`,onChange:e=>{const a=t.shownTableIds.indexOf(s);let l=t.shownTableIds.indexOf(t.lastCheckboxTableId);null!==t.lastCheckboxTableId&&e.nativeEvent.shiftKey||(l=a);const r=l<a?l:a,c=a>l?a:l,o={...t.tables};for(let a=r;a<=c;a++)o[t.shownTableIds[a]].selected=e.target.checked;n({tables:o,lastCheckboxTableId:s})}}),(0,e.createElement)("label",{htmlFor:`cb-select-${s}`},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.sprintf)((0,a.__)("Select table “%s”","tablepress"),c)))),(0,e.createElement)("td",{className:"column-table-id"},s),(0,e.createElement)("td",{className:"column-table-name"},c),(0,e.createElement)("td",{className:"column-import-active"},(0,e.createElement)(l.ToggleControl,{checked:r.active,onChange:e=>{const a={...t.tables};a[s].active=e,n({tables:a})}})),(0,e.createElement)("td",{className:"column-import-location"},(0,e.createElement)("input",{type:"text",className:"large-text code",disabled:!r.active,value:r.location,onChange:e=>{const a={...t.tables};a[s].location=e.target.value,n({tables:a})}})),(0,e.createElement)("td",{className:"column-import-interval"},(0,e.createElement)(o,{disabled:!r.active,value:r.interval,onChange:e=>{const a={...t.tables};a[s].interval=e,n({tables:a})}})),(0,e.createElement)("td",{className:"column-import-last-import",dangerouslySetInnerHTML:{__html:r.last_import}}))}))),(0,e.createElement)("tfoot",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{className:"column-checkbox"},(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-tfoot",checked:0<t.shownTableIds.length&&t.shownTableIds.every((e=>t.tables[e].selected)),disabled:0===t.shownTableIds.length,onChange:e=>{const a={...t.tables};t.shownTableIds.forEach((t=>{a[t].selected=e.target.checked})),n({tables:a})}}),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-tfoot"},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.__)("Select All")))),(0,e.createElement)("th",null,(0,a.__)("ID","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Table Name","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Active","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Import File Location","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Import Interval","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Last Automatic Import","tablepress"))))),c)}),null))})();