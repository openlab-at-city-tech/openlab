(()=>{"use strict";const e=window.React,t=window.ReactDOM,s=window.wp.i18n,a=e=>"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e),r=window.wp.url,n=function(e,t){const s=`save-changes-${Date.now()}`,r=a("#spinner-save-changes");r.parentNode.insertAdjacentHTML("afterend",`<div id="${s}" class="ajax-alert notice notice-${e}"><p>${t}</p></div>`),r.remove();const n=a(`#${s}`);n.offsetWidth,n.style.opacity=0,n.addEventListener("transitionend",(()=>n.remove())),a(".button-save-changes").forEach((e=>e.disabled=!1)),document.body.classList.remove("wait")},c=(e,t)=>{var c;c={action:"tablepress_advanced_access_rights",_ajax_nonce:a("#_wpnonce").value,tablepress:JSON.stringify(t.map)},e.insertAdjacentHTML("beforeend",`<span id="spinner-save-changes" class="spinner-save-changes spinner is-active" title="${(0,s.__)("Changes are being saved …","tablepress")}"></span>`),a(".button-save-changes").forEach((e=>e.disabled=!0)),document.body.classList.add("wait"),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:(0,r.buildQueryString)(c)}).then((e=>{if(!e.ok)throw new Error(`There was a problem with the server, HTTP response code ${e.status} (${e.statusText}).`);return e.json()})).then((e=>{if(null==e||"-1"===e||void 0===e.success)throw new Error("The JSON data returned from the server is unclear or incomplete.");if(!0!==e.success){const t=e.error_details?`</p><p>These errors were encountered:</p><pre>${e.error_details}</pre><p>`:"";throw new Error(`The data could not be saved to the database properly.${t}`)}!function(e){const t={success_save:(0,s.__)("The changes were saved successfully.","tablepress"),error_save:(0,s.__)("Attention: Unfortunately, an error occurred.","tablepress")},a=e.message.includes("error")?"error":"success";n(a,t[e.message])}(e)})).catch((e=>{return t=e.message,t=(0,s.__)("Attention: Unfortunately, an error occurred.","tablepress")+" "+t,void n("error",t);var t}))};tp.advanced_access_rights.tables["#new_tables"]=(0,s.__)("New tables","tablepress"),tp.advanced_access_rights.users["#new_users"]={};const l=Object.keys(tp.advanced_access_rights.tables),o=Object.keys(tp.advanced_access_rights.users);tp.advanced_access_rights.map=Object.fromEntries(l.map((e=>{const t=Object.fromEntries(o.map((t=>[t,tp.advanced_access_rights.map[e]?.[t]?1:0])));return[e,t]})));((e,s)=>{const a=document.getElementById("tablepress-advanced-access-rights-screen");a&&("function"==typeof t.createRoot?(0,t.createRoot)(a).render(s):(0,t.render)(s,a))})(0,(0,e.createElement)((()=>{const t=(0,e.useRef)(null),[a,r]=(0,e.useState)({map:tp.advanced_access_rights.map,lastCheckboxIdx:null}),n=e=>{const t={...a,...e};r(t)};return(0,e.useEffect)((()=>{(e=>{const t=window?.navigator?.platform?.includes("Mac")?(0,s._x)("⌘","keyboard shortcut modifier key on a Mac keyboard","tablepress"):(0,s._x)("Ctrl+","keyboard shortcut modifier key on a non-Mac keyboard","tablepress"),a=(0,s.sprintf)(e.dataset.shortcut,t);e.title=(0,s.sprintf)((0,s.__)("Keyboard Shortcut: %s","tablepress"),a),window.addEventListener("keydown",(t=>{let s="";(t.ctrlKey||t.metaKey)&&83===t.keyCode&&(s="save-changes"),"save-changes"===s&&(document.activeElement.blur(),e.click(),t.preventDefault())}),!0)})(t.current)}),[]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,e.createElement)("input",{type:"button",className:"button button-primary button-large button-save-changes",value:(0,s.__)("Save Changes","tablepress"),onClick:e=>c(e.target.parentNode,a)})),(0,e.createElement)("table",{id:"tablepress-access-rights-map",className:"tablepress-access-rights-map striped"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null),(0,e.createElement)("th",null),Object.entries(tp.advanced_access_rights.users).map((([t,a])=>(0,e.createElement)("th",{key:t,className:"#new_users"===t?"new-users-column":void 0},"#new_users"===t&&(0,s.__)("New users","tablepress"),"#new_users"!==t&&(0,e.createElement)(e.Fragment,null,t,":",(0,e.createElement)("br",null),(0,e.createElement)("abbr",{title:a.displayName},a.userLogin))))))),(0,e.createElement)("tbody",null,Object.entries(tp.advanced_access_rights.tables).map((([t,r])=>(0,e.createElement)("tr",{key:t,className:"#new_tables"===t?"new-tables-row":void 0},(0,e.createElement)("th",{className:"#new_tables"!==t?"column-table-id":void 0},"#new_tables"!==t&&`${t}:`),(0,e.createElement)("th",{className:"#new_tables"!==t?"column-table-name":void 0},""!==r.trim()?r:(0,s.__)("(no name)","tablepress")),Object.keys(tp.advanced_access_rights.users).map((s=>(0,e.createElement)("td",{key:s,className:"#new_users"===s?"new-users-column":void 0},(0,e.createElement)("input",{type:"checkbox",checked:1===a.map[t][s],onChange:e=>{const r={tableId:l.indexOf(t),userId:o.indexOf(s)};let c=a.lastCheckboxIdx?{...a.lastCheckboxIdx}:null;null!==c&&e.nativeEvent.shiftKey||(c=r);const d={tableId:c.tableId<r.tableId?c.tableId:r.tableId,userId:c.userId<r.userId?c.userId:r.userId},i=r.tableId>c.tableId?r.tableId:c.tableId,u=r.userId>c.userId?r.userId:c.userId,p={...a.map};for(let t=d.tableId;t<=i;t++)for(let s=d.userId;s<=u;s++){const a=l[t],r=o[s];p[a][r]=e.target.checked?1:0}n({map:p}),n({lastCheckboxIdx:r})}}))))))))),(0,e.createElement)("p",null,(0,e.createElement)("input",{ref:t,type:"button",id:"tablepress-advanced-access-rights-save-changes",className:"button button-primary button-large button-save-changes",value:(0,s.__)("Save Changes","tablepress"),"data-shortcut":(0,s._x)("%1$sS","keyboard shortcut for Save Changes","tablepress"),onClick:e=>c(e.target.parentNode,a)})))}),null))})();