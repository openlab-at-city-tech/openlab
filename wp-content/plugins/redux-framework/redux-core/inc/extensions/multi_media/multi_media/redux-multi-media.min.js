!function(x){"use strict";var p;redux.field_objects=redux.field_objects||{},redux.field_objects.multi_media=redux.field_objects.multi_media||{},redux.field_objects.multi_media.init=function(e){e=e||x(document).find(".redux-group-tab:visible").find(".redux-container-multi_media:visible"),x(e).each(function(){var e=x(this),i=e;(i=e.hasClass("redux-field-container")?i:e.parents(".redux-field-container:first")).is(":hidden")||i.hasClass("redux-field-init")&&(i.removeClass("redux-field-init"),redux.field_objects.multi_media.bindDelete(e),e.find(".redux_upload_button").off().on("click",function(e){redux.field_objects.multi_media.addFile(e,x(this).parents("fieldset.redux-field:first"),x(this))}),redux.field_objects.multi_media.modInit(e))})},redux.field_objects.multi_media.bindDelete=function(e){e.find(".redux_remove_file_button").off("click").on("click",function(e){redux.field_objects.multi_media.removeFile(e,x(this).parents("fieldset.redux-field:first"),x(this))})},redux.field_objects.multi_media.modInit=function(){p=redux_multi_media_l10},redux.field_objects.multi_media.removeErrMsgs=function(e){x("#"+e+" .attach_list li.redux-file-exists").each(function(e,i){x(i).remove()}),x("#"+e+" .attach_list li.redux-max-limit").each(function(e,i){x(i).remove()})},redux.field_objects.multi_media.selExists=function(e,t){var l=!1;return x("#"+e+" .attach_list li").each(function(e,i){if(0!==x(i).find("input#filelist-"+t).length)return!(l=!0)}),l},redux.field_objects.multi_media.addFile=function(e,r,i){var u,t,o,f=!0,c=i.prev("input").attr("id"),m=x("#"+c),_=m.attr("name"),h=r.attr("data-id");e.preventDefault(),redux.field_objects.multi_media.removeErrMsgs(h),i=x(r).find(".library-filter").data("lib-filter"),o=x(r).find(".redux-multi-media-container").data("max-file-upload"),void 0!==i&&""!==i&&(t=[],i=decodeURIComponent(i),i=JSON.parse(i),x.each(i,function(e,i){t.push(i)})),(u=wp.media({multiple:!0,title:p.title,library:{type:t},button:{text:p.upload_file}})).on("select",function(){var t,i=0,l=[],d=[],s=[],a=[],e=u.state().get("selection").toJSON(),n=x("#"+h+" .attach_list").children().length;m.val(e.url),x("#"+c+"_id").val(e.id),x(e).each(function(){var e;return o<=0||i+n<o?redux.field_objects.multi_media.selExists(h,this.id)?(e=(e=p.dup_warn).replace("%s","<strong>"+this.filename+"</strong>"),f='<li class="redux-file-exists">'+e+"</li>",a.push(f),!(t=!1)):(this.type&&"image"===this.type?(f='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="redux_remove_file_button" rel="'+c+"["+this.id+']">'+p.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+_+"["+this.id+']" value="'+this.url+'"></li>',s.push(f),t=!0):(f="<li>"+p.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+p.download+'</a> / <a href="#" class="redux_remove_file_button" rel="'+c+"["+this.id+']">'+p.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+_+"["+this.id+']" value="'+this.url+'"></li>',d.push(f)),void i++):(e=(e=p.max_warn).replace("%s","<strong>"+o+"</strong>"),f='<li class="redux-max-limit">'+e+"</li>",a.push(f),!1)}),x.isEmptyObject(s)||x(s).each(function(e,i){l.push(i),t=!0}),x.isEmptyObject(d)||x(d).each(function(e,i){l.push(i),t=!0}),x.isEmptyObject(a)||x(a).each(function(e,i){l.push(i)}),x(l).each(function(){m.siblings(".redux_media_status").slideDown().append(this)}),u.close(),!0===t&&(redux.field_objects.multi_media.bindDelete(r),redux_change(x(r).find(".redux_media_status")))}),u.open()},redux.field_objects.multi_media.removeFile=function(e,i,t){var l;return e.preventDefault(),t.is(".attach_list .redux_remove_file_button")?(t.parents("li").remove(),redux_change(x(i).find(".redux_media_status"))):(e=t.attr("rel"),l=t.parents(".img_status"),i.find("input#"+e).val(""),i.find("input#"+e+"_id").val(""),(l.length?l:t.parents(".redux_media_status")).html("")),!1}}(jQuery);