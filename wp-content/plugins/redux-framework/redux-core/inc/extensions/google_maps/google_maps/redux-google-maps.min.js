!function(b){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.google_maps=redux.field_objects.google_maps||{},redux.field_objects.google_maps.init=function(e){e=e||b(document).find(".redux-group-tab:visible").find(".redux-container-google_maps:visible"),b(e).each(function(e){var o,t=b(this);let n=t;(n=t.hasClass("redux-field-container")?n:t.parents(".redux-field-container:first")).is(":hidden")||n.hasClass("redux-field-init")&&(n.removeClass("redux-field-init"),o=Boolean(t.find(".redux_framework_google_maps").data("delay-render")),redux.field_objects.google_maps.clickHandler(t),redux.field_objects.google_maps.initMap(t,e,o))})},redux.field_objects.google_maps.initMap=async function(a,e,o){let l,d,s,t,r,i,g,m,c,n=!1;const p=a.find(".redux_framework_google_maps"),_=p.attr("id"),u=_+"_autocomplete",f=_+"_map_canvas";var y=b("#"+f),v=_+"_latitude",w=_+"_longitude";b(p).attr("data-idx",e),!0===o||b("#"+_).hasClass("rendered")||(!0===Boolean(p.data("delay-render"))&&p.addClass("rendered"),g=await google.maps.importLibrary("places"),g=new google.maps.places.Autocomplete(document.getElementById(u),{types:["geocode"]}),l=Boolean(p.data("scroll-wheel")),d=Boolean(p.data("street-view")),s=Boolean(p.data("map-type")),t=p.data("address"),t=(t=decodeURIComponent(t)).trim(),e=y.data("default-lat"),o=y.data("default-long"),r=y.data("default-zoom"),""!==t?""!==e&&""!==o||(n=!0):n=!1,e=e||39.11676722061108,o=o||-100.47761000000003,n?(new google.maps.Geocoder).geocode({address:t},function(e,o){var t,n;o===google.maps.GeocoderStatus.OK?(m=e[0].geometry.location,i={center:m,zoom:r,streetViewControl:d,mapTypeControl:s,scrollwheel:l,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},mapId:"REDUX_GOOGLE_MAPS"},c=new google.maps.Map(document.getElementById(f),i),(t=a.find("#"+_+"_latitude")).val(e[0].geometry.location.lat()),(n=a.find("#"+_+"_longitude")).val(e[0].geometry.location.lng()),redux.field_objects.google_maps.renderControls(a,t,n,g,c,u,p,m,_)):alert("Geocode was not successful for the following reason: "+o)}):(m=new google.maps.LatLng(e,o),i={center:m,zoom:r,streetViewControl:d,mapTypeControl:s,scrollwheel:l,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},mapId:"REDUX_GOOGLE_MAPS"},c=new google.maps.Map(document.getElementById(f),i),redux.field_objects.google_maps.renderControls(a,v,w,g,c,u,p,m,_)))},redux.field_objects.google_maps.renderControls=function(n,a,l,d,s,e,r,i,o){let g,m,c=r.data("geo-alert");var e=document.getElementById(e);s.controls[google.maps.ControlPosition.TOP_LEFT].push(e),(d=new google.maps.places.Autocomplete(e)).bindTo("bounds",s),e=r.data("marker-tooltip"),e=decodeURIComponent(e),g=new google.maps.InfoWindow,m=new google.maps.Marker({position:i,map:s,anchorPoint:new google.maps.Point(0,-29),draggable:!0,title:e,animation:google.maps.Animation.DROP}),c=decodeURIComponent(c),google.maps.event.addListener(d,"place_changed",function(){var e,o;let t;g.close(),(e=d.getPlace()).geometry?(console.log(e.geometry.viewport),e.geometry.viewport?s.fitBounds(e.geometry.viewport):(s.setCenter(e.geometry.location),s.setZoom(17)),o=r.data("marker-tooltip"),o=decodeURIComponent(o),(m=new google.maps.Marker({position:i,map:s,anchorPoint:new google.maps.Point(0,-29),title:o,clickable:!0,draggable:!0,animation:google.maps.Animation.DROP})).setPosition(e.geometry.location),m.setVisible(!0),t="",e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),g.setContent("<div><strong>"+e.name+"</strong><br>"+t),g.open(s,m),redux.field_objects.google_maps.geoLocate(d),redux.field_objects.google_maps.fillInAddress(n,a,l,d)):window.alert(c)}),google.maps.event.addListener(m,"drag",function(e){document.getElementById(a).value=e.latLng.lat(),document.getElementById(l).value=e.latLng.lng()}),google.maps.event.addListener(m,"dragend",function(){redux_change(n.find(".redux_framework_google_maps"))}),s.addListener("zoom_changed",function(){n.find(".google_m_zoom_input").val(s.getZoom())}),g=new google.maps.InfoWindow,google.maps.event.addListener(m,"click",function(){var e=document.getElementById(o+"_marker_info").value;""!==e&&(g.setContent(e),g.open(s,m))})},redux.field_objects.google_maps.fillInAddress=function(e,o,t,n){var a,l,d,s=e.find(".redux_framework_google_maps").attr("id"),r={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"},i=n.getPlace();let g,m;for(g in document.getElementById(o).value=i.geometry.location.lat(),document.getElementById(t).value=i.geometry.location.lng(),r)r.hasOwnProperty(g)&&(g=s+"_"+g,document.getElementById(g).value="",document.getElementById(g).disabled=!1);for(d=i.address_components.length,m=0;m<d;m+=1)r[a=i.address_components[m].types[0]]&&(l=i.address_components[m][r[a]],document.getElementById(s+"_"+a).value=l)},redux.field_objects.google_maps.geoLocate=function(t){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o=new google.maps.Circle({center:o,radius:e.coords.accuracy});t.setBounds(o.getBounds())})},redux.field_objects.google_maps.clickHandler=function(o){o.find(".google_m_api_key_button").on("click",function(){var e=o.find(".google_m_api_key_wrapper");e.is(":visible")?e.slideUp("fast",function(){o.find("#google_m_api_key_input").trigger("focus")}):e.slideDown("medium",function(){o.find("#google_m_api_key_input").trigger("focus")})}),o.find(".google_m_autocomplete").on("keypress",function(e){13===e.keyCode&&e.preventDefault()}),o.find(".google_m_autocomplete").on("click",function(e){b(this).trigger("focus"),b(this).trigger("select"),e.preventDefault()})}}(jQuery);