{"version":3,"file":"./blocks/image/interactivity.min.js","mappings":"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","sources":["webpack://wp/./packages/block-library/src/image/interactivity.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { store } from '../utils/interactivity';\n\nconst focusableSelectors = [\n\t'a[href]',\n\t'area[href]',\n\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])',\n\t'select:not([disabled]):not([aria-hidden])',\n\t'textarea:not([disabled]):not([aria-hidden])',\n\t'button:not([disabled]):not([aria-hidden])',\n\t'iframe',\n\t'object',\n\t'embed',\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n];\n\nstore( {\n\tactions: {\n\t\tcore: {\n\t\t\timage: {\n\t\t\t\tshowLightbox: ( { context, event } ) => {\n\t\t\t\t\tcontext.core.image.initialized = true;\n\t\t\t\t\tcontext.core.image.lastFocusedElement =\n\t\t\t\t\t\twindow.document.activeElement;\n\t\t\t\t\tcontext.core.image.scrollDelta = 0;\n\n\t\t\t\t\t// Since the img is hidden and its src not loaded until\n\t\t\t\t\t// the lightbox is opened, let's create an img element on the fly\n\t\t\t\t\t// so we can get the dimensions we need to calculate the styles\n\t\t\t\t\tconst imgDom = document.createElement( 'img' );\n\n\t\t\t\t\timgDom.onload = function () {\n\t\t\t\t\t\t// Enable the lightbox only after the image\n\t\t\t\t\t\t// is loaded to prevent flashing of unstyled content\n\t\t\t\t\t\tcontext.core.image.lightboxEnabled = true;\n\t\t\t\t\t\tif ( context.core.image.lightboxAnimation === 'zoom' ) {\n\t\t\t\t\t\t\tsetZoomStyles( imgDom, context, event );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Hide overflow only when the animation is in progress,\n\t\t\t\t\t\t// otherwise the removal of the scrollbars will draw attention\n\t\t\t\t\t\t// to itself and look like an error\n\t\t\t\t\t\tdocument.documentElement.classList.add(\n\t\t\t\t\t\t\t'has-lightbox-open'\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\t\t\t\t\timgDom.setAttribute( 'src', context.core.image.imageSrc );\n\t\t\t\t},\n\t\t\t\thideLightbox: async ( { context, event } ) => {\n\t\t\t\t\tcontext.core.image.hideAnimationEnabled = true;\n\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\t// If scrolling, wait a moment before closing the lightbox.\n\t\t\t\t\t\tif ( context.core.image.lightboxAnimation === 'fade' ) {\n\t\t\t\t\t\t\tcontext.core.image.scrollDelta += event.deltaY;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tevent.type === 'mousewheel' &&\n\t\t\t\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t\t\t\twindow.scrollY -\n\t\t\t\t\t\t\t\t\t\tcontext.core.image.scrollDelta\n\t\t\t\t\t\t\t\t) < 10\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\tcontext.core.image.lightboxAnimation === 'zoom'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Disable scroll until the zoom animation ends.\n\t\t\t\t\t\t\t// Get the current page scroll position\n\t\t\t\t\t\t\tconst scrollTop =\n\t\t\t\t\t\t\t\twindow.pageYOffset ||\n\t\t\t\t\t\t\t\tdocument.documentElement.scrollTop;\n\t\t\t\t\t\t\tconst scrollLeft =\n\t\t\t\t\t\t\t\twindow.pageXOffset ||\n\t\t\t\t\t\t\t\tdocument.documentElement.scrollLeft;\n\t\t\t\t\t\t\t// if any scroll is attempted, set this to the previous value.\n\t\t\t\t\t\t\twindow.onscroll = function () {\n\t\t\t\t\t\t\t\twindow.scrollTo( scrollLeft, scrollTop );\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t// Enable scrolling after the animation finishes\n\t\t\t\t\t\t\tsetTimeout( function () {\n\t\t\t\t\t\t\t\twindow.onscroll = function () {};\n\t\t\t\t\t\t\t}, 400 );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.documentElement.classList.remove(\n\t\t\t\t\t\t\t'has-lightbox-open'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tcontext.core.image.lightboxEnabled = false;\n\t\t\t\t\t\tcontext.core.image.lastFocusedElement.focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandleKeydown: ( { context, actions, event } ) => {\n\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\tif ( event.key === 'Tab' || event.keyCode === 9 ) {\n\t\t\t\t\t\t\t// If shift + tab it change the direction\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tevent.shiftKey &&\n\t\t\t\t\t\t\t\twindow.document.activeElement ===\n\t\t\t\t\t\t\t\t\tcontext.core.image.firstFocusableElement\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\tcontext.core.image.lastFocusableElement.focus();\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t! event.shiftKey &&\n\t\t\t\t\t\t\t\twindow.document.activeElement ===\n\t\t\t\t\t\t\t\t\tcontext.core.image.lastFocusableElement\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\tcontext.core.image.firstFocusableElement.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( event.key === 'Escape' || event.keyCode === 27 ) {\n\t\t\t\t\t\t\tactions.core.image.hideLightbox( {\n\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\tselectors: {\n\t\tcore: {\n\t\t\timage: {\n\t\t\t\troleAttribute: ( { context } ) => {\n\t\t\t\t\treturn context.core.image.lightboxEnabled ? 'dialog' : '';\n\t\t\t\t},\n\t\t\t\timageSrc: ( { context } ) => {\n\t\t\t\t\treturn context.core.image.initialized\n\t\t\t\t\t\t? context.core.image.imageSrc\n\t\t\t\t\t\t: '';\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\teffects: {\n\t\tcore: {\n\t\t\timage: {\n\t\t\t\tinitLightbox: async ( { context, ref } ) => {\n\t\t\t\t\tcontext.core.image.figureRef =\n\t\t\t\t\t\tref.querySelector( 'figure' );\n\t\t\t\t\tcontext.core.image.imageRef = ref.querySelector( 'img' );\n\t\t\t\t\tif ( context.core.image.lightboxEnabled ) {\n\t\t\t\t\t\tconst focusableElements =\n\t\t\t\t\t\t\tref.querySelectorAll( focusableSelectors );\n\t\t\t\t\t\tcontext.core.image.firstFocusableElement =\n\t\t\t\t\t\t\tfocusableElements[ 0 ];\n\t\t\t\t\t\tcontext.core.image.lastFocusableElement =\n\t\t\t\t\t\t\tfocusableElements[ focusableElements.length - 1 ];\n\n\t\t\t\t\t\tref.querySelector( '.close-button' ).focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n} );\n\nfunction setZoomStyles( imgDom, context, event ) {\n\tlet targetWidth = imgDom.naturalWidth;\n\tlet targetHeight = imgDom.naturalHeight;\n\n\tconst verticalPadding = 40;\n\n\t// As per the design, let's allow the image to stretch\n\t// to the full width of its containing figure, but for the height,\n\t// constrain it with a fixed padding\n\tconst containerWidth = context.core.image.figureRef.clientWidth;\n\n\t// The lightbox image has `positione:absolute` and\n\t// ignores its parent's padding, so let's set the padding here,\n\t// to be used when calculating the image width and positioning\n\tlet horizontalPadding = 0;\n\tif ( containerWidth > 480 ) {\n\t\thorizontalPadding = 40;\n\t} else if ( containerWidth > 1920 ) {\n\t\thorizontalPadding = 80;\n\t}\n\n\tconst containerHeight =\n\t\tcontext.core.image.figureRef.clientHeight - verticalPadding * 2;\n\n\t// Check difference between the image and figure dimensions\n\tconst widthOverflow = Math.abs(\n\t\tMath.min( containerWidth - targetWidth, 0 )\n\t);\n\tconst heightOverflow = Math.abs(\n\t\tMath.min( containerHeight - targetHeight, 0 )\n\t);\n\n\t// If image is larger than its container any dimension, resize along its largest axis.\n\t// For vertically oriented devices, always maximize the width.\n\tif ( widthOverflow > 0 || heightOverflow > 0 ) {\n\t\tif (\n\t\t\twidthOverflow >= heightOverflow ||\n\t\t\tcontainerHeight >= containerWidth\n\t\t) {\n\t\t\ttargetWidth = containerWidth - horizontalPadding * 2;\n\t\t\ttargetHeight =\n\t\t\t\timgDom.naturalHeight * ( targetWidth / imgDom.naturalWidth );\n\t\t} else {\n\t\t\ttargetHeight = containerHeight;\n\t\t\ttargetWidth =\n\t\t\t\timgDom.naturalWidth * ( targetHeight / imgDom.naturalHeight );\n\t\t}\n\t}\n\n\t// The reference img element lies adjacent to the event target button in the DOM\n\tconst { x: originLeft, y: originTop } =\n\t\tevent.target.nextElementSibling.getBoundingClientRect();\n\tconst scaleWidth =\n\t\tevent.target.nextElementSibling.offsetWidth / targetWidth;\n\tconst scaleHeight =\n\t\tevent.target.nextElementSibling.offsetHeight / targetHeight;\n\n\t// Get values used to center the image\n\tlet targetLeft = 0;\n\tif ( targetWidth >= containerWidth ) {\n\t\ttargetLeft = horizontalPadding;\n\t} else {\n\t\ttargetLeft = ( containerWidth - targetWidth ) / 2;\n\t}\n\tlet targetTop = 0;\n\tif ( targetHeight >= containerHeight ) {\n\t\ttargetTop = verticalPadding;\n\t} else {\n\t\ttargetTop = ( containerHeight - targetHeight ) / 2 + verticalPadding;\n\t}\n\n\tconst root = document.documentElement;\n\troot.style.setProperty( '--lightbox-scale-width', scaleWidth );\n\troot.style.setProperty( '--lightbox-scale-height', scaleHeight );\n\troot.style.setProperty( '--lightbox-image-max-width', targetWidth + 'px' );\n\troot.style.setProperty(\n\t\t'--lightbox-image-max-height',\n\t\ttargetHeight + 'px'\n\t);\n\troot.style.setProperty(\n\t\t'--lightbox-initial-left-position',\n\t\toriginLeft + 'px'\n\t);\n\troot.style.setProperty(\n\t\t'--lightbox-initial-top-position',\n\t\toriginTop + 'px'\n\t);\n\troot.style.setProperty(\n\t\t'--lightbox-target-left-position',\n\t\ttargetLeft + 'px'\n\t);\n\troot.style.setProperty(\n\t\t'--lightbox-target-top-position',\n\t\ttargetTop + 'px'\n\t);\n}\n"],"names":["focusableSelectors","store","actions","core","image","showLightbox","context","event","initialized","lastFocusedElement","window","document","activeElement","scrollDelta","imgDom","createElement","onload","lightboxEnabled","lightboxAnimation","targetWidth","naturalWidth","targetHeight","naturalHeight","containerWidth","figureRef","clientWidth","horizontalPadding","containerHeight","clientHeight","verticalPadding","widthOverflow","Math","abs","min","heightOverflow","x","originLeft","y","originTop","target","nextElementSibling","getBoundingClientRect","scaleWidth","offsetWidth","scaleHeight","offsetHeight","targetLeft","targetTop","root","documentElement","style","setProperty","setZoomStyles","classList","add","setAttribute","imageSrc","hideLightbox","async","hideAnimationEnabled","deltaY","type","scrollY","scrollTop","pageYOffset","scrollLeft","pageXOffset","onscroll","scrollTo","setTimeout","remove","focus","handleKeydown","key","keyCode","shiftKey","firstFocusableElement","preventDefault","lastFocusableElement","selectors","roleAttribute","effects","initLightbox","ref","querySelector","imageRef","focusableElements","querySelectorAll","length"],"sourceRoot":""}