window.GFDropboxSettings=null,function(i){GFDropboxSettings=function(){var e=this;this.legacyUI=!i("#customAppKey").parent().hasClass("gform-settings-input__container"),this.init=function(){this.initialValues={appKey:this.getAppKey(),appSecret:this.getAppSecret()},this.pageURL=gform_dropbox_pluginsettings_strings.settings_url,this.bindAppKeyUpdate(),this.bindDeauthorize(),this.bindDisableCustomApp(),this.bindEnableCustomApp(),this.setupValidationIcons(),this.checkAppKeyValidity(),i("#tab_gravityformsdropbox #gform-settings-save").hide()},this.bindAppKeyUpdate=function(){i("input#customAppKey, input#customAppSecret").on("keyup",this.clearIcons),i("input#customAppKey, input#customAppSecret").on("blur",this.checkAppKeyValidity)},this.clearIcons=function(){e.legacyUI?i("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid"):(i("#gform_setting_customAppKey .gform-settings-input__container").removeClass("gform-settings-input__container--feedback-success gform-settings-input__container--feedback-error"),i("#gform_setting_customAppSecret .gform-settings-input__container").removeClass("gform-settings-input__container--feedback-success gform-settings-input__container--feedback-error"))},this.bindDeauthorize=function(){i("#gform_dropbox_deauth_button").on("click",function(t){t.preventDefault(),i(this).attr("disabled","disabled"),i.ajax({async:!1,url:ajaxurl,dataType:"json",data:{action:"gfdropbox_deauthorize",nonce:gform_dropbox_pluginsettings_strings.nonce_deauthorize},success:function(t){t.success||401===t.data.code?window.location.href=e.pageURL:alert(t.data.message),i(this).removeAttr("disabled")}})})},this.bindDisableCustomApp=function(){i("#gform_dropbox_disable_customApp").on("click",function(t){t.preventDefault(),i("input#customAppEnable").val(""),i("#gform-settings-save").trigger("click")})},this.bindEnableCustomApp=function(){i("#gform_dropbox_enable_customApp").on("click",function(t){t.preventDefault(),i("input#customAppEnable").val("1"),i("#gform-settings-save").trigger("click")})},this.checkAppKeyValidity=function(){e.resetAppKeyStatus(),i.ajax({url:ajaxurl,dataType:"json",type:"GET",data:{action:"gfdropbox_valid_app_key_secret",app_key:e.getAppKey(),app_secret:e.getAppSecret(),nonce:gform_dropbox_pluginsettings_strings.nonce_validation},success:function(t){t.success?(e.setAppKeyStatus(t.success,t.data.auth_url,t.data),e.lockAppKeyFields(!1)):(e.lockAppKeyFields(!1),e.setAppKeyStatus(t.success,null,t.data))}})},this.getAppKey=function(){return i("input#customAppKey").val()},this.getAppSecret=function(){return i("input#customAppSecret").val()},this.lockAppKeyFields=function(t){i("input#customAppKey, input#customAppSecret").prop("disabled",t)},this.resetAppKeyStatus=function(){this.legacyUI?i("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid"):i("#gform_setting_customAppKey .gform-settings-field__feedback, #gform_setting_customAppSecret .gform-settings-field__feedback").removeClass("gform-settings-field__feedback--valid gform-settings-field__feedback--invalid")},this.setAppKeyStatus=function(t,e,s){void 0!==s&&null!==s.valid_key&&null!==s.valid_secret&&(s.valid_secret&&(this.legacyUI?i("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-check fa-check gf_valid"):(i("#gform_setting_customAppKey .gform-settings-input__container").addClass("gform-settings-input__container--feedback-success"),i("#gform_setting_customAppSecret .gform-settings-input__container").addClass("gform-settings-input__container--feedback-success")),i("#gform_dropbox_auth_message").hide(),i("#gform_dropbox_auth_button").show(),i("#gform_dropbox_auth_button").attr("href",e)),s.valid_key&&!s.valid_secret&&(this.legacyUI?(i("#gaddon-setting-row-customAppKey .fa").addClass("icon-check fa-check gf_valid"),i("#gaddon-setting-row-customAppSecret .fa").addClass("icon-remove fa-times gf_invalid")):(i("#gform_dropbox_auth_message").show(),i("#gform_dropbox_auth_button").hide(),i("#gform_setting_customAppKey .gform-settings-input__container").addClass("gform-settings-input__container--feedback-success"),i("#gform_setting_customAppSecret .gform-settings-input__container").addClass("gform-settings-input__container--feedback-error"))),!1!==s.valid_key&&null!==s.valid_key||(this.legacyUI?i("#gaddon-setting-row-customAppKey .fa").addClass("icon-remove fa-times gf_invalid"):i("#gform_setting_customAppKey .gform-settings-input__container").addClass("gform-settings-input__container--feedback-error")),!1!==t&&null!==t||(i("#gform_dropbox_auth_message").show(),i("#gform_dropbox_auth_button").hide()))},this.setupValidationIcons=function(){0==i("#gaddon-setting-row-customAppKey .fa").length&&(this.legacyUI?i(' <i class="fa"></i>'):i('<span class="gform-settings-field__feedback" aria-hidden="true"></span>')).insertAfter(i("#customAppKey")),0==i("#gaddon-setting-row-customAppSecret .fa").length&&(this.legacyUI?i(' <i class="fa"></i>'):i('<span class="gform-settings-field__feedback" aria-hidden="true"></span>')).insertAfter(i("#customAppSecret"))},this.init()},i(document).ready(GFDropboxSettings)}(jQuery);