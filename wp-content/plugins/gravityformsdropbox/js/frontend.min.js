window.GFDropbox=null,function(n){GFDropbox=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);var r=this;this.fieldUniqueIdentifier=this.formId+"_"+this.inputId,this.init=function(){this.createDropboxButton(),this.refreshPreview(),this.setupPreviewBind()},this.createDropboxButton=function(){var e=Dropbox.createChooseButton({extensions:this.extensions,linkType:this.linkType,multiselect:this.multiselect,success:this.uploadHandler}),e=(document.querySelector("#field_"+this.fieldUniqueIdentifier+" .ginput_container").prepend(e),n("label[for=input_"+this.fieldUniqueIdentifier+"]").attr("id","input_"+this.fieldUniqueIdentifier+"_label"),"input_"+this.fieldUniqueIdentifier+"_label ");e+=jQuery("#input_"+this.fieldUniqueIdentifier).attr("aria-describedby"),jQuery("#input_"+this.fieldUniqueIdentifier).removeAttr("aria-describedby"),jQuery("#field_"+this.fieldUniqueIdentifier+" .dropbox-dropin-btn").attr("aria-describedby",e)},this.getFieldValue=function(){var e=document.getElementById("input_"+this.fieldUniqueIdentifier).value||[];try{return e?JSON.parse(e):[]}catch(e){return[]}},this.getFileName=function(e){return e.split("/").pop().split("?dl=").shift()},this.refreshPreview=function(){var e=document.getElementById("gform_preview_"+this.fieldUniqueIdentifier),t=r.getFieldValue();for(e.innerHTML="",i=0;i<t.length;i++){var n=decodeURIComponent(this.getFileName(t[i]));html='<div aria-live="assertive" aria-atomic="true" class="ginput_preview">',html=(html+='<input aria-label="Delete file'+n+'" tabindex="0" type="button" class="gform_delete"  id="gfrom_dropbox_filename_'+i+'" data-file="'+n+'" >')+('<label for="gfrom_dropbox_filename_'+i+'" tabindex="0">'+n+"</label>")+"</div>",e.innerHTML+=html}jQuery(document).on("click",".gdropbox_preview .gform_delete + label",function(e){e.preventDefault(),e.stopImmediatePropagation()})},this.removeFile=function(e){var t=this.getFieldValue();for(i=0;i<t.length;i++){var n=this.getFileName(t[i]);decodeURIComponent(n)===e&&t.splice(i,1)}this.setFieldValue(t),this.refreshPreview()},this.setFieldValue=function(e){e=e.length?JSON.stringify(e):"",document.getElementById("input_"+this.fieldUniqueIdentifier).value=e},this.setupPreviewBind=function(){var e=n("#gform_preview_"+this.fieldUniqueIdentifier);n(e).on("click",".ginput_preview .gform_delete",function(){r.removeFile(n(this).attr("data-file"))})},this.uploadHandler=function(e){var t=r.getFieldValue()&&r.multiselect?r.getFieldValue():[];for(i=0;i<e.length;i++)t.push(e[i].link);r.setFieldValue(t),r.refreshPreview()},this.init()}}(jQuery);