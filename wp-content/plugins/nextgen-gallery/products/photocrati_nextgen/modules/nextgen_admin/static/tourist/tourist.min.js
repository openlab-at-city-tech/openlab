"use strict";!function(u){function t(t,e){for(var o in e)s.call(e,o)&&(t[o]=e[o]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}function e(t,e){return function(){return t.apply(e,arguments)}}var n,o,s={}.hasOwnProperty;function i(){return i.__super__.constructor.apply(this,arguments)}function r(t){this.options=null!=t?t:{},this.onClickNext=e(this.onClickNext,this),this.onClickClose=e(this.onClickClose,this),this.el=u("<div/>"),this.initialize(t),this._bindClickEvents(),Tourist.Tip.Base._cacheTip(this)}function p(){return p.__super__.constructor.apply(this,arguments)}function h(t){this.options=_.extend({offset:10,tipOffset:10},t),this.el=u(u.parseHTML(this.template)),this.hide()}function l(){return this._renderTipBackground=e(this._renderTipBackground,this),l.__super__.constructor.apply(this,arguments)}function a(){return a.__super__.constructor.apply(this,arguments)}function c(t){this.options=null!=t?t:{},this.onChangeCurrentStep=e(this.onChangeCurrentStep,this),this.next=e(this.next,this),this.options=_.extend({tipClass:"Bootstrap"},this.options),this.model=new Tourist.Model({current_step:null}),t=_.extend({model:this.model},this.options.tipOptions),this.view=new Tourist.Tip[this.options.tipClass](t),this.view.bind("click:close",_.bind(this.stop,this,!0)),this.view.bind("click:next",this.next),this.model.bind("change:current_step",this.onChangeCurrentStep)}window.Tourist=window.Tourist||{},Tourist.Model=(o=Backbone.Model,t(i,o),i.prototype._module="Tourist",i),window.Tourist.Tip=window.Tourist.Tip||{},Tourist.Tip.Base=(r.prototype._module="Tourist",_.extend(r.prototype,Backbone.Events),r.prototype.skipButtonTemplate='<button class="btn btn-default btn-sm pull-right tour-next">Skip this step →</button>',r.prototype.nextButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Next step →</button>',r.prototype.finalButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Finish up</button>',r.prototype.closeButtonTemplate='<a class="btn btn-close tour-close" href="#"><i class="icon icon-remove"></i></a>',r.prototype.okButtonTemplate='<button class="btn btn-sm tour-close btn-primary">Okay</button>',r.prototype.actionLabelTemplate=_.template('<h4 class="action-label"><%= label %></h4>'),r.prototype.actionLabels=["Do this:","Then this:","Next this:"],r.prototype.highlightClass="tour-highlight",r.prototype.template=_.template('<div>\n  <div class="tour-container">\n    <%= close_button %>\n    <%= content %>\n    <p class="tour-counter <%= counter_class %>"><%= counter%></p>\n  </div>\n  <div class="tour-buttons">\n    <%= buttons %>\n  </div>\n</div>'),r.prototype.destroy=function(){return this.el.remove()},r.prototype.render=function(t){return this.hide(),t&&(this._setTarget(t.target||!1,t),this._setZIndex(""),this._renderContent(t,this._buildContentElement(t)),t.target&&this.show(),t.zIndex)&&this._setZIndex(t.zIndex,t),this},r.prototype.show=function(){},r.prototype.hide=function(){},r.prototype.setTarget=function(t,e){return this._setTarget(t,e)},r.prototype.cleanupCurrentTarget=function(){return this.target&&this.target.removeClass&&this.target.removeClass(this.highlightClass),this.target=null},r.prototype.onClickClose=function(t){return this.trigger("click:close",this,t),!1},r.prototype.onClickNext=function(t){return this.trigger("click:next",this,t),!1},r.prototype._getTipElement=function(){},r.prototype._renderContent=function(t,e){},r.prototype._bindClickEvents=function(){var t=this._getTipElement();return t.on("click",".tour-close",this.onClickClose),t.on("click",".tour-next",this.onClickNext)},r.prototype._setTarget=function(t,e){return this.cleanupCurrentTarget(),t&&e&&e.highlightTarget&&t.addClass(this.highlightClass),this.target=t},r.prototype._setZIndex=function(t){return this._getTipElement().css("z-index",t||"")},r.prototype._buildContentElement=function(t){var e=this._buildButtons(t),t=u(u.parseHTML(this.template({content:t.content,buttons:e,close_button:this._buildCloseButton(t),counter:t.final?"":"step "+(t.index+1)+" of "+t.total,counter_class:t.final?"final":""})));return e||t.find(".tour-buttons").addClass("no-buttons"),this._renderActionLabels(t),t},r.prototype._buildButtons=function(t){var e="";return t.okButton&&(e+=this.okButtonTemplate),t.skipButton&&(e+=this.skipButtonTemplate),t.nextButton&&(e+=t.final?this.finalButtonTemplate:this.nextButtonTemplate),e},r.prototype._buildCloseButton=function(t){return t.closeButton?this.closeButtonTemplate:""},r.prototype._renderActionLabels=function(t){for(var e,o=t.find(".action"),i=0,s=[],n=0,r=o.length;n<r;n++)e=o[n],u(u.parseHTML(this.actionLabelTemplate({label:this.actionLabels[i]}))).insertBefore(e),s.push(i++);return s},r._cacheTip=function(t){return Tourist.Tip.Base._cachedTips||(Tourist.Tip.Base._cachedTips=[]),Tourist.Tip.Base._cachedTips.push(t)},r.destroy=function(){var t,e,o;if(Tourist.Tip.Base._cachedTips){for(t=0,e=(o=Tourist.Tip.Base._cachedTips).length;t<e;t++)o[t].destroy();return Tourist.Tip.Base._cachedTips=null}},r),Tourist.Tip.Bootstrap=(o=Tourist.Tip.Base,t(p,o),p.prototype.initialize=function(t){return this.options=_.extend({showEffect:null,hideEffect:null},t),this.tip=new Tourist.Tip.BootstrapTip(this.options)},p.prototype.destroy=function(){return this.tip.destroy(),p.__super__.destroy.call(this)},p.prototype.show=function(){return this.options.showEffect?Tourist.Tip.Bootstrap.effects[this.options.showEffect].call(this,this.tip,this.tip.el):this.tip.show()},p.prototype.hide=function(){return this.options.hideEffect?Tourist.Tip.Bootstrap.effects[this.options.hideEffect].call(this,this.tip,this.tip.el):this.tip.hide()},p.prototype._getTipElement=function(){return this.tip.el},p.prototype._setTarget=function(t,e){return p.__super__._setTarget.call(this,t,e),this.tip.setTarget(t)},p.prototype._renderContent=function(t,e){var o=t.my||"left center",i=t.at||"right center";return this.tip.setContainer(t.container||u("body")),this.tip.setContent(e),this.tip.setPosition(t.target||!1,o,i)},p),Tourist.Tip.Bootstrap.effects={slidein:function(t,e){var o,i,s,n,r,p,h={top:80,left:80,right:-80,bottom:-80},t=t.my.split(" ")[0],h=h[t=t||"top"];for("right"===(t="bottom"===t?"top":t)&&(t="left"),n=parseInt(e.css(t)),e.stop(),(o={})[t]=n+h,e.css(o),e.show(),o[t]=n,r=0,p=(s=["easeOutCubic","swing","linear"]).length;r<p&&!u.easing[i=s[r]];r++);return e.animate(o,300,i),null}},Tourist.Tip.BootstrapTip=(h.prototype.template='<div class="popover tourist-popover">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>',h.prototype.FLIP_POSITION={bottom:"top",top:"bottom",left:"right",right:"left"},h.prototype.destroy=function(){return this.el.remove()},h.prototype.show=function(){return this.el.show().addClass("visible")},h.prototype.hide=function(){return this.el.hide().removeClass("visible")},h.prototype.setTarget=function(t){return this.target=t,this._setPosition(this.target,this.my,this.at)},h.prototype.setPosition=function(t,e,o){return this.target=t,this.my=e,this.at=o,this._setPosition(this.target,this.my,this.at)},h.prototype.setContainer=function(t){return t.append(this.el)},h.prototype.setContent=function(t){return this._getContentElement().html(t)},h.prototype._getContentElement=function(){return this.el.find(".popover-content")},h.prototype._getTipElement=function(){return this.el.find(".arrow")},h.prototype._setPosition=function(t,e,o){var i,s,n,r,p;if(null==e&&(e="left center"),null==o&&(o="right center"),t&&(n=(p=e.split(" "))[0],p=p[1],s=this.el.css("display"),this.el.css({top:0,left:0,margin:0,display:"block"}).removeClass("top").removeClass("bottom").removeClass("left").removeClass("right").addClass(this.FLIP_POSITION[n]),t))return n=this._getTipElement().css({left:"",right:"",top:"",bottom:""}),"center"!==p&&(r={left:n[0].offsetWidth/2,right:0,top:n[0].offsetHeight/2,bottom:0},(i={})[p]=r[p]+this.options.tipOffset,i[this.FLIP_POSITION[p]]="auto",n.css(i)),r=this._caculateTargetPosition(o,t),p=this._caculateTipPosition(e,r),n=this._adjustForArrow(e,p),this.el.css(n),this.el.css({display:s})},h.prototype._caculateTargetPosition=function(t,e){return"[object Array]"===Object.prototype.toString.call(e)?{left:e[0],top:e[1]}:(e=this._getTargetBounds(e),t=this._lookupPosition(t,e.width,e.height),{left:e.left+t[0],top:e.top+t[1]})},h.prototype._caculateTipPosition=function(t,e){var o=this.el[0].offsetWidth,i=this.el[0].offsetHeight,t=this._lookupPosition(t,o,i);return{left:e.left-t[0],top:e.top-t[1]}},h.prototype._adjustForArrow=function(t,e){var t=t.split(" "),o=t[0],t=t[1],i=this._getTipElement(),s=i[0].offsetWidth,n=i[0].offsetHeight,r={top:e.top,left:e.left};switch(o){case"top":r.top+=n+this.options.offset;break;case"bottom":r.top-=n+this.options.offset;break;case"left":r.left+=s+this.options.offset;break;case"right":r.left-=s+this.options.offset}switch(t){case"left":r.left-=s/2+this.options.tipOffset;break;case"right":r.left+=s/2+this.options.tipOffset;break;case"top":r.top-=n/2+this.options.tipOffset;break;case"bottom":r.top+=n/2+this.options.tipOffset}return r},h.prototype._lookupPosition=function(t,e,o){var i=e/2,s=o/2;return{"top left":[0,0],"left top":[0,0],"top right":[e,0],"right top":[e,0],"bottom left":[0,o],"left bottom":[0,o],"bottom right":[e,o],"right bottom":[e,o],"top center":[i,0],"left center":[0,s],"right center":[e,s],"bottom center":[i,o]}[t]},h.prototype._getTargetBounds=function(t){var e=t[0],e="function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight};return u.extend({},e,t.offset())},h),Tourist.Tip.QTip=(o=Tourist.Tip.Base,t(l,o),l.prototype.QTIP_DEFAULTS={content:{text:" "},show:{ready:!(n={top:80,left:80,right:-80,bottom:-80}),delay:0,effect:function(t){var e,o,i,s=u(this),t=t.options.position.my;return t=t&&t[t.precedance],o=n[t=t||"top"],"right"===(t="bottom"===t?"top":t)&&(t="left"),i=parseInt(s.css(t)),(e={})[t]=i+o,s.css(e),s.show(),e[t]=i,s.animate(e,300,"easeOutCubic"),null},autofocus:!10},hide:{event:null,delay:0,effect:!14},position:{adjust:{method:"shift shift",scroll:!6}},style:{classes:"ui-tour-tip",tip:{height:6,width:14}},events:{},zindex:2e3},l.prototype.initialize=function(t){return t=u.extend(!0,{},this.QTIP_DEFAULTS,t),this.el.qtip(t),this.qtip=this.el.qtip("api"),this.qtip.render()},l.prototype.destroy=function(){return this.qtip&&this.qtip.destroy(),l.__super__.destroy.call(this)},l.prototype.show=function(){return this.qtip.show()},l.prototype.hide=function(){return this.qtip.hide()},l.prototype._getTipElement=function(){return u("#qtip-"+this.qtip.id)},l.prototype._setTarget=function(t,e){return l.__super__._setTarget.call(this,t,e),this.qtip.set("position.target",t||!1)},l.prototype._renderContent=function(t,e){var o=this,i=t.my||"left center",s=t.at||"right center";return this._adjustPlacement(i,s),this.qtip.set("content.text",e),this.qtip.set("position.container",t.container||u("body")),this.qtip.set("position.my",i),this.qtip.set("position.at",s),this.qtip.set("position.viewport",t.viewport||!1),this.qtip.set("position.target",t.target||!1),setTimeout(function(){return o._renderTipBackground(i.split(" ")[0])},10)},l.prototype._adjustPlacement=function(t,e){return 0===t.indexOf("top")?this._adjust(0,10):0===t.indexOf("bottom")?this._adjust(0,-10):0===t.indexOf("right")?this._adjust(-10,0):this._adjust(10,0)},l.prototype._adjust=function(t,e){return this.qtip.set("position.adjust.x",t),this.qtip.set("position.adjust.y",e)},l.prototype._renderTipBackground=function(t){var e=u("#qtip-"+this.qtip.id+" .qtip-tip"),o=e.find(".qtip-tip-bg");return o.length||(o=u("<div/>",{class:"icon icon-tip qtip-tip-bg"}),e.append(o)),o.removeClass("top left right bottom"),o.addClass(t)},l),Tourist.Tip.Simple=(o=Tourist.Tip.Base,t(a,o),a.prototype.initialize=function(t){return u("body").append(this.el)},a.prototype.show=function(){return this.el.show()},a.prototype.hide=function(){return this.el.hide()},a.prototype._getTipElement=function(){return this.el},a.prototype._renderContent=function(t,e){return this.el.html(e)},a),Tourist.Tour=(_.extend(c.prototype,Backbone.Events),c.prototype.start=function(){return this.trigger("start",this),this.next()},c.prototype.stop=function(t){return t?this._showCancelFinalStep():this._stop()},c.prototype.next=function(){var t=this._teardownCurrentStep(),e=0;return(e=t?t.index+1:e)<this.options.steps.length?this._showStep(this.options.steps[e],e):e===this.options.steps.length?this._showSuccessFinalStep():this._stop()},c.prototype.setStepOptions=function(t){return this.options.stepOptions=t},c.prototype.onChangeCurrentStep=function(t,e){return this.view.render(e)},c.prototype._showCancelFinalStep=function(){return this._showFinalStep(!1)},c.prototype._showSuccessFinalStep=function(){return this._showFinalStep(!0)},c.prototype._teardownCurrentStep=function(){var t=this.model.get("current_step");return this._teardownStep(t),t},c.prototype._stop=function(){return this._teardownCurrentStep(),this.model.set({current_step:null}),this.trigger("stop",this)},c.prototype._showFinalStep=function(t){var e=this._teardownCurrentStep(),t=t?this.options.successStep:this.options.cancelStep;return _.isFunction(t)&&(t.call(this,this,this.options.stepOptions),t=null),!t||e&&e.final?this._stop():(t.final=!0,this._showStep(t,this.options.steps.length))},c.prototype._showStep=function(t,e){if(t)return(t=_.clone(t)).index=e,t.total=this.options.steps.length,t.final||(t.final=this.options.steps.length===e+1&&!this.options.successStep),t=_.extend(t,this._setupStep(t)),this.model.set({current_step:t})},c.prototype._setupStep=function(t){var e,o,i,s;if(!t||!t.setup)return{};if(t.bind)for(o=0,i=(s=t.bind).length;o<i;o++)t[e=s[o]]=_.bind(t[e],t,this,this.options.stepOptions);return t.setup.call(t,this,this.options.stepOptions)||{}},c.prototype._teardownStep=function(t){return t&&t.teardown&&t.teardown.call(t,this,this.options.stepOptions),this.view.cleanupCurrentTarget()},c)}.call(void 0,jQuery);