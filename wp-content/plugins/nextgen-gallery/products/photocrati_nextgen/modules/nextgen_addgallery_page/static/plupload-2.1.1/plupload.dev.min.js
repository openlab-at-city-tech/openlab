!function(e,t,i){function n(e){function t(e,t,i){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?n[r[e]]=t:i||(n[e]=t)}var i=e.required_features,n={};return"string"==typeof i?a.each(i.split(/\s*,\s*/),function(e){t(e,!0)}):"object"==typeof i?a.each(i,function(e,i){t(i,e)}):!0===i&&(e.multipart||(n.send_binary_string=!0),e.chunk_size>0&&(n.slice_blob=!0),e.resize.enabled&&(n.send_binary_string=!0),a.each(e,function(e,i){t(i,!!e,!0)})),n}var r=e.setTimeout,s={},a={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(e){var i,n=[];"array"!==t.typeOf(e)&&(e=[e]);for(var r=e.length;r--;)(i=t.get(e[r]))&&n.push(i);return n.length?n:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return e?(""+e).replace(i,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var i="";return a.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===i||/\D/.test(e))return a.translate("N/A");var n=Math.pow(1024,4);return e>n?t(e/n,1)+" "+a.translate("tb"):e>(n/=1024)?t(e/n,1)+" "+a.translate("gb"):e>(n/=1024)?t(e/n,1)+" "+a.translate("mb"):e>1024?Math.round(e/1024)+" "+a.translate("kb"):e+" "+a.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,i){var n,r;return n=new a.Uploader(e),r=t.Runtime.thatCan(n.getOption().required_features,i||e.runtimes),n.destroy(),r},addFileFilter:function(e,t){s[e]=t}};a.addFileFilter("mime_types",function(e,t,i){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),file:t}),i(!1)):i(!0)}),a.addFileFilter("max_file_size",function(e,t,i){e=a.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:t}),i(!1)):i(!0)}),a.addFileFilter("prevent_duplicates",function(e,t,i){if(e)for(var n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size)return this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:t}),void i(!1);i(!0)}),a.Uploader=function(e){function o(){var e,t,i=0;if(this.state==a.STARTED){for(t=0;t<T.length;t++)e||T[t].status!=a.QUEUED?i++:(e=T[t],this.trigger("BeforeUpload",e)&&(e.status=a.UPLOADING,this.trigger("UploadFile",e)));i==T.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",T))}}function l(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,u()}function u(){var e,t;for(w.reset(),e=0;e<T.length;e++)t=T[e],t.size!==i?(w.size+=t.origSize,w.loaded+=t.loaded*t.origSize/t.size):w.size=i,t.status==a.DONE?w.uploaded++:t.status==a.FAILED?w.failed++:w.queued++;w.size===i?w.percent=T.length>0?Math.ceil(w.uploaded/T.length*100):0:(w.bytesPerSec=Math.ceil(w.loaded/((+new Date-I||1)/1e3)),w.percent=w.size>0?Math.ceil(w.loaded/w.size*100):0)}function d(){var e=A[0]||U[0];return!!e&&e.getRuntime().uid}function c(e,i){if(e.ruid){var n=t.Runtime.getInfo(e.ruid);if(n)return n.can(i)}return!1}function f(){this.bind("FilesAdded",_),this.bind("CancelUpload",v),this.bind("BeforeUpload",m),this.bind("UploadFile",E),this.bind("UploadProgress",R),this.bind("StateChanged",b),this.bind("QueueChanged",u),this.bind("Error",z),this.bind("FileUploaded",y),this.bind("Destroy",S)}function g(e,i){var n=this,r=0,s=[],o={accept:e.filters.mime_types,runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:F,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};a.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(o[t]=e[t])}),e.browse_button&&a.each(e.browse_button,function(i){s.push(function(s){var l=new t.FileInput(a.extend({},o,{name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:i}));l.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,A.push(this),s()},l.onchange=function(){n.addFile(this.files)},l.bind("mouseenter mouseleave mousedown mouseup",function(n){P||(e.browse_button_hover&&("mouseenter"===n.type?t.addClass(i,e.browse_button_hover):"mouseleave"===n.type&&t.removeClass(i,e.browse_button_hover)),e.browse_button_active&&("mousedown"===n.type?t.addClass(i,e.browse_button_active):"mouseup"===n.type&&t.removeClass(i,e.browse_button_active)))}),l.bind("error runtimeerror",function(){l=null,s()}),l.init()})}),e.drop_element&&a.each(e.drop_element,function(e){s.push(function(i){var s=new t.FileDrop(a.extend({},o,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);n.features.dragdrop=e.can("drag_and_drop"),r++,U.push(this),i()},s.ondrop=function(){n.addFile(this.files)},s.bind("error runtimeerror",function(){s=null,i()}),s.init()})}),t.inSeries(s,function(){"function"==typeof i&&i(r)})}function p(e,i,n){var r=new t.Image;try{r.onload=function(){r.downsize(i.width,i.height,i.crop,i.preserve_headers)},r.onresize=function(){n(this.getAsBlob(e.type,i.quality)),this.destroy()},r.onerror=function(){n(e)},r.load(e)}catch(t){n(e)}}function h(e,i,r){function s(e,t,i){var n=O[e];switch(e){case"max_file_size":"max_file_size"===e&&(O.max_file_size=O.filters.max_file_size=t);break;case"chunk_size":(t=a.parseSize(t))&&(O[e]=t);break;case"filters":"array"===a.typeOf(t)&&(t={mime_types:t}),i?a.extend(O.filters,t):O.filters=t,t.mime_types&&(O.filters.mime_types.regexp=function(e){var t=[];return a.each(e,function(e){a.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(O.filters.mime_types));break;case"resize":i?a.extend(O.resize,t,{enabled:!0}):O.resize=t;break;case"prevent_duplicates":O.prevent_duplicates=O.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=a.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":O[e]=t,i||(l=!0);break;default:O[e]=t}i||o.trigger("OptionChanged",e,t,n)}var o=this,l=!1;"object"==typeof e?a.each(e,function(e,t){s(t,e,r)}):s(e,i,r),r?(O.required_features=n(a.extend({},O)),F=n(a.extend({},O,{required_features:!0}))):l&&(o.trigger("Destroy"),g.call(o,O,function(e){e?(o.runtime=t.Runtime.getInfo(d()).type,o.trigger("Init",{runtime:o.runtime}),o.trigger("PostInit")):o.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}))}function _(e,t){[].push.apply(T,t),e.trigger("QueueChanged"),e.refresh()}function m(e,t){if(O.unique_names){var i=t.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),t.target_name=t.id+"."+n}}function E(e,i){function n(){d-- >0?r(s,1e3):(i.loaded=g,e.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:i,response:D.responseText,status:D.status,responseHeaders:D.getAllResponseHeaders()}))}function s(){var c,p,h,_;i.status!=a.DONE&&i.status!=a.FAILED&&e.state!=a.STOPPED&&(h={name:i.target_name||i.name},u&&f.chunks&&o.size>u?(_=Math.min(u,o.size-g),c=o.slice(g,g+_)):(_=o.size,c=o),u&&f.chunks&&(e.settings.send_chunk_number?(h.chunk=Math.ceil(g/u),h.chunks=Math.ceil(o.size/u)):(h.offset=g,h.total=o.size)),D=new t.XMLHttpRequest,D.upload&&(D.upload.onprogress=function(t){i.loaded=Math.min(i.size,g+t.loaded),e.trigger("UploadProgress",i)}),D.onload=function(){if(D.status>=400)return void n();d=e.settings.max_retries,_<o.size?(c.destroy(),g+=_,i.loaded=Math.min(g,o.size),e.trigger("ChunkUploaded",i,{offset:i.loaded,total:o.size,response:D.responseText,status:D.status,responseHeaders:D.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&e.trigger("UploadProgress",i)):i.loaded=i.size,c=p=null,!g||g>=o.size?(i.size!=i.origSize&&(o.destroy(),o=null),e.trigger("UploadProgress",i),i.status=a.DONE,e.trigger("FileUploaded",i,{response:D.responseText,status:D.status,responseHeaders:D.getAllResponseHeaders()})):r(s,1)},D.onerror=function(){n()},D.onloadend=function(){this.destroy(),D=null},e.settings.multipart&&f.multipart?(h.name=i.target_name||i.name,D.open("post",l,!0),a.each(e.settings.headers,function(e,t){D.setRequestHeader(t,e)}),p=new t.FormData,a.each(a.extend(h,e.settings.multipart_params),function(e,t){p.append(t,e)}),p.append(e.settings.file_data_name,c),D.send(p,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:F,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(l=a.buildUrl(e.settings.url,a.extend(h,e.settings.multipart_params)),D.open("post",l,!0),D.setRequestHeader("Content-Type","application/octet-stream"),a.each(e.settings.headers,function(e,t){D.setRequestHeader(t,e)}),D.send(c,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:F,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})))}var o,l=e.settings.url,u=e.settings.chunk_size,d=e.settings.max_retries,f=e.features,g=0;i.loaded&&(g=i.loaded=u*Math.floor(i.loaded/u)),o=i.getSource(),e.settings.resize.enabled&&c(o,"send_binary_string")&&~t.inArray(o.type,["image/jpeg","image/png"])?p.call(this,o,e.settings.resize,function(e){o=e,i.size=e.size,s()}):s()}function R(e,t){l(t)}function b(e){if(e.state==a.STARTED)I=+new Date;else if(e.state==a.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==a.UPLOADING&&(e.files[t].status=a.QUEUED,u())}function v(){D&&D.abort()}function y(e){u(),r(function(){o.call(e)},1)}function z(e,t){t.file&&(t.file.status=a.FAILED,l(t.file),e.state==a.STARTED&&(e.trigger("CancelUpload"),r(function(){o.call(e)},1)))}function S(e){e.stop(),a.each(T,function(e){e.destroy()}),T=[],A.length&&(a.each(A,function(e){e.destroy()}),A=[]),U.length&&(a.each(U,function(e){e.destroy()}),U=[]),F={},P=!1,I=D=null,w.reset()}var O,I,w,D,x=a.guid(),T=[],F={},A=[],U=[],P=!1;O={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},h.call(this,e,null,!0),w=new a.QueueProgress,a.extend(this,{id:x,uid:x,state:a.STOPPED,features:{},runtime:null,files:T,settings:O,total:w,init:function(){var e=this;if("function"==typeof O.preinit?O.preinit(e):a.each(O.preinit,function(t,i){e.bind(i,t)}),!O.browse_button||!O.url)return void this.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")});f.call(this),g.call(this,O,function(i){"function"==typeof O.init?O.init(e):a.each(O.init,function(t,i){e.bind(i,t)}),i?(e.runtime=t.Runtime.getInfo(d()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})})},setOption:function(e,t){h.call(this,e,t,!this.runtime)},getOption:function(e){return e?O[e]:O},refresh:function(){A.length&&a.each(A,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),o.call(this))},stop:function(){this.state!=a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){P=arguments[0]===i||arguments[0],A.length&&a.each(A,function(e){e.disable(P)}),this.trigger("DisableBrowse",P)},getFile:function(e){var t;for(t=T.length-1;t>=0;t--)if(T[t].id===e)return T[t]},addFile:function(e,i){function n(e,i){var n=[];t.each(u.settings.filters,function(t,i){s[i]&&n.push(function(n){s[i].call(u,t,e,function(e){n(!e)})})}),t.inSeries(n,i)}function o(e){var s=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!l)return!1;e.ruid=l,e.connectRuntime(l)}o(new a.File(e))}else e instanceof t.Blob?(o(e.getSource()),e.destroy()):e instanceof a.File?(i&&(e.name=i),c.push(function(t){n(e,function(i){i||(f.push(e),u.trigger("FileFiltered",e)),r(t,1)})})):-1!==t.inArray(s,["file","blob"])?o(new t.File(null,e)):"node"===s&&"filelist"===t.typeOf(e.files)?t.each(e.files,o):"array"===s&&(i=null,t.each(e,o))}var l,u=this,c=[],f=[];l=d(),o(e),c.length&&t.inSeries(c,function(){f.length&&u.trigger("FilesAdded",f)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,i=T.length-1;i>=0;i--)if(T[i].id===t)return this.splice(i,1)[0]},splice:function(e,t){var n=T.splice(e===i?0:e,t===i?T.length:t),r=!1;return this.state==a.STARTED&&(r=!0,this.stop()),this.trigger("FilesRemoved",n),a.each(n,function(e){e.destroy()}),this.trigger("QueueChanged"),this.refresh(),r&&this.start(),n},bind:function(e,t,i){var n=this;a.Uploader.prototype.bind.call(this,e,function(){var e=[].slice.call(arguments);return e.splice(0,1,n),t.apply(this,e)},0,i)},destroy:function(){this.trigger("Destroy"),O=w=null,this.unbindAll()}})},a.Uploader.prototype=t.EventTarget.instance,a.File=function(){function e(e){a.extend(this,{id:a.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),["blob","file"])?e:null},getSource:function(){return i[this.id]?i[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete i[this.id])}}),i[this.id]=e}var i={};return e}(),a.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.ngg_plupload=a}(window,mOxie);