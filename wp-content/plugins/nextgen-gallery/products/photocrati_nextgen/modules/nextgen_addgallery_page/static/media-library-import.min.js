"use strict";!function(r){var l={ml_data:null,import_ids:[],selectors:{ml_btn_import:r("#ngg-importML-selected-image-import"),ml_btn_select:r("#ngg-importML-select-opener"),gallery_select:r("#ngg-importML-gallery-id"),gallery_name:r("#ngg-importML-gallery-name")},initialize:function(){this.methods.initialize(),this.methods.set_events()},methods:{initialize:function(){l.ml_dialog=top.wp.media.frames.ngg_importml=top.wp.media({multiple:!0,title:ngg_importml_i18n.title,button:{text:ngg_importml_i18n.button_text}})},urlencode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},import:{import_count:0,params:{action:"import_media_library"},start:function(){l.selectors.ml_btn_import.attr("disabled",!0),l.selectors.ml_btn_select.attr("disabled",!0),l.methods.import.params.gallery_id=l.methods.urlencode(l.selectors.gallery_select.val()),l.methods.import.params.gallery_name=l.methods.urlencode(l.selectors.gallery_name.val()),l.progress_bar=r.nggProgressBar({title:ngg_importml_i18n.progress_title,infinite:!0,starting_value:ngg_importml_i18n.in_progress}),r(l).trigger("send_ajax")},done:function(){l.progress_bar.close(100),l.selectors.ml_btn_import.attr("disabled",!1),l.selectors.ml_btn_select.attr("disabled",!1);var e=ngg_importml_i18n.imported_multiple,e=(e=(e=1==l.methods.import.import_count?ngg_importml_i18n.imported_singular:e).replace("{gid}",l.methods.import.params.gallery_id)).replace("{count}",l.methods.import.import_count);delete l.methods.import.params.gallery_id,delete l.methods.import.params.gallery_name,r.gritter.add({title:ngg_importml_i18n.gritter_title,text:e,sticky:!0}),l.methods.import.import_count=0,l.ml_dialog.trigger("reset"),l.import_ids=[],l.selectors.ml_btn_import.fadeOut()},send_ajax:function(){var e=l.methods.import.params;e.nonce=ngg_importml_i18n.nonce,e.attachment_ids=[l.import_ids.pop()],r.post(photocrati_ajax.url,e,function(e){var t;void 0===e.error?(l.methods.import.import_count++,0==l.selectors.gallery_select.find('option[value="'+e.gallery_id+'"]').length&&(l.methods.import.params.gallery_id=e.gallery_id,t=r("<option/>").attr("value",e.gallery_id).html(e.gallery_name),l.selectors.gallery_select.append(t),l.selectors.gallery_select.val(e.gallery_id),t.prop("selected",!0),l.selectors.gallery_name.val("").fadeOut())):r.gritter.add({title:ngg_importml_i18n.gritter_error,text:e.error,sticky:!0}),0==l.import_ids.length?l.methods.import.done():r(l).trigger("send_ajax")},"json")}},set_events:function(){r(l).on("send_ajax",function(){l.methods.import.send_ajax()}),l.ml_dialog.on("select",function(){l.import_ids=[],l.ml_data=l.ml_dialog.state().get("selection"),l.ml_data.map(function(e){e=e.toJSON(),l.import_ids.push(e.id)});var e=ngg_importml_i18n.import_multiple.replace("%s",l.import_ids.length);1==l.import_ids.length&&(e=ngg_importml_i18n.import_singular),l.selectors.ml_btn_import.html(e),l.selectors.ml_btn_import.fadeIn()}),l.selectors.ml_btn_select.on("click",function(e){e.preventDefault(),l.ml_dialog.open()}),l.selectors.ml_btn_import.on("click",function(e){e.preventDefault(),l.methods.import.start()}),l.selectors.gallery_select.on("change",function(){0==parseInt(this.value)?(l.selectors.gallery_name.fadeIn().trigger("focus"),0==l.selectors.gallery_name.val().length&&(l.selectors.ml_btn_import.fadeOut(),l.selectors.ml_btn_select.fadeOut())):l.selectors.gallery_name.fadeOut(400,function(){l.selectors.gallery_select.trigger("focus"),l.selectors.ml_btn_select.fadeIn(),0<l.import_ids.length&&l.selectors.ml_btn_import.fadeIn()})}),l.selectors.gallery_name.on("keyup",function(){0<l.selectors.gallery_name.val().length?(l.selectors.gallery_name.removeClass("error"),l.selectors.ml_btn_select.fadeIn(),0<l.import_ids.length&&l.selectors.ml_btn_import.fadeIn()):(l.selectors.ml_btn_import.fadeOut(),l.selectors.ml_btn_select.fadeOut())})}}};jQuery(function(){(window.ngg_importml=l).initialize(),window.Frame_Event_Publisher.broadcast()})}(jQuery);