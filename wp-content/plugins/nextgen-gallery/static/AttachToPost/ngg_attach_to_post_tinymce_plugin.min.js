"use strict";!function(t,d){window.id="wordpress-post-page",tinyMCE.addI18n("en.ngg_attach_to_post",{title:"Attach NextGEN Gallery to Post"}),tinymce.create("tinymce.plugins.NextGEN_AttachToPost",{siteurl:t,getInfo:function(){return{longname:"NextGEN Gallery",author:"Imagely",authorurl:"https://www.imagely.com",infourl:"https://www.imagely.com/wordpress-gallery-plugin/nextgen-gallery/",version:"0.1"}},init:function(o,t){var a=this;function e(t,e){for(;0<=t.content.indexOf(e);){for(var n=t.content.indexOf(e),o=n+e.length,a=!1,r=null,i=!1,c=t.content.length;;){var g=t.content[o];if('"'==g||"'"==g&&"="==i)r=a&&r==g?(a=!1,null):(a=!0,g);else if("]"==g&&!a)break;if(i=g,o==c)break;o++}var n=t.content.substring(n,++o),l=n.substring(1,n.length-1),s=(l=(l=l.replace("[","&#91;")).replace("]","&#93;"),_.template(d("#ngg-igw-placeholder").html()));t.content=t.content.replace(n,s(d.extend(ngg_igw_i18n,{shortcode:l,ref:_.now()})))}}o.windowManager.nggOldOpen=o.windowManager.open,o.windowManager.open=function(t,e){t=o.windowManager.nggOldOpen(t,e);return t.on("close",a.wm_close_event),t},o.addCommand("ngg_attach_to_post",this.render_attach_to_post_interface,{editor:o,plugin:o.plugins.NextGEN_AttachToPost}),o.addButton("NextGEN_AttachToPost",{title:"ngg_attach_to_post.title",cmd:"ngg_attach_to_post",image:t+"/igw_button.png"}),o.on("mouseup touchend",function(t){var e,n;tinymce.extend(a,{editor:o,plugin:o.plugins.NextGEN_AttachToPost}),"IMG"===t.target.tagName?0<=a.get_class_name(t.target).indexOf("ngg_displayed_gallery")&&(o.dom.events.cancel(t),e=(e=t.target.src.match(/\d+$/))&&e.pop(),a.render_attach_to_post_interface({key:"id",val:e})):(e=d(t.target)).hasClass("nggPlaceholderButton")&&(e.hasClass("nggIgwRemove")?(n=(e=e.parents(".nggPlaceholder"))[0].getAttribute("data-shortcode"),o.fire("ngg-removed",{shortcode:n}),e.remove()):(window.igw_shortcode=d(t.target).parents(".nggPlaceholder")[0].getAttribute("data-shortcode"),a.render_attach_to_post_interface({key:"shortcode",val:Base64.encode(window.igw_shortcode),ref:d(t.target).parents(".nggPlaceholder").attr("id")})))}),o.on("BeforeSetContent",function(t){e(t,"[ngg_images "),e(t,"[ngg ")}),o.on("PostProcess",function(t){var e=d("<div/>").append(t.content);e.find(".nggPlaceholder").toArray().forEach(function(t){var t=d(t),e=t.data("shortcode"),e="["+_.unescape(e)+"]";t.replaceWith(e)}),t.content=e[0].innerHTML})},get_class_name:function(t){t=t.getAttribute("class")?t.getAttribute("class"):t.className;return t||""},wm_close_event:function(t){t&&t.target&&t.target._id&&"ngg_attach_to_post_dialog"==t.target._id&&(d("html,body").css("overflow","auto"),tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.dom.select("p")[0]),tinyMCE.activeEditor.selection.collapse(0))},render_attach_to_post_interface:function(t){for(var e=window.igw.url,n=(void 0!==t&&(e+="&"+t.key+"="+encodeURIComponent(t.val),void 0!==t.ref)&&(e+="&ref="+encodeURIComponent(t.ref)),e=(e+="&editor="+this.editor.id)+("&nonce="+window.ngg_tinymce_plugin.nonce),window);null!=n.parent&&n.parent!=n;)n=n.parent;var t=(n=d(n)).width(),o=n.height(),a=1600,r=1200,i=t-.05*t,c=o-.1*o;(i=i<800?t-20:i)<a&&(a=i),(c=c<600?o-40:c)<r&&(r=c),document.activeElement.blur(),Array.prototype.forEach.call(document.querySelectorAll("input, textarea"),function(t){t.blur()}),this.editor.windowManager.open({url:e,id:"ngg_attach_to_post_dialog",width:a,height:r,title:"NextGEN Gallery - Attach To Post"}),d("html,body").css("overflow","hidden"),d("#ngg_attach_to_post_dialog_ifr").css("overflow-y","auto"),d("#ngg_attach_to_post_dialog_ifr").css("overflow-x","hidden")}}),tinymce.PluginManager.add("NextGEN_AttachToPost",tinymce.plugins.NextGEN_AttachToPost)}(photocrati_ajax.wp_site_url,jQuery);