"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(Fe){Fe.Jcrop=function(e,t){"object"!==_typeof(e=e)&&(e=Fe(e)[0]),"trackDocument"in(t="object"!==_typeof(t)?{}:t)||(-1!==navigator.appName.indexOf("Internet Explorer")?t.trackDocument=-1!==navigator.appVersion.indexOf("MSIE 8"):t.trackDocument=!0),"keySupport"in t||(t.keySupport=-1!==navigator.appName.indexOf("Internet Explorer"));var l,f,p,b,g,y,n,_,V,N,W,m,v,x,S,C={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},o=(He(t),Fe(e)),a=o.clone().removeAttr("id").css({position:"absolute"}),e=(a.width(o.width()),a.height(o.height()),o.after(a).hide(),a),s=C.boxWidth,r=C.boxHeight,c=e.width(),u=e.height(),z=(s<c&&0<s&&(u=(c=s)/e.width()*e.height()),r<u&&0<r&&(c=(u=r)/e.height()*e.width()),g=e.width()/c,y=e.height()/u,e.width(c).height(u),a.width()),I=a.height(),A=Fe("<div />").width(z).height(I).addClass(ge("holder")).css({position:"relative",backgroundColor:C.bgColor}).insertAfter(o).append(a),T=(C.addClass&&A.addClass(C.addClass),Fe("<img />").attr("src",a.attr("src")).css("position","absolute").width(z).height(I)),Q=Fe("<div />").width(K(100)).height(K(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(T),d=Fe("<div />").width(K(100)).height(K(100)).css("zIndex",320),k=Fe("<div />").css({position:"absolute",zIndex:300}).insertBefore(a).append(Q,d),s=C.boundary,M=ke().width(z+2*s).height(I+2*s).css({position:"absolute",top:B(-s),left:B(-s),zIndex:290}).on("mousedown",function(e){{var t;C.disabled||C.allowSelect&&(n=!0,O=ye(a),J.disableHandles(),(t="crosshair")!=_&&(R.setCursor(t),_=t),t=me(e),H.setPressed(t),R.activateHandlers(Ie,ze),we.watchKeys(),J.update(),e.stopPropagation(),e.preventDefault())}return!1}),O=ye(a),H=(S=x=v=m=0,{flipCoords:q,setPressed:function(e){e=Y(e),x=m=e[0],S=v=e[1]},setCurrent:function(e){e=Y(e),N=e[0]-x,W=e[1]-S,x=e[0],S=e[1]},getOffset:function(){return[N,W]},moveOffset:function(e){var t=e[0],e=e[1];m+t<0&&(t-=t+m),v+e<0&&(e-=e+v),I<S+e&&(e+=I-(S+e)),z<x+t&&(t+=z-(x+t)),m+=t,x+=t,v+=e,S+=e},getCorner:function(e){var t=X();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:X});function X(){var e,t,n,o,s,r,i,a,c,u,d;return C.aspectRatio?(e=C.aspectRatio,t=C.minSize[0]/g,C.minSize[1],n=C.maxSize[0]/g,c=C.maxSize[1]/y,o=x-m,s=S-v,r=Math.abs(o),u=Math.abs(s),0==n&&(n=10*z),0==c&&(c=10*I),r/u<e?(a=S,w=u*e,(i=o<0?m-w:w+m)<0?(i=0,h=Math.abs((i-m)/e),a=s<0?v-h:h+v):z<i&&(i=z,h=Math.abs((i-m)/e),a=s<0?v-h:h+v)):(i=x,h=r/e,(a=s<0?v-h:v+h)<0?(a=0,w=Math.abs((a-v)*e),i=o<0?m-w:w+m):I<a&&(a=I,w=Math.abs(a-v)*e,i=o<0?m-w:w+m)),m<i?(i-m<t?i=m+t:n<i-m&&(i=m+n),a=v<a?v+(i-m)/e:v-(i-m)/e):i<m&&(m-i<t?i=m-t:n<m-i&&(i=m-n),a=v<a?v+(m-i)/e:v-(m-i)/e),i<0?(m-=i,i=0):z<i&&(m-=i-z,i=z),a<0?(v-=a,a=0):I<a&&(v-=a-I,a=I),last=G(q(m,v,i,a))):(c=x-m,u=S-v,l&&Math.abs(c)>l&&(x=0<c?m+l:m-l),f&&Math.abs(u)>f&&(S=0<u?v+f:v-f),b&&Math.abs(u)<b&&(S=0<u?v+b:v-b),p&&Math.abs(c)<p&&(x=0<c?m+p:m-p),m<0&&(x-=m,m-=m),v<0&&(S-=v,v-=v),x<0&&(m-=x,x-=x),S<0&&(v-=S,S-=S),z<x&&(m-=d=x-z,x-=d),I<S&&(v-=d=S-I,S-=d),z<m&&(S-=d=m-I,v-=d),I<v&&(S-=d=v-I,v-=d),G(q(m,v,x,S)))}function Y(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>z&&(e[0]=z),e[1]>I&&(e[1]=I),[e[0],e[1]]}function q(e,t,n,o){var s=e,r=n,i=t,a=o;return n<e&&(s=n,r=e),o<t&&(i=o,a=t),[Math.round(s),Math.round(i),Math.round(r),Math.round(a)]}function G(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}L=370,U={},P=!(F={}),E=C.handleOffset,C.drawBorders&&(U={top:$("hline").css("top",-1!==navigator.appVersion.indexOf("MSIE 8")?B(-1):B(0)),bottom:$("hline"),left:$("vline"),right:$("vline")}),C.dragEdges&&(F.t=te("n"),F.b=te("s"),F.r=te("e"),F.l=te("w")),C.sideHandles&&ne(["n","s","e","w"]),C.cornerHandles&&ne(["sw","nw","ne","se"]),Z=ke().on("mousedown",Se("move")).css({cursor:"move",position:"absolute",zIndex:360}),Q.append(Z),ce();var D,L,U,F,P,E,Z,J={updateVisible:re,update:ie,release:function(){ce(),k.hide(),a.css("opacity",1),D=!1},refresh:se,setCursor:function(e){Z.css("cursor",e)},enableHandles:ae,enableOnly:function(){P=!0},showHandles:function(){P&&(oe(H.getFixed()),d.show())},disableHandles:ce,animMode:ue,done:function(){ue(!1),se()}};function $(e){e=Fe("<div />").css({position:"absolute",opacity:C.borderOpacity}).addClass(ge(e));return Q.append(e),e}function ee(e,t){e=Fe("<div />").on("mousedown",Se(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t});return d.append(e),e}function te(e){var t=C.handleSize,n=t,o=t,t=E,s=E;switch(e){case"n":case"s":o=K(100);break;case"e":case"w":n=K(100)}return ee(e,L++).width(o).height(n).css({top:B(1-t),left:B(1-s)})}function ne(e){for(i in e)F[e[i]]=(t=e[i],ee(t,L++).css({top:B(1-E),left:B(1-E),opacity:C.handleOpacity}).addClass(ge("handle")));var t}function oe(e){var t=Math.round(e.h/2-E),n=Math.round(e.w/2-E),o=(west=1-E,e.w-E),e=e.h-E;"e"in F&&F.e.css({top:B(t),left:B(o)})&&F.w.css({top:B(t)})&&F.s.css({top:B(e),left:B(n)})&&F.n.css({left:B(n)}),"ne"in F&&F.ne.css({left:B(o)})&&F.se.css({top:B(e),left:B(o)})&&F.sw.css({top:B(e)}),"b"in F&&F.b.css({top:B(e)})&&F.r.css({left:B(o)})}function se(){var e=H.getFixed();H.setPressed([e.x,e.y]),H.setCurrent([e.x2,e.y2]),re()}function re(){if(D)return ie()}function ie(){var e,t,n=H.getFixed();e=n.w,t=n.h,k.width(e).height(t),e=n.x,t=n.y,T.css({top:B(-t),left:B(-e)}),k.css({top:B(t),left:B(e)}),C.drawBorders&&U.right.css({left:B(n.w-1)})&&U.bottom.css({top:B(n.h-1)}),P&&oe(n),D||(k.show(),a.css("opacity",C.bgOpacity),D=!0),C.onChange(Ce(n))}function ae(){if(P=!0,C.allowResize)return oe(H.getFixed()),d.show(),!0}function ce(){P=!1,d.hide()}function ue(e){((V=e)?ce:ae)()}de=function(){},le=function(){},(fe=C.trackDocument)||M.on("mousemove",pe).on("mouseup",he).on("mouseout",he),a.before(M);var de,le,fe,R={activateHandlers:function(e,t){return n=!0,de=e,le=t,M.css({zIndex:450}),fe&&Fe(document).on("mousemove",pe).on("mouseup",he),!1},setCursor:function(e){M.css("cursor",e)}};function pe(e){de(me(e))}function he(e){return e.preventDefault(),e.stopPropagation(),n&&(n=!1,le(me(e)),C.onSelect(Ce(H.getFixed())),M.css({zIndex:290}),fe&&Fe(document).off("mousemove",pe).off("mouseup",he),de=function(){},le=function(){}),!1}j=Fe('<input type="radio" />').css({position:"absolute",left:"-30px"}).on("keypress",function(e){if(e.ctrlKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:be(e,-t,0);break;case 39:be(e,t,0);break;case 38:be(e,0,-t);break;case 40:be(e,0,t);break;case 27:J.release();break;case 9:return!0}return nothing(e)}).on("blur",function(e){j.hide()}),r=Fe("<div />").css({position:"absolute",overflow:"hidden"}).append(j),C.keySupport&&r.insertBefore(a);var j,we={watchKeys:function(){C.keySupport&&(j.show(),j.trigger("focus"))}};function be(e,t,n){C.allowMove&&(H.moveOffset([t,n]),J.updateVisible()),e.preventDefault(),e.stopPropagation()}function B(e){return parseInt(e)+"px"}function K(e){return parseInt(e)+"%"}function ge(e){return C.baseClass+"-"+e}function ye(e){e=Fe(e).offset();return[e.left,e.top]}function me(e){return[e.pageX-O[0],e.pageY-O[1]]}function ve(e,t){if(O=ye(a),R.setCursor("move"==e?e:e+"-resize"),"move"==e)return R.activateHandlers((n=t,we.watchKeys(),function(e){H.moveOffset([e[0]-n[0],e[1]-n[1]]),n=e,J.update()}),ze);var n,o,s,t=H.getFixed(),r=xe(e),i=H.getCorner(xe(r));H.setPressed(H.getCorner(r)),H.setCurrent(i),R.activateHandlers((o=e,s=t,function(e){if(C.aspectRatio)switch(o){case"e":case"w":e[1]=s.y+1;break;case"n":case"s":e[0]=s.x+1}else switch(o){case"e":case"w":e[1]=s.y2;break;case"n":case"s":e[0]=s.x2}H.setCurrent(e),J.update()}),ze)}function xe(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function Se(t){return function(e){return C.disabled||"move"==t&&!C.allowMove||(n=!0,ve(t,me(e)),e.stopPropagation(),e.preventDefault()),!1}}function Ce(e){return{x:parseInt(e.x*g),y:parseInt(e.y*y),x2:parseInt(e.x2*g),y2:parseInt(e.y2*y),w:parseInt(e.w*g),h:parseInt(e.h*y)}}function ze(e){var t=H.getFixed();t.w>C.minSelect[0]&&t.h>C.minSelect[1]?(J.enableHandles(),J.done()):J.release(),R.setCursor(C.allowSelect?"crosshair":"default")}function Ie(e){H.setCurrent(e),J.update()}function ke(){var e=Fe("<div></div>").addClass(ge("tracker"));return-1!==navigator.appName.indexOf("Internet Explorer")&&e.css({opacity:0,backgroundColor:"white"}),e}function Me(e){Oe([e[0]/g,e[1]/y,e[2]/g,e[3]/y])}function Oe(e){H.setPressed([e[0],e[1]]),H.setCurrent([e[2],e[3]]),J.update()}function He(e){"object"!=_typeof(e)&&(e={}),"function"!=typeof(C=Fe.extend(C,e)).onChange&&(C.onChange=function(){}),"function"!=typeof C.onSelect&&(C.onSelect=function(){})}function De(e){C.allowResize?e?J.enableOnly():J.enableHandles():J.disableHandles(),R.setCursor(C.allowSelect?"crosshair":"default"),J.setCursor(C.allowMove?"move":"default"),A.css("backgroundColor",C.bgColor),"setSelect"in C&&(Me(t.setSelect),J.done(),delete C.setSelect),"trueSize"in C&&(g=C.trueSize[0]/z,y=C.trueSize[1]/I),l=C.maxSize[0]||0,f=C.maxSize[1]||0,p=C.minSize[0]||0,b=C.minSize[1]||0,"outerImage"in C&&(a.attr("src",C.outerImage),delete C.outerImage),J.refresh()}d.hide(),De(!0);e={animateTo:function(e){var t,n,o,s,r,i,a,c,u,d,l,f=e[0]/g,p=e[1]/y,h=e[2]/g,w=e[3]/y;function b(){window.setTimeout(l,n)}V||(e=H.flipCoords(f,p,h,w),f=H.getFixed(),t=initcr=[f.x,f.y,f.x2,f.y2],n=C.animationDelay,o=t[0],s=t[1],h=t[2],w=t[3],r=e[0]-initcr[0],i=e[1]-initcr[1],a=e[2]-initcr[2],c=e[3]-initcr[3],u=0,d=C.swingSpeed,J.animMode(!0),l=function(){u+=(100-u)/d,t[0]=o+u/100*r,t[1]=s+u/100*i,t[2]=h+u/100*a,t[3]=w+u/100*c,u<100?b():J.done(),99.8<=u&&(u=100),Oe(t)},b())},setSelect:Me,setOptions:function(e){He(e),De()},tellSelect:function(){return Ce(H.getFixed())},tellScaled:function(){return H.getFixed()},disable:function(){C.disabled=!0,J.disableHandles(),J.setCursor("default"),R.setCursor("default")},enable:function(){C.disabled=!1,De()},cancel:function(){J.done(),R.activateHandlers(null,null)},focus:we.watchKeys,getBounds:function(){return[z*g,I*y]},getWidgetSize:function(){return[z,I]},release:J.release,destroy:function(){A.remove(),o.show()}};return o.data("Jcrop",e),e},Fe.fn.Jcrop=function(o){return"object"!==_typeof(o)&&(o={}),this.each(function(){if(Fe(this).data("Jcrop")){if("api"==o)return Fe(this).data("Jcrop");Fe(this).data("Jcrop").setOptions(o)}else e=this,t=o.useImg||e.src,(n=new Image).onload=function(){Fe.Jcrop(e,o)},n.src=t;var e,t,n}),this}}(jQuery);