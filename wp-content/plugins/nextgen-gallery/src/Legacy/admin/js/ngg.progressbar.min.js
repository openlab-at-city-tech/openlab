"use strict";!function(a){nggProgressBar={settings:{header:"",id:"progressbar",init:!1,maxStep:100,wait:!1,finishedNote:"Done!",submitNGGFormOnFinished:!0,includeTinyMCEHackForIncrements:!0},width:0,init:function(i){var e=this;return i=this.settings=a.extend({},this.settings,{},i||{}),this.adjust_max_step(i.maxStep),0===a("#"+i.id+"_dialog").length&&(i.header=0<i.header.length?i.header:"",a("body").append('<div id="'+i.id+'_dialog"><div id="'+i.id+'" class="progressborder"><div class="'+i.id+'"><span>0%</span></div></div></div>'),a("#"+i.id+"_dialog").dialog({width:640,resizable:!0,modal:!0,title:i.header,position:{my:"center",at:"center",of:this.find_parent(window)},close:function(i,t){e.remove_dialog(0,0)}})),this.div=a("#"+i.id+"_dialog"),i.init=!0,this.div},adjust_max_step:function(i){this.settings.maxStep=i,this.width=Math.round(100/i*100)/100},find_parent:function(i){try{i&&i.parent&&(i=i.parent)}catch(i){}return i},addMessage:function(i){var t=this.settings,e=(t.init||this.init(),this.div);0===e.find("#"+t.id+"_message").length?e.append('<div class="'+t.id+'_message"><span style="display:block" id="'+t.id+'_message">'+i+"</span></div>"):a("#"+t.id+"_message").html(i)},addNote:function(i,t){var e=this.settings,n=(e.init||this.init(),this.div);e.wait=!0,0===n.find("#"+e.id+"_note").length&&n.append('<ul id="'+e.id+'_note">&nbsp;</ul>'),t?a("#"+e.id+"_note").append("<li>"+i+"<div class='show_details'><span>[more]</span><br />"+t+"</div></li>"):a("#"+e.id+"_note").append("<li>"+i+"</li>"),n.dialog("option","height",220)},increase:function(i){var t,e,n=this.settings,s=i*this.width+"%",i=Math.round(i*this.width)+"%";a("#"+n.id+" div").width(s),a("#"+n.id+" span").html(i),n.includeTinyMCEHackForIncrements&&(a(this.find_parent(window).document).scrollTop(0),t=a(this.find_parent(window).frameElement).parent(),e=t.css("top"),setTimeout(function(){t.css("top",0)},1),setTimeout(function(){t.css("top",e)},3))},finished:function(i){var t=this.settings,e=(i=void 0===i?t.finishedNote:i,a("#"+t.id+" div").width("100%"),a("#"+t.id+" span").html("100%"),this.div),n=this;t.wait?(a("#"+t.id).delay(1e3).hide("slow"),n.addNote(i),e.on("click",function(){n.remove_dialog(!1,0)})):window.setTimeout(function(){n.remove_dialog(!0,1)},1e3)},remove_dialog:function(i,t){var e=a("#"+this.settings.id+"_dialog");(i?e.delay(4e3):e).dialog("destroy"),e.remove(),this.settings.submitNGGFormOnFinished&&((e=a(".nggform")).prepend('<input type="hidden" name="ajax_callback" value="'+t+'">'),(i?e.delay(4e3):e).trigger("submit"))}}}(jQuery);var nggProgressBarManager={starting_count:0,progress_bar:null,polling_status:!1,button:null,messages:{no_images_found:"No images were found to operate on",operation_finished:"Operation has completed",header:"Working..."},initialize:function(i,t,e,n){var s=this;this.messages=t,this.primary_url=e,this.secondary_url=void 0===n?e:n,this.button=document.getElementById(i),this.button.addEventListener("click",function(i){i.preventDefault(),s.button.setAttribute("disabled","true"),s.first_fetch()})},initialize_progress_bar:function(){if(this.progress_bar)return this.progress_bar;var i=this;this.progress_bar=nggProgressBar.init({header:this.messages.header,wait:!0,finishedNote:this.messages.operation_finished,submitNGGFormOnFinished:!1,includeTinyMCEHackForIncrements:!1}),this.progress_bar.on("dialogclose",function(){i.polling_status=!1,i.progress_bar=null,i.button.removeAttribute("disabled")})},first_fetch:function(){this.initialize_progress_bar();var t=this;fetch(this.primary_url,{method:"post",cache:"no-cache"}).then(function(i){return i.json()}).then(function(i){0===i.remaining?(t.button.removeAttribute("disabled"),nggProgressBar.finished(t.messages.no_images_found)):(t.polling_status=!0,t.starting_count=i.remaining,nggProgressBar.adjust_max_step(t.starting_count),t.continuing_fetch())})},continuing_fetch:function(){var t=this;fetch(this.secondary_url,{method:"post",cache:"no-cache"}).then(function(i){return i.json()}).then(function(i){i=Math.round((t.starting_count-i.remaining)/t.starting_count*100);i<100?(nggProgressBar.increase(i),t.polling_status&&t.continuing_fetch()):(nggProgressBar.increase(100),nggProgressBar.finished(),t.button.removeAttribute("disabled"))})}};