(()=>{(function(e){e.fn.charCount=function(t){var m={allowed:140,x_limit:280,mastodon_limit:500,bluesky_limit:300,warning:25,css:"counter",counterElement:"span",cssWarning:"warning",cssExceeded:"exceeded",counterText:""},t=e.extend(m,t);function r(n){var u=e(n).val().length;console.log(u);var a=t.allowed,l=t.x_limit,o=t.mastodon_limit,s=t.bluesky_limit;a=Math.max(a,l,o,s);var f=Math.min(a,l,o,s),x=e(n).val().indexOf("#url#")>-1?18:0,v=e(n).val().indexOf("#longurl#")>-1?14:0;if(e("#title").length)var d=e(n).val().indexOf("#title#")>-1?e("#title").val().length-7:0;else var d=0;var h=e(n).val().indexOf("#blog#")>-1?e("#wp-admin-bar-site-name a").val().length-6:0,i=u+x+v+d+h,c=a-i;i>=l?(e(".x-notification").show(),e(".x-notification span").text(l)):e(".x-notification").hide(),i>=o?(e(".mastodon-notification").show(),e(".mastodon-notification span").text(o)):e(".mastodon-notification").hide(),i>=s?(e(".bluesky-notification").show(),e(".bluesky-notification span").text(s)):e(".bluesky-notification").hide(),i>=f-t.warning?e(n).next().attr("aria-live","polite"):e(n).next().removeAttr("aria-live","polite"),c<=t.warning&&c>=0?e(n).next().addClass(t.cssWarning):e(n).next().removeClass(t.cssWarning),c<0?e(n).next().addClass(t.cssExceeded):e(n).next().removeClass(t.cssExceeded),e(n).next().html(t.counterText+c)}this.each(function(){e(this).after("<"+t.counterElement+' aria-atomic="true" class="'+t.css+'">'+t.counterText+"</"+t.counterElement+">"),e(this).on("keyup",function(){setTimeout(r(this),200)}),e(this).on("change",function(){setTimeout(r(this),200)})})}})(jQuery);})();
