!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}((function(e,t){var o,s,a=[],r=[],d=-1,l=0,n=0,c="",m=-1,p=0,u="",f=folders_media_options.page_url,h="",g="",v=!1,j=!1,k=!1,y=!1,w=0,b=0,x=[],C=null,S=null,E=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var e={};folders_media_options.terms.length;_.each(folders_media_options.terms||{},(function(t,o){e[t.term_id]={text:t.name+" ("+t.trash_count+")",props:{media_folder:t.slug}}})),e.all={text:"All Folders",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e},change:function(){var e={};_.each(folders_media_options.terms||{},(function(t,o){e[t.term_id]={text:t.name+" ("+t.trash_count+")",props:{media_folder:t.slug}}})),e.all={text:"Select a folder >>",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e;var t=this.filters[this.el.value];t&&this.model.set(t.props)}}),I=0,D=0,O=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){O.prototype.createToolbar.call(this),this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new E({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var P,R=wp.media.model.Query;_.extend(R,{get:(P=[],function(e,t){var o,s={},a=R.orderby,r=R.defaultProps;return delete e.query,delete e.cache,_.defaults(e,r),_.each(["include","exclude"],(function(t){e[t]&&!_.isArray(e[t])&&(e[t]=[e[t]])})),_.each(e,(function(e,t){_.isNull(e)||(s[R.propmap[t]||t]=e)})),_.defaults(s,R.defaultArgs),s.orderby=a.valuemap[e.orderby]||e.orderby,P=[],o||(o=new R([],_.extend(t||{},{props:e,args:s})),P.push(o)),o})});var T=window.wp;void 0!==T&&"function"==typeof T.Uploader&&(T.media.view.Modal.prototype.on("close",(function(){a=[]})),e.extend(T.Uploader.prototype,{progress:function(){},init:function(){this.uploader&&(this.uploader.bind("FileFiltered",(function(t,o){I++,e(".folder-meter").css("width","0%"),e(".media-folder-loader").show(),e("#total_upload_files").text(I)})),this.uploader.bind("BeforeUpload",(function(t,o){var s=d,a=t.settings.multipart_params;if((s=parseInt(s))>0&&(a.folder_for_media=s),D<I){e(".media-folder-loader").show();var r=D/I*100;e(".folder-meter").css("width",r+"%")}D++,e("#current_upload_files").text(D)})),this.uploader.bind("UploadComplete",(function(t,o){var s=window.wp;d=-1,e(".folder-meter").css("width","100%"),setTimeout((function(){e(".media-folder-loader").hide(),e(".folder-meter").css("width","0%"),I=0,D=0}),1250),L=e.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",beforeSend:function(){null!=L&&L.abort()},success:function(t){t=e.parseJSON(t),x=t.taxonomies,G(),e(".all-posts .total-count").text(t.total_items),e(".un-categorized-posts .total-count").text(t.empty_items)}}),J(),void 0!==s.media.frame&&null!==s.media.frame.content.get()&&void 0!==s.media.frame.content.get().collection&&(a=[],e(".folder-modal ul.attachments li.selected").length?e(".folder-modal ul.attachments li.selected").each((function(){a.push(e(this).data("id"))})):(s.media.frame.content.get().collection.props.set({ignore:+new Date}),s.media.frame.content.get().options.selection.reset()))})))}}));var L,N=window.wp;if(void 0!==N&&"function"==typeof N.Uploader){var H=window.wp.media,A=H.view.Modal;H.view.Modal=H.view.Modal.extend({className:"folder-modal",initialize:function(){A.prototype.initialize.apply(this,arguments)},open:function(){A.prototype.open.apply(this,arguments)&&(e(".folder-modal").length||e(".supports-drag-drop").length&&e(".supports-drag-drop").each((function(){"block"!=e(this).css("display")&&"inline-block"!=e(this).css("display")||e(this).addClass("folder-modal")})),e(".folder-modal").length?(e(".folder-custom-menu").remove(),e(".folder-modal .media-frame-tab-panel").removeClass("has-folder-menu"),e(".folder-modal .media-frame").hasClass("hide-menu")?e(".folder-custom-menu").length||(e(".folder-modal .media-frame-tab-panel").before("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),e(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",(function(){oe(),K(),V()}))):e(".folder-custom-menu").length||(e(".folder-modal .media-frame-menu").addClass("has-folder-menu"),e(".folder-modal .media-frame-menu .media-menu").append("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),e(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",(function(){oe(),K(),V()}))),e(".folder-form-data").remove(),e(".media-frame-tab-panel:first").before("<div class='folder-form-data'></div>"),e(".folder-form-data").html(folders_media_options.form_content)):setTimeout((function(){-1!=d&&e("#media-attachment-taxonomy-filter").each((function(){e(this).val(d),e(this).trigger("change")}))}),1e3))},close:function(){A.prototype.close.apply(this,arguments),e(".folder-modal").removeClass("folder-modal")}})}function M(){"yes"==folders_media_options.useFolderUndo&&(e("#do-undo").addClass("active"),e(".undo-folder-action").removeClass("disabled"),setTimeout((function(){e("#do-undo").removeClass("active"),e(".undo-folder-action").addClass("disabled")}),parseInt(folders_media_options.defaultTimeout)))}function F(){e(".cut-folder-action, .copy-folder-action, .paste-folder-action, .delete-folder-action").addClass("disabled"),e("#js-tree-menu .jstree-anchor.jstree-clicked").length&&e(".delete-folder-action").removeClass("disabled"),(e("#menu-checkbox").is(":checked")||e("#menu-checkbox").is(":checked"))&&e("#js-tree-menu input.checkbox:checked").length>0&&e(".delete-folder-action").removeClass("disabled")}function U(){e("#custome_folder_color_css").remove();var t="<style id='custome_folder_color_css'>";e(r).each((function(e,o){""!=o.has_color&&(t+="li.jstree-node[id='"+o.folder_id+"'] .pfolder-folder-close {color: "+o.has_color+"!important;}")})),t+="</style>",e("head").append(t)}function J(){e(".jstree-anchor:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover",tolerance:"pointer",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(t,o){if(l=e(this).closest("li.jstree-node").attr("id"),e(this).closest("ul.jstree-container-ul").find(".jstree-clicked").length){var s=e(this).closest("ul.jstree-container-ul").find(".jstree-clicked");h=s.closest("li.jstree-node").attr("id")}o.draggable.hasClass("wcp-move-multiple")?e(".wp-list-table input:checked").length&&(chkStr="",e(".wp-list-table input:checked").each((function(){chkStr+=e(this).val()+","})),u=Y(l,"nonce"),e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(t){"1"==(t=e.parseJSON(t)).status?(M(),q()):(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show())}})):o.draggable.hasClass("wcp-move-file")?(postID=o.draggable[0].attributes["data-id"].nodeValue,u=Y(l,"nonce"),chkStr=postID+",",e(".wp-list-table input:checked").each((function(){e(this).val()!=postID&&(chkStr+=e(this).val()+",")})),e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(t){"1"==(t=e.parseJSON(t)).status?(M(),q()):(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show())}})):o.draggable.hasClass("attachment")&&(chkStr=o.draggable[0].attributes["data-id"].nodeValue,u=Y(l,"nonce"),e(".attachments-browser li.attachment.selected").length>1&&(chkStr="",e(".attachments-browser li.attachment.selected").each((function(){chkStr+=e(this).data("id")+","}))),g=chkStr,e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(e){M(),q(),ae()}}))}}),e(".media-frame:not(.hide-router) .attachments-browser li.attachment:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(t,o){e(".selected-items").remove();var s=e(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length;return s=0==s||1==s?folders_media_options.lang.ONE_ITEM:s+" "+folders_media_options.lang.ITEMS,e("<div class='selected-items'><span class='total-post-count'>"+s+" "+folders_media_options.lang.SELECTED+"</span></div>")},start:function(t,o){e("body").addClass("no-hover-css")},cursor:"move",appendTo:".media-modal",cursorAt:{left:0,top:0},stop:function(t,o){e(".selected-items").remove(),e("body").removeClass("no-hover-css")}}),e(".un-categorised-items").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-hover-list",tolerance:"pointer",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(t,o){l=-1,u=folders_media_options.nonce,o.draggable.hasClass("wcp-move-multiple")?e(".wp-list-table input:checked").length&&(chkStr="",e(".wp-list-table input:checked").each((function(){chkStr+=e(this).val()+","})),Q(chkStr)):o.draggable.hasClass("wcp-move-file")?(postID=o.draggable[0].attributes["data-id"].nodeValue,chkStr=postID+",",e(".wp-list-table input:checked").each((function(){postID!=e(this).val()&&(chkStr+=e(this).val()+",")})),Q(chkStr)):o.draggable.hasClass("attachment")&&(chkStr=o.draggable[0].attributes["data-id"].nodeValue,e(".attachments-browser li.attachment.selected").length>1&&(chkStr="",e(".attachments-browser li.attachment.selected").each((function(){chkStr+=e(this).data("id")+","}))),g=chkStr,Q(chkStr))}}),e(".tree-structure .folder-item:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover-list",tolerance:"pointer",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(t,o){if(e("body").removeClass("no-hover-css"),l=e(this).data("id"),e(this).closest("ul.jstree-container-ul").find(".jstree-clicked").length){var s=e(this).closest("ul.jstree-container-ul").find(".jstree-clicked");h=s.closest("li.jstree-node").attr("id")}o.draggable.hasClass("wcp-move-multiple")?(u=Y(l,"nonce"),e(".wp-list-table input:checked").length&&(chkStr="",e(".wp-list-table input:checked").each((function(){chkStr+=e(this).val()+","})),e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(e){M(),q(),ae()}}))):o.draggable.hasClass("wcp-move-file")?(postID=o.draggable[0].attributes["data-id"].nodeValue,u=Y(l,"nonce"),chkStr=postID+",",e(".wp-list-table input:checked").each((function(){e(this).val()!=postID&&(chkStr+=e(this).val()+",")})),e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(e){M(),q(),ae()}})):o.draggable.hasClass("attachment")&&(chkStr=o.draggable[0].attributes["data-id"].nodeValue,u=Y(l,"nonce"),e(".attachments-browser li.attachment.selected").length>1&&(chkStr="",e(".attachments-browser li.attachment.selected").each((function(){chkStr+=e(this).data("id")+","}))),e.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+l+"&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(e){M(),q(),ae()}}))}}),e(".wcp-move-file:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move",start:function(t,o){e(this).closest("td").addClass("wcp-draggable"),e("body").addClass("no-hover-css")},stop:function(t,o){e(this).closest("td").removeClass("wcp-draggable"),e("body").removeClass("no-hover-css")}}),e(".wcp-move-multiple:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(t,o){return e(".selected-items").remove(),selectedItems=e("#the-list th input:checked").length,selectedItems>0?(selectedItems=0==selectedItems||1==selectedItems?folders_media_options.lang.ONE_ITEM:selectedItems+" "+folders_media_options.lang.ITEMS,e("<div class='selected-items'><span class='total-post-count'>"+selectedItems+" "+folders_media_options.lang.SELECTED+"</span></div>")):e("<div class='selected-items'><span class='total-post-count'>"+folders_media_options.lang.SELECT_ITEMS+"</span></div>")},start:function(t,o){e("body").addClass("no-hover-css")},cursor:"move",cursorAt:{left:0,top:0},stop:function(t,o){e(".selected-items").remove(),e("body").removeClass("no-hover-css")}})}function V(){e(".folder-modal #js-tree-menu").jstree({core:{cache:!1,animation:0,max_depth:s?"-1":1,check_callback:function(t,o,a,r,d){if(e("*").removeClass("drag-bot").removeClass("drag-in").removeClass("drag-up"),("move_node"===t||"copy_node"===t)&&d&&d.dnd)switch(d.pos){case"a":d.origin.get_node(d.ref,!0).addClass("drag-bot"),nodeId=e(".drag-bot").attr("id"),e("#jstree-dnd").text("Below "+e.trim(e("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"i":if(!s&&e("#do_not_show_again").is(":checked"))return!1;d.origin.get_node(d.ref,!0).addClass("drag-in"),nodeId=e(".drag-in").attr("id"),e("#jstree-dnd").text("Inside "+e.trim(e("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"b":d.origin.get_node(d.ref,!0).addClass("drag-up"),nodeId=e(".drag-up").attr("id"),e("#jstree-dnd").text("Above "+e.trim(e("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;default:e("#jstree-dnd").text(e("#jstree-dnd").data("txt"))}return!0}},data:{cache:!1},select_node:!1,search:{show_only_matches:!0,case_sensitive:!1,fuzzy:!1},plugins:["dnd","search","contextmenu"],contextmenu:{select_node:0,show_at_node:0,items:function(){return{}}}}).bind("ready.jstree",(function(){if(z(),J(),""!=folders_media_options.default_folder&&0!=folders_media_options.default_folder){var t=function(e){if(r.length>0)for(i=0;i<r.length;i++)if(r[i].slug==e)return r[i].folder_id;return""}(folders_media_options.default_folder);""!=t&&e(".folder-modal #media-attachment-taxonomy-filter option[value='"+t+"']").length&&(e(".folder-modal #media-attachment-taxonomy-filter").val(t).trigger("change"),e(".folder-modal #js-tree-menu .jstree-clicked").removeClass("jstree-clicked"),e(".folder-modal #js-tree-menu").jstree("select_node",t),e(".folder-modal #js-tree-menu .jstree-node[id='"+t+"'] > a").addClass("jstree-clicked"))}})).bind("after_open.jstree",(function(){J()})).bind("open_all.jstree",(function(){J()})).bind("create_node.jstree",(function(){J()})).bind("delete_node.jstree",(function(){J()})).bind("close_all.jstree",(function(){J()})).bind("after_close.jstree",(function(){J()})).bind("move_node.jstree",(function(t,o){if(!s){var a=o.old_position;if("#"!=o.parent)return e("#js-tree-menu").jstree("move_node","#"+o.node.id,"#",a),e("#sub-drag-folder-popup").show(),!1}z(),"#"!=o.node.parent&&jQuery("#js-tree-menu").jstree("open_node",o.node.parent),folderMoveId=o.node.id,orderString="",e(".folder-modal .jstree-node[id='"+folderMoveId+"']").closest("ul").children().each((function(){"undefined"!=e(this).attr("id")&&(orderString+=e(this).attr("id")+",")})),e(".folder-modal #"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?parentID=e("#"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().attr("id"):parentID=0,""!=orderString&&(e(".form-loader-count").css("width","100%"),e.ajax({url:folders_media_options.ajax_url,data:"term_ids="+orderString+"&action=wcp_save_folder_order&type="+folders_media_options.post_type+"&nonce="+folders_media_options.nonce+"&term_id="+folderMoveId+"&parent_id="+parentID,method:"post",success:function(t){"1"==(t=e.parseJSON(t)).status?(e("#wcp_folder_parent").html(t.options),e(".form-loader-count").css("width","0"),q(),ae(),G(),J()):(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show(),window.location.reload(!0))}}))})),J()}function Q(t){e(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").length?(h=e(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").closest(".jstree-node").attr("id"),e.ajax({url:folders_media_options.ajax_url,data:{post_id:t,action:"premio_check_for_other_folders",active_folder:h,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:folders_media_options.taxonomy_status,taxonomy:h},method:"post",success:function(t){-1==(t=e.parseJSON(t)).status?(e("#unassigned_folders").val(t.data.post_id),e("#confirm-your-change").show()):(q(),M())}})):(u=folders_media_options.nonce,e.ajax({url:folders_media_options.ajax_url,data:"post_id="+t+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id="+"-1&nonce="+u+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+h,method:"post",success:function(e){q(),M()}}))}function z(){e("#js-tree-menu .jstree-node").each((function(){var t=e(this).data("count")&&""!=e(this).data("count")?e(this).data("count"):0;e(".jstree-node[id='"+e(this).attr("id")+"'] > a span.premio-folder-count").text(t)})),e("span.premio-folder-count").each((function(){""==e(this).text()&&e(this).text(0)})),""!=h&&0!=h&&e(".jstree-node[id='"+h+"']").length&&(e("#js-tree-menu").jstree("select_node",h),e(".sticky-folders .sticky-folder-"+h+" a").length&&e(".sticky-folders .sticky-folder-"+h+" a").addClass("active-item")),e(".ajax-preloader").hide(),e(".js-tree-data").show(),K(),W(),e(".sticky-folders ul > li").length>0&&e(".sticky-folders").addClass("active")}function Y(e,t){if(r.length>0)for(i=0;i<r.length;i++)if(parseInt(r[i].folder_id)==parseInt(e))return r[i][t];return""}function B(e){if(r.length>0)for(i=0;i<r.length;i++)if(parseInt(r[i].folder_id)==parseInt(e))return i;return null}function W(){e(".sticky-folders > ul").html("");var t="";if(U(),e("#js-tree-menu li.jstree-node.is-sticky").each((function(){var o=e(this).attr("id"),s=e.trim(e("#js-tree-menu").jstree(!0).get_node(o).text),a=e("li.jstree-node[id='"+o+"'] > a span.premio-folder-count").text(),r=e("li.jstree-node[id='"+o+"']").hasClass("is-high")?" is-high ":"";t+="<li data-folder-id='"+o+"' class='sticky-fldr "+r+" sticky-folder-"+o+"'><a href='javascript:;'><span class='folder-title'>"+s+"</span><span class='folder-actions'><span class='update-inline-record'><i class='pfolder-edit-folder'></i></span><span class='star-icon'><i class='pfolder-star'></i></span><span class='premio-folder-count'>"+a+"</span></span></a></li>"})),e(".sticky-folders > ul").html(t),e(".jstree-anchor.jstree-clicked").length){var o=e(".jstree-anchor.jstree-clicked").closest("li.jstree-node").attr("id");e(".sticky-folders .sticky-folder-"+o+" a").addClass("active-item")}e(".sticky-folders > ul > li").length>0?e(".sticky-folders").addClass("active"):e(".sticky-folders").removeClass("active")}function K(){var t=e(window).height()-e("#wpadminbar").height()-e(".sticky-wcp-custom-form").height()-70;e("#custom-scroll-menu").height(t),e("#custom-scroll-menu").overlayScrollbars({resize:"none",sizeAutoCapable:!0,autoUpdateInterval:33,x:"scroll",clipAlways:!1,y:"scroll"}),e(".custom-scroll-menu").hasClass("hor-scroll")&&(jQuery("#custom-scroll-menu .os-viewport").on("scroll",(function(){X()})),X())}function X(){jQuery(".folder-modal #js-tree-menu span.folder-actions").css("right",jQuery(".folder-modal #custom-scroll-menu .horizontal-scroll-menu").width()-jQuery(".folder-modal #custom-scroll-menu .os-viewport").width()-e(".folder-modal #custom-scroll-menu .os-viewport").scrollLeft()-10)}function q(){if(e(".media-toolbar").hasClass("media-toolbar-mode-select")&&e("ul.attachments li.selected").length&&(e("ul.attachments li.selected").trigger("click"),e(".select-mode-toggle-button").trigger("click")),""!=g&&(e("#js-tree-menu a.jstree-clicked").length>0||"-1"==h)){if(e("#media-attachment-taxonomy-filter").length){g=g.split(",");for(var t=0;t<g.length;t++)""!=g[t]&&e(".attachments-browser li[data-id='"+g[t]+"']").remove()}g=""}e("#media-attachment-taxonomy-filter").length?se(0):(e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=get_folders_default_list",method:"post",success:function(t){t=e.parseJSON(t),e(".header-posts .total-count").text(t.total_items),e(".un-categorised-items .total-count").text(t.empty_items),x=t.taxonomies,G(),J()}}),e(".folder-loader-ajax").addClass("active"),e("#folder-posts-filter").length?e("#folder-posts-filter").load(f+" #posts-filter",(function(){var t={Title:"",Url:f};history.pushState(t,t.Title,t.Url),"show"!=folders_media_options.show_in_page||e(".tree-structure").length||e(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>'),triggerInlineUpdate()})):e("#wpbody").load(f+" #wpbody-content",!1,(function(t){var o={Title:"",Url:f};history.pushState(o,o.Title,o.Url),"show"!=folders_media_options.show_in_page||e(".tree-structure").length||e(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>')})))}function G(){if(e("#media-attachment-taxonomy-filter").length&&(e("#media-attachment-taxonomy-filter").each((function(){folders_media_options.terms=x;var t=e(this);currentDDVal=e(this).val(),t.html("<option value='all'>"+folders_media_options.lang.SELECT_FOLDER+"</option><option value='unassigned'>"+folders_media_options.lang.UNASSIGNED+"</option>"),x;for(var o=0;o<x.length;o++)t.append("<option value='"+x[o].term_id+"'>"+x[o].name+" ("+x[o].trash_count+")</option>");t.val(currentDDVal)})),e("select.folder_for_media").length)){var t=e("select.folder_for_media").val();e("select.folder_for_media option:not(:first-child):not(:last-child)").remove();for(var o=0;o<x.length;o++)e("select.folder_for_media option:last-child").before("<option value='"+x[o].term_id+"'>"+x[o].name+"</option>");""!=t&&e(".folder_for_media").val(t)}for(e("span.premio-folder-count").text(""),e(".folder-count").text(""),o=0;o<x.length;o++)e(".jstree-node[id='"+x[o].term_id+"'] > a.jstree-anchor span.premio-folder-count").text(x[o].trash_count),e(".sticky-folder-"+x[o].term_id+" .premio-folder-count").text(x[o].trash_count);e("span.premio-folder-count").each((function(){""==e(this).text()&&e(this).text(0)})),""!=h&&e("#wcp_folder_"+h).addClass("active-item"),j&&(e("#title_"+n).trigger("click"),j=!1)}function Z(){var t=e.trim(e("#folder-search").val());e("#js-tree-menu").jstree("search",t)}function $(t){var o=folders_media_options.lang.DELETE_FOLDER_MESSAGE,s=folders_media_options.lang.ITEM_NOT_DELETED;if(v=!1,1==t&&e("#menu-checkbox").is(":checked")){if(v=!0,0==e("#js-tree-menu input.checkbox:checked").length)return e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(folders_media_options.lang.SELECT_AT_LEAST_ONE_FOLDER),void e("#error-folder-popup").show();e("#js-tree-menu input.checkbox:checked").length>1&&(o=folders_media_options.lang.DELETE_FOLDERS_MESSAGE,s=folders_media_options.lang.ITEMS_NOT_DELETED)}e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#remove-folder-item").text(folders_media_options.lang.YES_DELETE_IT),e("#remove-folder-message").text(o),e("#remove-folder-notice").text(s),e("#confirm-remove-folder").show(),e("#remove-folder-item").focus()}function ee(){folderName=e.trim(e("#js-tree-menu").jstree(!0).get_node(n).text),parentID=e("#wcp_folder_"+n).closest("li.jstree-node").data("folder-id"),parentID==t&&(parentID=0),e("#update-folder-data").text(folders_media_options.lang.SUBMIT),e(".folder-form-errors").removeClass("active"),e("#update-folder-item-name").val(folderName),e("#update-folder-item").removeClass("disabled"),e("#update-folder-item").show(),e("#update-folder-item-name").focus(),e(".dynamic-menu").remove()}function te(){if(0==p&&m>=10)return e("#folder-limitation-message").html("You've reached the 10 folder limitation!"),e("#no-more-folder-credit").show(),!1;e("#add-update-folder-title").text(folders_media_options.lang.ADD_NEW_FOLDER),e("#save-folder-data").text(folders_media_options.lang.SUBMIT),e(".folder-form-errors").removeClass("active"),e("#add-update-folder-name").val(""),k&&(w=n,e("#add-update-folder-name").val(e.trim(e("#js-tree-menu").jstree(!0).get_node(n).text)+" #2"),n=e("#"+n+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?e("#"+n+"_anchor").closest(".jstree-node").parent().parent().attr("id"):0),e("#add-update-folder").removeClass("disabled"),e("#add-update-folder").show(),e("#add-update-folder-name").focus(),e(".dynamic-menu").remove()}function oe(){setTimeout((function(){if(e("#js-tree-menu .jstree-node.jstree-leaf").length==e("#js-tree-menu .jstree-node").length)e("#expand-collapse-list").removeClass("all-open"),e("#expand-collapse-list").attr("data-folder-tooltip",folders_media_options.lang.EXPAND);else{var t=e("#js-tree-menu .jstree-node.jstree-closed").length+e("#js-tree-menu .jstree-node.jstree-open").length;e("#js-tree-menu .jstree-node.jstree-closed").length==t?(e("#expand-collapse-list").removeClass("all-open"),e("#expand-collapse-list").attr("data-folder-tooltip",folders_media_options.lang.EXPAND)):(e("#expand-collapse-list").addClass("all-open"),e("#expand-collapse-list").attr("data-folder-tooltip",folders_media_options.lang.COLLAPSE))}}),500),J()}function se(t){L=e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_get_default_list&active_id="+h,method:"post",beforeSend:function(){null!=L&&L.abort()},success:function(t){t=e.parseJSON(t),e(".header-posts .total-count").text(t.total_items),e(".un-categorised-items .total-count").text(t.empty_items),selectedVal=e("#media-attachment-taxonomy-filter").val(),selectedVal,x=t.taxonomies,G(),J()}})}function ae(){e(".folder-loader-ajax").addClass("active"),e(".folder-loader-ajax img").removeClass("active"),e(".folder-loader-ajax svg#successAnimation").addClass("active").addClass("animated"),setTimeout((function(){e(".folder-loader-ajax").removeClass("active"),e(".folder-loader-ajax img").addClass("active"),e(".folder-loader-ajax svg#successAnimation").removeClass("active").removeClass("animated")}),2e3),J()}e(document).ready((function(){e(document).on("click",".folder-settings-btn > a",(function(t){t.stopPropagation(),e(".folder-settings-btn").toggleClass("active")})),e(document).on("click","body,html",(function(){e(".folder-settings-btn").removeClass("active")})),e(document).on("click",".folder-setting-menu",(function(e){e.stopPropagation()})),e(document).on("click","#remove-from-all-folders:not(.disabled), #remove-from-current-folder:not(.disabled)",(function(){e("#remove-from-all-folders, #remove-from-current-folder").addClass("disabled");var t="all";e(this).hasClass("remove-from-current-folder")&&(t="current"),e("#confirm-your-change").hide(),e.ajax({url:folders_media_options.ajax_url,data:{post_id:e("#unassigned_folders").val(),action:"wcp_remove_post_folder",active_folder:h,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:folders_media_options.taxonomy_status,taxonomy:h,remove_from:t},method:"post",success:function(t){e("#remove-from-all-folders, #remove-from-current-folder").removeClass("disabled"),ae(),q(),M()}})})),o=parseInt(folders_media_options.hasStars),s=parseInt(folders_media_options.hasChildren),e(document).on("click",".thumbnail-hover-box a",(function(t){return t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),window.open(e(this).prop("href"),"_blank"),!1})),e(document).ajaxComplete((function(e,o,s){if(s.data!=t&&""!=s.data&&"string"==typeof s.data&&-1!=s.data.indexOf("action=query-attachments")&&J(),a.length>0)for(var r=0;r<a.length;r++)if(jQuery(".folder-modal ul.attachments li[data-id='"+a[r]+"']").length&&!jQuery(".folder-modal ul.attachments li[data-id='"+a[r]+"']").hasClass("selected")){var d=jQuery.Event("click");d.ctrlKey=!0,jQuery(".folder-modal ul.attachments li[data-id='"+a[r]+"']").trigger(d)}})),x=folders_media_options.terms,p=parseInt(folders_media_options.is_key_active),m=parseInt(folders_media_options.folders),r=folders_media_options.folder_settings,e(document).on("click",".header-posts a.all-posts",(function(t){n=0,h="",d="all",e(".active-item").removeClass("active-item"),e(".jstree-clicked").removeClass("jstree-clicked"),e(this).addClass("active-item"),e(".sticky-folders .active-item").removeClass("active-item"),e(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("all").trigger("change"),e(this).closest(".media-frame").find(".folder_for_media").val("all").trigger("change"),F()})),e(document).on("click",".un-categorised-items",(function(t){n=0,h="",d="unassigned",e(".active-item").removeClass("active-item"),e(".sticky-folders .active-item").removeClass("active-item"),e(".jstree-clicked").removeClass("jstree-clicked"),e(this).addClass("active-item"),e(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("unassigned").trigger("change"),e(this).closest(".media-frame").find(".folder_for_media").val("-1").trigger("change"),F()})),e(document).on("click","a.jstree-anchor",(function(t){var o,s=e(this).closest("li.jstree-node").attr("id");d=n=s,e(this).closest(".folder-modal").find(".active-item").removeClass("active-item"),e(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").val(s),e(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").trigger("change"),thisSlug=Y(s,"slug"),o=thisSlug,e.ajax({url:folders_media_options.ajax_url,type:"post",data:"action=save_folder_last_status&post_type="+folders_media_options.post_type+"&post_id="+o+"&nonce="+folders_media_options.nonce,cache:!1,async:!1,success:function(){}}),e(".custom-media-select").removeClass("active"),e(".folder-modal #js-tree-menu .jstree-clicked").removeClass("jstree-clicked"),e(".folder-modal #js-tree-menu").jstree("select_node",h),e(".folder-modal #js-tree-menu #"+d+"_anchor").addClass("jstree-clicked"),F()})),e(document).on("change",".folder_for_media",(function(){"add-folder"!=e(this).val()&&null!=e(this).val()?d=e(this).val():"add-folder"==e(this).val()&&(d=-1)})),e(document).on("click",".new-folder-pro",(function(t){t.preventDefault(),e(".dynamic-menu").remove(),e("#sub-folder-popup").show()})),e(document).on("click",".close-popup-button a",(function(){e(".folder-popup-form").hide(),e(".folder-modal .jstree-node[id='"+n+"']").length?e(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")})),e(document).on("click",".update-inline-record",(function(a){var r;(a.stopImmediatePropagation(),a.stopPropagation(),0!=folders_media_options.can_manage_folder)&&(isHigh=e(this).closest("li.sticky-fldr").hasClass("is-high"),isSticky=e(this).closest("li.sticky-fldr").hasClass("is-sticky"),isStickyClass=!!isSticky,e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu' data-id='"+e(this).closest("li").data("folder-id")+"'><ul>",menuHtml+="<li class='new-main-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.NEW_FOLDER+"</a></li>",menuHtml+=s?"<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.NEW_FOLDER+"</a></li>":"<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.PRO.NEW_SUB_FOLDER+"</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>"+folders_media_options.lang.RENAME+"</a></li>",menuHtml+="<li class='color-folder'><a href='javascript:;'><span class=''><span class='dashicons dashicons-art'></span></span>"+folders_media_options.lang.CHANGE_COLOR+"<span class='dashicons dashicons-arrow-right-alt2'></span></a>",menuHtml+="<ul class='color-selector'>",menuHtml+="<li class='color-selector-ul'>",e(folders_media_options.selected_colors).each((function(e,t){menuHtml+="<span class='folder-color-option' data-color='"+t+"' style='background-color:"+t+"'></span>"})),menuHtml+="</li>",menuHtml+="<li><a href='"+folders_media_options.upgrade_url+"' target='_blank' class='change-custom-color'>"+folders_media_options.lang.ADD_CUSTOM_COLORS+"</a></li>",menuHtml+="<li><a href='javascript:;' class='folder-color-default'>"+folders_media_options.lang.REMOVE_COLOR+"</a></li>",menuHtml+="</ul>",menuHtml+="</li>",menuHtml+="<li class='default-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-active-icon'></i></span>"+folders_media_options.lang.PRO.OPEN_THIS_FOLDER+"</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>"+folders_media_options.lang.PRO.STICKY_FOLDER+"</a></li>",menuHtml+=o?"<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?folders_media_options.lang.REMOVE_STAR:folders_media_options.lang.ADD_STAR)+"</a></li>":"<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?folders_media_options.lang.PRO.REMOVE_STAR:folders_media_options.lang.PRO.ADD_STAR)+"</a></li>",menuHtml+="<li class='lock-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='dashicons dashicons-lock'></span> "+folders_media_options.lang.PRO.LOCK_FOLDER+"</a></li><li class='duplicate-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-clone'></i></span> "+folders_media_options.lang.PRO.DUPLICATE_FOLDER+"</a></li>",hasPosts=parseInt(e(this).closest("li.jstree-node").find("h3.title:first > .total-count").text()),"attachment"==folders_media_options.post_type&&hasPosts&&(menuHtml+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span>"+folders_media_options.lang.PRO.DOWNLOAD_ZIP+"</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>"+folders_media_options.lang.DELETE+"</a></li></ul></div>",e("body").append(menuHtml),a.pageX==t||a.pageY==t?(e(".dynamic-menu").css("left",C),e(".dynamic-menu").css("top",S-10),r=S):(e(".dynamic-menu").css("left",a.pageX),e(".dynamic-menu").css("top",a.pageY),r=a.pageY),r+e(".dynamic-menu").height()>e(window).height()&&e(".dynamic-menu").css("margin-top",e(window).height()-(r+e(".dynamic-menu").height())))})),e(document).on("click",".folder-color-option , .folder-color-default",(function(t){t.stopPropagation(),l=e(this).closest(".dynamic-menu").data("id");var o=e(this).attr("data-color");void 0===o&&(o="");var s=B(l);r[s].has_color=o,u=Y(l,"nonce"),U(),e.ajax({url:folders_media_options.ajax_url,data:{term_id:l,type:folders_media_options.post_type,action:"wcp_change_color_folder",nonce:u,color:o},method:"post",cache:!1,success:function(t){t=e.parseJSON(t),U()}})})),e(document).on("click","body, html",(function(t){e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),e(".folder-order").removeClass("active")})),e(document).on("click",".dynamic-menu, .folder-order",(function(e){e.stopPropagation()})),e(document).on("contextmenu",".jstree-anchor",(function(t){return C=t.pageX,S=t.pageY,e(this).find("span.folder-inline-edit").trigger("click"),!1})),e(document).on("click",".folder-actions span.folder-inline-edit",(function(a){var r;if(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault(),0!=folders_media_options.can_manage_folder)return isHigh=e(this).closest("li.jstree-node").hasClass("is-high"),isSticky=e(this).closest("li.jstree-node").hasClass("is-sticky"),isStickyClass=!!isSticky,e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu' data-id='"+e(this).closest("li").prop("id")+"'><ul>",menuHtml+="<li class='new-main-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.NEW_FOLDER+"</a></li>",menuHtml+=s?"<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.NEW_FOLDER+"</a></li>":"<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>"+folders_media_options.lang.PRO.NEW_SUB_FOLDER+"</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>"+folders_media_options.lang.RENAME+"</a></li>",menuHtml+="<li class='color-folder'><a href='javascript:;'><span class=''><span class='dashicons dashicons-art'></span></span>"+folders_media_options.lang.CHANGE_COLOR+"<span class='dashicons dashicons-arrow-right-alt2'></span></a>",menuHtml+="<ul class='color-selector'>",menuHtml+="<li class='color-selector-ul'>",e(folders_media_options.selected_colors).each((function(e,t){menuHtml+="<span class='folder-color-option' data-color='"+t+"' style='background-color:"+t+"'></span>"})),menuHtml+="</li>",menuHtml+="<li><a href='"+folders_media_options.upgrade_url+"' target='_blank' class='change-custom-color'>"+folders_media_options.lang.ADD_CUSTOM_COLORS+"</a></li>",menuHtml+="<li><a href='javascript:;' class='folder-color-default'>"+folders_media_options.lang.REMOVE_COLOR+"</a></li>",menuHtml+="</ul>",menuHtml+="</li>",menuHtml+="<li class='default-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-active-icon'></i></span>"+folders_media_options.lang.PRO.OPEN_THIS_FOLDER+"</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>"+folders_media_options.lang.PRO.STICKY_FOLDER+"</a></li>",menuHtml+=o?"<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?folders_media_options.lang.REMOVE_STAR:folders_media_options.lang.ADD_STAR)+"</a></li>":"<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?folders_media_options.lang.PRO.REMOVE_STAR:folders_media_options.lang.PRO.ADD_STAR)+"</a></li>",menuHtml+="<li class='lock-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='dashicons dashicons-lock'></span>"+folders_media_options.lang.PRO.LOCK_FOLDER+"</a></li><li class='duplicate-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-clone'></i></span>"+folders_media_options.lang.PRO.DUPLICATE_FOLDER+"</a></li>",hasPosts=parseInt(e(this).closest("a.jstree-anchor").find(".premio-folder-count").text()),"attachment"==folders_media_options.post_type&&hasPosts&&(menuHtml+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span>"+folders_media_options.lang.PRO.DOWNLOAD_ZIP+"</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>"+folders_media_options.lang.DELETE+"</a></li></ul></div>",e("body").append(menuHtml),e(this).parents("li.jstree-node").addClass("active-menu"),a.pageX==t||a.pageY==t?(e(".dynamic-menu").css("left",C),e(".dynamic-menu").css("top",S-10),r=S):(e(".dynamic-menu").css("left",a.pageX),e(".dynamic-menu").css("top",a.pageY),r=a.pageY),r+e(".dynamic-menu").height()>e(window).height()&&e(".dynamic-menu").css("margin-top",e(window).height()-(r+e(".dynamic-menu").height())),!1})),e(document).on("click",".dynamic-menu",(function(e){e.stopImmediatePropagation(),e.stopPropagation()})),e(document).on("click","body, html",(function(){e(".dynamic-menu").remove()})),e(document).on("click",".new-folder",(function(t){t.stopPropagation(),n=e(this).closest(".dynamic-menu").data("id"),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),j=!1,k=!1,te()})),e(document).on("click",".new-main-folder",(function(){y=1,n=e(this).closest(".dynamic-menu").data("id"),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),j=!1,k=!1,te()})),e(document).on("click","#add-new-folder",(function(t){e("#js-tree-menu a.jstree-clicked").length?(n=e("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),s||e("#pro-notice").removeClass("hide-it")):(n=0,e("#pro-notice").addClass("hide-it")),j=!1,te()})),e(document).on("submit","#save-folder-form",(function(t){if(t.stopPropagation(),t.preventDefault(),c=e("#add-update-folder-name").val(),""==e.trim(c))e(".folder-form-errors").addClass("active"),e("#add-update-folder-name").focus();else{e("#save-folder-data").html('<span class="dashicons dashicons-update"></span>'),e("#add-update-folder").addClass("disabled");var o=n;j&&(o=0),s||(o=0);var a="";0==o?(b=e("#js-tree-menu > ul > li.jstree-node").length,y&&(b=jQuery("#js-tree-menu > ul > li[id='"+n+"']").index(),jQuery("#js-tree-menu > ul > li").each((function(e){a+=jQuery(this).attr("id")+",",e==b&&(a+="#,")})),b+=1)):b=e("#js-tree-menu > ul > li.jstree-node[id='"+o+"'] > ul.jstree-children > li").length+1;var d=[];0==o?e("#js-tree-menu > .jstree-container-ul > .jstree-node").length&&e("#js-tree-menu > .jstree-container-ul > .jstree-node").each((function(){d.push(e(this).attr("id"))})):e("#js-tree-menu .jstree-node[id='"+o+"'] > ul> li.jstree-node").length&&e("#js-tree-menu .jstree-node[id='"+o+"'] > ul> li.jstree-node").each((function(){d.push(e(this).attr("id"))})),e.ajax({url:folders_media_options.ajax_url,data:{parent_id:o,type:folders_media_options.post_type,action:"wcp_add_new_folder",nonce:folders_media_options.nonce,term_id:o,order:b,name:c,is_duplicate:k,duplicate_from:w,parent_ids:a,folders:d,parent_menu:y},method:"post",success:function(t){if(result=e.parseJSON(t),e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),-1==result.status)e("#no-more-folder-credit").show();else if("1"==result.status){if(p=parseInt(result.is_key_active),m=parseInt(result.folders),e("#current-folder").text(m),e("#ttl-fldr").text(10),oe(),result.data.length)for(var o=0;o<result.data.length;o++){var s={folder_id:result.data[o].term_id,folder_count:0,is_sticky:result.data[o].is_sticky,is_high:result.data[o].is_high,has_color:result.has_color,nonce:result.data[o].nonce,slug:result.data[o].slug,is_deleted:0},a=result.data[o].title;a=a.replace(/\\/g,""),r.push(s),y?e("#js-tree-menu").jstree().create_node("#",{id:result.data[o].term_id,text:" "+a},o,(function(){e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-nonce",result.data[o].nonce),e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-slug",result.data[o].slug),e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-parent",result.parent_id),e(".jstree-node[id='"+result.data[o].term_id+"'] > a.jstree-anchor .premio-folder-count").text(result.data[o].folder_count)})):e("#js-tree-menu").jstree().create_node(result.parent_id,{id:result.data[o].term_id,text:" "+a},o,(function(){e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-nonce",result.data[o].nonce),e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-slug",result.data[o].slug),e(".jstree-node[id='"+result.data[o].term_id+"']").attr("data-parent",result.parent_id),e(".jstree-node[id='"+result.data[o].term_id+"'] > a.jstree-anchor .premio-folder-count").text(result.data[o].folder_count)})),y=0,e(".jstree-node[id='"+result.data[o].term_id+"']").length&&e(".jstree-node[id='"+result.data[o].term_id+"'] > a.jstree-anchor").trigger("focus")}ae(),W(),n=result.term_id,se(0),k=!1,w=0}else e("#error-folder-popup-message").html(result.message),e("#error-folder-popup").show()}})}return!1})),e(document).on("click",".form-cancel-btn",(function(){e(".folder-popup-form").hide(),e(".folder-modal .jstree-node[id='"+n+"']").length?e(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")})),e(document).on("click",".folder-popup-form",(function(t){e(".folder-popup-form").hide(),e(".folder-modal .jstree-node[id='"+n+"']").length?e(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")})),e(document).on("click",".popup-form-content",(function(e){e.stopPropagation()})),document.onkeydown=function(t){("key"in(t=t||window.event)?"Escape"===t.key||"Esc"===t.key:27===t.keyCode)&&e(".folder-popup-form").hide()},e(document).on("click",".rename-folder",(function(t){t.stopPropagation(),n=e(this).closest(".dynamic-menu").data("id"),ee(),e(".dynamic-menu").remove()})),e(document).on("click","#inline-update",(function(t){e("#js-tree-menu a.jstree-clicked").length&&(n=e("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),ee())})),e(document).on("submit","#update-folder-form",(function(o){return o.stopPropagation(),o.preventDefault(),c=e("#update-folder-item-name").val(),""==e.trim(c)?(e(".folder-form-errors").addClass("active"),e("#update-folder-item-name").focus()):(e("#update-folder-data").html('<span class="dashicons dashicons-update"></span>'),e("#update-folder-item").addClass("disabled"),u=Y(n,"nonce"),parentID=e(".jstree-node[id='"+n+"']").closest("li.jstree-node").attr("id"),parentID==t&&(parentID=0),e.ajax({url:folders_media_options.ajax_url,data:{parent_id:parentID,type:folders_media_options.post_type,action:"wcp_update_folder",nonce:u,term_id:n,order:b,name:c},method:"post",success:function(t){result=e.parseJSON(t),"1"==result.status?(e("#js-tree-menu").jstree("rename_node",result.id," "+result.term_title),folderPostId=B(result.id),null!=folderPostId&&(r[folderPostId].nonce=result.nonce,r[folderPostId].slug=result.slug),e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),ae(),e("#media-attachment-taxonomy-filter").length&&se(0),e(".folder-modal .jstree-node[id='"+result.id+"']").length?e(".folder-modal .jstree-node[id='"+result.id+"'] > a.jstree-anchor").trigger("focus"):e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")):(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(result.message),e("#error-folder-popup").show())}})),!1})),e(document).on("click",".mark-folder",(function(t){t.stopPropagation(),l=e(this).closest(".dynamic-menu").data("id"),u=Y(l,"nonce"),e(".form-loader-count").css("width","100%"),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"),e.ajax({url:folders_media_options.ajax_url,data:"term_id="+l+"&type="+folders_media_options.post_type+"&action=wcp_mark_un_mark_folder&nonce="+u,method:"post",cache:!1,success:function(t){t=e.parseJSON(t),e(".form-loader-count").css("width","0%"),"1"==t.status?(folderPostId=B(t.id),"1"==t.marked?(e("li.jstree-node[id='"+t.id+"']").addClass("is-high"),e(".sticky-folder-"+t.id).addClass("is-high"),null!=folderPostId&&(r[folderPostId].is_high=1)):(e("li.jstree-node[id='"+t.id+"']").removeClass("is-high"),e(".sticky-folder-"+t.id).removeClass("is-high"),null!=folderPostId&&(r[folderPostId].is_high=0)),e(".folder-modal .jstree-node[id='"+t.id+"']").length?e(".folder-modal .jstree-node[id='"+t.id+"'] > a.jstree-anchor").trigger("focus"):e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus"),ae()):(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show())}})})),e(document).on("click",".duplicate-folder",(function(t){t.stopPropagation(),n=e(this).closest(".dynamic-menu").data("id"),e(".dynamic-menu").remove(),j=!1,k=!0,te()})),e(document).on("click",".remove-folder",(function(){l=e(this).closest(".dynamic-menu").data("id"),n=e(this).closest(".dynamic-menu").data("id"),$(0),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu")})),e(document).on("click","#remove-folder-item",(function(t){t.stopPropagation(),e(".folder-popup-form").addClass("disabled"),e("#remove-folder-item").html('<span class="dashicons dashicons-update"></span>'),u=Y(n,"nonce"),v?function(){if(e("#menu-checkbox").is(":checked")&&e("#js-tree-menu input.checkbox:checked").length>0){var t="";e("#js-tree-menu input.checkbox:checked").each((function(){t+=e(this).closest("li.jstree-node").attr("id")+",",e(this).closest("li.jstree-node").hasClass("jstree-clicked")&&!0})),e(".form-loader-count").css("width","100%"),e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_muliple_folder&term_id="+t+"&nonce="+folders_media_options.nonce,method:"post",success:function(t){if(t=e.parseJSON(t),e(".form-loader-count").css("width","0px"),"1"==t.status){for(p=parseInt(t.is_key_active),m=parseInt(t.folders),e("#current-folder").text(m),i=0;i<t.term_ids.length;i++)e(".folder-modal #js-tree-menu").jstree().delete_node(t.term_ids[i]);e("#ttl-fldr").text(10),ae(),e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),q(),W(),ae(),e(".folder-modal #wcp_folder_"+h).length||(e(".header-posts a").trigger("click"),h=0)}else window.location.reload();e("#menu-checkbox").attr("checked",!1),e("#js-tree-menu input.checkbox").attr("checked",!1),e("#js-tree-menu").removeClass("show-folder-checkbox")}})}}():e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_folder&term_id="+n+"&nonce="+u,method:"post",success:function(t){if("1"==(t=e.parseJSON(t)).status){var o=function(t){if(e(".jstree-node[id='"+t+"']").next().length)return e(".jstree-node[id='"+t+"']").next().attr("id");if(e(".jstree-node[id='"+t+"']").prev().length)return e(".jstree-node[id='"+t+"']").prev().attr("id");if(e(".jstree-node[id='"+t+"']").parent().parent().hasClass("jstree-node"))return e(".jstree-node[id='"+t+"']").parent().parent().attr("id");return 0}(n);e("#js-tree-menu").jstree().delete_node(n),p=parseInt(t.is_key_active),m=parseInt(t.folders),e("#current-folder").text(m),e("#ttl-fldr").text(10),e(".sticky-folders .sticky-folder-"+n).remove(),ae(),e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),q(),W(),h==n&&e(".header-posts").trigger("click"),0!=o&&e("#"+o+"_anchor").length?e("#"+o+"_anchor").trigger("click"):e(".header-posts").trigger("click")}else e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show()}})})),e(document).on("click","#sort-order-list",(function(t){t.stopPropagation(),e(".folder-order").toggleClass("active")})),e(document).on("click","#expand-collapse-list",(function(t){t.stopPropagation();var o=0;e(this).hasClass("all-open")?(e(this).removeClass("all-open"),o=0,e(this).attr("data-folder-tooltip",folders_media_options.lang.EXPAND),e("#js-tree-menu").jstree("close_all")):(e(this).addClass("all-open"),o=1,e(this).attr("data-folder-tooltip",folders_media_options.lang.COLLAPSE),e("#js-tree-menu").jstree("open_all")),g="",e("#js-tree-menu .jstree-node:not(.jstree-leaf)").each((function(){g+=e(this).attr("id")+","})),""!=g&&(e(".form-loader-count").css("width","100%"),u=folders_media_options.nonce,e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_change_all_status&status="+o+"&folders="+g+"&nonce="+u,method:"post",success:function(t){e(".form-loader-count").css("width","0"),"0"==(t=e.parseJSON(t)).status&&(e(".folder-popup-form").hide(),e(".folder-popup-form").removeClass("disabled"),e("#error-folder-popup-message").html(t.message),e("#error-folder-popup").show(),window.location.reload(!0),e(".folder-modal .jstree-anchor.jstree-clicked").length&&e(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus"))}}))})),e(document).on("click",".folder-sort-menu a:not(.pro-feature)",(function(t){t.stopPropagation(),t.preventDefault(),e(".form-loader-count").css("width","100%"),e(".folder-order").removeClass("active"),e(this).attr("data-sort"),e.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_folders_by_order&nonce="+folders_media_options.nonce+"&order="+e(this).attr("data-sort"),method:"post",success:function(t){1==(t=e.parseJSON(t)).status&&(e("#js-tree-menu").jstree().destroy(),e("#js-tree-menu").append("<ul></ul>"),e("#js-tree-menu ul").html(t.data),x=t.terms,G(),V()),e(".form-loader-count").css("width","0")}})})),e(document).on("change","#media-attachment-taxonomy-filter",(function(t){e("#js-tree-menu").hasClass("jstree")&&e("#js-tree-menu").jstree(!0).deselect_all(),e(".active-item").removeClass("active-item"),"all"==e(this).val()?e(".all-posts").addClass("active-item"):"unassigned"==e(this).val()?e(".un-categorised-items").addClass("active-item"):e("#js-tree-menu").jstree("select_node",e(this).val())})),e(document).on("click",".jstree-node .jstree-icon",(function(){l=e(this).closest("li.jstree-node").attr("id"),e("li.jstree-node[id='"+l+"']").hasClass("jstree-open")?folderStatus=1:folderStatus=0,e(".form-loader-count").css("width","100%"),u=Y(l,"nonce"),oe(),e.ajax({url:folders_media_options.ajax_url,data:"is_active="+folderStatus+"&action=save_wcp_folder_state&term_id="+l+"&nonce="+u,method:"post",success:function(t){e(".form-loader-count").css("width","0"),"0"==(t=e.parseJSON(t)).status||(e("#wcp_folder_"+l).hasClass("active")?(e("#wcp_folder_"+l).removeClass("active"),e("#wcp_folder_"+l).find("ul.ui-sortable:first-child > li").slideUp(),folderStatus=0):(e("#wcp_folder_"+l).addClass("active"),e("#wcp_folder_"+l).find("ul.ui-sortable:first-child > li").slideDown(),folderStatus=1),ae())}})})),e(document).on("keyup","#folder-search",(function(){Z()})),e(document).on("change","#folder-search",(function(){Z()})),e(document).on("blur","#folder-search",(function(){Z()})),e(document).on("click","#do_not_show_again",(function(){var t=e(this).is(":checked")?1:0;e.ajax({url:folders_media_options.ajax_url,type:"post",data:{action:"premio_hide_child_popup",status:t,nonce:folders_media_options.nonce,post_type:folders_media_options.post_type}})})),e(document).on("click","#menu-checkbox",(function(){e(this).is(":checked")?(e("#js-tree-menu").addClass("show-folder-checkbox"),e("#menu-checkbox").prop("checked",!0)):(e("#js-tree-menu input.checkbox").attr("checked",!1),e("#js-tree-menu").removeClass("show-folder-checkbox"),e("#menu-checkbox").prop("checked",!1))})),e(document).on("click","#menu-checkbox",(function(){e(this).is(":checked")?(e("#menu-checkbox").prop("checked",!0),e("#js-tree-menu").addClass("show-folder-checkbox")):(e("#menu-checkbox").prop("checked",!1),e("#js-tree-menu input.checkbox").attr("checked",!1),e("#js-tree-menu").removeClass("show-folder-checkbox"))})),e(document).on("click",".folder-checkbox, .input-checkbox",(function(e){e.stopImmediatePropagation(),e.stopPropagation()})),e(document).on("click","#inline-remove, .delete-folder-action:not(.disabled)",(function(){e("#js-tree-menu a.jstree-clicked").length?(n=e("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),$(1),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu")):e("#menu-checkbox").is(":checked")&&(e(".dynamic-menu").remove(),$(1))})),e(document).on("change",".folder_for_media",(function(){"add-folder"==e(this).val()&&(j=!0,e("#add-new-folder").trigger("click"))})),e(document).on("click","#js-tree-menu input.checkbox",(function(){F()})),J(),e(document).on("click",".undo-button, .undo-folder-action:not(.disabled)",(function(){e("#do-undo").removeClass("active"),"yes"==folders_media_options.useFolderUndo&&e.ajax({url:folders_media_options.ajax_url,type:"post",data:{post_type:folders_media_options.post_type,nonce:folders_media_options.nonce,action:"wcp_undo_folder_changes"},success:function(t){e("#undo-done").addClass("active"),setTimeout((function(){e("#undo-done").removeClass("active")}),2500),q()}})})),e(document).on("click",".close-undo-box",(function(t){t.preventDefault(),e("#do-undo").removeClass("active")}))})),e(document).ready((function(){"yes"==folders_media_options.use_shortcuts&&(e(document).on("click",".view-shortcodes",(function(t){t.preventDefault(),e("#keyboard-shortcut").show()})),e(document).keydown((function(t){var o=!(!t.ctrlKey&&!t.metaKey);if(e("input").is(":focus")||e("textarea").is(":focus")||!t.altKey||78!=t.keyCode&&78!=t.which||e(".block-editor-block-list__block").is(":focus")||!e(".folder-modal").length||(t.preventDefault(),e("#add-new-folder").trigger("click")),113!=t.keyCode&&113!=t.which||e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(n=e("#js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),ee(),e(".dynamic-menu").remove()),o&&(67==t.keyCode||t.which),o&&(88==t.keyCode||t.which),o&&(86==t.keyCode||t.which),!o||75!=t.keyCode&&75!=t.which||e("#keyboard-shortcut").show(),o&&(40==t.keyCode||40==t.which)&&e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var s=parseInt(e(".folder-modal #"+n).data("parent")),a=parseInt(e(".folder-modal #"+n).index())+1,r=parseInt(e(".folder-modal #"+n).data("child"));isNaN(s)&&(s=e(".folder-modal li#"+n).parents("li.jstree-node").length?e(".folder-modal li#"+n).parents("li.jstree-node").data("folder"):0,r=e(".folder-modal li#"+n).parents("li.jstree-node").length?e(".folder-modal li#"+n).parents("li.jstree-node").children():e(".folder-modal #js-tree-menu > ul > li").length),0==s&&(s=""),r==a?e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,0):e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,a+1)}if(o&&(38==t.keyCode||38==t.which)&&e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");s=parseInt(e(".folder-modal #"+n).data("parent")),a=parseInt(e(".folder-modal #"+n).index())-1,r=parseInt(e(".folder-modal #"+n).data("child"));isNaN(s)&&(a=parseInt(e("#"+n).index())-1,s=e(".folder-modal li#"+n).parents("li.jstree-node").length?e(".folder-modal li#"+n).parents("li.jstree-node").data("folder"):0,r=e(".folder-modal li#"+n).parents("li.jstree-node").length?e(".folder-modal li#"+n).parents("li.jstree-node").children():e(".folder-modal #js-tree-menu > ul > li").length),0==s&&(s=""),-1==a?e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,r):e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,a)}if(46!=t.keyCode&&46!=t.which&&8!=t.keyCode&&8!=t.which||e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").hasClass("is-locked")||(n=e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),$(0),e(".dynamic-menu").remove(),e(".active-menu").removeClass("active-menu"))),o&&(40==t.keyCode||40==t.which)&&e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");s=parseInt(e("#"+n).data("parent")),a=parseInt(e("#"+n).index())+1;0==s&&(s=""),(r=parseInt(e("#"+n).data("child")))==a?e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,0):e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,a+1)}if(o&&(38==t.keyCode||38==t.which)&&e(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=e(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");s=parseInt(e("#"+n).data("parent")),a=parseInt(e("#"+n).index())-1,r=parseInt(e("#"+n).data("child"));0==s&&(s=""),-1==a?e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,r):e(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+s,a)}27!=t.keyCode&&27!=t.which||(e(".folder-popup-form").hide(),e(".jstree-node[id='"+n+"']").length?e(".jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):e("#js-tree-menu .jstree-anchor.jstree-clicked").length&&e("#js-tree-menu .jstree-anchor.jstree-clicked").trigger("focus"))})))}))}));