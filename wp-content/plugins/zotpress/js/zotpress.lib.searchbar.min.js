jQuery(document).ready((function(){if(jQuery(".zp-Zotpress-SearchBox").length>0){var e=!0,t=1,r="",a="",n=zpShortcodeAJAX.ajaxurl+"?action=zpRetrieveViaShortcode&zpShortcode_nonce="+zpShortcodeAJAX.zpShortcode_nonce,u=!1;jQuery(".ZP_SHOWTAGS").length>0&&"1"==parseInt(jQuery(".ZP_SHOWTAGS").text())&&(u=!0);var s=!1;jQuery(".ZOTPRESS_AC_IMAGES").length>0&&(s=!0);var o=!1;function i(e,t,r){void 0!==e&&"false"!=e&&""!=e||(e=!1),void 0!==t&&"false"!=t&&""!=t||(t=!1),void 0!==r&&"false"!=r&&""!=r||(r=!1),a="",a+="&api_user_id="+jQuery(".ZOTPRESS_USER").val(),a+="&item_type=items",a+="&downloadable="+jQuery(".ZOTPRESS_AC_DOWNLOAD").val(),a+="&style="+jQuery(".ZP_STYLE").text(),a+="&sortby="+jQuery(".ZP_SORTBY").text(),a+="&order="+jQuery(".ZP_ORDER").text(),a+="&citeable="+jQuery(".ZOTPRESS_AC_CITE").val(),jQuery(".ZOTPRESS_AC_MAXRESULTS").val().length>0&&(a+="&maxresults="+jQuery(".ZOTPRESS_AC_MAXRESULTS").val()),u&&(a+="&showtags=true"),s&&(a+="&showimage=true"),t&&(a+="&request_start="+t),r&&(a+="&request_last="+r),a+="&update=true",a+="&request_update="+o,e?a+="&filter="+e:jQuery("input[name=zpSearchFilters]").length>0&&(a+="&filter="+jQuery("input[name=zpSearchFilters]:checked").val())}jQuery(".ZP_UPDATENEEDED").text().trim().length>0&&"true"==jQuery(".ZP_UPDATENEEDED").text()&&(o=!0),i(!1,!1,!1),jQuery("input[name='zpSearchFilters']").click((function(){jQuery("input[name=zpSearchFilters]").length>0&&i(jQuery(this).val(),!1,!1),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",n+a),jQuery("input.zp-Zotpress-SearchBox-Input").val().length>0&&jQuery("input.zp-Zotpress-SearchBox-Input").val()!=zpShortcodeAJAX.txt_typetosearch&&jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("search")})),jQuery("input.zp-Zotpress-SearchBox-Input").bind("keydown",(function(e){e.keyCode===jQuery.ui.keyCode.TAB&&jQuery(this).data("autocomplete").menu.active&&e.preventDefault(),13===e.keyCode&&e.preventDefault()})).bind("focus",(function(e){jQuery(this).val()==zpShortcodeAJAX.txt_typetosearch&&(jQuery(this).val(""),jQuery(this).removeClass("help"))})).bind("blur",(function(e){jQuery.trim(jQuery(this).val())==r?jQuery(this).attr("autocomplete","off"):jQuery(this).attr("autocomplete","on"),""==jQuery.trim(jQuery(this).val())&&(jQuery(this).val(zpShortcodeAJAX.txt_typetosearch),jQuery(this).addClass("help"))})).autocomplete({source:n+a,minLength:jQuery(".ZOTPRESS_AC_MINLENGTH").val(),focus:function(){return!1},search:function(u,s){var p=jQuery(this).val();u.hasOwnProperty("currentTarget")&&(p=u.currentTarget.value),jQuery.ajax({url:n+a+"&term="+p,ifModified:!0,xhrFields:{withCredentials:!0},success:function(e){var t=jQuery.parseJSON(e);t.updateneeded&&(o=t.updateneeded),console.log("zp: calling zp_get_items with update check?","always"),console.log("zp: is an update needed?",o)},error:function(e){console.log("zp: Zotpress via WP AJAX Error: ",e)}}),t=1,jQuery(".zp-List .zpSearchLoading").addClass("show"),jQuery(".zpSearchResultsPaging").length>0&&(jQuery(".zpSearchResultsPaging").empty(),jQuery(".zpSearchResultsPagingContainer").hide()),jQuery(".zpSearchResultsContainer").empty(),i(!1,0,!1),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",n+a),window.zpPage=1,1==e&&p&&(r=p)},response:function(s,c){if(jQuery(".zp-List .zpSearchLoading").removeClass("show"),"0"==c.content||"empty"==c.content[0].label)jQuery(".zpSearchResultsPaging").length>0&&(jQuery(".zpSearchResultsPaging").empty(),jQuery(".zpSearchResultsPagingContainer").hide()),jQuery(".zpSearchResultsContainer").append("<p>No items found.</p>\n");else{var l=c.content[4];l.length,p(l,u,t),0!=c.content[3].request_next&&"false"!=c.content[3].request_next?(1==e?window.zpBrowseList[0].paginate(e,!1):window.zpBrowseList[0].paginate(e,!0),e=!1,i(!1,c.content[3].request_next,c.content[3].request_last),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",n+a),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("search")):o?(console.log("zp: update needed"),jQuery(".zp-List .zpSearchLoading").addClass("show"),jQuery.ajax({url:n+a.replace("request_update=false","request_update=true")+"&term="+r,ifModified:!0,xhrFields:{withCredentials:!0},success:function(r){var a=jQuery.parseJSON(r);a.updateneeded&&(o=a.updateneeded),console.log("zp: calling zp_get_items with update check?","always"),console.log("zp: is an update needed?",o),jQuery(".zpSearchResultsPaging").length>0&&(jQuery(".zpSearchResultsPaging").empty(),jQuery(".zpSearchResultsPagingContainer").hide()),jQuery(".zpSearchResultsContainer").empty(),p(a.data,u,t),window.zpPage=1,window.zpBrowseList[0].paginate(e,!0),e=!1,o=!1,jQuery(".zp-List .zpSearchLoading").removeClass("show")},error:function(e){console.log("zp: Zotpress via WP AJAX Error: ",e)}})):(window.zpBrowseList[0].paginate(e,!0),e=!1)}},open:function(){jQuery(".ui-autocomplete").hide()}})}function p(e,t,r){jQuery.each(e,(function(e,a){var n="<div id='zp-Entry-"+a.key+"' class='zp-Entry zpSearchResultsItem hidden'>\n";s&&a.hasOwnProperty("image")&&(n+="<div id='zp-Citation-"+a.key+"' class='zp-Entry-Image hasImage' rel='"+a.key+"'>\n",n+="<img class='thumb' src='"+a.image[0]+"' alt='image' />\n",n+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"),-1!=a.bib.indexOf("[1]")&&(a.bib=a.bib.replace("[1]","["+r+"]"),r++),n+=a.bib,(t||jQuery("input.tag[name=zpSearchFilters]:checked").length>0)&&a.data.tags.length>0&&(n+="<span class='item_key'>Tag(s): ",jQuery.each(a.data.tags,(function(e,t){0!=e&&(n+=", "),n+=t.tag}))),jQuery(".zpSearchResultsContainer").append(n+"</div>\x3c!-- .zp-Entry --\x3e\n"),jQuery(".zpSearchResultsPagingContainer").show()}))}}));