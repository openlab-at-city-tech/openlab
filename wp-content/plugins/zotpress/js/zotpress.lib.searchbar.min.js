jQuery(document).ready((function(){if(jQuery(".zp-Zotpress-SearchBox").length>0){var e=!0,t=1,r="",n="",a=zpShortcodeAJAX.ajaxurl+"?action=zpRetrieveViaShortcode&zpShortcode_nonce="+zpShortcodeAJAX.zpShortcode_nonce,o=!1;jQuery(".ZP_SHOWTAGS").length>0&&"1"==parseInt(jQuery(".ZP_SHOWTAGS").text())&&(o=!0);var u=!1;jQuery(".ZOTPRESS_AC_IMAGES").length>0&&(u=!0);var s=!1;function p(e,t,r){void 0!==e&&"false"!=e&&""!=e||(e=!1),void 0!==t&&"false"!=t&&""!=t||(t=!1),void 0!==r&&"false"!=r&&""!=r||(r=!1),n="",n+="&api_user_id="+jQuery(".ZOTPRESS_USER").val(),n+="&item_type=items",n+="&downloadable="+jQuery(".ZOTPRESS_AC_DOWNLOAD").val(),n+="&style="+jQuery(".ZP_STYLE").text(),n+="&sortby="+jQuery(".ZP_SORTBY").text(),n+="&order="+jQuery(".ZP_ORDER").text(),n+="&citeable="+jQuery(".ZOTPRESS_AC_CITE").val(),jQuery(".ZOTPRESS_AC_MAXRESULTS").val().length>0&&(n+="&maxresults="+jQuery(".ZOTPRESS_AC_MAXRESULTS").val()),o&&(n+="&showtags=true"),u&&(n+="&showimage=true"),!1!==t&&(n+="&request_start="+t),!1!==r&&(n+="&request_last="+r),n+="&update=true",n+="&request_update="+s,e?n+="&filter="+e:jQuery("input[name=zpSearchFilters]").length>0&&(n+="&filter="+jQuery("input[name=zpSearchFilters]:checked").val())}jQuery(".ZP_UPDATENEEDED").text().trim().length>0&&"true"==jQuery(".ZP_UPDATENEEDED").text()&&(s=!0),p(!1,!1,!1),jQuery("input[name='zpSearchFilters']").click((function(){jQuery("input[name=zpSearchFilters]").length>0&&p(jQuery(this).val(),!1,!1),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",a+n),jQuery("input.zp-Zotpress-SearchBox-Input").val().length>0&&jQuery("input.zp-Zotpress-SearchBox-Input").val()!=zpShortcodeAJAX.txt_typetosearch&&jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("search")})),jQuery("input.zp-Zotpress-SearchBox-Input").bind("keydown",(function(e){e.keyCode===jQuery.ui.keyCode.TAB&&jQuery(this).data("autocomplete").menu.active&&e.preventDefault(),13===e.keyCode&&e.preventDefault()})).bind("focus",(function(e){jQuery(this).val()==zpShortcodeAJAX.txt_typetosearch&&(jQuery(this).val(""),jQuery(this).removeClass("help"))})).bind("blur",(function(e){jQuery.trim(jQuery(this).val())==r?jQuery(this).attr("autocomplete","off"):jQuery(this).attr("autocomplete","on"),""==jQuery.trim(jQuery(this).val())&&(jQuery(this).val(zpShortcodeAJAX.txt_typetosearch),jQuery(this).addClass("help"))})).autocomplete({source:a+n,minLength:jQuery(".ZOTPRESS_AC_MINLENGTH").val(),focus:function(){return!1},change:function(){if(jQuery.trim(jQuery(this).val())==r)return!1},search:function(o,u){var i=jQuery(this).val();o.hasOwnProperty("currentTarget")&&(i=o.currentTarget.value),console.log("zp: autocomplete search starts"),jQuery.ajax({url:a+n+"&term="+i,ifModified:!0,xhrFields:{withCredentials:!0},success:function(e){var t=jQuery.parseJSON(e);t.updateneeded&&(s=t.updateneeded),console.log("zp: calling zp_get_items with update check?","always"),console.log("zp: is an update needed?",s)},error:function(e){console.log("zp: Zotpress via WP AJAX Error: ",e)}}),t=1,(1==e||i&&i!=r)&&(console.log("zp: show loading for new query"),e=!0,jQuery(".zp-List .zpSearchLoading").addClass("show"),jQuery(".zpSearchResultsPaging").length>0&&(jQuery(".zpSearchResultsPaging").empty(),jQuery(".zpSearchResultsPagingContainer").hide()),jQuery(".zpSearchResultsContainer").empty(),p(!1,!1,!1),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",a+n),window.zpPage=1,i&&(r=i))},response:function(i,c){console.log("zp: autocomplete response?",c.content[4]);var l=jQuery(this).val();if(jQuery(".zp-List .zpSearchLoading").removeClass("show"),"0"==c.content||"empty"==c.content[0].label)jQuery(".zpSearchResultsPaging").length>0&&(jQuery(".zpSearchResultsPaging").empty(),jQuery(".zpSearchResultsPagingContainer").hide()),jQuery(".zpSearchResultsContainer").append("<p>No items found.</p>\n");else{var h=c.content[4];h.length,function(e,t,r){jQuery.each(e,(function(e,n){var a="<div id='zp-Entry-"+n.key+"' class='zp-Entry zpSearchResultsItem hidden'>\n";u&&n.hasOwnProperty("image")&&(a+="<div id='zp-Citation-"+n.key+"' class='zp-Entry-Image hasImage' rel='"+n.key+"'>\n",a+="<img class='thumb' src='"+n.image[0]+"' alt='image' />\n",a+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"),-1!=n.bib.indexOf("[1]")&&(n.bib=n.bib.replace("[1]","["+r+"]"),r++),a+=n.bib,(t||jQuery("input.tag[name=zpSearchFilters]:checked").length>0)&&n.data.tags.length>0&&(a+="<span class='item_key'>Tag(s): ",jQuery.each(n.data.tags,(function(e,t){0!=e&&(a+=", "),a+=t.tag}))),jQuery(".zpSearchResultsContainer").append(a+"</div>\x3c!-- .zp-Entry --\x3e\n"),jQuery(".zpSearchResultsPagingContainer").show()}))}(h,o,t),1==e?window.zpBrowseList[0].paginate(e,!1):window.zpBrowseList[0].paginate(e,!0),e=!1,r=l,console.log("zp: request next:",c.content[3].request_next,"request last:",c.content[3].request_last),Number.isInteger(c.content[3].request_next)&&c.content[3].request_next>0?(p(!1,c.content[3].request_next,c.content[3].request_last),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",a+n),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("search")):s?(console.log("zp: now for the update ..."),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("option","source",a+n.replace("request_update=false","request_update=true")),jQuery("input.zp-Zotpress-SearchBox-Input").autocomplete("search"),s=!1):(window.zpBrowseList[0].paginate(e,!0),e=!1)}},open:function(){jQuery(".ui-autocomplete").hide()}})}}));