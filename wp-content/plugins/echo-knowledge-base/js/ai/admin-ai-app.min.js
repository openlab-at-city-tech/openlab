(function(){"use strict";const{useState:e,useEffect:a,createElement:t}=wp.element;const{__:s}=wp.i18n;const{showError:n,showSuccess:i,makeApiRequest:o}=window.EPKB_AI_Util_React||{};const{AIAdminDashboard:c}=window.EPKB_AI_Dashboard||{};const{AIAdminGeneralSettings:r}=window.EPKB_AI_GeneralSettings||{};const{AIAdminChat:d}=window.EPKB_AI_Chat||{};const{AIAdminSearch:l}=window.EPKB_AI_Search||{};const{AIAdminTrainingData:b}=window.EPKB_AI_TrainingData||{};const{AIAdminTools:u}=window.EPKB_AI_Tools||{};const{AIAdminPROFeatures:p}=window.EPKB_AI_PROFeatures||{};const{AIAdminContentAnalysis:w}=window.EPKB_AI_ContentAnalysis||{};const m=({setActiveTab:e})=>{const a=window.location.href.split("page=")[0];const n=a+"page=epkb-kb-ai-features&active_tab=general-settings";return t("div",{className:"epkb-ai-api-key-missing",style:{backgroundColor:"#fee",border:"1px solid #c33",borderRadius:"4px",padding:"15px",margin:"20px 0"}},t("div",{className:"epkb-ai-error-box",style:{display:"flex",alignItems:"center"}},t("span",{className:"epkbfa epkbfa-exclamation-triangle",style:{color:"#c33",marginRight:"10px",fontSize:"24px"}}),t("div",{className:"epkb-ai-error-content"},t("h4",{style:{margin:"0 0 10px 0",color:"#c33"}},s("OpenAI API Key Required","echo-knowledge-base")),t("p",{style:{margin:"0 0 10px 0"}},s("To use AI features, you need to configure your OpenAI API key.","echo-knowledge-base")),t("a",{href:n,className:"epkb-ai-button epkb-ai-button-primary",onClick:a=>{a.preventDefault();e("general-settings");const t=new URL(window.location);t.searchParams.set("active_tab","general-settings");window.history.pushState({},"",t)}},s("Configure API Key","echo-knowledge-base")))))};const _=({settings:m})=>{const _=new URL(window.location);const h=m.active_tab||"dashboard";if(!_.searchParams.has("active_sub_tab")){const e=m.tabs_data?.[h];const a=e?.sub_tabs&&Object.values(e.sub_tabs)[0];if(a){_.searchParams.set("active_sub_tab",a.id);window.history.replaceState({},"",_)}}const[g,f]=e(h);const[y,k]=e(m.tabs_data||{});const[A,v]=e({});const[P,x]=e(false);const[I,S]=e(false);const E=y?.["general-settings"]?.ai_config?.ai_key&&y?.["general-settings"]?.ai_config?.ai_key.length>0;a((()=>{if(P)return;if(y?.dashboard?.status){x(true);const e=y.dashboard.status.issues&&y.dashboard.status.issues.length>0;S(e);return}const e=m.tabs?.find((e=>e.key==="dashboard"));if(!e?.check_status)return;const a=async()=>{try{const e=await jQuery.ajax({url:m.ajax_url,type:"POST",data:{action:"epkb_get_ai_status",force_refresh:"true",_wpnonce_epkb_ajax_action:m.ajax_nonce}});if(e.success&&e.data){k((a=>({...a,dashboard:{...a.dashboard,status:e.data}})));const a=e.data.issues&&e.data.issues.length>0;S(a);x(true)}}catch(e){console.error("Failed to load AI status:",e)}};setTimeout(a,2e3)}),[P,y,m]);const C=async e=>{v((a=>({...a,[e]:true})));try{const a=await o(`ai/${e}`,{method:"GET"});if(a.success){k((t=>({...t,[e]:a.data})))}}catch(e){n(e.message||s("Failed to load tab data","echo-knowledge-base"))}finally{v((a=>({...a,[e]:false})))}};const N=e=>{const a=y[e.key]||{};if(a.ai_disabled){return t("div",{className:"epkb-ai-disabled-content"},t("div",{className:"epkb-ai-notice epkb-ai-notice-warning",style:{padding:"12px 15px",marginBottom:"20px",borderLeft:"4px solid #ffba00",backgroundColor:"#fff8e5"}},t("p",{style:{margin:"0"}},t("span",{className:"dashicons dashicons-info",style:{marginRight:"8px",color:"#ffba00"}}),a.instructions||(e.key==="training-data"?s("To use Training Data, please enable either AI Chat or AI Search in their respective tabs.","echo-knowledge-base"):s("To use AI features, please configure your API key and accept the data privacy agreement in General Settings, then enable AI Search or AI Chat.","echo-knowledge-base"))," ",t("a",{href:"#",onClick:e=>{e.preventDefault();f("general-settings");const a=new URL(window.location);a.searchParams.set("active_tab","general-settings");window.history.pushState({},"",a)},style:{fontWeight:"bold",textDecoration:"underline"}},s("Go to General Settings","echo-knowledge-base")))))}const _={settings:m,tabData:a,isLoading:false,hasApiKey:E,makeApiRequest:o,showError:n,showSuccess:i,onDataChange:a=>{k((t=>({...t,[e.key]:{...t[e.key],...a}})))},onRefresh:()=>C(e.key)};switch(e.key){case"dashboard":return t(c,{..._,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"content-analysis":return t(w,{..._,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"general-settings":return t(r,{..._,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"chat":return t(d,{..._,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"search":return t(l,{..._,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"training-data":return t(b,{..._,selectedCollection:T,onTabSwitch:e=>{f(e);const a=new URL(window.location);a.searchParams.set("active_tab",e);window.history.pushState({},"",a)}});case"tools":return t(u,_);case"pro-features":return t(p,_);default:return t("div",null,s("Unknown tab","echo-knowledge-base"))}};const B=m.tabs&&m.tabs.length>0?m.tabs.map((e=>({name:e.key,title:e.title,className:`epkb-ai-tab-${e.key}`,icon:e.icon,has_issues:e.key==="dashboard"?I:false,requires_ai:e.requires_ai||false,is_disabled:e.requires_ai&&!m.ai_enabled}))):[];if(B.length===0){return t("div",{className:"epkb-ai-admin-app"},t("div",{className:"epkb-ai-admin-error"},t("h1",null,s("AI Configuration","echo-knowledge-base")),t("p",null,s("Error: No tabs configured. Please check the configuration.","echo-knowledge-base"))))}const[L,R]=e(false);const[T,K]=e(null);const[j,O]=e(false);const U=y["training-data"]?.data_collections||[];const D=e=>{K(e);R(false);f("training-data");const a=new URL(window.location);a.searchParams.set("active_tab","training-data");a.searchParams.set("collection_id",e.id);window.history.pushState({},"",a)};const z=async()=>{if(j)return;O(true);try{let e=0;U.forEach((a=>{const t=a.name.match(/(\d+)$/);if(t){e=Math.max(e,parseInt(t[1]))}}));const a=e+1;const t=s("Data Collection","echo-knowledge-base")+" "+a;const c=await o("training-collections",{method:"POST",data:{name:t,post_types:[]}});if(c.success){i(s("New training data collection created","echo-knowledge-base"));setTimeout((()=>{window.location.reload()}),1e3)}else{n(c.message||s("Failed to create collection","echo-knowledge-base"));O(false)}}catch(e){n(e.message||s("Failed to create collection","echo-knowledge-base"));O(false)}};a((()=>{const e=e=>{if(!e.target.closest(".epkb-ai-training-data-dropdown")){R(false)}};if(L){document.addEventListener("click",e);return()=>document.removeEventListener("click",e)}}),[L]);return t("div",{className:"epkb-ai-admin-app"},t("div",{className:"epkb-ai-admin-header"}),t("div",{className:"epkb-ai-custom-tabs"},window.EPKB_AI_SyncContext&&window.EPKB_AI_SyncContext.Consumer?t(window.EPKB_AI_SyncContext.Consumer,null,(e=>t("div",{className:"epkb-ai-tabs-nav"},t("div",{className:"epkb-ai-tabs-regular"},B.filter((e=>e.name!=="pro-features")).map((e=>t("button",{key:e.name,id:e.name==="dashboard"?"epkb-ai-dashboard-tab-button":undefined,className:`epkb-ai-tab-button ${g===e.name?"active":""} ${e.is_disabled?"disabled":""}`,onClick:async()=>{f(e.name);const a=new URL(window.location);a.searchParams.set("active_tab",e.name);const t=y[e.name]?.sub_tabs&&Object.values(y[e.name].sub_tabs)[0];if(t){a.searchParams.set("active_sub_tab",t.id)}window.history.pushState({},"",a);if(e.name==="dashboard"){try{const e=await jQuery.ajax({url:m.ajax_url,type:"POST",data:{action:"epkb_check_training_data_sync",_wpnonce_epkb_ajax_action:m.ajax_nonce}});if(e.success&&e.data){k((a=>({...a,dashboard:{...a.dashboard,dashboard_stats:{...a.dashboard?.dashboard_stats,training_data:{...a.dashboard?.dashboard_stats?.training_data,synced:e.data.has_synced_data?1:0}}}})))}}catch(e){console.error("Failed to check training data sync status:",e)}}},title:e.is_disabled?s("AI features must be enabled to access this tab","echo-knowledge-base"):"",style:e.is_disabled?{opacity:.6,cursor:"pointer"}:{}},e.icon&&t("span",{className:e.icon})," ",e.title,e.name==="content-analysis"&&t("span",{style:{marginLeft:"5px",backgroundColor:"#d54e21",color:"#fff",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",fontWeight:"bold",verticalAlign:"middle"}},"BETA"),e.is_disabled&&t("span",{className:"epkbfa epkbfa-lock",style:{marginLeft:"5px",fontSize:"14px"}}),e.has_issues&&t("span",{className:"epkb-ai-tab-issue-indicator",style:{color:"#dc3545",marginLeft:"5px",fontWeight:"bold",fontSize:"24px"}},"!"))))),B.filter((e=>e.name==="pro-features")).length>0&&t("div",{className:"epkb-ai-tabs-pro"},B.filter((e=>e.name==="pro-features")).map((e=>t("button",{key:e.name,className:`epkb-ai-tab-button epkb-ai-tab-button-pro ${g===e.name?"active":""}`,onClick:async()=>{f(e.name);const a=new URL(window.location);a.searchParams.set("active_tab",e.name);const t=y[e.name]?.sub_tabs&&Object.values(y[e.name].sub_tabs)[0];if(t){a.searchParams.set("active_sub_tab",t.id)}window.history.pushState({},"",a)}},e.icon&&t("span",{className:e.icon})," ",e.title))))))):t("div",{className:"epkb-ai-tabs-nav"},t("div",{className:"epkb-ai-tabs-regular"},B.filter((e=>e.name!=="pro-features")).map((e=>t("button",{key:e.name,id:e.name==="dashboard"?"epkb-ai-dashboard-tab-button":undefined,className:`epkb-ai-tab-button ${g===e.name?"active":""} ${e.is_disabled?"disabled":""}`,onClick:async()=>{f(e.name);const a=new URL(window.location);a.searchParams.set("active_tab",e.name);const t=y[e.name]?.sub_tabs&&Object.values(y[e.name].sub_tabs)[0];if(t){a.searchParams.set("active_sub_tab",t.id)}window.history.pushState({},"",a);if(e.name==="dashboard"){try{const e=await jQuery.ajax({url:m.ajax_url,type:"POST",data:{action:"epkb_check_training_data_sync",_wpnonce_epkb_ajax_action:m.ajax_nonce}});if(e.success&&e.data){k((a=>({...a,dashboard:{...a.dashboard,dashboard_stats:{...a.dashboard?.dashboard_stats,training_data:{...a.dashboard?.dashboard_stats?.training_data,synced:e.data.has_synced_data?1:0}}}})))}}catch(e){console.error("Failed to check training data sync status:",e)}}},title:e.is_disabled?s("AI features must be enabled to access this tab","echo-knowledge-base"):"",style:e.is_disabled?{opacity:.6,cursor:"pointer"}:{}},e.icon&&t("span",{className:e.icon})," ",e.title,e.name==="content-analysis"&&t("span",{style:{marginLeft:"5px",backgroundColor:"#d54e21",color:"#fff",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",fontWeight:"bold",verticalAlign:"middle"}},"BETA"),e.is_disabled&&t("span",{className:"epkbfa epkbfa-lock",style:{marginLeft:"5px",fontSize:"14px"}}),e.has_issues&&t("span",{className:"epkb-ai-tab-issue-indicator",style:{color:"#dc3545",marginLeft:"5px",fontWeight:"bold",fontSize:"24px"}},"!"))))),B.filter((e=>e.name==="pro-features")).length>0&&t("div",{className:"epkb-ai-tabs-pro"},B.filter((e=>e.name==="pro-features")).map((e=>t("button",{key:e.name,className:`epkb-ai-tab-button epkb-ai-tab-button-pro ${g===e.name?"active":""}`,onClick:async()=>{f(e.name);const a=new URL(window.location);a.searchParams.set("active_tab",e.name);const t=y[e.name]?.sub_tabs&&Object.values(y[e.name].sub_tabs)[0];if(t){a.searchParams.set("active_sub_tab",t.id)}window.history.pushState({},"",a)}},e.icon&&t("span",{className:e.icon})," ",e.title))))),window.EPKB_AI_SyncProgressBar&&window.EPKB_AI_SyncContext&&t(window.EPKB_AI_SyncContext.Consumer,null,(e=>{if(!e||!e.job||e.job.status==="idle"){return null}if(g!=="training-data"){return null}return t("div",{className:"epkb-ai-sync-message-container",style:{position:"relative",zIndex:10}},t(window.EPKB_AI_SyncProgressBar))})),window.EPKB_AI_ContentAnalysisProgressBar&&window.EPKB_AI_ContentAnalysisSyncContext&&t(window.EPKB_AI_ContentAnalysisSyncContext.Consumer,null,(e=>{if(!e||!e.analysisJob||e.analysisJob.status==="idle"){return null}if(g!=="content-analysis"){return null}const a=window.EPKB_AI_ContentAnalysis?.activeSubTab;if(a&&typeof a==="string"&&a.startsWith("improve-")){return null}return t("div",{className:"epkb-ai-sync-message-container",style:{position:"relative",zIndex:10}},t(window.EPKB_AI_ContentAnalysisProgressBar))})),t("div",{className:"epkb-ai-tab-content"},N({key:g,selectedCollection:T}))))};document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("epkb-ai-admin-react-root");if(e){const a=JSON.parse(e.dataset.epkbAiSettings||"{}");const s=document.getElementById("epkb-ai-initial-loader");if(s){setTimeout((()=>{s.style.display="none"}),100)}const n=window.EPKB_AI_SyncProvider;const i=window.EPKB_AI_ContentAnalysisSyncProvider;const o=t(_,{settings:a});let c=o;if(n){c=t(n,null,c);window.__EPKB_AI_HAS_TOP_LEVEL_SYNC_PROVIDER__=true}if(i){window.__EPKB_AI_HAS_TOP_LEVEL_CONTENT_ANALYSIS_PROVIDER__=true;c=t(i,null,c)}if(wp.element.createRoot){const a=wp.element.createRoot(e);a.render(c)}else{const{render:a}=wp.element;a(c,e)}}}));window.showEPKBAILoadingOverlay=function(e=null){let a=document.getElementById("epkb-ai-reload-overlay");if(!a){a=document.createElement("div");a.id="epkb-ai-reload-overlay";a.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999999; background: white; padding: 30px; border-radius: 8px; border: 3px solid #2271b1; box-shadow: 0 4px 20px rgba(0,0,0,0.25); min-width: 200px; text-align: center;";a.innerHTML=`\n\t\t\t\t<div class="epkb-ai-loading-container" style="margin: 0;">\n\t\t\t\t\t<div class="epkb-loading-spinner" style="margin: 0 auto 15px;"></div>\n\t\t\t\t\t<div class="epkb-ai-loading" id="epkb-ai-reload-message" style="margin: 0; font-size: 14px; color: #555;">${e||s("Reloading page...","echo-knowledge-base")}</div>\n\t\t\t\t</div>\n\t\t\t`;document.body.appendChild(a)}else{if(e){const a=document.getElementById("epkb-ai-reload-message");if(a){a.textContent=e}}a.style.display="block"}};window.addEventListener("beforeunload",(function(e){if(!e.defaultPrevented&&window.epkbAIPageInteracted){window.showEPKBAILoadingOverlay()}}));window.epkbAIPageInteracted=false;setTimeout((()=>{window.epkbAIPageInteracted=true}),1e3);window.EPKB_AI_App={AIAdminApp:_}})();