(function(){"use strict";const{useState:e,useEffect:t,useCallback:a,useRef:s,createElement:o,Fragment:n}=wp.element;const{__:i}=wp.i18n;const l=()=>{const e=document.getElementById("epkb-ai-notifications");if(e){const t=e.querySelectorAll(".epkb-ai-notification-error");t.forEach((e=>e.remove()))}};const r=({articleData:r,makeApiRequest:d,showSuccess:c,showError:p})=>{const[g,f]=e(null);const[y,u]=e(true);const[m,b]=e("tags");const[x,h]=e(null);const[k,w]=e([]);const[_,v]=e([]);const[S,A]=e(false);const[C,N]=e(false);const[z,I]=e(false);const[T,R]=e(null);const[B,F]=e(null);const[E,D]=e(false);const[W,P]=e(false);const L=s({articleId:null,attempts:0});const M=r&&r.id;const $=a((e=>{if(!e||typeof e!=="object"){return false}const t=e.processed_content;return typeof t==="string"&&t.trim().length>0}),[]);const O=a((async({mergeWithExisting:e=true,skipSetLoading:t=false,setLoadingState:a=null}={})=>{let s=false;if(E){if(L.current.articleId===M){return false}}P(false);D(true);try{const o=await d("content-analysis-processed-content",{params:{article_id:M}});if(o&&o.data&&o.data.processed_content){s=true;const n=document.querySelector(".epkb-ai-processed-content-display");const i=document.querySelector(".epkb-ai-article-content-display");let l=o.data.processed_content;if(typeof marked!=="undefined"&&marked&&marked.parse){try{l=marked.parse(o.data.processed_content)}catch(e){console.error("Markdown parsing failed:",e)}}if(n){n.innerHTML=l}if(i){i.innerHTML=l}f((t=>{const a={processed_content:o.data.processed_content};if(e&&t&&typeof t==="object"){return{...t,...a}}return a}));const r=`article_analysis_${M}`;const d=Date.now();sessionStorage.setItem(r,JSON.stringify({data:{processed_content:o.data.processed_content},timestamp:d,article_id:M}));const c=typeof a==="function"?a:u;if(!t&&typeof c==="function"){c(false)}return true}}catch(e){console.error("Error fetching processed content:",e);P(true)}finally{D(false);L.current={articleId:M,attempts:L.current.articleId===M?L.current.attempts+1:1}}if(!s){return false}return true}),[M,E,d,f]);t((()=>{if(!window.EPKB_AI_ContentAnalysisDetails_API){window.EPKB_AI_ContentAnalysisDetails_API={}}const e=window.EPKB_AI_ContentAnalysisDetails_API;e.articleId=M;e.getAnalysisDetails=()=>g;e.hasProcessedContent=$;e.fetchProcessedContent=O;e.requestProcessedContent=(t,a={})=>{if(t&&t!==M){e.pendingFetch={articleId:t,options:a};return false}return O(a)};return()=>{if(window.EPKB_AI_ContentAnalysisDetails_API===e){delete e.articleId;delete e.getAnalysisDetails;delete e.hasProcessedContent;delete e.fetchProcessedContent;delete e.requestProcessedContent;delete e.pendingFetch}}}),[g,M,O,$]);t((()=>{P(false)}),[M]);t((()=>{if(!M||!g){return}if(E){return}if(W){return}if(!$(g)){O({mergeWithExisting:true,skipSetLoading:true})}}),[g,M,O,$,E,W]);t((()=>{if(!window.EPKB_AI_ContentAnalysisDetails_API||!M){return}const e=window.EPKB_AI_ContentAnalysisDetails_API;if(!e.pendingFetch||!e.pendingFetch.articleId){return}if(e.pendingFetch.articleId!==M){return}if(E){return}const t=e.pendingFetch.options||{};delete e.pendingFetch;O(t)}),[M,O,E]);const G=3;const H=a((async(e,t)=>{let a=0;while(a<G){try{const s=await d(e,{method:"POST",data:t});if(s&&s.can_retry&&a<G-1){a++;await new Promise((e=>setTimeout(e,a*1e3)));continue}return s}catch(e){if(e&&e.reason=="execution_time_too_low"){break}else if(e&&e.can_retry&&a<G-1){a++;await new Promise((e=>setTimeout(e,a*1e3)))}throw e}}return{success:false}}),[d]);t((()=>{const e=async()=>{if(!r||!r.id){u(false);return}u(true);try{const e=72e5;const t=Date.now();const a=`article_analysis_${r.id}`;const s=sessionStorage.getItem(a);if(s){try{const o=JSON.parse(s);if(o.timestamp&&t-o.timestamp<e){f(o.data);u(false);return}else{sessionStorage.removeItem(a)}}catch(e){console.warn("[Content Analysis] Failed to parse cache:",e);sessionStorage.removeItem(a)}}const o=await d("content-analysis-details",{params:{article_id:r.id,kb_id:1}});if(o&&o.data){f(o.data);sessionStorage.setItem(a,JSON.stringify({data:o.data,timestamp:t,article_id:r.id}))}else{const e={score:r.score,importance:r.importance,scoreComponents:r.scoreComponents||[],title:r.title,last_analyzed:r.last_analyzed,status:r.status||r.display_status};f(e)}}catch(e){console.error("Error fetching analysis details:",e);const t={score:r.score,importance:r.importance,scoreComponents:r.scoreComponents||[],title:r.title,last_analyzed:r.last_analyzed,status:r.status||r.display_status};f(t)}finally{u(false)}};e()}),[r,d]);const K=a((e=>{w((t=>{if(t.includes(e)){return t.filter((t=>t!==e))}else{return[...t,e]}}))}),[]);const j=a((e=>{if(e&&e.trim()){v((t=>[...t,e.trim()]))}}),[]);const q=a((e=>{v((t=>t.filter(((t,a)=>a!==e))))}),[]);const U=a((async()=>{try{let e=0;let t=0;for(const a of k){const s=await d("content-analysis-tag-remove",{method:"POST",data:{article_id:r.id,tag_id:a,kb_id:1}});if(s&&s.success){e++}else{t++}}for(const a of _){const s=await d("content-analysis-tag-add",{method:"POST",data:{article_id:r.id,tag_name:a,kb_id:1}});if(s&&s.success){e++}else{t++}}if(e>0){c(i(`Successfully updated ${e} tag(s)`,"echo-knowledge-base"));window.EPKB_AI_Util_React&&window.EPKB_AI_Util_React.removeArticleAnalysisData(r.id);setTimeout((()=>{window.location.reload()}),1e3)}if(t>0){p(i(`Failed to update ${t} tag(s)`,"echo-knowledge-base"))}}catch(e){console.error("Error saving tags:",e);p(i("Failed to save tag changes","echo-knowledge-base"))}}),[k,_,r,d,c,p]);const J=a((async e=>{try{const t=await d("content-analysis-tag-add",{method:"POST",data:{article_id:r.id,tag_name:e,kb_id:1}});if(t&&t.success){c(i("Tag added successfully","echo-knowledge-base"));window.EPKB_AI_Util_React&&window.EPKB_AI_Util_React.removeArticleAnalysisData(r.id);setTimeout((()=>{window.location.reload()}),1e3)}else{p(i("Failed to add tag","echo-knowledge-base"))}}catch(e){console.error("Error adding tag:",e);p(i("Failed to add tag","echo-knowledge-base"))}}),[r,d,c,p]);const Y=a((async e=>{try{const t=await d("content-analysis-tag-remove",{method:"POST",data:{article_id:r.id,tag_id:e,kb_id:1}});if(t&&t.success){c(i("Tag removed successfully","echo-knowledge-base"));window.EPKB_AI_Util_React&&window.EPKB_AI_Util_React.removeArticleAnalysisData(r.id);setTimeout((()=>{window.location.reload()}),1e3)}else{p(i("Failed to remove tag","echo-knowledge-base"))}}catch(e){console.error("Error removing tag:",e);p(i("Failed to remove tag","echo-knowledge-base"))}}),[r,d,c,p]);const V=a((async e=>{try{let t=0;for(const a of e){const e=await d("content-analysis-tag-remove",{method:"POST",data:{article_id:r.id,tag_id:a.id,kb_id:1}});if(e&&e.success){t++}}if(t>0){c(`${t} tags removed successfully`);window.EPKB_AI_Util_React&&window.EPKB_AI_Util_React.removeArticleAnalysisData(r.id);setTimeout((()=>{window.location.reload()}),1500)}else{p(i("Failed to remove tags","echo-knowledge-base"))}}catch(e){console.error("Error removing tags:",e);p(i("Failed to remove tags","echo-knowledge-base"))}}),[r,d,c,p]);const X=a((async(e,t)=>{try{const a=await d("content-analysis-tag-edit",{method:"POST",data:{article_id:r.id,tag_id:e,new_name:t,kb_id:1}});if(a&&a.success){c(i("Tag updated successfully","echo-knowledge-base"));window.EPKB_AI_Util_React&&window.EPKB_AI_Util_React.removeArticleAnalysisData(r.id);setTimeout((()=>{window.location.reload()}),1e3)}else{p(i("Failed to update tag","echo-knowledge-base"))}}catch(e){console.error("Error updating tag:",e);p(i("Failed to update tag","echo-knowledge-base"))}}),[r,d,c,p]);const Q=(e,t,a)=>{if(!t)return null;const s=t.issues&&t.issues.length>0;return o("div",{className:s?"epkb-analysis-warning":"epkb-analysis-success",style:{padding:"20px",backgroundColor:"#ffffff",border:s?"2px solid #ffc107":"2px solid #28a745",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:s?"#ff9800":"#28a745"}},s?"âš ï¸":"âœ“"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:s?"#856404":"#155724"}},e),s?o("ul",{style:{margin:"0",paddingLeft:"20px",color:"#856404"}},t.issues.map(((e,t)=>{const a=e=>{const t=e.indexOf(": ");if(t===-1){return e}const a=e.substring(0,t+2);const s=e.substring(t+2);if(a.toLowerCase().includes("recommended")){return e}const i=s.split(", ");const l=i.map(((e,t)=>{const a=e.trim().replace(/^["']|["']$/g,"");if(!a)return null;return o(n,{key:t},t>0?", ":"",o("span",{style:{padding:"2px 8px",backgroundColor:"#e5e7eb",border:"1px solid #d1d5db",borderRadius:"4px",fontFamily:"monospace",fontSize:"13px",whiteSpace:"nowrap"}},a))}));return o(n,null,a,...l)};return o("li",{key:t,style:{marginBottom:"4px",fontSize:"14px"}},a(e))}))):o("p",{style:{margin:"0",color:"#155724",fontSize:"14px"}},a))))};const Z=(e,t)=>{if(e===null||e===undefined){return o("div",{className:"epkb-score-badge epkb-score-badge--not-analyzed"},o("div",{style:{fontSize:"12px",color:"#666"}},t),o("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#666"}},i("Not Analyzed","echo-knowledge-base")))}const a=parseInt(e)||0;let s="";let n="";if(a>=80){s="#46b450";n="rgba(70, 180, 80, 0.1)"}else if(a>=60){s="#f0ad4e";n="rgba(240, 173, 78, 0.1)"}else{s="#d54e21";n="rgba(213, 78, 33, 0.1)"}return o("div",{className:"epkb-score-badge",style:{backgroundColor:n,border:`2px solid ${s}`}},o("div",{style:{fontSize:"12px",color:"#666"}},t),o("div",{style:{fontSize:"17px",fontWeight:"bold",color:s}},e+"%"))};return o("div",{className:"epkb-ai-analysis-details-container",style:{padding:"20px",position:"relative"}},o("style",{},`\n\t\t\t\t@keyframes spin {\n\t\t\t\t\tfrom { transform: rotate(0deg); }\n\t\t\t\t\tto { transform: rotate(360deg); }\n\t\t\t\t}\n\t\t\t`),r&&r.is_demo&&o("div",{className:"epkb-demo-analytics-notice",style:{backgroundColor:"#fff3cd",border:"2px solid #ffc107",borderRadius:"8px",padding:"16px 20px",marginBottom:"20px",display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{className:"epkbfa epkbfa-info-circle",style:{fontSize:"24px",color:"#856404",marginTop:"2px"}}),o("div",{style:{flex:1}},o("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},o("span",{className:"epkb-demo-badge",style:{backgroundColor:"#ffc107",color:"#000",padding:"4px 12px",borderRadius:"4px",fontWeight:"600",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"}},i("Demo Article","echo-knowledge-base")),o("strong",{style:{fontSize:"16px",color:"#856404"}},i("Demo Analysis Data","echo-knowledge-base"))),o("p",{style:{margin:"0",color:"#856404",fontSize:"14px",lineHeight:"1.5"}},i("This is a demo article with sample analytics data for demonstration purposes. Create your own articles to see real content analysis results.","echo-knowledge-base")))),y?o("div",{className:"epkb-ai-analysis-details-loading",style:{padding:"40px",textAlign:"center"}},o("div",{className:"spinner is-active",style:{float:"none"}}),o("p",null,i("Loading analysis details...","echo-knowledge-base"))):!g?o("div",{className:"epkb-ai-analysis-details-empty",style:{padding:"40px",textAlign:"center"}},o("p",null,i("No analysis details available for this article.","echo-knowledge-base"))):o(n,null,o("div",{className:"epkb-ai-details-nav",style:{marginBottom:"20px",marginLeft:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"}},o("div",{style:{display:"flex",gap:"15px",alignItems:"center"}},o("div",{style:{display:"inline-flex",gap:"0",border:"1px solid #E5E6E7",backgroundColor:"#FFFFFF",borderRadius:"8px",overflow:"hidden"}},["tags","readability","content_gaps"].map(((e,t)=>o("button",{key:e,className:`epkb-ai-section-tab ${m===e?"active":""}`,onClick:()=>b(e),style:{padding:"12px 24px",border:"none",borderRight:t<2?"1px solid #E5E6E7":"none",backgroundColor:m===e?"#F0F8FF":"#FFFFFF",borderBottom:m===e?"3px solid #0073AA":"3px solid transparent",color:m===e?"#0073AA":"#555555",cursor:"pointer",fontSize:"14px",fontWeight:m===e?"600":"400",transition:"all 0.2s ease"},onMouseEnter:t=>{if(m!==e){t.target.style.backgroundColor="#F0F8FF";t.target.style.color="#0073AA"}},onMouseLeave:t=>{if(m!==e){t.target.style.backgroundColor="#FFFFFF";t.target.style.color="#555555"}}},e==="tags"?(()=>{const e=g&&g.scoreComponents||r&&r.scoreComponents||[];const t=e.find((e=>e.name==="Tags Usage"));if(t&&t.value&&t.value!=="-"&&t.value!=="Analyzing..."){const e=parseInt(t.value)||0;let a="#666";if(e>=80){a="#46b450"}else if(e>=60){a="#f0ad4e"}else{a="#d54e21"}return o("span",null,i("Tags","echo-knowledge-base"),"  ",o("span",{style:{color:a,fontWeight:"bold",marginLeft:"4px"}},`(${t.value}%)`))}return i("Tags","echo-knowledge-base")})():e==="readability"?(()=>{const e=g&&g.readability_analysis;if(e&&e.status==="analyzed"&&e.score!==undefined&&e.score!==null){const t=parseInt(e.score)||0;let a="#666";if(t>=80){a="#46b450"}else if(t>=60){a="#f0ad4e"}else{a="#d54e21"}return o("span",null,i("Readability","echo-knowledge-base"),"  ",o("span",{style:{color:a,fontWeight:"bold",marginLeft:"4px"}},`(${t}%)`))}return i("Readability","echo-knowledge-base")})():e==="content_gaps"?(()=>{const e=g&&g.gap_analysis;if(e&&e.status==="analyzed"&&e.score!==undefined&&e.score!==null){const t=parseInt(e.score)||0;let a="#666";if(t>=80){a="#46b450"}else if(t>=60){a="#f0ad4e"}else{a="#d54e21"}return o("span",null,i("Content Gaps","echo-knowledge-base"),"  ",o("span",{style:{color:a,fontWeight:"bold",marginLeft:"4px"}},`(${t}%)`))}return i("Content Gaps","echo-knowledge-base")})():i("Readability","echo-knowledge-base"))))),o("a",{href:r.edit_link||(typeof ajaxurl!=="undefined"?ajaxurl.replace("/wp-admin/admin-ajax.php","/wp-admin/post.php"):window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/")+"/wp-admin/post.php")+`?post=${r.id}&action=edit`,target:"_blank",className:"epkb-article-action-link",style:{display:"inline-flex",alignItems:"center",gap:"6px",textDecoration:"none",color:"#0073aa",fontSize:"14px",fontWeight:"600",padding:"6px 12px",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f6fc";e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent";e.currentTarget.style.textDecoration="none"}},o("span",{className:"dashicons dashicons-edit",style:{fontSize:"16px"}}),i("Edit Article","echo-knowledge-base")),o("a",{href:r.view_link||(typeof ajaxurl!=="undefined"?ajaxurl.replace("/wp-admin/admin-ajax.php",""):window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/"))+`/?p=${r.id}`,target:"_blank",className:"epkb-article-action-link",style:{display:"inline-flex",alignItems:"center",gap:"6px",textDecoration:"none",color:"#0073aa",fontSize:"14px",fontWeight:"600",padding:"6px 12px",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f6fc";e.currentTarget.style.textDecoration="underline"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent";e.currentTarget.style.textDecoration="none"}},o("span",{className:"dashicons dashicons-visibility",style:{fontSize:"16px"}}),i("View Article","echo-knowledge-base"))),o("div",{className:"epkb-score-importance-container"},Z(g.score!==null&&g.score!==undefined?g.score:r.score!==null&&r.score!==undefined?r.score:null,i("Overall Score","echo-knowledge-base")),o("div",{className:"epkb-article-importance-container"},o("div",{style:{fontSize:"12px",color:"#666"}},i("Article Importance","echo-knowledge-base")),o("div",{className:"epkb-importance-progress-bar"},o("div",{className:"epkb-importance-progress-fill",style:{width:`${g.importance||r.importance}%`}}),o("div",{className:"epkb-importance-progress-text"},`${g.importance||r.importance}%`))))),o("div",{className:"epkb-ai-analysis-details-content",style:{marginLeft:"20px"}},m==="readability"&&o("div",{className:"epkb-ai-readability-section",style:{display:"flex",gap:"20px",minHeight:"500px",alignItems:"stretch"}},o("div",{className:"epkb-readability-main-content",style:{flex:1,display:"flex",flexDirection:"column",gap:"20px",backgroundColor:"#ffffff",padding:"20px",borderRadius:"6px",border:"1px solid #e5e7eb",overflowY:"auto",position:"relative"}},(()=>{const e=g&&g.readability_analysis;if(e&&e.status==="analyzed"){const t=e.issues||[];const a=t.length>0;return o(n,null,o("button",{className:"button button-secondary epkb-ai-reanalyze-button",disabled:S,onClick:async()=>{l();A(true);f({...g,readability_analysis:{...g.readability_analysis,status:"pending"}});try{const e=await H("content-analysis-readability",{article_id:r.id});if(e&&e.success&&e.data){c(i("Readability analysis completed","echo-knowledge-base"));const t={...g,readability_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}if(e.data.processed_content){t.processed_content=e.data.processed_content}if(e.data.issue_positions){t.issue_positions=e.data.issue_positions}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}))}else{p(i("Failed to run readability analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run readability analysis","echo-knowledge-base"))}finally{A(false)}}},S?[o("span",{key:"spinner",className:"dashicons dashicons-update",style:{animation:"spin 1s linear infinite",marginRight:"5px"}}),o("span",{key:"text"},i("Analyzing...","echo-knowledge-base"))]:[o("span",{key:"icon",className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),o("span",{key:"text"},i("Re-analyze","echo-knowledge-base"))]),a?t.map(((e,t)=>o("div",{key:t,className:"epkb-analysis-warning",style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #ffc107",borderRadius:"6px",marginBottom:"15px",cursor:"pointer",transition:"background-color 0.2s ease"},onClick:()=>{R(t)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fffbf0"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#ff9800"}},"âš ï¸"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#856404"}},e.issue_type||"Issue"),e.problematic_text&&o("div",{style:{padding:"10px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",marginBottom:"8px",fontFamily:"monospace",fontSize:"13px",whiteSpace:"pre-wrap",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:marked.parseInline(e.problematic_text)}}),e.explanation&&o("div",{style:{margin:"0",color:"#856404",fontSize:"14px",lineHeight:"1.6"},dangerouslySetInnerHTML:{__html:marked.parseInline(e.explanation)}})))))):o("div",{className:"epkb-analysis-success",style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #28a745",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#28a745"}},"âœ“"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#155724"}},i("Readability Analysis","echo-knowledge-base")),o("p",{style:{margin:"0",color:"#155724",fontSize:"14px"}},i("No readability issues found. The article is clear and well-written.","echo-knowledge-base"))))))}if(e&&e.status==="error"){return o("div",{style:{padding:"20px",backgroundColor:"#fff3cd",border:"2px solid #ffc107",borderRadius:"6px"}},o("h4",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"10px",color:"#856404"}},i("Analysis Error","echo-knowledge-base")),o("p",{style:{margin:"0 0 15px 0",color:"#856404"}},e.error||i("An error occurred during readability analysis.","echo-knowledge-base")),S?o("div",{style:{textAlign:"center",marginTop:"10px"}},o("div",{className:"spinner is-active",style:{float:"none",margin:"0 auto"}}),o("p",{style:{fontSize:"14px",marginTop:"10px",color:"#856404"}},i("Retrying analysis...","echo-knowledge-base"))):o("button",{className:"button button-primary",onClick:async()=>{l();A(true);f({...g,readability_analysis:{...g.readability_analysis,status:"pending"}});try{const e=await H("content-analysis-readability",{article_id:r.id});if(e&&e.success&&e.data){c(i("Readability analysis completed","echo-knowledge-base"));const t={...g,readability_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}));b("readability")}else{p(i("Failed to run readability analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run readability analysis","echo-knowledge-base"))}finally{A(false)}},style:{fontSize:"14px",padding:"8px 20px"}},i("Retry Analysis","echo-knowledge-base")))}return o("div",{style:{textAlign:"center",padding:"60px 20px"}},o("h3",{style:{fontSize:"20px",marginBottom:"20px",color:"#333"}},i("Readability Analysis","echo-knowledge-base")),S?o("div",{style:{marginBottom:"20px"}},o("div",{className:"spinner is-active",style:{float:"none",margin:"0 auto"}}),o("p",{style:{fontSize:"14px",marginTop:"15px",color:"#666"}},i("Analyzing article readability...","echo-knowledge-base"))):o("p",{style:{fontSize:"14px",marginBottom:"30px",color:"#666"}},i("Click the button below to analyze this article's readability using AI.","echo-knowledge-base")),!S&&o("button",{className:"epkb-run-readability-analysis-btn",onClick:async()=>{l();A(true);try{const e=await H("content-analysis-readability",{article_id:r.id});if(e&&e.success&&e.data){c(i("Readability analysis completed","echo-knowledge-base"));const t={...g,readability_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}if(e.data.processed_content){t.processed_content=e.data.processed_content}if(e.data.issue_positions){t.issue_positions=e.data.issue_positions}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}));b("readability")}else{p(i("Failed to run readability analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run readability analysis","echo-knowledge-base"))}finally{A(false)}},style:{fontSize:"16px",padding:"12px 30px"}},i("Run Readability Analysis","echo-knowledge-base")))})()),o("div",{className:"epkb-readability-sidebar",style:{width:"50%",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",padding:"20px",display:"flex",flexDirection:"column",gap:"15px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",overflowY:"auto"}},o("h4",{style:{fontSize:"15px",fontWeight:"600",margin:"0 0 15px 0",color:"#1e293b"}},i("Article Content","echo-knowledge-base")),(()=>{const e=g&&g.processed_content;if(!e){return o("p",{style:{color:"#999",fontSize:"13px",fontStyle:"italic"}},i("No article content available","echo-knowledge-base"))}const t=e=>{if(!e)return;if(!e.dataset.markersWrapped){const t=e.querySelectorAll("span[data-epkb-issue]");t.forEach((e=>{e.className="epkb-issue-marker";e.style.display="none";e.setAttribute("data-issue-index",e.getAttribute("data-epkb-issue"))}));e.dataset.markersWrapped="true"}const t=e.querySelectorAll(".epkb-highlighted-issue-text");t.forEach((e=>{const t=e.parentNode;while(e.firstChild){t.insertBefore(e.firstChild,e)}t.removeChild(e)}));if(T!==null&&T!==undefined){const t=e.querySelector(`.epkb-issue-marker[data-issue-index="${T}"]`);if(t){let e=t.nextSibling;while(e&&e.nodeType===Node.TEXT_NODE&&!e.textContent.trim()){e=e.nextSibling}if(e){const t=document.createElement("mark");t.className="epkb-highlighted-issue-text";t.style.backgroundColor="#ffc107";t.style.padding="2px 4px";t.style.borderRadius="2px";t.style.fontWeight="bold";if(e.nodeType===Node.TEXT_NODE){t.textContent=e.textContent;e.replaceWith(t)}else if(e.nodeType===Node.ELEMENT_NODE){t.innerHTML=e.innerHTML;e.replaceWith(t)}setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}),100)}}}};if(typeof marked!=="undefined"&&marked&&marked.parse){try{let a=marked.parse(e);return o("div",{className:"epkb-ai-processed-content-display",style:{fontSize:"13px",lineHeight:"1.6",color:"#333",wordBreak:"break-word"},ref:t,dangerouslySetInnerHTML:{__html:a}})}catch(e){console.error("Markdown parsing failed:",e)}}return o("div",{className:"epkb-ai-processed-content-display",style:{fontSize:"13px",lineHeight:"1.6",color:"#333",whiteSpace:"pre-wrap",wordBreak:"break-word"}},e)})())),m==="content_gaps"&&o("div",{className:"epkb-ai-content-gaps-section",style:{display:"flex",gap:"20px",minHeight:"500px",alignItems:"stretch"}},o("div",{className:"epkb-content-gaps-main-content",style:{flex:1,display:"flex",flexDirection:"column",gap:"20px",backgroundColor:"#ffffff",padding:"20px",borderRadius:"6px",border:"1px solid #e5e7eb",overflowY:"auto",position:"relative"}},(()=>{const e=g&&g.gap_analysis;if(e&&e.status==="analyzed"){const t=e.gaps||[];const a=t.length>0;return o(n,null,o("button",{className:"button button-secondary epkb-ai-reanalyze-button",disabled:z,onClick:async()=>{l();I(true);f({...g,gap_analysis:{...g.gap_analysis,status:"pending"}});try{const e=await H("content-analysis-gap-analysis",{article_id:r.id});if(e&&e.success&&e.data){c(i("Content Gaps analysis completed","echo-knowledge-base"));const t={...g,gap_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}))}else{p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}finally{I(false)}}},z?[o("span",{key:"spinner",className:"dashicons dashicons-update",style:{animation:"spin 1s linear infinite",marginRight:"5px"}}),o("span",{key:"text"},i("Analyzing...","echo-knowledge-base"))]:[o("span",{key:"icon",className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),o("span",{key:"text"},i("Re-analyze","echo-knowledge-base"))]),a?t.map(((e,t)=>o("div",{key:t,className:"epkb-analysis-warning",style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #ffc107",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#ff9800"}},"âš ï¸"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#856404"}},e.gap_type||"Gap"),e.text&&o("div",{style:{padding:"10px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",marginBottom:"8px",fontFamily:"monospace",fontSize:"13px",whiteSpace:"pre-wrap",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:marked.parseInline(e.text)}}),e.analysis&&o("div",{style:{margin:"0",color:"#856404",fontSize:"14px",lineHeight:"1.6"},dangerouslySetInnerHTML:{__html:marked.parseInline(e.analysis)}})))))):o("div",{className:"epkb-analysis-success",style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #28a745",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#28a745"}},"âœ“"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#155724"}},i("Content Gaps Analysis","echo-knowledge-base")),o("p",{style:{margin:"0",color:"#155724",fontSize:"14px"}},i("No content gaps found. The article appears to be comprehensive.","echo-knowledge-base"))))))}if(e&&e.status==="error"){return o("div",{style:{padding:"20px",backgroundColor:"#fff3cd",border:"2px solid #ffc107",borderRadius:"6px"}},o("h4",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"10px",color:"#856404"}},i("Analysis Error","echo-knowledge-base")),o("p",{style:{margin:"0 0 15px 0",color:"#856404"}},e.error||i("An error occurred during Content Gaps analysis.","echo-knowledge-base")),z?o("div",{style:{textAlign:"center",marginTop:"10px"}},o("div",{className:"spinner is-active",style:{float:"none",margin:"0 auto"}}),o("p",{style:{fontSize:"14px",marginTop:"10px",color:"#856404"}},i("Retrying analysis...","echo-knowledge-base"))):o("button",{className:"button button-primary",onClick:async()=>{l();I(true);f({...g,gap_analysis:{...g.gap_analysis,status:"pending"}});try{const e=await H("content-analysis-gap-analysis",{article_id:r.id});if(e&&e.success&&e.data){c(i("Content Gaps analysis completed","echo-knowledge-base"));const t={...g,gap_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}));b("content_gaps")}else{p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}finally{I(false)}},style:{fontSize:"14px",padding:"8px 20px"}},i("Retry Analysis","echo-knowledge-base")))}if(e&&e.status==="not_available"){return o("div",{style:{textAlign:"center",padding:"60px 20px"}},o("h3",{style:{fontSize:"20px",marginBottom:"20px",color:"#333"}},i("Content Gaps Analysis","echo-knowledge-base")),o("p",{style:{fontSize:"14px",marginBottom:"30px",color:"#666"}},e.message||i("Gap analysis is only available with AI Features add-on.","echo-knowledge-base")),o("a",{href:"https://www.echoknowledgebase.com/wordpress-add-ons/ai-features/",target:"_blank",rel:"noopener noreferrer",className:"button button-primary",style:{fontSize:"14px",padding:"10px 30px"}},i("Learn More About AI Features","echo-knowledge-base")))}return o("div",{style:{textAlign:"center",padding:"60px 20px"}},o("h3",{style:{fontSize:"20px",marginBottom:"20px",color:"#333"}},i("Content Gaps Analysis","echo-knowledge-base")),z?o("div",{style:{marginBottom:"20px"}},o("div",{className:"spinner is-active",style:{float:"none",margin:"0 auto"}}),o("p",{style:{fontSize:"14px",marginTop:"15px",color:"#666"}},i("Analyzing article for content gaps...","echo-knowledge-base"))):o("p",{style:{fontSize:"14px",marginBottom:"30px",color:"#666"}},i("Click the button below to analyze this article for missing content using AI.","echo-knowledge-base")),!z&&o("button",{className:"epkb-run-gap-analysis-btn",onClick:async()=>{l();I(true);try{const e=await H("content-analysis-gap-analysis",{article_id:r.id});if(e&&e.success&&e.data){c(i("Content Gaps analysis completed","echo-knowledge-base"));const t={...g,gap_analysis:e.data};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}));b("content_gaps")}else{p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run Content Gaps analysis","echo-knowledge-base"))}finally{I(false)}},style:{fontSize:"16px",padding:"12px 30px"}},i("Run Content Gaps Analysis","echo-knowledge-base")))})()),o("div",{className:"epkb-content-gaps-sidebar",style:{width:"50%",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",padding:"20px",display:"flex",flexDirection:"column",gap:"15px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",overflowY:"auto"}},o("h4",{style:{fontSize:"15px",fontWeight:"600",margin:"0 0 15px 0",color:"#1e293b"}},i("Article Content","echo-knowledge-base")),(()=>{const e=g&&g.processed_content||g&&g.gap_analysis&&g.gap_analysis.processed_content;if(!e){return o("p",{style:{color:"#999",fontSize:"13px",fontStyle:"italic"}},i("No article content available","echo-knowledge-base"))}if(typeof marked!=="undefined"&&marked&&marked.parse){try{let t=marked.parse(e);return o("div",{className:"epkb-ai-article-content-display",style:{fontSize:"13px",lineHeight:"1.6",color:"#333",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:t}})}catch(e){console.error("Markdown parsing failed:",e)}}return o("div",{className:"epkb-ai-article-content-display",style:{fontSize:"13px",lineHeight:"1.6",color:"#333",whiteSpace:"pre-wrap",wordBreak:"break-word"}},e)})())),m==="tags"&&o("div",{className:"epkb-ai-tags-section"},o("div",{className:"epkb-tags-main-content"},o("button",{className:"button button-secondary epkb-ai-reanalyze-button",disabled:C,onClick:async()=>{l();N(true);if(g.tag_analysis){f({...g,tag_analysis:{...g.tag_analysis,status:"pending"}})}try{const e=await H("content-analysis-tags",{article_id:r.id});if(e&&e.success&&e.data){c(i("Tags analysis completed","echo-knowledge-base"));const t={...g,tag_analysis:e.data.tag_analysis,current_tags:e.data.current_tags,suggested_tags:e.data.suggested_tags,recommended_tags:e.data.recommended_tags};if(e.data.updated_overall_score!==undefined){t.score=e.data.updated_overall_score}if(e.data.updated_score_components!==undefined){t.scoreComponents=e.data.updated_score_components}f(t);sessionStorage.setItem(`article_analysis_${r.id}`,JSON.stringify({data:t,timestamp:Date.now(),article_id:r.id}))}else{p(i("Failed to run tags analysis","echo-knowledge-base"))}}catch(e){p(i("Failed to run tags analysis","echo-knowledge-base"))}finally{N(false)}}},C?[o("span",{key:"spinner",className:"dashicons dashicons-update",style:{animation:"spin 1s linear infinite",marginRight:"5px"}}),o("span",{key:"text"},i("Analyzing...","echo-knowledge-base"))]:[o("span",{key:"icon",className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),o("span",{key:"text"},i("Re-analyze Tags","echo-knowledge-base"))]),g.tag_analysis?o(n,null,o(n,{key:"count"},Q(i("Tag Count","echo-knowledge-base"),g.tag_analysis.count_score,i("The number of tags is within the recommended range (3-10).","echo-knowledge-base"))),o(n,{key:"relevance"},(()=>{const e=!g.current_tags||g.current_tags.length===0;if(e){return o("div",{style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #999",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#666"}},"â„¹ï¸"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#333"}},i("Tag Relevance","echo-knowledge-base")),o("p",{style:{margin:"0",color:"#666",fontSize:"14px"}},i("Not Applicable due to missing tags","echo-knowledge-base")))))}return Q(i("Tag Relevance","echo-knowledge-base"),g.tag_analysis.relevance_score,i("All tags are relevant and appear in the article content.","echo-knowledge-base"))})()),o(n,{key:"format"},(()=>{const e=!g.current_tags||g.current_tags.length===0;if(e){return o("div",{style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #999",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#666"}},"â„¹ï¸"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#333"}},i("Tag Format","echo-knowledge-base")),o("p",{style:{margin:"0",color:"#666",fontSize:"14px"}},i("Not Applicable due to missing tags","echo-knowledge-base")))))}return Q(i("Tag Format","echo-knowledge-base"),g.tag_analysis.format_score,i("All tags are properly formatted and follow best practices.","echo-knowledge-base"))})()),o(n,{key:"duplicates"},(()=>{const e=!g.current_tags||g.current_tags.length===0;if(e){return o("div",{style:{padding:"20px",backgroundColor:"#ffffff",border:"2px solid #999",borderRadius:"6px",marginBottom:"15px"}},o("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"}},o("span",{style:{fontSize:"24px",color:"#666"}},"â„¹ï¸"),o("div",{style:{flex:1}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 8px 0",color:"#333"}},i("Duplicate Tags","echo-knowledge-base")),o("p",{style:{margin:"0",color:"#666",fontSize:"14px"}},i("Not Applicable due to missing tags","echo-knowledge-base")))))}return Q(i("Duplicate Tags","echo-knowledge-base"),g.tag_analysis.duplicate_score,i("No duplicate or similar tags found.","echo-knowledge-base"))})()),o(n,{key:"categories"},Q(i("Categories","echo-knowledge-base"),g.tag_analysis.category_score,i("Article has the right number of categories (1-3).","echo-knowledge-base")))):null,(()=>{const e=g.suggested_tags&&(Array.isArray(g.suggested_tags)&&g.suggested_tags.length>0||typeof g.suggested_tags==="object"&&(g.suggested_tags.broad&&g.suggested_tags.broad.length>0||g.suggested_tags.specific&&g.suggested_tags.specific.length>0));const t=g.recommended_tags&&g.recommended_tags.find((e=>e.type==="ai_feature_required"));const a=g.recommended_tags&&g.recommended_tags.find((e=>e.type==="ai_no_suggestions"));if(!e&&!t&&!a){console.log("AI Tag Suggestions: Box hidden (no relevant AI data)");return null}const s=e=>{if(!e||!Array.isArray(e)||e.length===0){return null}return e.map(((e,t)=>{const a=typeof e==="string"?e:e.name;const s=_.includes(a);const n=g.current_tags&&g.current_tags.some((e=>(e.name||e)===a));return o("div",{key:t,className:"epkb-suggested-tag-item",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:n?"#e0e0e0":s?"#d4edda":"#ffffff",border:"1px solid "+(n?"#999":s?"#28a745":"#0073aa"),borderRadius:"4px"}},o("span",{style:{fontSize:"14px",color:n?"#666":"#1e293b",textDecoration:n?"line-through":"none"}},a),n?o("span",{style:{fontSize:"11px",color:"#666",fontStyle:"italic"}},"(existing)"):s?o("span",{style:{fontSize:"11px",color:"#28a745",fontWeight:"bold"}},"âœ“ Added"):o("button",{className:"button button-small",onClick:()=>j(a),style:{padding:"4px 12px",fontSize:"12px",backgroundColor:"#28a745",borderColor:"#28a745",color:"#fff",cursor:"pointer",fontWeight:"bold"}},i("Add","echo-knowledge-base")))}))};const n=typeof g.suggested_tags==="object"&&!Array.isArray(g.suggested_tags)&&(g.suggested_tags.broad||g.suggested_tags.specific);return o("div",{className:"epkb-suggested-tags-section",style:{marginTop:"20px",padding:"20px",backgroundColor:"#f0f8ff",border:"2px solid #0073aa",borderRadius:"6px"}},o("h4",{style:{fontSize:"16px",fontWeight:"600",margin:"0 0 15px 0",color:"#0073aa",display:"flex",alignItems:"center",gap:"8px"}},o("span",{style:{fontSize:"20px"}},"ðŸ’¡"),i("AI-Powered Tag Suggestions","echo-knowledge-base")),!e&&t?[o("p",{key:"subtitle",style:{fontSize:"14px",color:"#555",margin:"0 0 15px 0"}},i("Based on AI content analysis, consider adding these tags:","echo-knowledge-base")),o("div",{key:"message",style:{padding:"15px",backgroundColor:"#fff8e5",border:"1px solid #ffba00",borderRadius:"4px"}},o("p",{style:{fontSize:"14px",color:"#856404",margin:"0",lineHeight:"1.6"}},t.message||i("Get the AI Features add-on to unlock AI-powered tag suggestions.","echo-knowledge-base")))]:!e&&a?[o("p",{key:"subtitle",style:{fontSize:"14px",color:"#555",margin:"0 0 15px 0"}},i("Based on AI content analysis, consider adding these tags:","echo-knowledge-base")),o("div",{key:"message",style:{padding:"15px",backgroundColor:"#e3f2fd",border:"1px solid #0073aa",borderRadius:"4px"}},o("p",{style:{fontSize:"14px",color:"#004085",margin:"0",lineHeight:"1.6"}},a.message||i("No tag suggestions available for this article at this time.","echo-knowledge-base")))]:[o("p",{key:"subtitle",style:{fontSize:"14px",color:"#555",margin:"0 0 15px 0"}},i("Based on AI content analysis, consider adding these tags:","echo-knowledge-base")),n?[g.suggested_tags.broad&&g.suggested_tags.broad.length>0?o("div",{key:"broad-section",style:{marginBottom:"20px"}},o("h5",{style:{fontSize:"14px",fontWeight:"600",margin:"0 0 10px 0",color:"#0073aa",display:"flex",alignItems:"center",gap:"6px"}},o("span",{style:{fontSize:"16px"}},"ðŸŒ"),i("Broad Tags","echo-knowledge-base"),o("span",{style:{fontSize:"12px",fontWeight:"normal",color:"#666",marginLeft:"4px"}},i("(General categories)","echo-knowledge-base"))),o("div",{className:"epkb-suggested-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"10px"}},s(g.suggested_tags.broad))):null,g.suggested_tags.specific&&g.suggested_tags.specific.length>0?o("div",{key:"specific-section"},o("h5",{style:{fontSize:"14px",fontWeight:"600",margin:"0 0 10px 0",color:"#0073aa",display:"flex",alignItems:"center",gap:"6px"}},o("span",{style:{fontSize:"16px"}},"ðŸŽ¯"),i("Specific Tags","echo-knowledge-base"),o("span",{style:{fontSize:"12px",fontWeight:"normal",color:"#666",marginLeft:"4px"}},i("(Detailed topics)","echo-knowledge-base"))),o("div",{className:"epkb-suggested-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"10px"}},s(g.suggested_tags.specific))):null]:o("div",{key:"tags-list",className:"epkb-suggested-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"10px"}},s(g.suggested_tags))])})()),o("div",{className:"epkb-tags-sidebar"},o("h4",{className:"epkb-tags-heading"},o("span",{className:"epkbfa epkbfa-tag epkb-tags-heading-icon"}),i("Article Tags","echo-knowledge-base")),o("div",{className:"epkb-sidebar-tags-list"},g.current_tags&&g.current_tags.length>0?g.current_tags.map((e=>{const t={id:e.id||e.term_id,name:e.name||e,issues:e.issues||[]};const a=k.includes(t.id);const s=!t.issues||t.issues.length===0;const n=x&&x.id===t.id;return o("div",{key:t.id,className:"epkb-sidebar-tag-item-wrapper"},o("span",{style:{fontSize:"14px",fontWeight:"bold",color:s?"#059669":"#666",minWidth:"18px",flexShrink:0}},s?"âœ“":""),o("div",{className:"epkb-sidebar-tag-item"+(a?" is-marked-for-deletion":""),onClick:()=>h(t),onMouseEnter:null,onMouseLeave:null},t.name.replace(/^["']|["']$/g,"")),o("button",{onClick:e=>{e.stopPropagation();K(t.id)},className:a?"epkb-button-restore":"epkb-button-delete",title:a?i("Restore tag","echo-knowledge-base"):i("Mark for deletion","echo-knowledge-base")},a?"â†¶":"Ã—"))})):o("p",{className:"note"},i("No tags","echo-knowledge-base")),_.map(((e,t)=>o("div",{key:"new-"+t,className:"epkb-sidebar-tag-item-wrapper new"},o("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#0284c7",minWidth:"18px",flexShrink:0}},"+"),o("div",{className:"epkb-sidebar-tag-item new",style:{display:"inline-block",padding:"4px 12px",backgroundColor:"#e0f2fe",border:"1px solid #0ea5e9",borderRadius:"3px",cursor:"pointer",transition:"background-color 0.2s ease",fontSize:"13px",color:"#1e293b"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#bae6fd"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#e0f2fe"}},e.replace(/^["']|["']$/g,"")),o("button",{onClick:()=>q(t),className:"epkb-button-remove",title:i("Remove tag","echo-knowledge-base")},"Ã—"))))),o("div",{className:"epkb-sidebar-add-tag",style:{borderTop:"1px solid #e5e7eb",paddingTop:"15px",marginBottom:"20px"}},o("label",{className:"epkb-add-tag-heading"},o("span",{className:"epkbfa epkbfa-plus epkb-add-tag-heading-icon"}),i("Add New Tag","echo-knowledge-base")),o("div",{className:"controls"},o("input",{type:"text",className:"epkb-sidebar-new-tag-input",placeholder:i("Tag name","echo-knowledge-base"),style:{},onKeyDown:e=>{if(e.key==="Enter"){const t=e.target;if(t.value.trim()){j(t.value.trim());t.value=""}}}}),o("button",{className:"button button-primary add-btn",onClick:()=>{const e=document.querySelector(".epkb-sidebar-new-tag-input");if(e&&e.value.trim()){j(e.value.trim());e.value=""}}},"+"))),o("div",{className:"epkb-tag-best-practices",style:{padding:"15px",backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px",marginBottom:"20px"}},o("h5",{style:{fontSize:"14px",fontWeight:"600",margin:"0 0 12px 0",color:"#1e293b"}},i("Tag Best Practices","echo-knowledge-base")),o("div",{style:{fontSize:"13px",lineHeight:"1.6",color:"#555"}},o("p",{style:{margin:"0 0 10px 0",fontWeight:"600"}},i("Guidelines:","echo-knowledge-base")),o("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px"}},o("li",{style:{marginBottom:"6px"}},o("strong",{},i("Relevant & Keyword-Rich:","echo-knowledge-base"))," ",i("Use descriptive tags matching content and search terms.","echo-knowledge-base")),o("li",{style:{marginBottom:"6px"}},o("strong",{},i("Avoid Duplicates:","echo-knowledge-base"))," ",i("Don't reuse category names as tags (or vice versa).","echo-knowledge-base")),o("li",{style:{marginBottom:"6px"}},o("strong",{},i("Reuse Consistently:","echo-knowledge-base"))," ",i('Stick to a strategy; avoid unique tags per post to prevent "tag bloat" (thin pages hurt SEO). Tags should group multiple posts; noindex thin archives (â‰¤2 posts).',"echo-knowledge-base")),o("li",{style:{marginBottom:"6px"}},o("strong",{},i("Keep Short:","echo-knowledge-base"))," ",i("1â€“3 words, reusable.","echo-knowledge-base"))),o("p",{style:{margin:"0 0 8px 0",fontWeight:"600"}},i("Editor Checklist:","echo-knowledge-base")),o("ul",{style:{margin:"0",paddingLeft:"20px"}},o("li",{style:{marginBottom:"6px"}},i("Groups â‰¥3 posts (now or soon)?","echo-knowledge-base")),o("li",{style:{marginBottom:"6px"}},i("1â€“3 words, distinct from existing tags/categories?","echo-knowledge-base")),o("li",{style:{marginBottom:"6px"}},i("Merge synonyms instead of new tags?","echo-knowledge-base")),o("li",{style:{marginBottom:"0"}},i("Noindex if thin; index if substantial with description?","echo-knowledge-base"))))),o("p",{className:"note"},i("Note: Saving will update tag archive page redirects (optional)","echo-knowledge-base")),o("button",{className:"button button-primary save-btn",onClick:U,disabled:k.length===0&&_.length===0,style:{opacity:k.length===0&&_.length===0?.5:1}},i("Save Changes","echo-knowledge-base")))))))};window.EPKB_AI_ContentAnalysisDetails=r})();