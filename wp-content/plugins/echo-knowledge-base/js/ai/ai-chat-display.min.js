(function(){"use strict";if(!window.EPKBChatUtils){console.error("AI Chat Display: EPKBChatUtils module not loaded");return}const{parseMessageFormatting:e,showErrorMessage:a,createErrorReport:t}=window.EPKBChatUtils;function s(e,a=20){e=e.replace("#","");let t=parseInt(e.substring(0,2),16);let s=parseInt(e.substring(2,4),16);let n=parseInt(e.substring(4,6),16);t=Math.floor(t*(1-a/100));s=Math.floor(s*(1-a/100));n=Math.floor(n*(1-a/100));const o=e=>{const a=e.toString(16);return a.length===1?"0"+a:a};return"#"+o(t)+o(s)+o(n)}function n(a){const{memo:t,createElement:s}=a;return t((function a({message:t,isUser:n}){const o=typeof t==="object"&&t!==null?t.text||t.content||String(t):String(t);const i=!n?e(o):o;return s("div",{className:`epkb-ai-chat-message ${n?"epkb-ai-chat-message--user":"epkb-ai-chat-message--assistant"}`},s("div",{className:"epkb-ai-chat-message-bubble"},s("div",{className:"epkb-ai-chat-message-content",...!n&&i!==o?{dangerouslySetInnerHTML:{__html:i}}:{}},!n&&i!==o?null:o)))}),((e,a)=>e.message===a.message&&e.isUser===a.isUser))}function o(e,s){const{createElement:n}=s;const{isOpen:o,messages:i,inputValue:r,isTyping:l,errorMessage:c,isInitialConversationLoading:p,isSending:d,setIsOpen:g,setInputValue:h,handleSend:u,handleKeyDown:m,clearConversation:b,chatWindowRef:k,messagesEndRef:w,inputRef:f,toggleButtonRef:C,config:v,widgetColors:N,isAdmin:y,showTechnicalLogs:I,Message:E,TypingIndicator:A,LoadingSkeleton:S}=e;return n("div",{className:"epkb-ai-chat-widget"},o&&n("div",{className:"epkb-ai-chat-window",role:"dialog","aria-modal":"true","aria-label":v.widget_header_title||"AI Assistant",ref:k},n("div",{className:"epkb-ai-chat-header",style:{background:N.headerGradient}},n("h3",null,v.widget_header_title||"AI Assistant"),n("div",{className:"epkb-ai-chat-header-actions"},i.length>1&&n("button",{onClick:()=>b(),className:"epkb-ai-chat-new",title:"New Conversation","aria-label":"Start new conversation"},"ðŸ”„"),n("button",{onClick:()=>g(false),className:"epkb-ai-chat-close","aria-label":"Close chat"},"Ã—"))),n("div",{className:"epkb-ai-chat-messages"},p&&i.length===1?n(S):i.map((e=>n(E,{key:e.messageId||e.id,message:e.text,isUser:e.isUser}))),l&&n(A),n("div",{ref:w}),c&&n("div",{id:"epkb-ai-chat-error-container",className:"epkb-ai-chat-error",style:{position:"sticky",bottom:0,marginTop:"10px"},ref:e=>{if(e&&c){const s=window.jQuery;if(s){a({message:c,isAdmin:y&&I,container:s(e),onReport:e=>{const a=t("AI Chat",e,{},r||"N/A");console.log("AI Chat Error Report:\n",a);if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(a).then((()=>{alert("Error report copied to clipboard. Please share with support.")})).catch((()=>{alert("Error report logged to console. Please check console and share with support.")}))}else{alert("Error report logged to console. Please check console and share with support.")}},source:"chat"})}}}})),n("div",{className:"epkb-ai-chat-input-container"},n("div",{className:"epkb-ai-chat-input-wrapper"},n("input",{ref:f,type:"text",value:r,onChange:e=>h(e.target.value),onKeyDown:m,placeholder:v.input_placeholder_text||"Type your message...",className:"epkb-ai-chat-input"}),n("button",{onClick:u,className:`epkb-ai-chat-send ${d?"epkb-ai-chat-send--loading":""}`,disabled:!r.trim()||d,"aria-label":d?"Sending message":"Send message"},d?"âŸ³":"âž¤")))),n("button",{onClick:()=>g(!o),className:`epkb-ai-chat-toggle ${o?"epkb-ai-chat-toggle--open":""}`,"aria-label":o?"Close chat":"Open chat",style:{backgroundColor:N.launcher},ref:C},o?"Ã—":"ðŸ’¬"))}window.EPKBChatDisplay={darkenColor:s,createMessageComponent:n,renderChatWidget:o}})();