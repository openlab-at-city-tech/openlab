(function(){"use strict";class e{constructor(){this.CACHE_PREFIX="epkb_chat_";this.MESSAGE_CACHE_PREFIX="epkb_chat_messages_";this.CHAT_ID_KEY="epkb_chat_id"}saveChatId(e){try{if(e){sessionStorage.setItem(this.CHAT_ID_KEY,e);return{success:true,error:null}}return{success:false,error:{message:"No chat ID provided"}}}catch(e){console.error("Failed to save chat ID:",e);return{success:false,error:{type:"storage_error",message:e.message,details:"Failed to save chat ID to storage"}}}}loadChatId(){try{const e=sessionStorage.getItem(this.CHAT_ID_KEY);if(e&&typeof e!=="string"){throw new Error("Invalid chat ID format: "+e)}return e}catch(e){console.error("Failed to load chat ID:",e);return null}}clearChatId(){try{sessionStorage.removeItem(this.CHAT_ID_KEY);return{success:true,error:null}}catch(e){console.error("Failed to clear chat ID:",e);return{success:false,error:{type:"storage_error",message:e.message,details:"Failed to clear chat ID from storage"}}}}saveMessages(e,t){if(!e||!t){return false}try{const r=`${this.MESSAGE_CACHE_PREFIX}${e}`;sessionStorage.setItem(r,JSON.stringify(t));return true}catch(r){if(r.name==="QuotaExceededError"){this.clearOldCaches();try{const r=`${this.MESSAGE_CACHE_PREFIX}${e}`;sessionStorage.setItem(r,JSON.stringify(t));return true}catch(e){return false}}return false}}loadMessages(e){if(!e){return null}try{const t=`${this.MESSAGE_CACHE_PREFIX}${e}`;const r=sessionStorage.getItem(t);return r?JSON.parse(r):null}catch(e){return null}}clearMessageCache(e){if(!e){return false}try{const t=`${this.MESSAGE_CACHE_PREFIX}${e}`;sessionStorage.removeItem(t);return true}catch(e){console.error("Failed to clear message cache:",e);return false}}clearOldCaches(e=null){try{const t=Object.keys(sessionStorage);t.forEach((t=>{if(t.startsWith(this.MESSAGE_CACHE_PREFIX)){if(!e||!t.includes(e)){sessionStorage.removeItem(t)}}}))}catch(e){}}}window.EPKBChatCache={ChatCacheManager:e}})();