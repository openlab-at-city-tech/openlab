(function(){"use strict";const{useState:e,useEffect:a,useCallback:s,createElement:t}=wp.element;const{__:i}=wp.i18n;const{showError:n,showSuccess:c,makeApiRequest:l,showLoadingDialog:o,useTableSearch:r,formatServerDateTime:d,TutorialButton:p}=window.EPKB_AI_Util_React||{};const u=e=>{const a=document.createElement("div");a.className="epkb-ai-dialog epkb-ai-loading-dialog";a.style.cssText=`\n\t\t\tposition: fixed;\n\t\t\tbottom: 20px;\n\t\t\tright: 20px;\n\t\t\tbackground: white;\n\t\t\tborder-radius: 8px;\n\t\t\tpadding: 24px;\n\t\t\tmax-width: 350px;\n\t\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n\t\t\tz-index: 999999;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tgap: 16px;\n\t\t\tborder: 1px solid #ddd;\n\t\t`;const s=document.createElement("div");s.className="epkb-loading-spinner";s.style.cssText="width: 24px; height: 24px; flex-shrink: 0;";const t=document.createElement("p");t.style.cssText="margin: 0; color: #555; font-size: 14px; line-height: 1.5; font-weight: 500;";t.textContent=e;a.appendChild(s);a.appendChild(t);document.body.appendChild(a);a.offsetHeight;return{close:()=>{a.style.transition="opacity 0.3s ease-out";a.style.opacity="0";setTimeout((()=>a.remove()),300)}}};const b=({searches:a,selectedId:n,onSelect:l,onDelete:o,isLoading:p,onRefresh:b,onSearch:m,allSearches:_,currentPage:h,totalPages:k,onPageChange:f})=>{const[g,y]=e([]);const[w,v]=e(false);const[N,S]=e("desc");const[x,C]=e((()=>{const e="epkb_viewed_search_history";try{const a=localStorage.getItem(e);return a?new Set(JSON.parse(a)):new Set}catch(e){return new Set}}));const E=s((e=>{C((a=>{const s=new Set(a);s.add(e);const t="epkb_viewed_search_history";try{localStorage.setItem(t,JSON.stringify([...s]))}catch(e){}return s}))}),[]);const{searchTerm:R,displayedData:P,isSearching:A,searchMessage:q,handleSearchChange:I,clearSearch:T}=r({data:a,allData:_,onServerSearch:m,searchFields:["query","user_name","user"]});const L=[...P].sort(((e,a)=>{const s=new Date(e.created_at||e.time||0);const t=new Date(a.created_at||a.time||0);if(N==="asc"){return s-t}else{return t-s}}));const D=e=>{if(e){y(L.map((e=>e.id)))}else{y([])}};const O=()=>{S(N==="asc"?"desc":"asc")};const B=(e,a)=>{if(a){y([...g,e])}else{y(g.filter((a=>a!==e)))}};const $=async()=>{if(g.length===0)return;const{showConfirmDialog:e}=window.EPKB_AI_Util_React||{};if(!e){if(!confirm(i("Are you sure you want to delete the selected searches?","echo-knowledge-base"))){return}}else{const a=await e({title:i("Delete Search History","echo-knowledge-base"),message:i("Are you sure you want to delete the selected searches?","echo-knowledge-base"),confirmText:i("Delete","echo-knowledge-base"),cancelText:i("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-destructive"});if(!a){return}}const a=u(i("Deleting searches...","echo-knowledge-base"));g.forEach((e=>{const a=document.getElementById(`search-row-${e}`);if(a){a.style.opacity="0.5";a.style.transition="opacity 0.3s ease"}}));try{await o(g);y([])}catch(e){g.forEach((e=>{const a=document.getElementById(`search-row-${e}`);if(a){a.style.opacity="1"}}));throw e}finally{if(a){a.close()}}};const U=async()=>{v(true);await b();v(false);c(i("Search history refreshed successfully","echo-knowledge-base"))};return t("div",{className:"epkb-ai-data-source-table"},t("div",{className:"epkb-ai-table-content"},t("div",{className:"epkb-submissions-table-container"},t("div",{className:"epkb-table-filter-container"},t("div",{className:"epkb-ai-search-input"},t("input",{type:"text",placeholder:i("Search queries...","echo-knowledge-base"),value:R,onChange:e=>I(e.target.value)}),t("span",{className:"epkb-ai-search-icon epkbfa epkbfa-search"})),t("button",{className:"epkb-ai-button epkb-ai-button-success",onClick:U,disabled:p||w,style:{backgroundColor:"#46b450",borderColor:"#46b450",color:"#fff",padding:"6px 12px",fontSize:"14px",marginRight:g.length>0?"10px":"0"}},w?i("Refreshing...","echo-knowledge-base"):t("span",null,t("span",{className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),i("Refresh","echo-knowledge-base"))),g.length>0&&t("button",{className:"epkb-ai-button epkb-ai-button-destructive",onClick:$},i("Delete Selected","echo-knowledge-base"))),p?t("div",{className:"epkb-ai-loading"},t("div",{className:"epkb-loading-spinner"}),t("p",null,i("Loading search history...","echo-knowledge-base"))):L.length===0&&!R?t("div",{className:"epkb-ai-no-data"},t("p",null,i("No searches found","echo-knowledge-base"))):t("table",{id:"epkb-search-conversations-table"},t("thead",null,t("tr",null,t("th",null,t("input",{type:"checkbox",checked:g.length===L.length&&L.length>0,onChange:e=>D(e.target.checked)})),t("th",{"data-column":"search_date",style:{cursor:"pointer",userSelect:"none"},onClick:O},t("span",null,i("Time","echo-knowledge-base")," ",N==="asc"?"↑":"↓")),t("th",{"data-column":"user"},i("User","echo-knowledge-base")),t("th",{"data-column":"query"},i("Search Query","echo-knowledge-base")),t("th",{"data-column":"info"},i("Info","echo-knowledge-base")))),t("tbody",null,L.map((e=>t("tr",{key:e.id,id:`search-row-${e.id}`,className:`${n===e.id?"selected":""} ${!x.has(e.id)?"epkb-ai-unviewed-record":""}`.trim(),onClick:()=>{E(e.id);l(e.id)}},t("td",null,t("input",{type:"checkbox",checked:g.includes(e.id),onChange:a=>B(e.id,a.target.checked),onClick:e=>e.stopPropagation()})),t("td",null,d?d(e.created_at||e.time,"-"):e.created_at||e.time||"-"),t("td",null,e.user_id&&e.user_id>0?t("a",{href:`user-edit.php?user_id=${e.user_id}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"}},e.user_name||e.user):e.user_name||e.user||"Guest"),t("td",null,e.query),t("td",{className:"epkb-ai-search-info-cell"},(()=>{let a=null;if(e.metadata){a=typeof e.metadata==="string"?JSON.parse(e.metadata):e.metadata}if(a&&a.contact_submission){return t("span",{style:{color:"#2271b1",fontWeight:"600"}},t("span",{className:"epkbfa epkbfa-user",style:{fontSize:"16px",marginRight:"5px"},title:i("Contact request submitted","echo-knowledge-base")}),i("User Needs Help","echo-knowledge-base"))}const s=a?a.vote:null;if(s==="up"){return t("span",{className:"epkbfa epkbfa-thumbs-up",style:{color:"#46b450",fontSize:"16px"},title:i("Positive feedback","echo-knowledge-base")})}else if(s==="down"){return t("span",{className:"epkbfa epkbfa-thumbs-down",style:{color:"#dc3232",fontSize:"16px"},title:i("Negative feedback","echo-knowledge-base")})}return"-"})())))))),(q||A)&&t("div",{className:"epkb-ai-search-message",style:{textAlign:"center",padding:"10px",color:"#666",fontStyle:"italic"}},A?i("Searching server for more results...","echo-knowledge-base"):q),(()=>{if(k<=1){return null}return t("div",{className:"epkb-ai-pagination"},t("button",{disabled:h===1,onClick:()=>f(h-1),className:"epkb-ai-button epkb-ai-button-secondary"},i("Previous","echo-knowledge-base")),t("span",{className:"epkb-ai-page-info"},`${i("Page","echo-knowledge-base")} ${h} ${i("of","echo-knowledge-base")} ${k}`),t("button",{disabled:h===k,onClick:()=>f(h+1),className:"epkb-ai-button epkb-ai-button-secondary"},i("Next","echo-knowledge-base")))})())))};const m=({search:e})=>{if(!e){return t("div",{className:"epkb-ai-data-source-settings"},t("h3",{className:"epkb-ai-data-source-heading"},i("Search Details","echo-knowledge-base")),t("div",{className:"epkb-ai-action-content"},t("div",{className:"epkb-ai-no-selection"},t("p",null,i("Select a search to view details","echo-knowledge-base")))))}return t("div",{className:"epkb-ai-data-source-settings"},t("h3",{className:"epkb-ai-data-source-heading"},i("Search Details","echo-knowledge-base")),t("div",{className:"epkb-ai-action-content"},t("div",{className:"epkb-ai-conversation-details"},t("div",{className:"epkb-ai-conversation-meta"},t("h4",null,i("Search Information","echo-knowledge-base")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Query:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.query||"-")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("User:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.user_id&&e.user_id>0?t("a",{href:`user-edit.php?user_id=${e.user_id}`,target:"_blank",rel:"noopener noreferrer"},e.user_name||e.user||"Guest"):e.user_name||e.user||"Guest")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Date:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},d?d(e.created_at,"-"):e.created_at||"-")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Results Count:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.results_count||0)),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Status:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.status||"completed"))),(()=>{let a=null;if(e.metadata){a=typeof e.metadata==="string"?JSON.parse(e.metadata):e.metadata}if(a&&a.contact_submission){const e=a.contact_submission;return t("div",{className:"epkb-ai-contact-request-box",style:{marginTop:"20px",padding:"15px",background:"#f9f9f9",borderRadius:"4px"}},t("h4",{style:{marginTop:"0",color:"#2271b1"}},t("span",{className:"epkbfa epkbfa-user",style:{marginRight:"5px"}}),i("Contact Request","echo-knowledge-base")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Name:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.name||"-")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Email:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},e.email?t("a",{href:`mailto:${e.email}`},e.email):"-")))}return null})(),(()=>{let a=null;if(e.metadata){a=typeof e.metadata==="string"?JSON.parse(e.metadata):e.metadata}const s=a?a.vote:null;if(s){return t("div",{className:"epkb-ai-feedback-box",style:{marginTop:"20px",padding:"15px",background:"#f9f9f9",borderRadius:"4px"}},t("h4",{style:{marginTop:"0",color:"#2271b1"}},t("span",{className:"epkbfa epkbfa-star",style:{marginRight:"5px"}}),i("Feedback","echo-knowledge-base")),t("div",{className:"epkb-ai-meta-item"},t("span",{className:"epkb-ai-meta-label"},i("Vote:","echo-knowledge-base")),t("span",{className:"epkb-ai-meta-value"},s==="up"?t("span",{style:{color:"#46b450",fontWeight:"bold"}},t("span",{className:"epkbfa epkbfa-thumbs-up",style:{fontSize:"16px",marginRight:"5px"}}),i("Positive","echo-knowledge-base")):t("span",{style:{color:"#dc3232",fontWeight:"bold"}},t("span",{className:"epkbfa epkbfa-thumbs-down",style:{fontSize:"16px",marginRight:"5px"}}),i("Negative","echo-knowledge-base")))))}return null})(),t("div",{className:"epkb-ai-conversation-thread"},t("h4",null,i("Search Interaction","echo-knowledge-base")),e.messages&&e.messages.length>0?t("div",{className:"epkb-ai-messages-list"},e.messages.map(((e,a)=>t("div",{key:a,className:`epkb-ai-message epkb-ai-message-${e.role}`},t("div",{className:"epkb-ai-message-header"},t("span",{className:"epkb-ai-message-role"},e.role==="user"?i("User","echo-knowledge-base"):i("AI Assistant","echo-knowledge-base")),e.timestamp&&t("span",{className:"epkb-ai-message-time"},d?d(e.timestamp,""):e.timestamp)),t("div",{className:"epkb-ai-message-bubble"},t("div",{className:"epkb-ai-message-content"},e.content)))))):t("div",{className:"epkb-ai-messages-list"},(e.ai_response||e.response)&&t("div",{className:"epkb-ai-message epkb-ai-message-assistant"},t("div",{className:"epkb-ai-message-header"},t("span",{className:"epkb-ai-message-role"},i("AI Response","echo-knowledge-base")),e.response_time&&t("span",{className:"epkb-ai-message-time"},d?d(e.response_time,""):e.response_time)),t("div",{className:"epkb-ai-message-bubble"},t("div",{className:"epkb-ai-message-content"},e.ai_response||e.response))),e.results&&e.results.length>0&&t("div",{className:"epkb-ai-message epkb-ai-message-system"},t("div",{className:"epkb-ai-message-header"},t("span",{className:"epkb-ai-message-role"},i("Search Results","echo-knowledge-base"))),t("div",{className:"epkb-ai-message-bubble"},t("div",{className:"epkb-ai-message-content"},t("div",{className:"epkb-ai-search-results-list"},e.results.map(((e,a)=>t("div",{key:a,className:"epkb-ai-result-item"},t("div",{className:"epkb-ai-result-header"},t("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},e.title),e.clicked&&t("span",{className:"epkb-ai-clicked-badge"},i("✓ Clicked","echo-knowledge-base"))),e.score&&t("div",{className:"epkb-ai-result-meta"},i("Relevance:","echo-knowledge-base")," ",(e.score*100).toFixed(0)+"%")))))))))))))};const _=({field:s,fieldName:i,value:n,onChange:c,onPresetChange:l})=>{const[o,r]=e(false);const d=["epkb-ai-field","epkb-ai-field-select","epkb-ai-behavior-preset-select"];if(s.field_class){s.field_class.split(" ").forEach((e=>{if(e&&!d.includes(e)){d.push(e)}}))}a((()=>{const e=e=>{if(!e.target.closest(".epkb-ai-custom-dropdown")){r(false)}};const a=document.querySelector(".epkb-ai-behavior-preset-select");const s=a?a.closest(".epkb-ai-settings-section"):null;if(s){if(o){s.classList.add("epkb-has-dropdown-open")}else{s.classList.remove("epkb-has-dropdown-open")}}if(o){document.addEventListener("click",e);return()=>{document.removeEventListener("click",e);if(s){s.classList.remove("epkb-has-dropdown-open")}}}}),[o]);const p=e=>{const a=e.split(" - ");if(a.length===2){return{name:a[0].trim(),description:a[1].trim()}}return{name:e,description:""}};const u=s.options[n]||"";const b=p(u);return t("div",{className:d.join(" ")},t("label",{className:"epkb-ai-field-label"},s.label),t("div",{className:"epkb-ai-custom-dropdown"},t("div",{className:"epkb-ai-dropdown-trigger",onClick:()=>r(!o)},t("span",{className:"epkb-ai-dropdown-value"},b.name),t("span",{className:"epkb-ai-dropdown-arrow"},o?"▲":"▼")),o&&t("div",{className:"epkb-ai-dropdown-menu"},Object.entries(s.options).map((([e,a])=>{const s=p(a);return t("div",{key:e,className:"epkb-ai-dropdown-option"+(n===e?" selected":""),onClick:async()=>{c(i,e);if(l&&e!=="custom"){await l(e)}r(false)}},t("div",{className:"epkb-ai-option-name"},s.name),s.description&&t("div",{className:"epkb-ai-option-description"},s.description))})))),s.description&&t("p",{className:"epkb-ai-field-description"},s.description))};const h=({fieldName:e,field:a,value:s,onChange:n})=>{const{useState:c}=wp.element;const[l,o]=c("");const r=a.column_number||1;const d=a.available_sections||{};const p=Array.isArray(s)?s:[];const u=()=>{if(!l)return;const a=[...p,l];n(e,a);o("")};const b=a=>{const s=p.filter(((e,s)=>s!==a));n(e,s)};const m=(a,s)=>{const t=[...p];const i=s==="up"?a-1:a+1;if(i<0||i>=t.length)return;[t[a],t[i]]=[t[i],t[a]];n(e,t)};return t("div",{className:"epkb-ai-field epkb-ai-field-sections-manager"+(a.field_class?" "+a.field_class:"")},t("label",{className:"epkb-ai-field-label"},a.label),t("div",{className:"epkb-search-results-column-manager","data-column":r},t("div",{className:"epkb-selected-sections"},t("ul",{className:"epkb-sections-list"},p.length===0?t("li",{className:"epkb-no-sections"},i("No sections added yet","echo-knowledge-base")):p.map(((e,a)=>t("li",{key:e+"-"+a,className:"epkb-section-item","data-section-id":e},t("span",{className:"epkb-section-name"},d[e]||e),t("div",{className:"epkb-section-actions"},t("button",{type:"button",className:"epkb-btn-move-up",disabled:a===0,onClick:()=>m(a,"up")},t("i",{className:"epkbfa epkbfa-arrow-up"})),t("button",{type:"button",className:"epkb-btn-move-down",disabled:a===p.length-1,onClick:()=>m(a,"down")},t("i",{className:"epkbfa epkbfa-arrow-down"})),t("button",{type:"button",className:"epkb-btn-remove",onClick:()=>b(a)},t("i",{className:"epkbfa epkbfa-times"})))))))),t("div",{className:"epkb-add-section-controls"},t("select",{className:"epkb-section-select",value:l,onChange:e=>o(e.target.value)},t("option",{value:""},i("-- Select Section --","echo-knowledge-base")),Object.entries(d).map((([e,a])=>t("option",{key:e,value:e},a)))),t("button",{type:"button",className:"epkb-btn-add-section epkb-primary-btn",onClick:u},i("Add Section","echo-knowledge-base")))),a.description&&t("p",{className:"epkb-ai-field-description"},a.description))};const k=({settings:e,onChange:s,onSave:n,isSaving:c,onPresetChange:l,onLayoutPresetChange:o})=>{a((()=>{const a=()=>{const a=e.ai_search_enabled||"off";const s=e.ai_search_mode||"simple_search";if(a==="off"){const e=document.getElementById("search_results_general");if(e){const a=e.querySelectorAll(".epkb-ai-field");a.forEach((e=>{if(e.classList.contains("epkb-ai-search-mode")||e.classList.contains("epkb-ai-search-enabled")){e.style.display=""}else{e.style.display="none"}}))}["search_results_presets","search_results_columns","search_results_column_sections","search_results_sections"].forEach((e=>{const a=document.getElementById(e);if(a)a.style.display="none"}));return}const t=document.getElementById("search_results_general");if(t){const e=t.querySelectorAll(".epkb-ai-search-enabled, .epkb-ai-search-mode");e.forEach((e=>{e.style.display=""}))}if(s==="simple_search"){const e=document.querySelectorAll(".epkb-ai-mode-simple_search");e.forEach((e=>{const a=e.closest(".epkb-ai-field");if(a)a.style.display=""}));const a=document.querySelectorAll(".epkb-ai-mode-advanced_search");a.forEach((e=>{if(e.id==="epkb-ai-pro-ad-container"){e.style.display="none"}else{const a=e.closest(".epkb-ai-field");if(a)a.style.display="none"}}));const s=document.querySelector(".epkb-ai-behavior-preset-select");if(s&&!s.classList.contains("epkb-ai-mode-simple_search")){const e=s.closest(".epkb-ai-field");if(e)e.style.display=""}["search_results_presets","search_results_columns","search_results_column_sections","search_results_sections"].forEach((e=>{const a=document.getElementById(e);if(a)a.style.display="none"}));return}if(s==="advanced_search"){const e=document.querySelectorAll(".epkb-ai-mode-simple_search");e.forEach((e=>{const a=e.closest(".epkb-ai-field");if(a)a.style.display="none"}));const a=document.querySelectorAll(".epkb-ai-mode-advanced_search");a.forEach((e=>{if(e.id==="epkb-ai-pro-ad-container"){e.style.display=""}else{const a=e.closest(".epkb-ai-field");if(a)a.style.display=""}}));const s=document.querySelector(".epkb-ai-behavior-preset-select");if(s){const e=s.closest(".epkb-ai-field");if(e){if(s.classList.contains("epkb-ai-mode-simple_search")){e.style.display="none"}else{e.style.display=""}}}["search_results_presets","search_results_columns","search_results_column_sections","search_results_sections"].forEach((e=>{const a=document.getElementById(e);if(a)a.style.display=""}))}};a()}),[e.ai_search_enabled,e.ai_search_mode]);a((()=>{const a=()=>{const a=e.ai_search_results_num_columns||"1";const s=document.querySelector('[data-column="1"]');const t=document.querySelector('[data-column="2"]');const n=document.querySelector('[data-column="3"]');const c=s?s.closest(".epkb-ai-field").querySelector(".epkb-ai-field-label"):null;const l=t?t.closest(".epkb-ai-field").querySelector(".epkb-ai-field-label"):null;const o=n?n.closest(".epkb-ai-field").querySelector(".epkb-ai-field-label"):null;if(c){c.textContent=a==="1"?i("Single Column","echo-knowledge-base"):i("Left Column","echo-knowledge-base")}if(l){l.textContent=a==="2"?i("Right Column","echo-knowledge-base"):i("Middle Column","echo-knowledge-base")}if(o){o.textContent=i("Right Column","echo-knowledge-base")}};a()}),[e.ai_search_results_num_columns]);const r=(a,n)=>{const c=e.hasOwnProperty(a)?e[a]:n.value||"";switch(n.type){case"toggle":return t("div",{className:"epkb-ai-field epkb-ai-field-toggle"},t("label",{className:"epkb-ai-toggle-label"},t("input",{type:"checkbox",checked:c==="on",onChange:e=>s(a,e.target.checked?"on":"off")}),t("span",{className:"epkb-ai-toggle-text"},n.label)),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"radio":return t("div",{className:"epkb-ai-field epkb-ai-field-radio"+(n.field_class?" "+n.field_class:"")},t("div",{className:"epkb-ai-field-label"},n.label),t("div",{className:"epkb-ai-radio-group"},Object.entries(n.options).map((([e,i])=>t("label",{key:e,className:"epkb-ai-radio-label"},t("input",{type:"radio",name:a,value:e,checked:c===e,onChange:e=>s(a,e.target.value)}),t("span",{className:"epkb-ai-radio-text"},i))))),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"checkbox":return t("div",{className:"epkb-ai-field epkb-ai-field-checkbox"+(n.field_class?" "+n.field_class:"")},t("label",{className:"epkb-ai-checkbox-label"},t("input",{type:"checkbox",checked:c==="on",onChange:e=>s(a,e.target.checked?"on":"off")}),t("span",{className:"epkb-ai-checkbox-text"},n.label)),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"text":return t("div",{className:"epkb-ai-field epkb-ai-field-text"+(n.field_class?" "+n.field_class:"")},t("label",{className:"epkb-ai-field-label"},n.label),t("input",{type:"text",className:"epkb-ai-input",value:c||"",onChange:e=>s(a,e.target.value),placeholder:n.placeholder||""}),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"number":return t("div",{className:"epkb-ai-field epkb-ai-field-number"},t("label",{className:"epkb-ai-field-label"},n.label),t("input",{type:"number",className:"epkb-ai-input",value:c||"",onChange:e=>s(a,e.target.value),min:n.min,max:n.max,step:n.step}),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"select":if(n.field_class&&n.field_class.includes("epkb-ai-behavior-preset-select")){return t(_,{field:n,fieldName:a,value:c,onChange:s,onPresetChange:l})}if(n.field_class&&n.field_class.includes("epkb-ai-layout-preset-select")){return t(_,{field:n,fieldName:a,value:c,onChange:s,onPresetChange:o})}const r=e=>{const a=typeof e==="string"&&e.indexOf("gpt-5")===0;if(a){return{type:"gpt5",defaults:{verbosity:"medium",reasoning:"medium",max_output_tokens:5e3}}}return{type:"gpt4",defaults:{temperature:.2,top_p:1,max_output_tokens:5e3}}};return t("div",{className:"epkb-ai-field epkb-ai-field-select"+(n.field_class?" "+n.field_class:"")},t("label",{className:"epkb-ai-field-label"},n.label),t("select",{className:"epkb-ai-select",value:c,onChange:t=>{const i=t.target.value;s(a,i);if(a==="ai_search_model"){const a=e.ai_search_preset!==undefined?e.ai_search_preset:e.sections&&e.sections.search_behavior&&e.sections.search_behavior.fields&&e.sections.search_behavior.fields.ai_search_preset?e.sections.search_behavior.fields.ai_search_preset.value:"custom";if(a==="custom"){const e=r(i);if(e.type==="gpt5"){if(e.defaults.verbosity!==undefined)s("ai_search_verbosity",e.defaults.verbosity);if(e.defaults.reasoning!==undefined)s("ai_search_reasoning",e.defaults.reasoning)}else{if(e.defaults.temperature!==undefined)s("ai_search_temperature",e.defaults.temperature);if(e.defaults.top_p!==undefined)s("ai_search_top_p",e.defaults.top_p)}if(e.defaults.max_output_tokens!==undefined)s("ai_search_max_output_tokens",e.defaults.max_output_tokens)}}}},Object.entries(n.options).map((([e,a])=>t("option",{key:e,value:e},a)))),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"textarea":return t("div",{className:"epkb-ai-field epkb-ai-textarea-field"+(n.field_class?" "+n.field_class:"")},t("div",{className:"epkb-ai-textarea-header"},t("label",null,n.label),n.show_reset&&t("button",{type:"button",className:"epkb-ai-reset-button",onClick:async()=>{if(n.default){const{showConfirmDialog:e}=window.EPKB_AI_Util_React||{};if(!e){if(confirm(i("Are you sure you want to reset to default instructions?","echo-knowledge-base"))){s(a,n.default)}}else{const t=await e({title:i("Reset Instructions","echo-knowledge-base"),message:i("Are you sure you want to reset to default instructions? Your custom instructions will be lost.","echo-knowledge-base"),confirmText:i("Reset","echo-knowledge-base"),cancelText:i("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-destructive"});if(t){s(a,n.default)}}}}},i("Reset to Default","echo-knowledge-base"))),t("textarea",{value:c||"",onChange:e=>s(a,e.target.value),rows:n.rows||3,placeholder:n.placeholder}),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"custom_html":return t("div",{className:"epkb-ai-field epkb-ai-field-custom-html"+(n.field_class?" "+n.field_class:"")},t("label",{className:"epkb-ai-field-label"},n.label),t("div",{className:"epkb-ai-custom-html-content",dangerouslySetInnerHTML:{__html:n.value||""}}),n.description&&t("p",{className:"epkb-ai-field-description"},n.description));case"sections_manager":return t(h,{fieldName:a,field:n,value:Array.isArray(c)?c:[],onChange:s});default:return null}};return t("div",{className:"epkb-ai-settings"},t("div",{className:"epkb-ai-settings-sections-wrapper"},Object.entries(e.sections||{}).map((([e,a])=>t("div",{key:e,id:e,className:"epkb-ai-settings-section"},t("div",{className:"epkb-ai-section-header"},a.icon&&t("span",{className:a.icon}),t("div",{className:"epkb-ai-header-text"},t("h3",null,a.title))),t("div",{className:"epkb-ai-section-content"},Object.entries(a.fields||{}).map((([e,a])=>t("div",{key:e,className:"epkb-ai-field-row"},r(e,a)))))))),e.ai_pro_ad_html&&t("div",{id:"epkb-ai-pro-ad-container",className:"epkb-ai-pro-ad epkb-ai-mode-advanced_search",style:{margin:"20px 0"},dangerouslySetInnerHTML:{__html:e.ai_pro_ad_html}})),t("div",{className:"epkb-ai-settings-actions"},t("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:n,disabled:c},c?i("Saving...","echo-knowledge-base"):i("Save Settings","echo-knowledge-base"))))};const f=({settings:n,tabData:c,isLoading:l,onDataChange:o,makeApiRequest:r,showError:d,showSuccess:u,onTabSwitch:_})=>{const[h,f]=e((()=>{const e=new URL(window.location);return e.searchParams.get("active_sub_tab")||c?.active_sub_tab||"search-history"}));const[g,y]=e(null);const[w,v]=e([]);const[N,S]=e(false);const[x,C]=e(false);const[E,R]=e(c?.ai_config||{});const[P,A]=e(false);const[q,I]=e(null);const[T,L]=e(false);const[D,O]=e(1);const[B,$]=e(1);const[U,j]=e({ai_search_enabled:c?.ai_config?.ai_search_enabled||"off",ai_chat_enabled:c?.ai_config?.ai_chat_enabled||"off"});a((()=>{if(c){v([]);if(c.ai_config){R(c.ai_config);j({ai_search_enabled:c.ai_config.ai_search_enabled||"off",ai_chat_enabled:c.ai_config.ai_chat_enabled||"off"})}}}),[c]);const z=s((async()=>{L(true);try{const e=await r("ai-search/searches",{method:"GET",params:{kb_id:n?.kb_id||1,per_page:100}});if(e&&e.searches){let a=[...e.searches];const s=e.pagination?.total_pages||1;for(let e=2;e<=s;e++){const s=await r("ai-search/searches",{method:"GET",params:{kb_id:n?.kb_id||1,page:e,per_page:100}});if(s&&s.searches){a=[...a,...s.searches]}}I(a);return a}}catch(e){console.error("Failed to fetch all searches for filtering:",e);throw e}finally{L(false)}return[]}),[r,n?.kb_id]);const F=s((async e=>{if(!e)return null;O(1);if(T)return null;if(q&&q.length>0){return q}try{const e=await z();return e}catch(e){console.error("Server search failed:",e);return null}}),[z,T,q]);const G=async(e=1)=>{if(!r){return Promise.resolve([])}if(E.ai_search_enabled==="off"){v([]);I(null);A(true);$(1);return Promise.resolve([])}S(true);try{const a=await r("ai-search/searches",{method:"GET",params:{kb_id:n?.kb_id||1,per_page:10,page:e}});if(a&&a.searches){v(a.searches);A(true);$(a.pages||1);I(null);return a.searches}else{v([]);A(true);I(null);$(1);return[]}}catch(e){d(e.message||i("Failed to load search history","echo-knowledge-base"));throw e}finally{S(false)}};a((()=>{if(h==="search-history"&&!P){G(D)}}),[h,P,n?.kb_id,r]);a((()=>{if(h==="search-history"&&P){G(D)}}),[D]);a((()=>()=>{A(false);v([]);I(null);y(null)}),[]);const H=(e,a)=>{R((s=>({...s,[e]:a})))};const J=e=>{const a=window.epkb_ai_api?.presets?.search||{};if(e!=="custom"&&a[e]){const s=a[e];R((a=>{const t={...a,ai_search_preset:e};if(s.model!==undefined)t.ai_search_model=s.model;if(s.verbosity!==undefined)t.ai_search_verbosity=s.verbosity;if(s.reasoning!==undefined)t.ai_search_reasoning=s.reasoning;if(s.temperature!==undefined)t.ai_search_temperature=s.temperature;if(s.max_output_tokens!==undefined)t.ai_search_max_output_tokens=s.max_output_tokens;if(s.top_p!==undefined)t.ai_search_top_p=s.top_p;return t}))}else{R((a=>({...a,ai_search_preset:e})))}};const K=e=>{const a=window.epkb_ai_api?.presets?.search_layout||{};if(e!=="custom"&&a[e]){const s=a[e];R((a=>({...a,ai_search_results_layout_preset:e,...s})))}else{R((a=>({...a,ai_search_results_layout_preset:e})))}};const M=async()=>{C(true);try{const e={ai_search_enabled:E.ai_search_enabled,ai_search_mode:E.ai_search_mode,ai_search_model:E.ai_search_model,ai_search_instructions:E.ai_search_instructions,ai_search_verbosity:E.ai_search_verbosity,ai_search_reasoning:E.ai_search_reasoning,ai_search_temperature:E.ai_search_temperature,ai_search_max_output_tokens:E.ai_search_max_output_tokens,ai_search_top_p:E.ai_search_top_p,ai_search_immediate_query:E.ai_search_immediate_query,ai_search_ask_button_text:E.ai_search_ask_button_text,ai_search_results_width:E.ai_search_results_width,ai_search_results_separator:E.ai_search_results_separator,ai_search_results_num_columns:E.ai_search_results_num_columns,ai_search_results_column_widths:E.ai_search_results_column_widths,ai_search_results_column_1_sections:E.ai_search_results_column_1_sections,ai_search_results_column_2_sections:E.ai_search_results_column_2_sections,ai_search_results_column_3_sections:E.ai_search_results_column_3_sections,ai_search_results_matching_articles_name:E.ai_search_results_matching_articles_name,ai_search_results_ai_answer_name:E.ai_search_results_ai_answer_name,ai_search_results_glossary_name:E.ai_search_results_glossary_name,ai_search_results_tips_name:E.ai_search_results_tips_name,ai_search_results_steps_name:E.ai_search_results_steps_name,ai_search_results_tasks_list_name:E.ai_search_results_tasks_list_name,ai_search_results_you_can_also_ask_name:E.ai_search_results_you_can_also_ask_name,ai_search_results_related_keywords_name:E.ai_search_results_related_keywords_name,ai_search_results_custom_prompt_name:E.ai_search_results_custom_prompt_name,ai_search_results_feedback_name:E.ai_search_results_feedback_name,ai_search_results_contact_us_name:E.ai_search_results_contact_us_name,ai_search_results_custom_prompt_text:E.ai_search_results_custom_prompt_text,ai_search_results_contact_support_button_text:E.ai_search_results_contact_support_button_text,ai_search_results_contact_support_email:E.ai_search_results_contact_support_email};const a=await r("ai/settings",{method:"POST",data:{settings:e}});if(a.success){u(i("Settings saved successfully","echo-knowledge-base"));o({ai_config:E});const e=U.ai_search_enabled!==E.ai_search_enabled;const a=U.ai_chat_enabled!==E.ai_chat_enabled;if(e||a){setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","search");window.location.href=e.toString()}),1e3)}else{j({ai_search_enabled:E.ai_search_enabled,ai_chat_enabled:E.ai_chat_enabled||U.ai_chat_enabled})}}}catch(e){d(e.message||i("Failed to save settings","echo-knowledge-base"))}finally{C(false)}};const W=async e=>{try{const a=await r("ai-search/searches/bulk",{method:"DELETE",data:{ids:e}});const s=a.success||a===true||typeof a==="string"&&a.includes("deleted successfully")||a.message&&a.message.includes("deleted successfully");if(s){const s=typeof a==="string"?a:a.message||i("Searches deleted successfully","echo-knowledge-base");u(s);v((a=>a.filter((a=>!e.includes(a.id)))));I((a=>a?a.filter((a=>!e.includes(a.id))):null));if(e.includes(g)){y(null)}}else{throw new Error(a.message||a||i("Failed to delete searches","echo-knowledge-base"))}}catch(e){d(e.message||i("Failed to delete searches","echo-knowledge-base"));throw e}};const Q=w.find((e=>e.id===g));const V=[{id:"search-history",title:i("Search History","echo-knowledge-base")},{id:"search-settings",title:i("Search Settings","echo-knowledge-base")}];const Y=c?.sub_tabs?Object.values(c.sub_tabs):V;const X=c?.ai_config?.ai_disclaimer_accepted==="on";if(!X){const{DisclaimerRequiredMessage:e}=window.EPKB_AI_Util_React||{};if(e){return t(e,{i18n:n?.i18n||{},onAccept:()=>{if(_){_("general-settings")}else{const e=new URL(window.location.href);if(e.searchParams.has("page")){e.searchParams.set("active_tab","general-settings");window.location.href=e.toString()}}}})}}const Z=()=>{switch(h){case"search-history":if(E.ai_search_enabled==="off"){return t("div",{className:"epkb-ai-disabled-message"},t("div",{className:"epkb-ai-notice epkb-ai-notice-warning"},t("h3",null,i("AI Search is Disabled","echo-knowledge-base")),t("p",null,i("To view search history, please enable AI Search in the Settings tab.","echo-knowledge-base")),t("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:()=>{f("search-settings");const e=new URL(window.location);e.searchParams.set("active_sub_tab","search-settings");window.history.pushState({},"",e)}},i("Go to Settings","echo-knowledge-base"))))}return t("div",{className:"epkb-ai-data-source-layout"},t(b,{searches:w,allSearches:q,selectedId:g,onSelect:y,onDelete:W,isLoading:N,onRefresh:()=>G(D),onSearch:F,currentPage:D,totalPages:B,onPageChange:O}),t(m,{search:Q}));case"search-settings":const e={};if(c?.settings_sections){Object.entries(c.settings_sections).forEach((([a,s])=>{if(s.sub_tab==="search-settings"){e[a]=s}}))}return t(k,{settings:{...E,sections:e,ai_pro_ad_html:c?.ai_pro_ad_html},onChange:H,onSave:M,isSaving:x,onPresetChange:J,onLayoutPresetChange:K});default:return null}};return t("div",{className:"epkb-ai-search-container"},Y.length>0&&t("div",{className:"epkb-ai-sub-tabs"},t("div",{className:"epkb-ai-sub-tabs-header"},t("div",{className:"epkb-ai-sub-tabs-nav"},Y.map((e=>t("button",{key:e.id,className:`epkb-ai-sub-tab-button epkb-ai-sub-tab-${e.id} ${h===e.id?"active":""}`,onClick:()=>{f(e.id);const a=new URL(window.location);a.searchParams.set("active_sub_tab",e.id);window.history.pushState({},"",a)}},e.title)))),p&&t(p,{url:"https://www.echoknowledgebase.com/documentation/step-2-enable-ai-search/"}),h==="search-settings"&&t("button",{type:"button",className:"epkb-ai-button epkb-ai-button-primary epkb-ai-sub-tabs-save-button",onClick:M,disabled:x},x?i("Saving...","echo-knowledge-base"):i("Save Settings","echo-knowledge-base")))),Z())};window.EPKB_AI_Search={AIAdminSearch:f}})();