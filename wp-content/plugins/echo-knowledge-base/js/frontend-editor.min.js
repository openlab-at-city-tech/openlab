jQuery(document).ready((function(e){let t=e("#epkb-fe__editor");if(t.length&&document.body.contains(t[0])){document.body.appendChild(t[0])}if(t.length>0){if(t.data("display-frontend-editor-closed")){e("#epkb-fe__toggle").show()}else{a(null)}}e(document).on("click",".epkb-fe__toggle, #wp-admin-bar-epkb-edit-mode-button",(function(t){if(e(t.target).closest(".epkb-fe__toggle-close").length>0){return}const n=new URLSearchParams(window.location.search);const i=document.body.classList;const o={visualComposer:n.get("vcv-editable")==="1"||i.contains("vcwb-editor-body"),divi:i.contains("et-fb-root-ancestor"),siteOrigin:i.contains("siteorigin-panels-live-editor"),pageLayer:i.contains("pagelayer-body"),beaver:i.contains("fl-builder-edit"),elementor:i.contains("elementor-editor-active"),brizy:i.contains("brz"),kubio:i.contains("kubio-iframe-holder--show"),colibri:i.contains("colibri-in-customizer")||i.contains("customize-partial-edit-shortcuts-shown")||i.contains("colibri-in-customizer--loaded")};const s=Object.keys(o).find((e=>o[e]));if(s){t.preventDefault();const e={visualComposer:"Visual Composer",divi:"Divi Builder",siteOrigin:"SiteOrigin Builder",pageLayer:"Pagelayer Builder",beaver:"Beaver Builder",elementor:"Elementor Builder",brizy:"Brizy Builder",kubio:"Kubio Builder",colibri:"Colibri Page Builder"};const a=e[s]||"Page Builder";const n=wp.i18n.__("The Knowledge Base Editor is disabled while the ${ builderName } is active. Do you want to go to the Knowledge Base settings instead?","echo-knowledge-base");const i=window.confirm(n);if(i){const e=epkb_fe_vars?.admin_url;if(e){const t=e+"edit.php?post_type=epkb_post_type_1&page=epkb-kb-configuration#settings";window.open(t,"_blank")}}return}a(t)}));function a(a){if(a){a.preventDefault()}t.css("right","0");t.show();e(".epkb-fe__toggle").hide();e("#epkb-fe__editor .epkb-fe__feature-settings").each((function(){const t=e(this);const a=t.attr("data-row-number");const n=t.data("non-row-feature");if(a==="none"&&!n){t.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").addClass("epkb-fe__settings-section--hide")}else{t.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").removeClass("epkb-fe__settings-section--hide")}}))}e(document).on("click",".epkb-fe__header-close-button",(function(){t.hide();e(".epkb-fe__toggle").show();e("#epkb-fe__action-back").trigger("click");if(t.data("display-frontend-editor-closed")){return}e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_closed_fe_editor",_wpnonce_epkb_ajax_action:epkb_vars.nonce}})}));e(document).on("click",".epkb-fe__toggle-close",(function(a){a.preventDefault();a.stopPropagation();a.stopImmediatePropagation();e(".epkb-fe__toggle").hide();e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_hide_fe_toggle_button",kb_id:t.data("kbid"),_wpnonce_epkb_ajax_action:epkb_vars.nonce}});return false}));e(document).on("click","#epkb-fe__help-tab",(function(){t.addClass("epkb-fe__editor--help").removeClass("epkb-fe__editor--home");e("#epkb-fe__editor .epkb-fe__actions").show()}));e(document).on("click",".epkb-fe__feature-select-button",(function(){let a=e(this);let n=a.data("feature");let o=e('.epkb-fe__feature-settings[data-feature="'+n+'"]');e(".epkb-fe__header-title").hide();e('.epkb-fe__header-title[data-title="'+n+'"]').addClass("epkb-fe__header-title--active");t.addClass("epkb-fe__editor--settings").removeClass("epkb-fe__editor--home epkb-fe__editor--help");e(".epkb-fe__feature-select-button").hide();e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active");o.addClass("epkb-fe__feature-settings--active");o.find(".epkb-fe__settings-section").each((function(){let t=e(this);if(!t.hasClass("epkb-fe__is_opened")){t.addClass("epkb-fe__is_opened");t.find(".epkb-fe__settings-section-body").show()}}));o.find(".eckb-conditional-setting-input").trigger("click");o.find(".epkb-input-custom-dropdown select").each((function(){i(e(this))}));e("#epkb-fe__editor .epkb-fe__actions").show();e(".epkb-fe__top-actions").hide()}));e(document).on("click","#epkb-fe__action-back",(function(){t.removeClass((function(e,t){return(t.match(/\bepkb-fe__editor--\S+/g)||[]).join(" ")}));e(".epkb-fe__header-title").removeClass("epkb-fe__header-title--active");t.addClass("epkb-fe__editor--home");e(".epkb-fe__feature-select-button").show();e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active");e("#epkb-fe__editor .epkb-fe__actions").hide();e(".epkb-fe__top-actions").show()}));e(document).on("click",".epkb-fe__settings-section-header",(function(){let t=e(this).parent();let a=t.find(".epkb-fe__settings-section-body");if(t.hasClass("epkb-fe__is_opened")){a.stop().slideUp();t.removeClass("epkb-fe__is_opened")}else{a.stop().slideDown();t.addClass("epkb-fe__is_opened")}}));function n(t){let a=e(t).val();let n=e(t).closest(".epkb-fe__feature-settings").find(".epkb-fe__settings-section--module-box:not(.epkb-fe__settings-section--"+a+"-box)");n.addClass("epkb-fe__settings-section--hide");let i=e(t).closest(".epkb-fe__features-list").find(".epkb-fe__settings-section--"+a+"-box");if(!i.length){return}e(i.get().reverse()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide");let a=e(this).data("insert-box-after");e(t).closest(".epkb-fe__feature-settings .epkb-fe__settings-list").find(a).after(this)}));if(a==="categories_articles"){e('[name="kb_main_page_layout"]:checked').trigger("click")}}e('[data-settings-group="ml-row"].epkb-row-module-setting select').each((function(){n(this)}));function i(e){const t=e.closest(".epkb-input-custom-dropdown");if(!t.length)return;const a=t.find(".epkb-input-custom-dropdown__options-list");const n=e.val();const i=e.find("option:selected").text();t.find(".epkb-input-custom-dropdown__input span").text(i);a.find(".epkb-input-custom-dropdown__option").removeClass("epkb-input-custom-dropdown__option--selected");a.find('.epkb-input-custom-dropdown__option[data-value="'+n+'"]').addClass("epkb-input-custom-dropdown__option--selected")}let o=false;let s=t.find('[name="kb_main_page_layout"]:checked').val();let r="current";function c(a,n){if(o){return}const i=e(a.target).closest(".epkb-fe__feature-settings");const c=i.data("feature");const _=i.data("kb-page-type");const f=t.data("post-id");const b=e('.epkb-ml__row[data-feature="'+c+'"]');const k=b.length>0?b.attr("data-position"):"none";if(e(a.target).hasClass("wp-color-picker")&&n&&n.color){e(a.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",n.color.toString());e(a.target).val(n.color.toString())}let g=u();g[c+"_module_position"]=k;let h="";let m=0;if(_==="archive-page"){const t=e("body");const a=t.attr("class");const n=a?a.match(/tax-(epkb_post_type_\d+_[\w]+)/):null;if(n){h=n[1]}const i=a?a.match(/term-(\d+)/):null;if(i){m=parseInt(i[1])}}if(_==="main-page"){A("show","",e("#epkb-modular-main-page-container, #eckb-kb-template"));let t=i.find('[name="advanced_search_mp_presets"]:checked');if(t.length>0&&t.val()!=="current"){r=t.val()}}else if(_==="article-page"){A("show","",e("#eckb-article-page-container-v2"));let t=i.find('[name="advanced_search_ap_presets"]:checked');if(t.length>0&&t.val()!=="current"){r=t.val()}}else if(_==="archive-page"){A("show","",e("#eckb-archive-page-container"))}e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_apply_fe_settings",_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:g,kb_page_type:_,is_article_page:_==="article-page"?1:0,feature_name:c,setting_name:e(a.target).attr("name"),prev_link_css_id:e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]').attr("id"),settings_row_number:k?k:"none",taxonomy:h,term_id:m,kb_post_id:f,layout_name:s,selected_search_preset:r},success:function(a){if(!a.success){try{let t=JSON.parse(a);if(t.message){e("body").append(e(t.message))}}catch(e){}return}o=true;if(_==="main-page"){p(a);if(a.data.layout_settings_html&&a.data.layout_settings_html.length>0){s=t.find('[name="kb_main_page_layout"]:checked').val();let n=e('.epkb-fe__feature-settings[data-feature="'+c+'"] .epkb-fe__settings-list');n.html(a.data.layout_settings_html);if(parseInt(k)===1){let t=n.find(".epkb-fe__settings-section--"+c+"-box");if(t.length>0){e(t.get()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide")}))}}else{let t=e('<div id="epkb-fe__layout-change-settings" style="display: none !important;">'+a.data.layout_settings_html_temp+"</div>");let i=t.find(".epkb-fe__settings-section--"+c+"-box");if(i.length>0){e(i.get().reverse()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide");let t=e(this).data("insert-box-after");n.find(t).after(this)}))}}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+c+'"] .epkb-fe__settings-list .epkb-input-custom-dropdown select').trigger("change");e('#epkb-fe__editor .epkb-fe__feature-settings .epkb-fe__settings-list input[type="radio"][checked]').prop("checked",true);d(c);e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+c+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click");e('#epkb-fe__editor  .epkb-settings-control__input__toggle[name="'+c+'"]').trigger("click",true)}if(a.data.faqs_design_settings&&a.data.faqs_design_settings.length>0){i.find('[name="faq_preset_name"]').prop("checked",false);for(const[e,t]of Object.entries(a.data.faqs_design_settings)){const a=i.find('[name="'+e+'"]');l(i,a,e,t)}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+c+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click")}if(a.data.categories_articles_design_settings&&Object.keys(a.data.categories_articles_design_settings).length>0){i.find('[name="categories_articles_preset"]').val("current").trigger("change");for(const[e,t]of Object.entries(a.data.categories_articles_design_settings)){const a=i.find('[name="'+e+'"]');l(i,a,e,t)}e("#epkb-fe__editor .epkb-fe__settings-list .eckb-conditional-setting-input").trigger("click")}if(a.data.search_design_settings&&i.find('[name="advanced_search_mp_presets"]').length>0){for(const[e,t]of Object.entries(a.data.search_design_settings)){const a=i.find('[name="'+e+'"]');l(i,a,e,t)}i.find('[name="advanced_search_mp_presets"][value="current"]').prop("checked",true);e("#epkb-fe__editor .epkb-fe__settings-list .eckb-conditional-setting-input").trigger("click")}if(a.data.inline_styles&&a.data.inline_styles.length>0){e('[id^="epkb-mp-frontend-modular-"][id$="-layout-inline-css"]').html(a.data.inline_styles)}if(a.data.preview_html&&a.data.preview_html.length>0){let t=e('.epkb-ml__row[data-feature="'+c+'"]');if(t.length>0){t.html(a.data.preview_html)}}if(a.data.custom_inline_styles&&a.data.custom_inline_styles.length>0){let t=e('[id^="epkb-"][id$="-custom-inline-css"]');const n=e('<style id="epkb--custom-inline-css">'+a.data.custom_inline_styles+"</style>");if(t.length>0){t.replaceWith(n)}else{n.insertAfter('[id^="epkb-"][id$="-inline-css"]')}}setTimeout((function(){e(window).trigger("resize")}),100)}if(_==="article-page"){if(a.data.search_design_settings&&i.find('[name="advanced_search_ap_presets"]').length>0){for(const[e,t]of Object.entries(a.data.search_design_settings)){const a=i.find('[name="'+e+'"]');l(i,a,e,t)}i.find('[name="advanced_search_ap_presets"][value="current"]').prop("checked",true);e("#epkb-fe__editor .epkb-fe__settings-list .eckb-conditional-setting-input").trigger("click")}if(a.data.preview_html&&a.data.preview_html.length>0){const t=e(a.data.preview_html);const n=t.filter("#eckb-template-update-data");if(n.length){const t=JSON.parse(n.text());const a=e(".eckb-kb-template");if(t.classes){a.removeClass("eckb-article-resets eckb-article-defaults");a.addClass(t.classes)}if(t.style){a.attr("style",t.style)}}e('[id^="eckb-article-page-container"]').parent().html(a.data.preview_html)}if(a.data.inline_styles&&a.data.inline_styles.length>0){let t=e("#epkb-ap-frontend-layout-inline-css");if(t.length){t.html(a.data.inline_styles)}else{e('<style id="epkb-ap-frontend-layout-inline-css">'+a.data.inline_styles+"</style>").appendTo("head")}}setTimeout((function(){e(window).trigger("resize");if(typeof epkb_init_article_toc==="function"){epkb_init_article_toc()}if(c==="article-page-search-box"&&typeof epkb_init_advanced_search==="function"){epkb_init_advanced_search()}}),100)}if(_==="archive-page"){if(a.data.archive_design_settings&&a.data.archive_design_settings.length>0){i.find('[name="archive_content_sub_categories_display_mode"]').prop("checked",false);for(const[e,t]of Object.entries(a.data.archive_design_settings)){const a=i.find('[name="'+e+'"]');l(i,a,e,t)}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+c+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click")}if(a.data.preview_html&&a.data.preview_html.length>0){e("#eckb-archive-page-container").replaceWith(a.data.preview_html)}if(a.data.inline_styles&&a.data.inline_styles.length>0){let t=e("#epkb-cp-frontend-layout-inline-css");if(t.length){t.html(a.data.inline_styles)}else{e('<style id="epkb-cp-frontend-layout-inline-css">'+a.data.inline_styles+"</style>").appendTo("head")}}setTimeout((function(){e(window).trigger("resize")}),100)}o=false},complete:function(){if(_==="main-page"){A("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(_==="article-page"){A("remove","",e("#eckb-article-page-container-v2"))}else if(_==="archive-page"){A("remove","",e("#eckb-archive-page-container"))}},error:function(t,a,n){console.error("Frontend Editor Preview Error:",{status:t.status,statusText:t.statusText,textStatus:a,errorThrown:n,response:t.responseJSON||t.responseText});if(_==="main-page"){A("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(_==="article-page"){A("remove","",e("#eckb-article-page-container-v2"))}else if(_==="archive-page"){A("remove","",e("#eckb-archive-page-container"))}}})}function l(e,t,a,n){if(t.length===0){return}if(t.attr("type")==="radio"){e.find('[name="'+a+'"][value="'+n+'"]').prop("checked",true)}else if(t.attr("type")==="checkbox"){e.find('[name="'+a+'"]').prop("checked",n==="on")}else if(t.hasClass("wp-color-picker")){t.closest(".wp-picker-container").find(".wp-color-result").css("background-color",n);t.val(n)}else{t.val(n)}}function _(a,n){if(o){return}const i=e(a.target).closest(".epkb-fe__feature-settings");const s=i.data("kb-page-type");if(s==="main-page"){A("show","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(s==="article-page"){A("show","",e("#eckb-article-page-container-v2"))}else if(s==="archive-page"){A("show","",e("#eckb-archive-page-container"))}if(e(a.target).hasClass("wp-color-picker")&&n&&n.color){e(a.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",n.color.toString());e(a.target).val(n.color.toString())}const r=u();const c=JSON.stringify(r);const l=e("#epkb-fe__editor .epkb-fe__feature-settings--active").attr("data-feature");const _=new URL(window.location.href);_.searchParams.set("epkb_fe_reopen_feature",l);let p=e('<form method="post" action="'+_+'" style="display: none !important;">'+'<input type="hidden" name="epkb_fe_reload_mode" value="on">'+'<input type="hidden" name="kb_id" value="'+t.data("kbid")+'">'+'<input type="hidden" name="is_article_page" value="'+(s==="article-page"?1:0)+'">'+'<input type="text" name="new_kb_config" value="">'+"</form>");p.find('[name="new_kb_config"]').val(c);e("body").append(p);p.trigger("submit")}function p(t){if(t.data.link_css&&t.data.link_css.length>0){let a=e(t.data.link_css).attr("id");let n=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');if(a!==n.attr("id")){n.replaceWith(t.data.link_css)}}if(t.data.link_css_rtl&&t.data.link_css_rtl.length>0){let a=e(t.data.link_css_rtl).attr("id");let n=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');if(a!==n.attr("id")){n.replaceWith(t.data.link_css_rtl)}}if(t.data.elay_link_css&&t.data.elay_link_css.length>0){let a=e(t.data.elay_link_css).attr("id");let n=e('[id^="elay-mp-frontend-modular-"][id$="-layout-css"]');if(n.length>0){if(a!==n.attr("id")){n.replaceWith(t.data.elay_link_css)}}else{n.insertAfter("#elay-public-modular-styles-css")}if(n.length){n.replaceWith(t.data.elay_link_css)}else{let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');e(t.data.elay_link_css).insertAfter(a)}}if(t.data.elay_link_css_rtl&&t.data.elay_link_css_rtl.length>0){let a=e(t.data.elay_link_css).attr("id");let n=e('[id^="elay-mp-frontend-modular-"][id$="-layout-rtl-css"]');if(n.length>0){if(a!==n.attr("id")){n.replaceWith(t.data.elay_link_css_rtl)}}else{n.insertAfter("#elay-public-modular-styles-rtl-css")}if(n.length){n.replaceWith(t.data.elay_link_css_rtl)}else{let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');e(t.data.elay_link_css_rtl).insertAfter(a)}}}e(document).on("change","#epkb-fe__editor input, #epkb-fe__editor select, #epkb-fe__editor textarea",(function(a,n){if(n){return}if(o){return}let s=e(this);const r=s.attr("name");const l=["search_result_mode","search_box_results_style","article_search_box_results_style","article_search_result_mode","advanced_search_mp_show_top_category","advanced_search_ap_show_top_category","advanced_search_mp_results_list_size","advanced_search_ap_results_list_size","advanced_search_text_highlight_enabled","advanced_search_mp_results_page_size","advanced_search_ap_results_page_size","advanced_search_mp_box_results_style","advanced_search_ap_box_results_style","article_views_counter_method","back_navigation_mode"];if(l.includes(r)){return}const p={article_content_enable_author:[".eckb-article-content-author-container",".eckb-ach__article-meta__author"],article_content_enable_created_date:[".eckb-article-content-created-date-container",".eckb-ach__article-meta__date-created"],article_content_enable_last_updated_date:[".eckb-article-content-last-updated-date-container",".eckb-ach__article-meta__date-updated"],article_content_enable_article_title:["#eckb-article-content-title-container"],article_content_enable_back_navigation:["#eckb-article-back-navigation-container"],breadcrumb_enable:["#eckb-article-content-breadcrumb-container"],prev_next_navigation_enable:[".epkb-article-navigation-container"],"meta-data-footer-toggle":[".eckb-article-content-footer__article-meta"]};if(p[r]){const t=s.attr("type")==="checkbox"?s.prop("checked"):s.val()==="on";const a=p[r];let n=false;if(!t){a.forEach((t=>{e(t).hide()}));return}for(const t in a){const i=e(a[t]);if(i.length>0){n=true}else{n=false;break}}if(t&&n){a.forEach((t=>{e(t).show()}));return}else if(!t&&!n){return}}if(r==="toc_toggler"||r==="toc_left"||r==="toc_right"){o=true;if(r==="toc_toggler"){const t=s.prop("checked");if(t){if(g("left")){e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false)}else if(g("right")){e('#epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",false)}else{e("#epkb-fe__editor #toc_content").val("1").trigger("change");i(e("#epkb-fe__editor #toc_content"));e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false)}}else{e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));e('#epkb-fe__editor input[name="toc_locations"]').prop("checked",false);k()}}else if(r==="toc_locations"&&s.prop("checked")){const t=s.val();let a=false;switch(t){case"toc_left":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));a=g("left");break;case"toc_content":k();e("#epkb-fe__editor #toc_content").val("1").trigger("change");i(e("#epkb-fe__editor #toc_content"));a=true;break;case"toc_right":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));a=g("right");break}if(!a){s.prop("checked",false)}e("#epkb-fe__editor #toc_locations input").each((function(){if(e(this).val()===t&&a){return true}e(this).prop("checked",false)}));h()}else if(r==="toc_left"||r==="toc_right"){const t=r==="toc_left"?"left":"right";const a=parseInt(s.val());if(a>0){const a=t==="left"?"toc_left":"toc_right";e('#epkb-fe__editor input[name="toc_locations"][value="'+a+'"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"]').not('[value="'+a+'"]').prop("checked",false);e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));const n=t==="left"?"right":"left";const o=e("#epkb-fe__editor #toc_"+n);if(parseInt(o.val())>0){o.val("0").trigger("change");i(o)}}h()}o=false}let d=s.closest("[data-custom-unselection-group]").data("custom-unselection-group");let f=s.closest("[data-custom-nonzero-unselection-group]").data("custom-nonzero-unselection-group");if(d||f){o=true;e('[data-custom-unselection-group="'+d+'"] select').each((function(){if(r!==e(this).attr("name")&&e(this).val()===s.val()){e(this).val("none").trigger("change",true);e(this).closest(".eckb-conditional-setting-input").trigger("click")}}));e('[data-custom-nonzero-unselection-group="'+f+'"] select').each((function(){if(parseInt(s.val())>0&&r!==e(this).attr("name")&&parseInt(e(this).val())>0){e(this).val("0").trigger("change",true);e(this).closest(".eckb-conditional-setting-input").trigger("click")}}));o=false}if(r==="nav_sidebar_right"){const t=e(this).val();if(t==="0"||t===0){e('[name="article_nav_sidebar_type_right"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();return}const a=e('[name="article_nav_sidebar_type_left"]:checked').val();if(a!=="eckb-nav-sidebar-none"){e('[name="article_nav_sidebar_type_left"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();e('[name="article_nav_sidebar_type_right"][value="'+a+'"]').parent().find(".epkb-label").click()}}if(r==="nav_sidebar_left"){const t=e(this).val();if(t==="0"||t===0){e('[name="article_nav_sidebar_type_left"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();return}const a=e('[name="article_nav_sidebar_type_right"]:checked').val();if(a!=="eckb-nav-sidebar-none"){e('[name="article_nav_sidebar_type_right"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();e('[name="article_nav_sidebar_type_left"][value="'+a+'"]').parent().find(".epkb-label").click()}}if(s.attr("type")==="radio"&&!s.is(":checked")){return}if(r==="template_for_archive_page"&&s.val()==="current_theme_templates"){const t=`\n\t\t\t\t<div id="epkb-theme-template-dialog" class="epkb-dialog-box-form epkb-dialog-box-form--active">\n\t\t\t\t\t<div class="epkb-dbf__header">\n\t\t\t\t\t\t<h4>${epkb_vars.theme_template_switch_title||"Switch to Theme Template"}</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="epkb-dbf__body">\n\t\t\t\t\t\t${epkb_vars.theme_template_switch_msg||"The page will reload with your theme template. You can switch back in KB Settings."}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="epkb-dbf__footer">\n\t\t\t\t\t\t<div class="epkb-dbf__footer__accept">\n\t\t\t\t\t\t\t<span class="epkb-dbf__footer__accept__btn">OK</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="epkb-dbf__footer__cancel">\n\t\t\t\t\t\t\t<span class="epkb-dbf__footer__cancel__btn">Cancel</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="epkb-dbf__close epkbfa epkbfa-times"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="epkb-dialog-box-form-black-background"></div>\n\t\t\t`;e("#epkb-theme-template-dialog, .epkb-dialog-box-form-black-background").remove();e("body").append(t);e("#epkb-theme-template-dialog .epkb-dbf__footer__accept__btn").on("click",(function(){e("#epkb-theme-template-dialog, .epkb-dialog-box-form-black-background").remove();const t=e("#eckb-archive-page-container");A("show",epkb_vars.switching_template_msg||"Switching to theme template...",t);e.ajax({url:epkb_vars.ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_switch_kb_template",_wpnonce_epkb_ajax_action:epkb_vars.nonce,epkb_kb_id:e("#epkb-fe__editor").data("kbid"),template_type:"current_theme_templates"},success:function(e){if(e.reload===true){t.find(".epkb-admin-text").text(epkb_vars.reloading_page_msg||"Reloading page...");setTimeout((function(){window.location.reload()}),500)}else{A("remove","",t)}},error:function(a,n,i){A("remove","",t);e(".eckb-bottom-notice-message").remove();e("body").append(B("",epkb_vars.switch_template_error||"Failed to switch template. Please try again.","error"));console.error("Failed to switch template:",i)}})}));e("#epkb-theme-template-dialog .epkb-dbf__footer__cancel__btn, #epkb-theme-template-dialog .epkb-dbf__close").on("click",(function(){e("#epkb-theme-template-dialog, .epkb-dialog-box-form-black-background").remove();e('input[name="template_for_archive_page"][value="kb_templates"]').prop("checked",true)}));return}if(s.closest(".epkb-row-module-position").length){return}if(s.closest(".epkb-fe__settings-section--module-selection").length>0){return}if(s.closest(".epkb-fe__feature-settings").attr("data-row-number")==="none"&&!s.closest(".epkb-fe__feature-settings").attr("data-non-row-feature")){return}if(r==="kb_ai_collection_id"){c(a);return}const b=e(a.target).closest(".epkb-fe__feature-settings");const u=b.data("kb-page-type");const m=t.data("has-page-builder")===true;if(r==="templates_for_kb"||r==="template_main_page_display_title"||r==="general_typography_font_family"||u==="article-page"&&m){_(a);return}if(s.hasClass("wp-color-picker")){return}c(a)}));function d(t){let a=false;e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list .epkb-admin__color-field input').wpColorPicker({change:function(t,n){if(a){return}a=true;let i=e(t.target).wpColorPicker("color");let o=e(t.target).attr("name");e('.epkb-admin__color-field input[name="'+o+'"]').not(t.target).each((function(){e(this).wpColorPicker("color",i)}));a=false}});setTimeout((function(){e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list input.wp-color-picker').iris("option","change",b)}),100)}setTimeout((function(){e("#epkb-fe__editor input.wp-color-picker").iris("option","change",b)}),100);let f=false;function b(a,n){if(f){clearTimeout(f)}f=setTimeout((function(){const i=e(a.target).closest(".epkb-fe__feature-settings");const o=i.data("kb-page-type");const s=t.data("has-page-builder")===true;if(o==="article-page"&&s){_(a,n)}else{c(a,n)}f}),200)}e(document).on("click","#epkb-fe__action-save",(function(a){let n=u();const i=e("#epkb-fe__editor .epkb-fe__feature-settings--active");const o=i.data("kb-page-type");let s="eckb_save_fe_settings";if(o==="article-page"){s="eckb_save_fe_article_settings"}else if(o==="archive-page"){s="eckb_save_fe_archive_settings"}let c;if(o==="article-page"){c=e("#eckb-article-page-container-v2")}else if(o==="archive-page"){c=e("#eckb-archive-page-container")}else{c=e("#epkb-modular-main-page-container, #eckb-kb-template")}A("show","",c);e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:s,_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:n,is_article_page:o==="article-page"?1:0,selected_search_preset:r},success:function(t){if(t.data&&t.data.message){I(t.data.message)}if(t.success){}else{try{let a=JSON.parse(t);if(a.message){e("body").append(e(a.message))}}catch(e){}}A("remove","",c);r="current"},error:function(e,t,a){console.error("Frontend Editor Save Settings Error:",{status:e.status,statusText:e.statusText,textStatus:t,errorThrown:a,response:e.responseJSON||e.responseText});A("remove","",c)}})}));function u(){let a={};t.find("input, select, textarea").each((function(){if(!e(this).attr("name")||!e(this).attr("name").length||e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag").length||e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag-container").length){return true}if(e(this).attr("type")==="checkbox"){if(e(this).closest(".epkb-admin__checkboxes-multiselect").length){if(e(this).prop("checked")){if(!a[e(this).attr("name")]){a[e(this).attr("name")]=[]}a[e(this).attr("name")].push(e(this).val())}}else{a[e(this).attr("name")]=e(this).prop("checked")?"on":"off"}return true}if(e(this).attr("type")==="radio"){if(e(this).prop("checked")){a[e(this).attr("name")]=e(this).val()}return true}if(typeof e(this).attr("name")=="undefined"){return true}a[e(this).attr("name")]=e(this).val()}));if(e('[name="faq_group_ids"]').length&&typeof a.faq_group_ids=="undefined"){a.faq_group_ids=0}e(".epkb-ml__row").each((function(){const t=e(this);const n=t.attr("data-feature");const i=t.attr("data-position");if(n&&i){a[n+"_module_position"]=i}}));e(".epkb-fe__feature-settings").each((function(){const t=e(this);const n=t.attr("data-feature");const i=t.attr("data-row-number");if(n&&i==="none"){a[n+"_module_position"]="none"}}));const n=t.find('[name="general_typography_font_family"]');const i=t.find(".epkb-general_typography-loader");if(n.length>0){a.general_typography_font_family=n.val()}else if(i.length>0){a.general_typography_font_family=i.data("selected")}return a}function k(){e("#epkb-fe__editor #toc_left, #epkb-fe__editor #toc_right").each((function(){if(parseInt(e(this).val())>0){e(this).val("0").trigger("change");i(e(this))}}))}function g(t){let a=false;const n=e("#epkb-fe__editor #toc_"+t);if(n.length&&parseInt(n.val())===0){o=true;n.val("3").trigger("change");i(n);o=false;a=true}return a}function h(){let t=false;e('#epkb-fe__editor input[name="toc_locations"]').each((function(){if(e(this).prop("checked")){t=true}}));if(parseInt(e("#epkb-fe__editor #toc_left").val())>0||parseInt(e("#epkb-fe__editor #toc_right").val())>0||parseInt(e("#epkb-fe__editor #toc_content").val())>0){t=true}o=true;e("#epkb-fe__editor #toc_toggler input").prop("checked",t);o=false}e(document).on("click",'#epkb-fe__editor input[name="toc_locations"]',(function(){let t=e(this).prop("value");let a=e(this).prop("checked");let n=false;o=true;switch(t){case"toc_left":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));if(a){n=g("left")}break;case"toc_content":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));if(a){e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false);e("#epkb-fe__editor #toc_content").val("1").trigger("change");i(e("#epkb-fe__editor #toc_content"));n=true}break;case"toc_right":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");i(e("#epkb-fe__editor #toc_content"));if(a){n=g("right")}break;default:break}e('#epkb-fe__editor input[name="toc_locations"]').each((function(){if(e(this).prop("value")===t&&n){return true}e(this).prop("checked",false)}));h();o=false;c({target:this})}));const m=5;const v=e("#epkb-modular-main-page-container");const w=()=>e(".epkb-ml__row");const y=t=>e(`.epkb-ml__row[data-feature="${t}"]`);const x=()=>w().length;function C(){w().sort(((t,a)=>+e(t).attr("data-position")-+e(a).attr("data-position"))).appendTo(v)}function S(){w().each(((t,a)=>{const n=t+1;const i=e(a);const o=i.attr("data-feature");i.attr("data-position",n);if(o){e('.epkb-fe__feature-settings[data-feature="'+o+'"]').attr("data-row-number",n)}}));T()}function T(){w().each(((t,a)=>{const n=e(a);const i=parseInt(n.attr("data-position"));let o=n.attr("id");o=o?parseInt(o.replaceAll("epkb-ml__row-","")):i;const s=e("#epkb-ml__row-"+i);if(i===o){return}let r=e('[name="ml_row_'+o+'_module"]');let c=e('[name="ml_row_'+o+'_desktop_width"]');let l=e('[name="ml_row_'+o+'_desktop_width_units"]');const _=e('[name="ml_row_'+o+'_desktop_width_units"]:checked').val();let p=e('[name="ml_row_'+i+'_module"]');let d=e('[name="ml_row_'+i+'_desktop_width"]');let f=e('[name="ml_row_'+i+'_desktop_width_units"]');const b=e('[name="ml_row_'+i+'_desktop_width_units"]:checked').val();const u=c.closest(".epkb-fe__feature-settings").find(".epkb-row-module-position.epkb-settings-control-type-toggle .epkb-settings-control__input__toggle").prop("checked")?c.closest(".epkb-fe__feature-settings").attr("data-feature"):"none";const k=d.closest(".epkb-fe__feature-settings").find(".epkb-row-module-position.epkb-settings-control-type-toggle .epkb-settings-control__input__toggle").prop("checked")?d.closest(".epkb-fe__feature-settings").attr("data-feature"):"none";n.attr("id","epkb-ml__row-"+i);s.attr("id","epkb-ml__row-"+o);r.attr("id","ml_row_"+i+"_module").attr("name","ml_row_"+i+"_module");c.attr("id","ml_row_"+i+"_desktop_width").attr("name","ml_row_"+i+"_desktop_width").parent().find("label").attr("for","ml_row_"+i+"_desktop_width").closest("#ml_row_"+o+"_desktop_width").attr("id","ml_row_"+i+"_desktop_width");l.closest("#ml_row_"+o+"_desktop_width_units").attr("id","ml_row_"+i+"_desktop_width_units");l.each((function(){let t=e(this).attr("id");t=t.replaceAll("ml_row_"+o,"ml_row_"+i);e(this).attr("id",t).attr("name","ml_row_"+i+"_desktop_width_units").parent().find("label").attr("for",t)}));p.attr("id","ml_row_"+o+"_module").attr("name","ml_row_"+o+"_module");d.attr("id","ml_row_"+o+"_desktop_width").attr("name","ml_row_"+o+"_desktop_width").parent().find("label").attr("for","ml_row_"+o+"_desktop_width").closest("#ml_row_"+i+"_desktop_width").attr("id","ml_row_"+o+"_desktop_width");f.closest("#ml_row_"+i+"_desktop_width_units").attr("id","ml_row_"+o+"_desktop_width_units");f.each((function(){let t=e(this).attr("id");t=t.replaceAll("ml_row_"+i,"ml_row_"+o);e(this).attr("id",t).attr("name","ml_row_"+o+"_desktop_width_units").parent().find("label").attr("for",t)}));l.each((function(){if(e(this).val()===_){e(this).prop("checked",true)}}));f.each((function(){if(e(this).val()===b){e(this).prop("checked",true)}}));let g=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-inline-css"]');let h=g.html();h=h.replaceAll("#epkb-ml__row-"+i,"#epkb-ml__row-temp").replaceAll("#epkb-ml__row-"+o,"#epkb-ml__row-"+i).replaceAll("#epkb-ml__row-temp","#epkb-ml__row-"+o);g.html(h)}))}function j(t,a){if(x()>=m||y(a).length)return;const n="epkb-ml__row-"+e(t).closest("#epkb-fe__editor .epkb-fe__feature-settings--active").find('[id^="ml_row_"][id$="_desktop_width"]').attr("id").replaceAll("ml_row_","").replaceAll("_desktop_width","");e("<div>",{id:n,class:"epkb-ml__row","data-position":0,"data-feature":a}).prependTo(v);S();C();const i=y(a).attr("data-position");e('.epkb-fe__feature-settings[data-feature="'+a+'"]').attr("data-row-number",i);const o=e('.epkb-fe__feature-settings[data-feature="'+a+'"]');const s={target:o.find("input, select").first()[0],preventDefault:function(){}};if(s.target){c(s)}P()}function O(e){y(e).remove();S();C();P()}function P(){const t=x();e("#epkb-fe__editor .epkb-row-module-position .epkb-settings-control__input__toggle").each((function(){const a=e(this);const n=a.attr("name");const i=a.closest(".epkb-fe__settings-section-body");const o=i.find(".epkb-radio-buttons-container");const s=o.find('input[value="move-up"]');const r=o.find('input[value="move-down"]');const c=y(n);const l=c.length>0;const _=e('.epkb-fe__feature-settings[data-feature="'+n+'"]');a.prop("checked",l);if(l){const e=c.attr("data-position");_.attr("data-row-number",e)}else{_.attr("data-row-number","none")}if(!l||t<=1){o.hide()}else{o.show();const e=+c.attr("data-position");s.prop("disabled",e===1);r.prop("disabled",e===t)}if(l){_.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").removeClass("epkb-fe__settings-section--hide")}else{_.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").addClass("epkb-fe__settings-section--hide")}o.find('input[type="radio"]').prop("checked",false)}))}e(document).on("change","#epkb-fe__editor .epkb-row-module-position .epkb-settings-control__input__toggle",(function(){const e=this.name;if(this.checked){j(this,e)}else{O(e)}}));e(document).on("change",'.epkb-input[value="move-up"], .epkb-input[value="move-down"]',(function(){const t=e(this);const a=t.val()==="move-up"?-1:+1;const n=t.closest(".epkb-row-module-position").data("module");const i=y(n);const o=+i.attr("data-position");const s=o+a;const r=w().filter(((t,a)=>+e(a).attr("data-position")===s));if(!i.length||!r.length)return;i.attr("data-position",s);r.attr("data-position",o);T();C();P()}));S();C();P();const $=[{checkSelector:"#epkb-modular-main-page-container",prefix:"mp",containerSelector:"#epkb-ml__module-categories-articles",searchSelector:"#epkb-ml__row-1"},{checkSelector:"#eckb-article-page-container-v2",prefix:"ap",containerSelector:"#eckb-article-body",searchSelector:"#eckb-article-header"},{checkSelector:"#eckb-archive-body",prefix:"cp",containerSelector:"#eckb-archive-body",searchSelector:"#eckb-archive-header"}];function z(){const t=e("body").width();let a="";let n=0;let i=0;for(const t of $){if(e(t.checkSelector).length){a=t.prefix;n=Math.round(e(t.containerSelector).width());i=Math.round(e(t.searchSelector).width());break}}if(a){if(i){e(`.js-epkb-${a}-search-width`).text(`${i}px`)}if(n){e(`.js-epkb-${a}-width-container`).text(`${n}px`)}if(t){e(`.js-epkb-${a}-width`).text(`${t}px`)}}}z();e(window).on("resize",(function(){z()}));function A(e,t,a){if(e==="show"){let e='<div class="epkb-fe-dialog-box-loading">'+'<div class="epkb-admin-dbl__header">'+'<div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(t?'<div class="epkb-admin-text">'+t+"</div>":"")+"</div>"+"</div>";a.append(e)}else if(e==="remove"){a.find(".epkb-fe-dialog-box-loading").remove()}}e(document).on("click",".epkb-close-notice",(function(){let t=e(this).closest(".eckb-bottom-notice-message");t.addClass("fadeOutDown");setTimeout((function(){t.html("")}),1e4)}));function B(e,t,a){return'<div class="eckb-bottom-notice-message">'+'<div class="contents">'+'<span class="'+a+'">'+(e?"<h4>"+e+"</h4>":"")+(t?"<p>"+t+"</p>":"")+"</span>"+"</div>"+'<div class="epkb-close-notice epkbfa epkbfa-window-close"></div>'+"</div>"}function I(t,a=""){e(".eckb-bottom-notice-message").remove();e("body").append(B(a,t,"success"))}(function(){const t=new URL(window.location.href);const n=t.searchParams.get("epkb_fe_reopen_feature");if(n&&n.length>0){a(null);e(".epkb-fe__toggle").trigger("click");e('#epkb-fe__editor .epkb-fe__feature-select-button[data-feature="'+n+'"]').trigger("click");t.searchParams.delete("epkb_fe_reopen_feature");history.replaceState(null,"",t.pathname+t.search+t.hash)}})();(function(){const e=new URL(window.location.href);const t=e.searchParams.get("action");if(t&&t.length>0&&t==="epkb_load_editor"){a(null);e.searchParams.delete("action");e.searchParams.delete("epkb_kb_id");history.replaceState(null,"",e.pathname+e.search+e.hash)}})();e(document).on("click","#epkb-fe__editor .epkb-fe__open-feature-setting-link",(function(a){a.preventDefault();const n=e(this).attr("data-feature");const i=e(this).attr("data-setting");const o=e(this).attr("data-section");t.find(".epkb-highlighted_setting").removeClass("epkb-highlighted_setting");t.find('.epkb-fe__feature-select-button[data-feature="'+n+'"]').trigger("click");let s=0;let r=false;if(i){r=t.find('.epkb-fe__feature-settings[data-feature="'+n+'"] [name="'+i+'"]').closest(".epkb-input-group")}if(o){r=t.find('.epkb-fe__feature-settings[data-feature="'+n+'"] .epkb-fe__settings-section--'+o)}if(r.length>0){s=r.offset().top-t.offset().top-100;s=s>0?s:0;r.addClass("epkb-highlighted_setting")}t.animate({scrollTop:s},300);return false}));function D(){const e=[document.querySelector(".et_pb_section, .et_pb_row, .et_pb_column")!==null,typeof window.et_pb_custom!=="undefined",document.body.classList.contains("et_divi_theme")||document.body.classList.contains("et_pb_theme"),Array.from(document.querySelectorAll('link[rel="stylesheet"]')).some((e=>e.href.includes("divi")||e.href.includes("et-core"))),document.querySelector('meta[name="generator"][content*="Divi"]')!==null];return e.some((e=>e===true))}e(document).on("epkb-font-selected",(function(t,a){e("#general_typography_font_family").val(a);e(".epkb-general_typography-current").text(a)}));e(document).on("click",".epkb-general_typography-loader",(function(){let t=e(this);let a={action:"epkb_load_general_typography",_wpnonce_epkb_ajax_action:epkb_vars.nonce,active_font_family:t.data("selected")};q(a,(function(a){t.closest(".epkb-general_typography-loader-wrap").replaceWith(a.data);o=true;e("#general_typography_font_family").trigger("change");o=false}))}));function q(t,a,n,i,o,s){let r;let c;a=typeof a==="undefined"?"epkb_callback_noop":a;let l=e("#epkb-modular-main-page-container, #eckb-kb-template");e.ajax({type:"POST",dataType:"json",data:t,url:epkb_vars.ajaxurl,beforeSend:function(e){if(typeof s=="undefined"||s===false){A("show","",l)}if(typeof s=="object"){A("show","",s)}}}).done((function(e){c=e?e:"";if(c.error||typeof c.message==="undefined"){r=c.message?c.message:B("",epkb_vars.reload_try_again,"error")}})).fail((function(e,t,a){r=a?" ["+a+"]":epkb_vars.unknown_error;r=B(epkb_vars.error_occurred+". "+epkb_vars.msg_try_again,r,"error")})).always((function(){c=typeof c==="undefined"?"":c;if(typeof o=="function"){o(c)}if(!i){A("remove","",l)}if(r){e(".eckb-bottom-notice-message").remove();e("body").append(r).removeClass("fadeOutDown");setTimeout((function(){e(".eckb-bottom-notice-message").addClass("fadeOutDown")}),1e4);return}if(typeof a==="function"){if(typeof n==="undefined"){a(c)}else{a(c,n)}}else{if(i){location.reload()}}}))}}));