var imageChoicesAdmin=imageChoicesAdmin||{};!function(e){var i=""!==imageChoicesFieldVars.is_gf_min_2_5?2:1,o=i;imageChoicesAdmin.markup={removeChoicesButton:function(){return'<button class="button image-choices-remove-choices-btn" type="button" onclick="imageChoicesAdmin.removeAllChoices();">'+imageChoicesFieldStrings.removeAllChoices+"</button>"},choicesAdminRow:function(e,o,s){var t=void 0!==e?e:0,c=void 0!==o?o:"",s=void 0!==s?s:"",a='<i class="dashicons dashicons-format-image"></i>';return 1===i&&(a=imageChoicesFieldStrings.uploadImage),['<button type="button" id="image-choices-option-upload-button-'+t+'" class="button image-choices-option-upload-button" onclick="imageChoicesAdmin.OpenMediaLibrary(this);" title="'+imageChoicesFieldStrings.uploadImage+'">'+a+"</button>",'<span id="image-choices-option-preview-'+t+'" class="image-choices-option-preview-wrap">','<span class="image-choices-option-preview" style="background-image:url('+c+');"></span>','<a href="javascript:void(0);" class="image-choices-option-image-remove" onclick="imageChoicesAdmin.RemovePreview(this);" title="'+imageChoicesFieldStrings.removeImage+'"><i class="dashicons dashicons-no"></i></a>',"</span>",'<input type="hidden" id="image-choices-option-image-'+t+'" class="image-choices-option-image" value="'+c+'" />','<input type="hidden" id="image-choices-option-image-id-'+t+'" class="image-choices-option-image-id" value="'+s+'" />'].join("")},choicesPreviewRow:function(e,i,o){var s=void 0!==i?i:"",t=void 0!==o?o:"";return['<span class="image-choices-choice-image-wrap" style="background-image:url('+t+')">','<img src="'+t+'" alt="" class="image-choices-choice-image" />',"</span>",'<span class="image-choices-choice-text">'+s+"</span>"].join("")}},imageChoicesAdmin.getChoices=function(i){"undefined"==typeof i&&(i=GetSelectedField());var o='[class*="-choice-row"]:visible';parseFloat(imageChoicesVars.gf_version)>=2.6&&(o='[class*="-choice-row"]'),imageChoicesAdmin.getSettingsElement().find(o).each(function(){var o=e(this),s=o.data("index"),t=i.choices.length&&void 0!==i.choices[s].imageChoices_image?i.choices[s].imageChoices_image:"",c=i.choices.length&&void 0!==i.choices[s].imageChoices_imageID?i.choices[s].imageChoices_imageID:"";if(!o.find(".image-choices-option-image").length){var a=o.find('input[id*="_choice_text"]:first');a.length||(a=o.find('input[id*="-choice-text"]:first')),a.length&&a.before(imageChoicesAdmin.markup.choicesAdminRow(s,t,c))}var n=o.find(".image-choices-option-image");""!==n.val()&&o.addClass("image-choices-has-image")}),imageChoicesAdmin.updateFieldPreview(i)},imageChoicesAdmin.RemovePreview=function(i){if("undefined"!=typeof i){var o=e(i).closest('[class*="-choice-row"]');o.find(".image-choices-option-image").val(""),o.find(".image-choices-option-image-id").val(""),o.find(".image-choices-option-preview").css("background-image",""),o.removeClass("image-choices-has-image"),imageChoicesAdmin.UpdateFieldChoicesObject();var s=GetSelectedField();imageChoicesAdmin.updateFieldPreview(s)}},imageChoicesAdmin.UpdateFieldChoicesObject=function(){var i=GetSelectedField(),o=imageChoicesAdmin.getSettingsElement(),s='[class*="-choice-row"]:visible';parseFloat(imageChoicesVars.gf_version)>=2.6&&(s='[class*="-choice-row"]'),o.find(s).each(function(o){var s=e(this),t=s.find(".image-choices-option-image").val(),c=s.find(".image-choices-option-image-id").val(),a=s.data("index");""!==t?(s.addClass("image-choices-has-image"),s.find(".gf-image-choices-option-preview").css("background-image","url("+t+")")):s.removeClass("image-choices-has-image"),i.choices[a].imageChoices_image=t,i.choices[a].imageChoices_imageID=c})},imageChoicesAdmin.updateFieldPreview=function(i){var o=e("#field_"+i.id);i.imageChoices_enableImages&&void 0===i.imageChoices_showLabels&&imageChoicesAdmin.toggleShowLabels(!0),imageChoicesAdmin.$fieldChoices(o).each(function(o){var s=e(this);s.addClass("image-choices-choice");var t=s.find("label"),c=t.find(".image-choices-choice-text").length?t.find(".image-choices-choice-text").html():t.html();if(i.imageChoices_enableImages){if(i.choices.length>o){var a=void 0!==i.choices[o].imageChoices_image?i.choices[o].imageChoices_image:"";t.html(imageChoicesAdmin.markup.choicesPreviewRow(o,c,a))}}else t.html(c)})},imageChoicesAdmin.getField=function(){var i=GetSelectedField();return e("#field_"+i.id)},imageChoicesAdmin.removeAllChoices=function(){imageChoicesAdmin.getSettingsElement().find(".image-choices-option-image-remove").each(function(){e(this).trigger("click")}),$settingsWrap.find(".gf_delete_field_choice").each(function(){e(this).trigger("click")}),$settingsWrap.find('.field-choice-row input[type="text"], .gquiz-choice-row input[type="text"]').val("")},imageChoicesAdmin.isColorPickerPluginActive=function(){return window.hasOwnProperty("colorPickerFieldVars")&&"undefined"!=typeof window.colorPickerFieldVars},imageChoicesAdmin.toggleEnableImages=function(e){var i=imageChoicesAdmin.getSettingsElement(),o=i.find("input.field_choice_images_enabled"),s=i.find("input.field_color_picker_enabled");void 0===e&&(e=o.is(":checked")),e&&imageChoicesAdmin.isColorPickerPluginActive()&&s.length&&s.is(":checked")?window.confirm(imageChoicesFieldStrings.confirmImagesToggle)?(window.hasOwnProperty("colorPicker_toggleEnableColors")&&"function"==typeof window.colorPicker_toggleEnableColors&&window.colorPicker_toggleEnableColors(!1),imageChoicesAdmin.onToggleEnableImages(e)):o.prop("checked",!1):imageChoicesAdmin.onToggleEnableImages(e)},window.imageChoices_toggleEnableImages=imageChoicesAdmin.toggleEnableImages,imageChoicesAdmin.onToggleEnableImages=function(o){var s=GetSelectedField(),t=imageChoicesAdmin.getField(),c=imageChoicesAdmin.getSettingsElement(),a=c.find("input.field_choice_images_enabled");void 0===o&&(o=a.is(":checked")),SetFieldProperty("imageChoices_enableImages",o),a.prop("checked",o),2===i&&e("#image_choices_tab_toggle").toggle(o);var n='[id*="gfield_settings_choices_container"]:visible';parseFloat(imageChoicesVars.gf_version)>=2.6&&(n="quiz"===s.type.toLowerCase()?"#gquiz_gfield_settings_choices_container":"#gfield_settings_choices_container");var g=e(n);g.toggleClass("image-choices-enabled",o),t.toggleClass("image-choices-use-images",o),2===i&&c.toggleClass("image-choices-use-images",o);var m=c.find("#gfield_settings_choices_container + input"),d=c.find(".image-choices-remove-choices-btn");if(o&&!d.length&&1===i){m.length&&m.after(imageChoicesAdmin.markup.removeChoicesButton());var h=c.find("#gquiz_gfield_settings_choices_container + input");h.length&&1===i&&h.after(imageChoicesAdmin.markup.removeChoicesButton())}o||d.length&&d.remove();var l=e(".field_setting.other_choice_setting"),r="radio"===s.type||"poll"===s.type&&"radio"===s.inputType;r&&l.show(),imageChoicesAdmin.updateFieldPreview(s)},imageChoicesAdmin.toggleShowLabels=function(e){var i=imageChoicesAdmin.getField(),o=imageChoicesAdmin.getSettingsElement().find("input.image_choices_show_labels");void 0===e&&(e=o.is(":checked")),SetFieldProperty("imageChoices_showLabels",e),o.prop("checked",e),i.toggleClass("image-choices-show-labels",e)},imageChoicesAdmin.toggleShowPrices=function(e){var i=imageChoicesAdmin.getField(),o=imageChoicesAdmin.getSettingsElement().find("input.image_choices_show_prices");void 0===e&&(e=o.is(":checked")),SetFieldProperty("imageChoices_showPrices",e),o.prop("checked",e),i.toggleClass("image-choices-show-prices",e)},imageChoicesAdmin.toggleUseLightbox=function(i){var o=imageChoicesAdmin.getField(),s=imageChoicesAdmin.getSettingsElement().find("input.image_choices_use_lightbox");if(void 0===i&&(i=s.is(":checked")),SetFieldProperty("imageChoices_useLightbox",i),s.prop("checked",i),o.toggleClass("image-choices-use-lightbox",i),i){var t=GetSelectedField();e.each(t.choices,function(e,i){var o=i.hasOwnProperty("imageChoices_image")&&""!==i.imageChoices_image,s=i.hasOwnProperty("imageChoices_imageID")&&""!==i.imageChoices_imageID;if(o&&!s)return window.alert(imageChoicesFieldStrings.useLightboxWarning),!1})}},imageChoicesAdmin.updateEntrySetting=function(e){SetFieldProperty("imageChoices_entrySetting",e),imageChoicesAdmin.getSettingsElement().find("#image-choices-entry-value").val(e)},imageChoicesAdmin.OpenMediaLibrary=function(i){if("undefined"!=typeof i){var o=e(i).closest('[class*="-choice-row"]'),s=o.data("file-frame");if(s)return void s.open();s=wp.media({title:"Select an image to upload",button:{text:"Use this image"},frame:"post",state:"insert",multiple:!1}),setTimeout(function(){e('input[value="Insert into Post"]').val("Use this Image"),e("button.media-button-insert").text("Use this Image")},100),jQuery("body").on("click","li.attachment",function(){e('input[value="Insert into Post"]').val("Use this Image"),e("button.media-button-insert").text("Use this Image")}),s.on("insert",function(i){var t=s.state();if(i=i||t.get("selection")){var c=i.first(),a=t.display(c).toJSON();c=c.toJSON();for(var n=[a.size,"medium","thumbnail","full"],g=0,m=n[g].toString();!c.sizes.hasOwnProperty(m)||!c.sizes[m].hasOwnProperty("url")||""===c.sizes[m].url;)g++,m=n[g].toString();var d=c.sizes[m].url;o.find(".image-choices-option-image").val(d),o.find(".image-choices-option-image-id").val(c.id),o.find(".image-choices-option-preview").css("background-image","url("+d+")"),o.addClass("image-choices-has-image"),imageChoicesAdmin.UpdateFieldChoicesObject();var h=GetSelectedField();imageChoicesAdmin.updateFieldPreview(h);var l=e("#choices-ui-flyout");l.length&&l.addClass("gform-flyout--anim-in-ready gform-flyout--anim-in-active")}}),s.open(),o.data("file-frame",s)}},imageChoicesAdmin.fieldCanHaveImages=function(e){return!("undefined"==typeof e||!e.hasOwnProperty("type"))&&("radio"===e.type||"checkbox"===e.type||"quiz"===e.type&&"radio"==e.inputType||"quiz"===e.type&&"checkbox"==e.inputType||"poll"===e.type&&"radio"==e.inputType||"poll"===e.type&&"checkbox"==e.inputType||"post_custom_field"===e.type&&"radio"==e.inputType||"post_custom_field"===e.type&&"checkbox"==e.inputType||"survey"===e.type&&"radio"==e.inputType||"survey"===e.type&&"checkbox"==e.inputType||"product"===e.type&&"radio"==e.inputType||"option"===e.type&&"radio"==e.inputType||"option"===e.type&&"checkbox"==e.inputType)},imageChoicesAdmin.$fieldChoices=function(e){if("undefined"==typeof e||e instanceof jQuery==!1)return[];var i='.ginput_container .gfield_radio div[class*="gchoice"], .ginput_container .gfield_checkbox .gchoice:not(.gchoice_select_all)';return 1===o&&(i=".ginput_container .gfield_radio li, .ginput_container .gfield_checkbox li:not(.gchoice_select_all)"),e.find(i)},imageChoicesAdmin.getSettingsElement=function(){var o="#field_settings_container";if(1===i)o="#field_settings";else if(parseFloat(imageChoicesVars.gf_version)>=2.6){var s=GetSelectedField();o+="quiz"===s.type?", #gquiz_gfield_settings_choices_container":", #gfield_settings_choices_container"}return e(o)},imageChoicesAdmin.previewHeight=function(e){if("object"!=typeof e){var i=imageChoicesAdmin.getField();e=i.find(".ginput_container")}e.length&&e.closest(".gfield").hasClass("image-choices-admin-field")&&setTimeout(function(){e.height(e.find("> ul:first").outerHeight())},20)},"undefined"!=typeof gform&&gform.addAction("gform_load_field_choices",function(i){var o="undefined"!=typeof i&&i.length?i[0]:GetSelectedField(),s=100;setTimeout(function(){var i=e("#field_"+o.id),s=imageChoicesAdmin.getSettingsElement();if(imageChoicesAdmin.fieldCanHaveImages(o)){i.addClass("image-choices-admin-field"),s.addClass("image-choices-field-settings");var t=o.imageChoices_enableImages===!0,c=void 0!==o.imageChoices_useLightbox&&o.imageChoices_useLightbox,a=void 0===o.imageChoices_showLabels||o.imageChoices_showLabels,n="product"===o.type&&void 0!==o.imageChoices_showPrices&&o.imageChoices_showPrices,g=void 0!==o.imageChoices_entrySetting?o.imageChoices_entrySetting:"form_setting";imageChoicesAdmin.toggleEnableImages(t),imageChoicesAdmin.toggleUseLightbox(c),imageChoicesAdmin.toggleShowLabels(a),imageChoicesAdmin.toggleShowPrices(n),imageChoicesAdmin.updateEntrySetting(g),imageChoicesAdmin.getChoices(o)}else i.removeClass("image-choices-admin-field"),s.removeClass("image-choices-field-settings"),imageChoicesAdmin.toggleEnableImages(!1)},s)}),e(document).bind("gform_load_field_settings",function(i,s,t){o=t.hasOwnProperty("markupVersion")&&""!==t.markupVersion?t.markupVersion:1,"function"!=typeof window.imageChoices_GF_UpdateFieldChoices&&(window.imageChoices_GF_UpdateFieldChoices=UpdateFieldChoices,window.UpdateFieldChoices=function(){window.imageChoices_GF_UpdateFieldChoices.apply(this,arguments),e(window).trigger("gf_update_field_choices")}),imageChoicesAdmin.previewHeight()}),e(window).on("gf_update_field_choices",function(){setTimeout(function(){imageChoicesAdmin.getChoices()},10),imageChoicesAdmin.previewHeight()}),e(document).on("click",".gf_insert_field_choice, .gf_delete_field_choice",function(e){imageChoicesAdmin.previewHeight()}),e(document).ready(function(){"undefined"!=typeof form&&form.hasOwnProperty("markupVersion")&&(o=""!==form.markupVersion?form.markupVersion:1),e(".gfield.image-choices-admin-field").each(function(){imageChoicesAdmin.$fieldChoices(e(this)).addClass("image-choices-choice")}),e("#gform_fields .gfield .ginput_container").each(function(){imageChoicesAdmin.previewHeight(e(this))});var i,s=e("#gf_image_choices_custom_css_global");s.length&&(s.after('<div id="gf_image_choices_custom_css_global_editor">'+s.text()+"</div>"),i=ace.edit("gf_image_choices_custom_css_global_editor"),i.setOptions({showInvisibles:!1,showGutter:!0,showLineNumbers:!0,displayIndentGuides:!1,scrollPastEnd:!1,theme:"ace/theme/xcode"}),i.session.setMode("ace/mode/css"),i.getSession().on("change",function(){s.val(i.getSession().getValue())}));var t=e("#gf_image_choices_custom_css");t.length&&(t.after('<div id="gf_image_choices_custom_css_editor">'+t.text()+"</div>"),i=ace.edit("gf_image_choices_custom_css_editor"),i.setOptions({showInvisibles:!1,showGutter:!0,showLineNumbers:!0,showFoldWidgets:!1,displayIndentGuides:!1,scrollPastEnd:!1,theme:"ace/theme/xcode"}),i.session.setMode("ace/mode/css"),i.getSession().on("change",function(){t.val(i.getSession().getValue())}))})}(jQuery);