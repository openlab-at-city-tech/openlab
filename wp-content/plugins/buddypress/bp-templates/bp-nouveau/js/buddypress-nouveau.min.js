window.wp=window.wp||{},window.bp=window.bp||{},function(s,p){"undefined"!=typeof BP_Nouveau&&(s.Nouveau={start:function(){this.setupGlobals(),this.prepareDocument(),this.initObjects(),this.setHeartBeat(),this.addListeners()},setupGlobals:function(){this.ajax_request=null,this.objects=p.map(BP_Nouveau.objects,function(e){return e}),this.objectNavParent=BP_Nouveau.object_nav_parent,this.heartbeat=wp.heartbeat||{},this.querystring=this.getLinkParams()},prepareDocument:function(){var a;p("body").hasClass("no-js")&&p("body").removeClass("no-js").addClass("js"),BP_Nouveau.warnings&&"undefined"!=typeof console&&console.warn&&p.each(BP_Nouveau.warnings,function(e,t){console.warn(t)}),p(".buddypress_object_nav .widget-title").length&&(a=p(".buddypress_object_nav .widget-title").html(),p("body").find('*:contains("'+a+'")').each(function(e,t){p(t).hasClass("widget-title")||a!==p(t).html()||p(t).is("a")||p(t).remove()}))},getStorage:function(e,t){e=(e=sessionStorage.getItem(e))?JSON.parse(e):{};return void 0!==t?e[t]||!1:e},setStorage:function(e,t,a){var s=this.getStorage(e);return void 0===a&&void 0!==s[t]?delete s[t]:s[t]=a,sessionStorage.setItem(e,JSON.stringify(s)),null!==sessionStorage.getItem(e)},getLinkParams:function(e,t){e=e?-1!==e.indexOf("?")?"?"+e.split("?")[1]:"":document.location.search;if(!e)return null;e=e.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return t?e[t]:e},urlDecode:function(e,t){var a=t||{amp:"&",lt:"<",gt:">",quot:'"',"#039":"'"};return decodeURIComponent(e.replace(/\+/g," ")).replace(/&([^;]+);/g,function(e,t){return a[t]||""})},ajax:function(e,t){this.ajax_request&&this.ajax_request.abort();e=p.extend({},s.Nouveau.getStorage("bp-"+t),{nonce:BP_Nouveau.nonces[t]},e);return void 0!==BP_Nouveau.customizer_settings&&(e.customized=BP_Nouveau.customizer_settings),this.ajax_request=p.post(BP_Nouveau.ajaxurl,e,"json"),this.ajax_request},inject:function(e,t,a){p(e).length&&t&&("append"===(a=a||"reset")?p(e).append(t):"prepend"===a?p(e).prepend(t):p(e).html(t),"undefined"==typeof bp_mentions&&void 0===s.mentions||p(".bp-suggestions").bp_mentions(s.mentions.users))},objectRequest:function(a){var e,s=this;if((a=p.extend({object:"",scope:null,filter:null,target:"#buddypress [data-bp-list]",search_terms:"",page:1,extras:null,caller:null,template:null,method:"reset"},a)).object&&a.target)return a.search_terms&&(a.search_terms=a.search_terms.replace(/</g,"&lt;").replace(/>/g,"&gt;")),null!==a.scope&&this.setStorage("bp-"+a.object,"scope",a.scope),null!==a.filter&&this.setStorage("bp-"+a.object,"filter",a.filter),null!==a.extras&&this.setStorage("bp-"+a.object,"extras",a.extras),p(this.objectNavParent+" [data-bp-object]").each(function(){p(this).removeClass("selected loading")}),p(this.objectNavParent+' [data-bp-scope="'+a.scope+'"], #object-nav li.current').addClass("selected loading"),p('#buddypress [data-bp-filter="'+a.object+'"] option[value="'+a.filter+'"]').prop("selected",!0),"friends"===a.object||"friend_requests"===a.object||"group_members"===a.object?(a.template=a.object,a.object="members"):"group_requests"===a.object?(a.object="groups",a.template="group_requests"):"notifications"===a.object&&(a.object="members",a.template="member_notifications"),e=p.extend({action:a.object+"_filter"},a),this.ajax(e,a.object).done(function(e){var t;!1!==e.success&&(p(s.objectNavParent+' [data-bp-scope="'+a.scope+'"]').removeClass("loading"),"reset"!==a.method?(s.inject(a.target,e.data.contents,a.method),p(a.target).trigger("bp_ajax_"+a.method,p.extend(a,{response:e.data}))):"pag-bottom"===a.caller&&p("#subnav").length?(t=p("#subnav").parent(),p("html,body").animate({scrollTop:t.offset().top},"slow",function(){p(a.target).fadeOut(100,function(){s.inject(this,e.data.contents,a.method),p(this).fadeIn(100,"swing",function(){p(a.target).trigger("bp_ajax_request",p.extend(a,{response:e.data}))})})})):p(a.target).fadeOut(100,function(){s.inject(this,e.data.contents,a.method),p(this).fadeIn(100,"swing",function(){p(a.target).trigger("bp_ajax_request",p.extend(a,{response:e.data}))})}))})},initObjects:function(){var a,s,r=this,n="all",i="",o=null,d=null;p.each(this.objects,function(e,t){void 0!==(a=r.getStorage("bp-"+t)).scope&&(n=a.scope),void 0!==a.extras&&"notifications"!==t&&(o=a.extras),p('#buddypress [data-bp-filter="'+t+'"]').length&&("-1"!==p('#buddypress [data-bp-filter="'+t+'"]').val()&&"0"!==p('#buddypress [data-bp-filter="'+t+'"]').val()?d=p('#buddypress [data-bp-filter="'+t+'"]').val():void 0!==a.filter&&(d=a.filter,p('#buddypress [data-bp-filter="'+t+'"] option[value="'+d+'"]').prop("selected",!0))),p(this.objectNavParent+' [data-bp-object="'+t+'"]').length&&(p(this.objectNavParent+' [data-bp-object="'+t+'"]').each(function(){p(this).removeClass("selected")}),p(this.objectNavParent+' [data-bp-scope="'+t+'"], #object-nav li.current').addClass("selected")),null!==r.querystring&&(void 0!==r.querystring[t+"_search"]?i=r.querystring[t+"_search"]:void 0!==r.querystring.s&&(i=r.querystring.s),i&&(i=r.urlDecode(i),p('#buddypress [data-bp-search="'+t+'"] input[type=search]').val(i))),p('#buddypress [data-bp-list="'+t+'"]').length&&(s={object:t,scope:n,filter:d,search_terms:i,extras:o},r.objectRequest(s))})},setHeartBeat:function(){void 0!==BP_Nouveau.pulse&&this.heartbeat&&(this.heartbeat.interval(Number(BP_Nouveau.pulse)),p.fn.extend({"heartbeat-send":function(){return this.bind("heartbeat-send.buddypress")}}),p.fn.extend({"heartbeat-tick":function(){return this.bind("heartbeat-tick.buddypress")}}))},addListeners:function(){p("[data-bp-disable-input]").on("change",this.toggleDisabledInput),p(document).on("heartbeat-send.buddypress",this.heartbeatSend),p(document).on("heartbeat-tick.buddypress",this.heartbeatTick),p(this.objectNavParent+" .bp-navs").on("click","a",this,this.scopeQuery),p("#buddypress [data-bp-filter]").on("change",this,this.filterQuery),p("#buddypress [data-bp-search]").on("submit","form",this,this.searchQuery),p("#buddypress [data-bp-search] form").on("search","input[type=search]",this.resetSearch),p("#buddypress [data-bp-list], #buddypress #item-header").on("click","[data-bp-btn-action]",this,this.buttonAction),p("#buddypress [data-bp-close]").on("click",this,this.closeNotice),p("#buddypress [data-bp-list]").on("click","[data-bp-pagination] a",this,this.paginateAction)},toggleDisabledInput:function(e){var t=p(e.currentTarget),a="#"+t.data("bp-disable-input"),e=t.prop("checked");t.removeClass("enabled disabled"),e?(t.addClass("enabled"),p(a).prop("disabled",!1)):(p(a).prop("disabled",!0),t.addClass("disabled"))},heartbeatSend:function(e,t){p("#buddypress").trigger("bp_heartbeat_send",t)},heartbeatTick:function(e,t){p("#buddypress").trigger("bp_heartbeat_tick",t)},scopeQuery:function(e){var t,a,s,r=e.data,n=p(e.currentTarget).parent(),i="";return n.hasClass("no-ajax")||p(e.currentTarget).hasClass("no-ajax")||!n.attr("data-bp-scope")?e:(t=n.data("bp-scope"),a=n.data("bp-object"),t&&a?(e.preventDefault(),s=p("#buddypress").find('[data-bp-filter="'+a+'"]').first().val(),p('#buddypress [data-bp-search="'+a+'"] input[type=search]').length&&(i=p('#buddypress [data-bp-search="'+a+'"] input[type=search]').val()),n.hasClass("dynamic")&&n.find("a span").html(""),void r.objectRequest({object:a,scope:t,filter:s,search_terms:i,page:1})):e)},filterQuery:function(e){var t=e.data,a=p(e.target).data("bp-filter"),s="all",r=p(e.target).val(),n="";if(!a)return e;p(t.objectNavParent+" [data-bp-object].selected").length&&(s=p(t.objectNavParent+" [data-bp-object].selected").data("bp-scope")),p('#buddypress [data-bp-search="'+a+'"] input[type=search]').length&&(n=p('#buddypress [data-bp-search="'+a+'"] input[type=search]').val()),t.objectRequest({object:a,scope:s,filter:r,search_terms:n,page:1,template:null})},searchQuery:function(e){var t,a,s,r=e.data,n="all";if(p(e.delegateTarget).hasClass("no-ajax")||void 0===p(e.delegateTarget).data("bp-search"))return e;e.preventDefault(),t=p(e.delegateTarget).data("bp-search"),a=p("#buddypress").find('[data-bp-filter="'+t+'"]').first().val(),s=p(e.delegateTarget).find("input[type=search]").first().val(),p(r.objectNavParent+" [data-bp-object]").length&&(n=p(r.objectNavParent+' [data-bp-object="'+t+'"].selected').data("bp-scope")),r.objectRequest({object:t,scope:n,filter:a,search_terms:s,page:1,template:null})},showSearchSubmit:function(e){p(e.delegateTarget).find("[type=submit]").addClass("bp-show"),p("[type=submit]").hasClass("bp-hide")&&p("[type=submit]").removeClass("bp-hide")},resetSearch:function(e){p(e.target).val()?p(e.delegateTarget).find("[type=submit]").show():p(e.delegateTarget).submit()},buttonAction:function(e){var a=e.data,s=p(e.currentTarget),r=s.data("bp-btn-action"),t=s.data("bp-nonce"),n=s.closest("[data-bp-item-id]"),i=n.data("bp-item-id"),o=s.closest(".list-wrap"),d=n.data("bp-item-component");if(!r||!i||!d)return e;if(e.preventDefault(),void 0!==BP_Nouveau[r+"_confirm"]&&!1===window.confirm(BP_Nouveau[r+"_confirm"])||s.hasClass("pending"))return!1;var t=t||s.prop("href"),c=a.getLinkParams(t,"_wpnonce"),t={is_friend:"remove_friend",not_friends:"add_friend",pending:"withdraw_friendship",accept_friendship:"accept_friendship",reject_friendship:"reject_friendship"};"members"===d&&void 0!==t[r]&&(r=t[r],d="friends"),s.addClass("pending loading"),a.ajax({action:d+"_"+r,item_id:i,_wpnonce:c},d).done(function(e){var t;{if(!1!==e.success)return"groups"===d&&void 0!==e.data.is_group&&e.data.is_group?window.location.reload():void 0!==e.data.is_user&&e.data.is_user?(s.parent().html(e.data.feedback),void n.fadeOut(1500)):(p(a.objectNavParent+' [data-bp-scope="personal"]').length&&(t=Number(p(a.objectNavParent+' [data-bp-scope="personal"] span').html())||0,-1!==p.inArray(r,["leave_group","remove_friend"])?--t:-1!==p.inArray(r,["join_group"])&&(t+=1),t<0&&(t=0),p(a.objectNavParent+' [data-bp-scope="personal"] span').html(t)),void s.parent().replaceWith(e.data.contents));o.prepend(e.data.feedback),s.removeClass("pending loading"),n.find(".bp-feedback").fadeOut(6e3)}})},closeNotice:function(e){var t=p(e.currentTarget);e.preventDefault(),"clear"===t.data("bp-close")&&(void 0!==p.cookie("bp-message")&&p.removeCookie("bp-message"),void 0!==p.cookie("bp-message-type")&&p.removeCookie("bp-message-type")),t.closest(".bp-feedback").hasClass("bp-sitewide-notice")&&s.Nouveau.ajax({action:"messages_dismiss_sitewide_notice"},"messages"),t.closest(".bp-feedback").remove()},paginateAction:function(e){var t,a=e.data,s=p(e.currentTarget),r=null,n=null,i=null,o=null,d=s.closest("[data-bp-pagination]").data("bp-pagination")||null;if(null===d)return e;e.preventDefault(),null!==(t=p(e.delegateTarget).data("bp-list")||null)&&(void 0!==(e=a.getStorage("bp-"+t)).scope&&(r=e.scope),void 0!==e.filter&&(n=e.filter),void 0!==e.extras&&(o=e.extras));d={object:t,scope:r,filter:n,search_terms:i=p('#buddypress [data-bp-search="'+t+'"] input[type=search]').length?p('#buddypress [data-bp-search="'+t+'"] input[type=search]').val():i,extras:o,page:a.getLinkParams(s.prop("href"),d)||1};a.objectRequest(d)}},s.Nouveau.start())}(window.bp,jQuery);