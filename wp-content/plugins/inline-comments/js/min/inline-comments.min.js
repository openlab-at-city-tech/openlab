!function(n,t){"use strict";var i,e,o,c,a=[],r=0,m=t(window).width();n.rebuild=function(){m=t(window).width(),a=[],t("#incom_wrapper .incom-bubble").remove(),l(),t("#comments-and-form:visible").length&&(Q(),X("out"))};var u=function(n){i=t.extend({canComment:!0,selectors:"p",moveSiteSelector:"html",countStatic:!0,alwaysStatic:!1,defaultBubbleText:"+",bubbleStyle:"bubble",bubbleAnimationIn:"default",bubbleAnimationOut:"default",position:"left",background:"white",backgroundOpacity:"1",displayBranding:!1},n)},s=function(){var n,e,o;0===t("#incom_wrapper").length&&(n=document.createDocumentFragment(),e=document.createElement("div"),o=document.querySelector("html"),e.setAttribute("id","incom_wrapper"),e.className="incom-position-"+i.position,n.appendChild(e),o.appendChild(n)),l()},l=function(){var n,e,o;for(n=t(i.selectors),e=0,o=n.length;e<o;e+=1){var c=t(n[e]);f(c),b.createFromElement(c)}},f=function(n,t){if(t=t||0,!n.attr("data-incom")){var i=d(n);t=p(t,i);var e=i+t;n.attr("data-incom",e)}},b={set:function(n){t.extend({posX:void 0,posY:void 0,id:void 0,visible:!1},n)},createFromElement:function(n){v(n)}},d=function(n){return n.prop("tagName").substr(0,5)},p=function(n,i){var e=i+n;if(-1!==t.inArray(e,a))for(;-1!==t.inArray(e,a);)n++,e=i+n;return a.push(e),n},v=function(n){var i=h(n),e=w(n),o=t("<a/>",{href:"",class:"incom-bubble-link"}).text(i).wrap(e).parent().appendTo("#incom_wrapper");C(o),q(n,o),E(o)?(S(n,o),A(n,o)):o.hide()},h=function(n){return k(n)?g(n):i.defaultBubbleText},g=function(n){var i=n.attr("data-incom"),e="[data-incom-comment="+i+"]",o=t(e).length;return o+=t(e+" .children li").length},w=function(n){var t=n.attr("data-incom");return'<div class="'+y(n)+'" data-incom-bubble="'+t+'" />'},y=function(n){var t="incom-bubble";return(i.alwaysStatic||k(n)&&i.countStatic)&&(t+=" incom-bubble-static"),k(n)||!k(n)&&"bubble"===i.bubbleStyle?t+=" incom-bubble-style":t+=" incom-bubble-dynamic",t},k=function(n){var i=g(n);return!!(t.isNumeric(i)&&i>0)},C=function(n){n.hasClass("incom-bubble-static")&&n.css("display","block")},S=function(n,e){!e.hasClass("incom-bubble-static")&&i.canComment&&n.add(e).hover(function(){t(".incom-bubble:not(.incom-bubble-static)").hide(),"fadein"===i.bubbleAnimationIn?e.stop(!0,!0).fadeIn():e.stop(!0,!0).show(),E(e)||e.hide()},function(){"fadeout"===i.bubbleAnimationOut?e.stop(!0,!0).fadeOut():e.stop(!0,!0).delay(700).hide(0)})},A=function(n,i){i.on("click",function(e){e.preventDefault();var o=t(this);o.hasClass("incom-bubble-active")?(Q(!0),o.removeClass("incom-bubble-active")):(U("incom-active"),n.addClass("incom-active"),Q(),i.addClass("incom-bubble-active"),x(i))})},_=function(){return 0===t(".incom-comments-wrapper").length?t("<div/>",{class:"incom-comments-wrapper"}).appendTo("#incom_wrapper").css("background-color","rgba("+$(i.background)+","+i.backgroundOpacity+")"):t(".incom-comments-wrapper")},x=function(n){var t=_();B(),T(),q(n,t),F(t),H(),I()},I=function(){t(document).ready(K()).ajaxStop(function(){K()})},T=function(){t("#comments-and-form").appendTo(".incom-comments-wrapper").show(),O()},O=function(){var n=t("<input>").attr("type","hidden").attr("name","data_incom").val(W);t("#comments-and-form .form-submit").append(t(n))},B=function(){var n="[data-incom-comment="+W()+"]";t("#comments-and-form .comment").hide(),t("#comments-and-form .comment"+n).addClass("incom-visible-comment").show(),t(".incom-visible-comment .children li").show()},W=function(){return t(".incom-active").attr("data-incom")},q=function(n,t){var i=n.offset();t.css({top:i.top,left:J()?i.left+n.outerWidth():i.left-t.outerWidth()})},D=function(n){e=n.outerWidth(),o=n.offset().left,c=o+e},E=function(n){return D(n),!(c>m||o<0)},F=function(n){D(n),J()&&c>m?(N(c-m),X("in")):!J()&&o<0&&(N(-o),X("in"))},N=function(n){r=n},j=function(){return r},H=function(){t("html").click(function(n){0===t(n.target).parents("#incom_wrapper").length&&Q(!0)})},K=function(){t(".incom-cancel").click(function(n){n.preventDefault(),Q(!0)})},Q=function(n){var i=t(".incom-bubble"),e=t(".incom-comments-wrapper");t("#comments-and-form").appendTo("#incom_wrapper").hide(),t(".incom-visible-comment").removeClass("incom-visible-comment"),i.hasClass("incom-bubble-active")&&(i.removeClass("incom-bubble-active"),n?e.fadeOut("fast",function(){t(this).remove(),U("incom-active")}):e.remove(),X("out"))},X=function(n){var e=t(i.moveSiteSelector);e.css({position:"relative"}),Y(e,n),"html"!==i.moveSiteSelector&&(G(n,".incom-bubble"),G(n,".incom-comments-wrapper"))},Y=function(n,t){var i;"in"===t?i=j():"out"===t&&(i="initial"),z(n,i)},z=function(n,t){var i=J()?"right":"left",e={};e[i]=t,n.css(e)},G=function(n,i){var e=t(i);"in"===n?e.css({left:J()?"-="+j():"+="+j()}):"out"===n&&e.css({left:J()?"+="+j():"-="+j()})},J=function(){return"right"===i.position},L=function(){M("data-incom-ref","data-incom"),R("data-incom-ref","data-incom")},M=function(n,i){t("["+n+"]").each(function(){var e=t(this),o=e.attr(n);t("["+i+'="'+o+'"]').length||e.parent().remove()})},P={init:function(){this.permalinksHandler()},permalinksHandler:function(){t("#comments-and-form").on("click","a.incom-permalink",function(){var n=t(this.hash);if(n.length){en(n);var i=t(this).attr("href");return tn(i),!1}})}},R=function(n,i){t("["+n+"]").click(function(){var e=t(this).attr(n),o=t("["+i+'="'+e+'"]');o.length&&(en(o),U("incom-scrolled-to"),o.addClass("incom-scrolled-to"))})},U=function(n){var i=t("."+n);0!==i.length&&(i.removeClass(n),0===i.prop("class").length&&i.removeAttr("class"))},V=function(){var n=t(".incom-cancel-x"),e=t(Z());!0!==i.displayBranding&&1!==i.displayBranding||t(".incom-info-icon").length||n.after(e)},Z=function(){return'<a class="incom-info-icon" href="http://kevinw.de/inline-comments/" title="Inline Comments by Kevin Weber" target="_blank">i</a>'},$=function(n){return parseInt(nn(n).substring(0,2),16)+","+parseInt(nn(n).substring(2,4),16)+","+parseInt(nn(n).substring(4,6),16)},nn=function(n){return"#"===n.charAt(0)?n.substring(1,7):n};t.easing.quart=function(n,t,i,e,o){return-e*((t=t/o-1)*t*t*t-1)+i};var tn=function(n){history.pushState(null,null,n),history.pushState?history.pushState(null,null,n):location.hash=n},en=function(n){var i=t("html, body"),e=n.offset().top-30;i.animate({scrollTop:e},1200,"quart")};n.init=function(n){u(n),s(),V(),L(),t(".incom-reply .comment-reply-link").on("click",function(){t("#comments-and-form #commentform").attr("id","incom-commentform")}),P.init()}}(window.incom=window.incom||{},jQuery);