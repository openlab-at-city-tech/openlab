jQuery(document).ready(function(a){if(a(document).on("click","#wpdcom .wmu-upload-wrap",function(){a(".wpd-form-foot",a(this).parents(".wpd_comm_form")).slideDown(parseInt(wpdiscuzAjaxObj.enableDropAnimation)?500:0)}),a(document).on("change",".wmu-add-files",function(){var e=a(this),t=e.parents(".wpd_comm_form"),d=e[0].files?e[0].files:[];d.length&&function(e,t,d){t.attr("data-uploading","true");var o=new FormData;o.append("action","wmuUploadFiles"),o.append("wmuAttachmentsData",a(".wmu-attachments-data",t).val()),o.append("uniqueId",t.find(".wpdiscuz_unique_id").val());var i=0;a.each(d,function(a,e){i+=e.size,o.append(wpdiscuzAjaxObj.wmuInput+"["+a+"]",e)}),i>parseInt(wpdiscuzAjaxObj.wmuMaxFileSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhraseMaxFileSize,"wmuPhraseMaxFileSize",e),"error",3e3):i>parseInt(wpdiscuzAjaxObj.wmuPostMaxSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhrasePostMaxSize,"wmuPhrasePostMaxSize",e),"error",3e3):wpdiscuzAjaxObj.getAjaxObj(!0,!0,o).done(function(e){e.success?(a(".wmu-attached-data-info",t).remove(),a(".wmu-add-files",t).after(e.data.attachmentsHtml),e.data.tooltip&&a(".wmu-upload-wrap",t).attr("wpd-tooltip",e.data.tooltip),function(e,t){a.each(t.data.previewsData,function(t,d){a(".wmu-action-wrap .wmu-"+t+"-tab",e).html(""),a.each(d,function(d,o){var i=o.id,r="",s=o.fullname,u=o.shortname;t==wpdiscuzAjaxObj.wmuKeyImages?(r=o.url,u=""):t==wpdiscuzAjaxObj.wmuKeyVideos?r=wpdiscuzAjaxObj.wmuIconVideo:t==wpdiscuzAjaxObj.wmuKeyFiles&&(r=wpdiscuzAjaxObj.wmuIconFile);var n='<div class="wmu-preview [PREVIEW_TYPE_CLASS]" title="[PREVIEW_TITLE]" data-wmu-type="[PREVIEW_TYPE]" data-wmu-attachment="[PREVIEW_ID]"><div class="wmu-preview-remove"><img class="wmu-preview-img" src="[PREVIEW_ICON]"><div class="wmu-file-name">[PREVIEW_FILENAME]</div><div class="wmu-delete">&nbsp;</div></div></div>';n=(n=(n=(n=(n=(n=n.replace("[PREVIEW_TYPE_CLASS]","wmu-preview-"+t)).replace("[PREVIEW_TITLE]",s)).replace("[PREVIEW_TYPE]",t)).replace("[PREVIEW_ID]",i)).replace("[PREVIEW_ICON]",r)).replace("[PREVIEW_FILENAME]",u),a(".wmu-action-wrap .wmu-"+t+"-tab",e).removeClass("wmu-hide").append(n)})})}(t,e),e.data.errors&&(wpdiscuzAjaxObj.setCommentMessage(e.data.errors,"error",3e3),console.log(e.data.errors))):e.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[e.data.errorCode],e.data.errorCode,t),"error",3e3):e.data.error&&wpdiscuzAjaxObj.setCommentMessage(e.data.error,"error",3e3),a("#wpdiscuz-loading-bar").fadeOut(250),t.attr("data-uploading","false")}).fail(function(e,d,o){console.log(o),a("#wpdiscuz-loading-bar").fadeOut(250),t.attr("data-uploading","false")})}(e,t,d)}),a(document).on("click",".wmu-attachment-delete",function(e){if(confirm(wpdiscuzAjaxObj.wmuPhraseConfirmDelete)){var t=a(this).data("wmu-attachment"),d=new FormData;d.append("action","wmuDeleteAttachment"),d.append("attachmentId",t),wpdiscuzAjaxObj.getAjaxObj(!0,!0,d).done(function(e){if(e.success){var d=a(".wmu-attachment-"+t).parents(".wmu-comment-attachments");a(".wmu-attachment-"+t).remove(),a(".wmu-attached-images *",d).length||a(".wmu-attached-images",d).remove(),a(".wmu-attached-videos *",d).length||a(".wmu-attached-videos",d).remove(),a(".wmu-attached-files *",d).length||a(".wmu-attached-files",d).remove()}else e.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[e.data.errorCode],e.data.errorCode,d),"error",3e3):e.data.error&&wpdiscuzAjaxObj.setCommentMessage(e.data.error,"error",3e3);a("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(e,t,d){console.log(d),a("#wpdiscuz-loading-bar").fadeOut(250)})}else console.log("canceled")}),a(document).on("click",".wmu-preview",function(){var e=a(this),t=e.parents(".wpd_comm_form"),d=(e.data("wmu-type"),e.data("wmu-attachment")),o=new FormData;o.append("action","wmuRemoveAttachmentPreview"),o.append("attachmentId",d),o.append("wmuAttachmentsData",a(".wmu-attachments-data",t).val()),o.append("uniqueId",t.find(".wpdiscuz_unique_id").val()),wpdiscuzAjaxObj.getAjaxObj(!0,!0,o).done(function(d){if(d.success){e.remove();var o=a(".wmu-tabs",t);a.each(o,function(e,t){a(".wmu-preview",t).length?a(t).removeClass("wmu-hide"):a(t).addClass("wmu-hide")}),a(".wmu-attached-data-info",t).remove(),a(".wmu-add-files",t).after(d.data.attachmentsHtml),d.data.tooltip&&a(".wmu-upload-wrap",t).attr("wpd-tooltip",d.data.tooltip)}else d.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[d.data.errorCode],d.data.errorCode,t),"error",3e3):d.data.error&&wpdiscuzAjaxObj.setCommentMessage(d.data.error,"error",3e3);a("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(e,t,d){console.log(d),a("#wpdiscuz-loading-bar").fadeOut(250)})}),parseInt(wpdiscuzAjaxObj.wmuIsLightbox)){function e(){a(".wmu-lightbox").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-lightbox",fixed:!0})}e(),wpdiscuzAjaxObj.wmuAddLightBox=e}wpdiscuzAjaxObj.wmuHideAll=function(e,t){"object"==typeof e?e.success?(a(".wmu-tabs",t).addClass("wmu-hide"),a(".wmu-preview",t).remove(),a(".wmu-attached-data-info",t).remove()):console.log(e.data):console.log(e)}});