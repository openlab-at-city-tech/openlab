jQuery(document).ready(function($){if($("body").on("click","#wpdcom .wmu-upload-wrap",function(){$(".wpd-form-foot",$(this).parents(".wpd_comm_form")).slideDown(parseInt(wpdiscuzAjaxObj.enableDropAnimation)?500:0)}),$("body").on("change",".wmu-add-files",function(){var a=$(this),c=a.parents(".wpd_comm_form"),b=a[0].files?a[0].files:[];b.length&&function(c,b,e){b.attr("data-uploading","true");var a=new FormData;a.append("action","wmuUploadFiles"),a.append("wmuAttachmentsData",$(".wmu-attachments-data",b).val()),a.append("uniqueId",b.find(".wpdiscuz_unique_id").val());var d=0;$.each(e,function(c,b){d+=b.size,a.append(wpdiscuzAjaxObj.wmuInput+"["+c+"]",b)}),d>parseInt(wpdiscuzAjaxObj.wmuMaxFileSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhraseMaxFileSize,"wmuPhraseMaxFileSize",c),"error",3e3):d>parseInt(wpdiscuzAjaxObj.wmuPostMaxSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj.wmuPhrasePostMaxSize,"wmuPhrasePostMaxSize",c),"error",3e3):wpdiscuzAjaxObj.getAjaxObj(!0,!0,a).done(function(a){var d,c;a.success?($(".wmu-attached-data-info",b).remove(),$(".wmu-add-files",b).after(a.data.attachmentsHtml),a.data.tooltip&&$(".wmu-upload-wrap",b).attr("wpd-tooltip",a.data.tooltip),d=b,c=a,$.each(c.data.previewsData,function(a,b){$(".wmu-action-wrap .wmu-"+a+"-tab",d).html(""),$.each(b,function(i,c){var g=c.id,e="",h=c.fullname,f=c.shortname;a==wpdiscuzAjaxObj.wmuKeyImages?(e=c.url,f=""):a==wpdiscuzAjaxObj.wmuKeyVideos?e=wpdiscuzAjaxObj.wmuIconVideo:a==wpdiscuzAjaxObj.wmuKeyFiles&&(e=wpdiscuzAjaxObj.wmuIconFile);var b='<div class="wmu-preview [PREVIEW_TYPE_CLASS]" title="[PREVIEW_TITLE]" data-wmu-type="[PREVIEW_TYPE]" data-wmu-attachment="[PREVIEW_ID]"><div class="wmu-preview-remove"><img class="wmu-preview-img" src="[PREVIEW_ICON]"><div class="wmu-file-name">[PREVIEW_FILENAME]</div><div class="wmu-delete">&nbsp;</div></div></div>';b=(b=(b=(b=(b=(b=b.replace("[PREVIEW_TYPE_CLASS]","wmu-preview-"+a)).replace("[PREVIEW_TITLE]",h)).replace("[PREVIEW_TYPE]",a)).replace("[PREVIEW_ID]",g)).replace("[PREVIEW_ICON]",e)).replace("[PREVIEW_FILENAME]",f),$(".wmu-action-wrap .wmu-"+a+"-tab",d).removeClass("wmu-hide").append(b)})}),a.data.errors&&(wpdiscuzAjaxObj.setCommentMessage(a.data.errors,"error",3e3),console.log(a.data.errors))):a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[a.data.errorCode],a.data.errorCode,b),"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3),$("#wpdiscuz-loading-bar").fadeOut(250),b.attr("data-uploading","false")}).fail(function(c,d,a){console.log(a),$("#wpdiscuz-loading-bar").fadeOut(250),b.attr("data-uploading","false")})}(a,c,b)}),$("body").on("click",".wmu-attachment-delete",function(c){if(confirm(wpdiscuzAjaxObj.wmuPhraseConfirmDelete)){var b=$(this).data("wmu-attachment"),a=new FormData;a.append("action","wmuDeleteAttachment"),a.append("attachmentId",b),wpdiscuzAjaxObj.getAjaxObj(!0,!0,a).done(function(c){if(c.success){var a=$(".wmu-attachment-"+b).parents(".wmu-comment-attachments");$(".wmu-attachment-"+b).remove(),$(".wmu-attached-images *",a).length||$(".wmu-attached-images",a).remove(),$(".wmu-attached-videos *",a).length||$(".wmu-attached-videos",a).remove(),$(".wmu-attached-files *",a).length||$(".wmu-attached-files",a).remove()}else c.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[c.data.errorCode],c.data.errorCode,a),"error",3e3):c.data.error&&wpdiscuzAjaxObj.setCommentMessage(c.data.error,"error",3e3);$("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(b,c,a){console.log(a),$("#wpdiscuz-loading-bar").fadeOut(250)})}else console.log("canceled")}),$("body").on("click",".wmu-preview",function(){var b=$(this),c=b.parents(".wpd_comm_form");b.data("wmu-type");var d=b.data("wmu-attachment"),a=new FormData;a.append("action","wmuRemoveAttachmentPreview"),a.append("attachmentId",d),a.append("wmuAttachmentsData",$(".wmu-attachments-data",c).val()),a.append("uniqueId",c.find(".wpdiscuz_unique_id").val()),wpdiscuzAjaxObj.getAjaxObj(!0,!0,a).done(function(a){if(a.success){b.remove();var d=$(".wmu-tabs",c);$.each(d,function(b,a){$(".wmu-preview",a).length?$(a).removeClass("wmu-hide"):$(a).addClass("wmu-hide")}),$(".wmu-attached-data-info",c).remove(),$(".wmu-add-files",c).after(a.data.attachmentsHtml),a.data.tooltip&&$(".wmu-upload-wrap",c).attr("wpd-tooltip",a.data.tooltip)}else a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.applyFilterOnPhrase(wpdiscuzAjaxObj[a.data.errorCode],a.data.errorCode,c),"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3);$("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(b,c,a){console.log(a),$("#wpdiscuz-loading-bar").fadeOut(250)})}),parseInt(wpdiscuzAjaxObj.wmuIsLightbox)){function a(){$(".wmu-lightbox").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-lightbox",fixed:!0})}a(),wpdiscuzAjaxObj.wmuAddLightBox=a}wpdiscuzAjaxObj.wmuHideAll=function(a,b){"object"==typeof a?a.success?($(".wmu-tabs",b).addClass("wmu-hide"),$(".wmu-preview",b).remove(),$(".wmu-attached-data-info",b).remove()):console.log(a.data):console.log(a)}})