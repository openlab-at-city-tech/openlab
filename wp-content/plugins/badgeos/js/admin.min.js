jQuery(document).ready(function(e){var a;e(".open_badge_enable_baking_blk_field").change(function(){"1"==e(this).val()?e(this).parents("fieldset").find(".sub_ob_badgeos_blk_fields").css("display","block"):e(this).parents("fieldset").find(".sub_ob_badgeos_blk_fields").css("display","none")}).trigger("change"),e("#badgeos_tools_email_allow_unsubscribe_email").change(function(){"Yes"==e(this).val()?e(".badgeos_tools_email_unsubscribe_page_fields").css("display","block"):e(".badgeos_tools_email_unsubscribe_page_fields").css("display","none")}).trigger("change"),e(".btn_badgeos_download_assets").click(function(){var a=e(this);a.attr("disabled",!0),a.parent().find("#btn_badgeos_download_assets_loader").css("visibility","visible");var t=a.parent().find(".badgeos_assets_id").val(),n=a.data("ajax_url");a.parent().parent().find(".badgeos_download_asset_success_message").css("display","none"),a.parent().parent().find(".badgeos_download_asset_failed_message").css("display","none");var i={action:"badgeos_download_asset",assets_id:t};return jQuery.post(n,i,function(e){a.parent().parent().find(".badgeos_template_info_log").attr("id");a.parent().find("#btn_badgeos_download_assets_loader").css("visibility","hidden"),"done"==e?a.parent().parent().find(".badgeos_download_asset_success_message").css("display","block"):a.parent().parent().find(".badgeos_download_asset_failed_message").css("display","block").html(e),a.attr("disabled",!1)}),!1}),e(".badgeos-profile-points-update-button").click(function(){var a=e(this),t=a.data("points_id"),n=a.data("field_id"),i=a.data("user_id"),s=e("#"+n).val(),d=a.data("admin_ajax"),r={action:"badgeos_user_profile_update_points",points_id:t,points:s,user_id:i};jQuery.post(d,r,function(t){t.success&&(console.log(t.data.new_points),e("#"+n+"-profile-label").html(t.data.new_points)),a.parents(".badgeos-credits").find(".badgeos-edit-credit-wrapper").hide(),a.parents(".badgeos-credits").find(".badgeos-earned-credit").show()})}),e(".badgeos-profile-points-cancel-button").click(function(){var a=e(this);a.parents(".badgeos-credits").find(".badgeos-edit-credit-wrapper").hide(),a.parents(".badgeos-credits").find(".badgeos-earned-credit").show()}),e("#award-achievement, #award-credits, #award-ranks").change(function(){e("#award-achievement, #award-credits, #award-ranks").is(":checked")?e("#badgeos-award-users").parents("tr").find("th, th label, td, td select, td span").slideUp({duration:500}):e("#badgeos-award-users").parents("tr").find("th, th label, td, td select, td span").slideDown({duration:500})}),e("#revoke-achievement, #revoke-credits, #revoke-ranks").change(function(){e("#revoke-achievement, #revoke-credits, #revoke-ranks").is(":checked")?e("#badgeos-revoke-users").parents("tr").find("th, th label, td, td select, td span").slideUp({duration:500}):e("#badgeos-revoke-users").parents("tr").find("th, th label, td, td select, td span").slideDown({duration:500})}),e("body").on("click","table.badgeos-rank-table .revoke-rank",function(){var a=e(this);a.siblings(".spinner-loader").find(".revoke-rank-spinner").show();var t=a.attr("data-rank_id"),n=a.attr("data-user_id"),i=a.attr("data-admin_ajax"),s={action:"user_profile_revoke_rank",rankID:t,userID:n};jQuery.post(i,s,function(t){a.siblings(".spinner-loader").find(".revoke-rank-spinner").hide(),"true"==t?a.parents("tr").find("td").slideUp(800,function(){a.parents("tr").remove(),e("table.badgeos-rank-revoke-table > tbody tr").length||e("table.badgeos-rank-revoke-table > tbody").append('<tr class="no-awarded-rank"><td colspan="5"><span class="description">'+admin_js.no_awarded_rank+"</span></td> </tr>")}):"false"==t&&a.siblings(".spinner-loader").append(e("Try Again"))})}),e("body").on("click",".user-profile-award-ranks .display-ranks-to-award",function(){var a=e(this);a.parents(".user-profile-award-ranks").find(".revoke-rank-spinner").show();var t=a.attr("data-admin_ajax"),n={action:"user_profile_display_award_list",user_id:a.attr("data-user-id"),rank_filter:a.attr("data-rank-filter")};jQuery.post(t,n,function(t){a.parents(".user-profile-award-ranks").find(".revoke-rank-spinner").hide(),e(".user-profile-award-ranks .badgeos-rank-table-to-award").remove(),a.parents(".user-profile-award-ranks").append(e(t))})}),e("body").on("click",".user-profile-award-ranks .badgeos-rank-table-to-award .award-rank",function(){var a=e(this);a.siblings(".spinner-loader").find(".award-rank-spinner").show();var t=a.attr("data-admin-ajax"),n={action:"user_profile_award_rank",user_id:a.attr("data-user-id"),rank_id:a.attr("data-rank-id")};jQuery.post(t,n,function(t){if(a.siblings(".spinner-loader").find(".award-rank-spinner").hide(),"true"==t){var n=a.attr("data-rank-id"),i=a.attr("data-user-id"),s=a.attr("data-admin-ajax"),d=a.parents("tr").attr("class"),r=a.parents("tr").attr("id"),o=a.parents("tr").clone(!0),l='<td class="last-awarded" align="center"><span class="profile_ranks_last_award_field">&#10003;</span></td><td><span data-rank_id="'+n+'" data-user_id="'+i+'" data-admin_ajax="'+s+'" class="revoke-rank">'+admin_js.revoke_rank+'</span><span class="spinner-loader" ><img class="award-rank-spinner" src="'+admin_js.loading_img+'" style="margin-left: 10px; display: none;" /></span></td>';"default-rank"==r&&(l='<td class="last-awarded" align="center"><span class="profile_ranks_last_award_field">&#10003;</span></td><td><span class="default-rank">'+admin_js.default_rank+"</span></td>"),e("td.award-rank-column",o).replaceWith(l),e.each(e(".badgeos-rank-revoke-table > tbody > tr"),function(a,t){e(t).hasClass(d)&&e(t).find("td.last-awarded").empty()}),e(".badgeos-rank-revoke-table > tbody").append(o),e(".badgeos-rank-revoke-table > tbody > tr.no-awarded-rank td, .badgeos-rank-revoke-table > tbody > tr.no-awarded-rank span").slideUp(800,function(){e(".badgeos-rank-revoke-table > tbody > tr.no-awarded-rank").remove()}),a.parents("tr").find("td").slideUp(800,function(){a.parents("tr").remove()})}else"false"==t&&a.siblings(".spinner-loader").append(e("Try Again"));e(".user-profile-award-ranks .badgeos-rank-table-to-award").remove(),a.parents(".user-profile-award-ranks").append(e(t))})}),e(".badgeos-credits .badgeos-credit-edit").click(function(){var a=e(this);a.siblings(".badgeos-edit-credit-wrapper").show(),a.siblings(".badgeos-earned-credit").hide()}),e("#badgeos_ach_check_all").click(function(a){e('input[name="badgeos_ach_check_indis[]"]').not(this).prop("checked",this.checked)}),e("#badgeos_btn_revoke_bulk_achievements").click(function(a){var t=e(this),n=[],i=e("#badgeos_user_id").val();e('input[name="badgeos_ach_check_indis[]"]:checked').each(function(){n.push(e(this).val())});var s={action:"delete_badgeos_bulk_achievements",achievements:n,user_id:i};t.siblings("#revoke-badges-loader").show(),e.post(admin_js.ajax_url,s,function(a){t.siblings("#revoke-badges-loader").hide(),"success"==a?window.location.reload():e("#wpbody-content .wrap").prepend('<div class="notice notice-warning is-dismissible"><p>'+a+"</p></div>")}),console.log(n)}),e("#_badgeos_earned_by").change(function(){var a=e("#_badgeos_sequential").parent().parent(),t=e("#_badgeos_points_required_badgeos_points_required").parent().parent().parent();a.hide(),t.hide(),"triggers"==e(this).val()?a.show():"points"==e(this).val()&&t.show()}).change(),e("#titlewrap").on("keyup","input[name=post_title]",function(){if(admin_js.achievement_post_type==e("#post_type").val()){var a=e(this);a.val().length>20?(a.css({background:"#faa",color:"#a00","border-color":"#a55"}),e("#title-warning").remove(),a.parent().append('<p id="title-warning">Achievement Type supports a maximum of 20 characters. Please choose a shorter title.</p>')):(a.css({background:"#fff",color:"#333","border-color":"#DFDFDF"}),e("#title-warning").remove())}}),e("#delete_log_entries").click(function(){if(confirm("It will delete all the log entries")){e.post(admin_js.ajax_url,{action:"delete_badgeos_log_entries"},function(a){e("#wpbody-content .wrap").prepend('<div class="notice notice-warning delete-log-entries"><p><img src="'+admin_js.loading_img+'" /> &nbsp;&nbsp;BadgeOS is deleting log entries as background process, you can continue exploring badgeos</p></div>'),setTimeout(function(){e("#wpbody-content .wrap .delete-log-entries").slideUp()},1e4)})}}),e("#badgeos_migrate_meta_to_db").click(function(){if(confirm("It will update the users' existing achievements and points in the badgeos table.")){e.post(admin_js.ajax_url,{action:"badgeos_migrate_data_from_meta_to_db"},function(a){e(".badgeos_migrate_meta_to_db_message").html('<div class="notice notice-warning delete-log-entries"><p><img src="'+admin_js.loading_img+'" /> &nbsp;&nbsp;BadgeOS is shifting data as a background process. You will receive a confirmation email upon successful completion. You can continue exploring badgeos.</p></div>')})}}),e("#badgeos_migrate_fields_single_to_multi").click(function(){if(confirm("It will update the existing achievement points with the point types.")){e.post(admin_js.ajax_url,{action:"badgeos_migrate_fields_points_to_point_types"},function(a){e(".badgeos_migrate_fields_single_to_multi_message").html('<div class="notice notice-warning migrage-point-fields-entries"><p>'+a+"</p></div>").slideDown()})}}),e("#badgeos_notice_update_from_meta_to_db").click(function(){if(confirm("It will update the users' existing achievements and points in the badgeos table")){e.post(admin_js.ajax_url,{action:"badgeos_migrate_data_from_meta_to_db_notice"},function(a){e("#wpbody-content .wrap").prepend('<div class="notice notice-warning"><p><img src="'+admin_js.loading_img+'" /> &nbsp;&nbsp;BadgeOS is shifting data as a background process. You will receive a confirmation email upon successful completion. You can continue exploring badgeos.</p></div>'),setTimeout(function(){e("#wpbody-content .wrap .migrate-meta-to-db").slideUp()},1e3)})}}),e("#badgeos_date_of_birth").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),e.fn.upload_listing_image=function(t){var n=t.attr("id"),i=n.replace("_button","");a?a.open():((a=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader_title"),button:{text:e(this).data("uploader_button_text")},multiple:!1})).on("select",function(){var t=a.state().get("selection").first().toJSON();e("#"+i).val(t.id),e("#not_earned_image_div img").attr("src",t.url),e("#not_earned_image_div img").show(),e("#"+n).attr("id","remove_not_earned_image_button"),e("#remove_not_earned_image_button").text("Remove image")}),a.open())},e("#not_earned_image_div").on("click","#upload_not_earned_image_button",function(a){a.preventDefault(),e.fn.upload_listing_image(e(this))}),e("#not_earned_image_div").on("click","#remove_not_earned_image_button",function(a){a.preventDefault(),e("#upload_not_earned_image").val(""),e("#not_earned_image_div img").attr("src",""),e("#not_earned_image_div img").attr("srcset",""),e("#not_earned_image_div img").hide(),e(this).attr("id","upload_not_earned_image_button"),e("#upload_not_earned_image_button").text("Set image")})});