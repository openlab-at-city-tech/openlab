jQuery(document).ready(function(e){"use strict";e.widget("cp.OutoftheBoxUploadbox",{options:{standalone:!1,auto_upload:!1,restrictions:{accepted_formats:null,min_file_size:null,max_file_size:null,max_uploads:null,quota:null,has_requirements:!1},use_encryption:!1,attached_browser:null,dropzone:self.element,pre_process:!1,template_row:".fileupload-table-row-template",queue_table:".fileupload-table-body",debug:!1},_create:function(){this.options.auto_upload=!0===this.element.hasClass("auto_upload")||!0===this.element.hasClass("force_auto_upload"),this.options.standalone=!0===this.options.main.element.hasClass("upload"),this.options.support_xhr=e.support.xhrFileUpload&&!1===this.options.use_encryption,this.options.support_chunked=!1,this.options.multipart_val=!this.options.support_xhr,this.options.method_val="POST",this.options.singlefileuploads_val=!0,this.options.maxchunksize_val=this.options.support_chunked?64e5:0,this.options.max_server_connections=5,void 0===window.current_server_connections&&(window.current_server_connections=0),this.upload_events={},this.options.restrictions.accepted_formats=new RegExp(this.element.find('input[name="acceptfiletypes"]').val(),"i"),this.options.restrictions.min_file_size=parseInt(this.element.find('input[name="minfilesize"]').val()),this.options.restrictions.max_file_size=this.options.support_xhr&&"0"===this.element.find('input[name="maxfilesize"]').attr("data-limit")?-1:parseInt(this.element.find('input[name="maxfilesize"]').val()),this.options.restrictions.max_uploads=parseInt(this.element.find('input[name="maxnumberofuploads"]').val()),this.options.has_requirements=0!==this.element.find(".upload-requirements-content-subtitle").children().length,this.options.pre_process=1==this.element.data("preprocess"),this.options.use_encryption="1"===this.element.find('input[name="encryption"]').val(),this.options.template_row=this.element.find(this.options.template_row),this.options.queue_table=this.element.find(this.options.queue_table),this.options.dropzone=this.options.main.element,this.in_form=this.element.closest("form").length>0,this.form_element=this.element.closest("form"),this.form_submit_button=this.form_element.find('input[type="submit"]:visible, input[type="button"].gform_next_button:visible, button[id^="gform_submit_button"]:visible, button[class*="cf7md-submit-btn"]:visible, button.wpforms-submit:visible, button.wpforms-page-next:visible, button.frm_button_submit:visible, button.ff-btn-submit:visible, button.ff-btn-next:visible, button.wsf-button.wsf-button-primary').not(".wpcp-upload-submit, .frm_prev_page"),this.form_upload_button=null,this.block_upload_element=null,this.upload_process=null,this.pre_process=null,this.pre_process_completed=!1,this.pending_uploads={},this.finished_uploads={},this.files_storage={},this.queue={},this.queue_length=0,this.queue_size=0,this.progress_timer=null,this.upload_started,this.time_remaining=0,this.progress_percentage=0,this.progress_bar=this.element.find(".fileupload-global-progress-bar"),this._initiate()},_destroy:function(){return this._super()},_setOption:function(e,t){this._super(e,t)},_initiate:function(){var e=this;e._log("LOADED",e),e._initUploadBox(),e._initFunctions(),e._refreshView(),e._log("ACTIVATED",e),window.setTimeout(function(){e.initated=!0},2e3)},_initUploadBox:function(){var t=this;t.upload_box=t.element.fileupload({url:t.options.ajax_url,type:t.options.method_val,maxChunkSize:t.options.maxchunksize_val,singleFileUploads:t.options.singlefileuploads_val,multipart:t.options.multipart_val,dataType:"json",autoUpload:t.options.auto_upload,maxFileSize:t.options.restrictions.max_file_size,acceptFileTypes:t.options.restrictions.accepted_formats,dropZone:t.options.dropzone,messages:{maxNumberOfFiles:t.options.maxNumberOfFiles,acceptFileTypes:t.options.acceptFileTypes,maxFileSize:t.options.maxFileSize,minFileSize:t.options.minFileSize},limitConcurrentUploads:3,disableImageLoad:!0,disableImageResize:!0,disableImagePreview:!0,disableAudioPreview:!0,disableVideoPreview:!0,uploadTemplateId:null,downloadTemplateId:null,add:function(e,o){t._add(o)},submit:function(e,o){return t._start(o),!1}}).on({fileuploaddrop:function(e,o){null!==t.block_upload_element&&t.block_upload_element.is(":visible")&&(o.files=[])},fileuploadprogress:function(e,o){t._progress(o)},fileuploadfail:function(e,o){var i=o.files[0];t.queue[i.hash].error=t.options.str_uploading_failed,t.queue[i.hash].status.type="upload-failed",t._isFinished(i)},fileuploaddone:function(e,o){t._done(o)},"outofthebox-upload-start":function(){e.each(t.queue,function(e,o){null!==o.upload_event&&void 0===t.finished_uploads[o.hash]&&void 0===t.pending_uploads[o.hash]&&(t.pending_uploads[o.hash]=o,o.upload_event())})}})},_add:function(t){var o=this;e.each(t.files,function(e,i){var n="";"relativePath"in i?n=i.relativePath:"webkitRelativePath"in i&&(n=i.webkitRelativePath),i.path=n.replace(i.name,""),""!==i.path&&(o.options.pre_process=!0,o.pre_process_completed=!1),i.hash=(i.path+i.name+i.size+("lastModified"in i?i.lastModified:"")).hashCode(),i.listtoken=o.options.listtoken,i.description=void 0!==i.description?i.description:"",i.directupload=o.options.support_xhr&&i.size<314572800,i.convert=!1,void 0!==o.queue[i.hash]&&(o._log("FILE ALREADY ADDED"),null!==o.queue[i.hash].status.request&&(o._log("STOP UPLOAD CURRENT FILE UPLOAD"),o._stop(i)),o.removeFileFromQueueTable(i)),i=o._validate(i),o.queue[i.hash]=i,o.queue[i.hash].status={type:"upload-waiting",progress:0,progressbar:null,request:null},o.queue[i.hash].element=o.addFileToQueueTable(i),o.queue_size+=i.size,o.queue_length++,i.error?(o._log("FILE NOT VALID"),o.element.find(".fileupload-requirements-button").click(),o.queue[i.hash].status.type="validation-failed",o.queue[i.hash].upload_event=null):(o.queue[i.hash].upload_event=function(){t.process().done(function(){t.submit()})},o.element.trigger("outofthebox-add-upload",[i,t,o]),o._log("FILE ADDED")),o.updateFileInQueueTable(i)}),o.options.auto_upload&&window.setTimeout(function(){o._log("AUTO UPLOAD"),o.element.trigger("outofthebox-upload-start")},500)},_validate:function(e){var t=this;return e.error=!1,e.name.length&&!t.options.restrictions.accepted_formats.test(e.name)?e.error=t.options.str_filetype_not_allowed:""!==t.options.restrictions.min_file_size&&e.size<=t.options.restrictions.min_file_size?e.error=t.options.str_min_file_size:t.options.restrictions.max_file_size>-1&&e.size>0&&e.size>t.options.restrictions.max_file_size?e.error=t.options.str_max_file_size:t.options.restrictions.max_uploads>0&&t.queue_length>0&&t.queue_length>=t.options.restrictions.max_uploads&&(e.error=t.options.str_files_limit),t._log("VALIDATED",e),e},_delete:function(e){},_start:function(t){var o=this;if(o._log("START",t),e.each(t.files,function(i,n){e.isEmptyObject(o.queue[n.hash])?n.error=!0:o.updateFileInQueueTable(n),!1!==n.error&&t.files.splice(i,1)}),0!==t.files.length){null===o.upload_process&&(o.upload_started=(new Date).getTime()),null===o.upload_process&&(o.upload_process=e.Deferred(),e.when(o.upload_process).then(function(){o._log("ALL UPLOADS FINISHED",t),o.upload_process=null,o._postProcess().then(function(e){o._finish(t,e)})})),window.onbeforeunload=function(){return!0},o.element.addClass("-is-uploading"),o.in_form&&o.form_upload_button.val(o.options.str_uploading).html(o.options.str_uploading).prop("disabled",!0).addClass("-wpcp-submit-active"),o.element.trigger("outofthebox-start-upload",[t.files[0],t,o]);var i=t.files[0];o.queue[i.hash].status.type="upload-starting",o.updateFileInQueueTable(i),o._preProcess().then(function(){o.pre_process_completed=!0,o._log("PREPROCESS COMPLETED"),o.pending_uploads[i.hash]=i,o._scrollToFile(i),i.directupload?o._getUploadUrl(i).then(function(n){if(window.current_server_connections--,e.isEmptyObject(n)||void 0===n.result||void 0===n.url)return o._log("UPLOAD FAILED",i),o.queue[i.hash].error=o.options.str_uploading_failed,o.queue[i.hash].status.type="upload-failed",o._isFinished(i),!1;t.url=n.url,o.queue[i.hash].fileid=n.id,o.queue[i.hash].convert=n.convert,o.upload_box.fileupload("option","multipart",!1),t.jqXHR=o.queue[i.hash].status.request=o.upload_box.fileupload("send",t),o._log("UPLOAD DIRECTLY TO CLOUD",t)},function(e){return window.current_server_connections--,o._log("UPLOAD FAILED",i),o.queue[i.hash].error=o.options.str_uploading_failed,o.queue[i.hash].status.type="upload-failed",o._isFinished(i),!1}):(o.upload_box.fileupload("option","multipart",!0),t.formData={action:"outofthebox-upload-file",account_id:o.options.account_id,type:"do-upload",hash:i.hash,file_path:i.path,last_modified:i.lastModified,file_description:i.description,lastpath:o.options.main.element.attr("data-path"),listtoken:o.options.listtoken,_ajax_nonce:o.options.upload_nonce},o._log("UPLOAD TO SERVER"),t.jqXHR=o.queue[i.hash].status.request=o.upload_box.fileupload("send",t))},function(){o.pre_process=null,o.pre_process_completed=!1,o._log("PREPROCESS FAILED");var e=t.files[0];return o.queue[e.hash].error=o.options.str_uploading_failed,o.queue[e.hash].status.type="upload-failed",o._isFinished(e),!1})}else o._refreshView()},_preProcess:function(){var t=this;return!1===t.options.pre_process||t.pre_process_completed?new Promise(function(e,t){e(!0)}):null!==t.pre_process?t.pre_process:(t.pre_process=e.ajax({type:"POST",url:t.options.ajax_url,data:{action:"outofthebox-upload-file",account_id:t.options.main.element.attr("data-account-id"),type:"upload-preprocess",listtoken:t.options.listtoken,lastpath:t.options.main.element.attr("data-path"),_ajax_nonce:t.options.upload_nonce},dataType:"json"}),t._log("PREPROCESS STARTED",t.pre_process),t.pre_process)},_getUploadUrl:function(t){var o=this;return o._log("OBTAIN DIRECT UPLOAD URL",t),new Promise(function(e,t){(function t(){if(window.current_server_connections<o.options.max_server_connections)return window.current_server_connections++,e();setTimeout(t,500)})()}).then(function(i){return e.ajax({type:"POST",url:OutoftheBox_vars.ajax_url,data:{action:"outofthebox-upload-file",account_id:o.options.main.options.account_id,type:"get-direct-url",filename:t.name,file_size:t.size,file_path:t.path,file_description:t.description,mimetype:t.type,last_modified:t.lastModified,orgin:window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),lastpath:o.options.main.element.attr("data-path"),listtoken:o.options.listtoken,_ajax_nonce:o.options.upload_nonce},dataType:"json"})})},_done:function(t){var o=this,i=t.files[0];!1===o.options.support_xhr&&void 0!==o.queue[i.hash].status.server_progress&&o.queue[i.hash].status.server_progress.abort();var n=!0;if(!o.options.support_xhr||void 0!==t.result&&null!==t.result&&""!==t.result||(n=!1),!1!==o.options.support_xhr||void 0!==t.result.file&&void 0!==t.result.file.fileid||(n=!1),!1===n)return o.queue[i.hash].error=o.options.str_uploading_failed,o.queue[i.hash].status.type="upload-failed",void o._isFinished(i);o.queue[i.hash].fileid=o.options.support_xhr?o.queue[i.hash].fileid:t.result.file.fileid,o.queue[i.hash].convert=o.options.support_xhr?o.queue[i.hash].convert:t.result.file.convert,i=o.queue[i.hash],o._convert(i).then(function(t){if(e.isEmptyObject(t)||void 0===t.result||0===t.result)return o.queue[i.hash].error=o.options.str_uploading_convert_failed,o._isFinished(i),!1;o.queue[i.hash].status.type="upload-finished",o.queue[i.hash].fileid=t.fileid,o.finished_uploads[o.queue[i.hash].fileid]=o.queue[i.hash],sendAnalyticsOFTB("Upload file",o.queue[i.hash].name),o._isFinished(i)})},_convert:function(e){return new Promise(function(t,o){var i={result:1,fileid:e.fileid};t(i)})},_isFinished:function(e){var t=this;t._log("FILE UPLOAD FINISHED",e),t.updateFileInQueueTable(e),!1!==e.error&&t.options.main._logEvent("log_failed_upload_event",t.options.main.element.attr("data-id"),{name:e.name,size:e.size,error:e.error}),t.queue[e.hash].upload_event=null,delete t.pending_uploads[e.hash],0===Object.keys(t.pending_uploads).length&&t.upload_process.resolve("upload-finished")},_postProcess:function(){var t=this;return 0===Object.keys(t.finished_uploads).length?(t._log("NO POST PROCESS (NO FILES UPLOADED)"),new Promise(function(e,t){e(!0)})):(t._log("POST PROCESS STARTED"),t._resetGlobalProgress(),t.progress_bar.width("99%"),e.ajax({type:"POST",url:t.options.ajax_url,data:{action:"outofthebox-upload-file",account_id:t.options.main.options.account_id,type:"upload-postprocess",listtoken:t.options.listtoken,files:Object.keys(t.finished_uploads),lastpath:t.options.main.element.attr("data-path"),_ajax_nonce:t.options.upload_nonce},dataType:"json"}))},_finish:function(t,o){var i=this;i._log("POST PROCESS FINISHED",o),window.onbeforeunload=null,e.each(o.files,function(e,t){i.files_storage[e]={hash:e,name:t.name,description:t.description,type:t.type,path:t.completepath,size:t.filesize,link:t.link,account_id:t.account_id,folderurl:t.folderurl}}),i.element.find(".fileupload-filelist").val(JSON.stringify(i.files_storage)).trigger("change"),i.element.removeClass("-is-uploading"),i.element.find(".-upload-finished").addClass("-upload-postprocess-finished"),i._resetGlobalProgress(),i.in_form&&i.form_upload_button.val(i.form_submit_button.val()).html(i.form_submit_button.html()).prop("disabled",!1).removeClass("-wpcp-submit-active"),i._refreshView(),!1===i.options.standalone&&!1===i.options.main.element.hasClass("upload")&&(i.options.main.options.clearLocalCache=!0,i.options.main.options.forceRefresh=!0,clearTimeout(i.options.main.updateTimer),i.options.main._getFileList({}));var n=!0;i.in_form&&e.each(i.queue,function(e,o){!1!==o.error&&(n=!1,i._scrollToFile(o),i._log("QUEUE CONTAINS ERRORS",i.queue),i._abort(t),i._dialogFailedUploads([o]))}),n&&i.element.trigger("outofthebox-upload-finished",[t,i])},_abort:function(e,t){var o=this;o._log("UPLOAD ABORT",t),window.onbeforeunload=null,o.upload_process=null,o.element.removeClass("-is-uploading"),o._refreshView(),o._resetGlobalProgress(),!1===o.options.standalone&&!1===o.options.main.element.hasClass("upload")&&(o.options.main.options.clearLocalCache=!0,o.options.main.options.forceRefresh=!0,clearTimeout(o.options.main.updateTimer),o.options.main._getFileList({})),o.form_upload_button.val(o.form_submit_button.val()).html(o.form_submit_button.html()).prop("disabled",!1).removeClass("-wpcp-submit-active")},_progress:function(e){var t=this;t._log("PROGRESS",e);var o,i=e.files[0];t.options.support_xhr&&i.directupload?(o=parseInt(e.loaded/e.total*100,10),t.queue[i.hash].status.type="uploading-to-cloud",null===t.progress_timer&&(t.progress_timer=setInterval(function(){t._globalProgress(t)},2e3),t._globalProgress(t))):(o=parseInt(e.loaded/e.total*100,10)/2,t.queue[i.hash].status.type="uploading-to-server",o>=50&&(o=50,t.queue[i.hash].status.type="uploading-to-cloud",setTimeout(function(){t._watchServerProgres(i)},2e3))),t.queue[i.hash].status.progress=o>0?o-1:o,t.updateFileInQueueTable(i)},_globalProgress:function(){var t=this,o=(new Date).getTime()-t.upload_started,i=0,n=0;e.each(t.queue,function(e,t){"validation-failed"!==t.status.type&&("upload-finished"===t.status.type||t.status.type,i+=t.size)}),e.each(t.queue,function(e,t){"validation-failed"!==t.status.type&&("upload-finished"===t.status.type||"upload-failed"===t.status.type?n+=t.size/i*100:n+=t.size/i*t.status.progressbar.value)}),t.progress_percentage=Math.round(n),t.time_remaining=Math.round((o/(n/100)-o)/1e3),t.time_remaining=Math.max(t.time_remaining,1),t.element.trigger("progress-update")},_resetGlobalProgress:function(){var e=this;clearInterval(e.progress_timer),e.progress_timer=null,e.progress_percentage=0,e.progress_bar.width(0)},_watchServerProgres:function(t){var o=this;null===o.progress_timer&&(o.progress_timer=setInterval(function(){o._globalProgress(o)},2e3),o._globalProgress(o)),o._getServerProgress(t).then(function(i){o._log("RECEIVED STATUS UPLOAD SERVER -> CLOUD",i),e.isEmptyObject(i)||void 0===i.status||"upload-failed"===i.status.progress||(o.queue[t.hash].status.type=i.status.progress,o.queue[t.hash].status.progress=50+i.status.percentage/2-1,o.updateFileInQueueTable(t),"upload-finished"!==i.status.progress&&setTimeout(function(){"upload-failed"!==o.queue[t.hash].status.type&&"upload-finished"!==o.queue[t.hash].status.type&&o._watchServerProgres(t)},2e3))})},_getServerProgress:function(t){var o=this;return o._log("GET STATUS UPLOAD SERVER -> CLOUD",t),o.queue[t.hash].status.server_progress=e.ajax({type:"POST",url:o.options.ajax_url,data:{action:"outofthebox-upload-file",account_id:o.element.attr("data-account-id"),type:"get-status",listtoken:o.options.listtoken,hash:t.hash,_ajax_nonce:o.options.upload_nonce},dataType:"json"}),o.queue[t.hash].status.server_progress},_stop:function(e){var t=this;t._log("ABORT FILE UPLOAD",e),t.queue[e.hash].status.request.abort(),t.queue[e.hash].status.type="upload-failed",t.queue[e.hash].error=e.error=t.options.str_uploading_cancelled},_redo:function(e){var t=this;t._log("REDO FILE UPLOAD",e),t.element.fileupload("add",{files:[e]})},_clear:function(){var e=this;e.upload_process=null,e.pre_process=null,e.pre_process_completed=!1,e.pending_uploads={},e.finished_uploads={},e.files_storage={},e.queue={},e.queue_length=0,e.queue_size=0,e.element.find('input[name="fileupload-filelist_'+e.options.listtoken+'"]').val(),e.in_form&&(e.form_element.find(".fileupload-filelist").val(""),e.form_upload_button.remove(),e.form_upload_button=null,e._addFormSubmitButton()),e.options.queue_table.find("tr:not(.fileupload-table-row-template)").remove(),e._refreshView(),e._log("CLEAR")},_log:function(e){var t=this;t.options.debug&&console.log("UPLOAD BOX:"+e)},addFileToQueueTable:function(e){var t=this,o=t.options.template_row.clone().removeClass("fileupload-table-row-template").addClass("-upload-waiting");return o.attr("data-id",e.hash),o.find(".fileupload-table-text-title").text(e.path.replace(e.name,"")+e.name),"undefined"!==e.size&&e.size>0&&o.find(".fileupload-table-text-subtitle").text(t.options.main._helperFormatBytes(e.size,1)),o.find(".fileupload-table-cell-icon img").attr("src",t._getThumbnail(e)),t.queue[e.hash].status.progressbar=new ldBar(o.find(".fileupload-loading-bar")[0],{preset:"circle",value:0}),t.options.queue_table.append(o),o},updateFileInQueueTable:function(e){var t=this,o=t.queue[e.hash].element;o.removeClass("-upload-waiting -upload-starting -uploading-to-cloud -uploading-to-server -upload-converting -upload-failed"),o.addClass("-"+t.queue[e.hash].status.type),t._log(t.queue[e.hash],t.queue[e.hash].status.progress),"uploading-to-cloud"!==t.queue[e.hash].status.type&&"uploading-to-server"!==t.queue[e.hash].status.type||t.queue[e.hash].status.progressbar.set(t.queue[e.hash].status.progress),o.find(".fileupload-table-text-subtitle").text(t.options.main._helperFormatBytes(e.size,1)+(e.description?" - "+e.description:"")),!1!==e.error&&(o.find(".fileupload-table-text-subtitle").text(e.error),o.addClass("-upload-failed"),t.queue_size-=e.size,t.queue_length--),t._refreshView()},removeFileFromQueueTable:function(t){var o=this,i=o.queue[t.hash].element;i.removeClass("-upload-waiting"),i.animate({opacity:"0"},"slow",function(){e(this).remove()}),!1===i.hasClass("-upload-failed")&&!1===i.hasClass("-upload-finished")&&(o.queue_size-=t.size,o.queue_length--),o.element.trigger("outofthebox-upload-removed",[t,o]),delete o.queue[t.hash],o._refreshView()},_refreshView:function(){var e=this;e.element.removeClass("-has-queue"),e.queue_length>0&&e.element.addClass("-has-queue"),e.queue_length>0&&(e.element.find(".fileupload-items").text(e.queue_length+" "+(1===e.queue_length?e.options.str_item:e.options.str_items)),e.element.find(".fileupload-items-size").text(e.options.main._helperFormatBytes(e.queue_size,1)));var t=e.element.find(".fileupload-start-button");t.prop("disabled",null!==e.upload_process),null!==e.upload_process?t.html('<i class="eva eva-settings-outline eva-spin eva-fw"></i><span> '+e.options.str_uploading+"</span>"):t.html("<span> "+e.options.str_uploading_start+"</span>"),!1===e.options.auto_upload&&e.element.find(".fileupload-add-button").prop("disabled",null!==e.upload_process),e.queue_length>2?e.progress_bar.fadeIn():e.progress_bar.fadeOut(),e._updateRequiredUI()},_initFunctions:function(){var t=this;t.options.main.options.mobile&&t.element.find(".upload-add-folder").remove(),t.element.find(".upload-add-file, .fileupload-header-title").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.element.find(".upload-input.upload-input-files").trigger("click"),tippy.hideAll()}),t.element.find(".upload-add-folder").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.element.find(".upload-input.upload-input-folder").trigger("click"),tippy.hideAll()});var o=t.element.find(".fileupload-add-button");if(1===o.next().find("li").length?o.on("click",function(e){t.element.find(".upload-add-file:first").trigger("click")}):(o.next().removeClass("tippy-content-holder"),tippy(o.get(0),{trigger:"click",content:o.next().get(0),allowHTML:!0,placement:"bottom-end",moveTransition:"transform 0.2s ease-out",interactive:!0,interactiveDebounce:500,theme:"wpcloudplugins-"+t.options.content_skin,onShown:function(e){},onCreate:function(e){}})),e(t.element).on("click",".upload-remove",function(o){o.preventDefault(),o.stopPropagation();var i=e(this).closest(".fileupload-table-row").attr("data-id"),n=t.queue[i];t.removeFileFromQueueTable(n)}),t.element.find(".fileupload-start-button").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.element.trigger("outofthebox-upload-start")}),e(t.element).on("click",".upload-stop",function(o){o.preventDefault(),o.stopPropagation();var i=e(this).closest(".fileupload-table-row").attr("data-id"),n=t.queue[i];t._stop(n)}),e(t.element).on("click",".upload-redo",function(o){o.preventDefault(),o.stopPropagation();var i=e(this).closest(".fileupload-table-row").attr("data-id"),n=t.queue[i];t._redo(n)}),e(t.element).on("progress-update",function(e,o,i){t.progress_bar.width(t.progress_percentage+"%")}),!1===t.options.has_requirements)t.element.find(".fileupload-requirements-button").remove();else{var i=t.element.find(".fileupload-requirements-button");i.next().removeClass("tippy-content-holder"),tippy(i.get(0),{trigger:"click mouseenter focus",content:i.next().get(0),allowHTML:!0,moveTransition:"transform 0.2s ease-out",theme:"wpcloudplugins-"+t.options.content_skin,onShown:function(e){},onCreate:function(e){}})}if(t.options.restrictions.max_file_size<0&&t.element.find(".max-file-size").text(t.options.str_uploading_no_limit),t.options.standalone&&-1==document.cookie.indexOf("OFTB-ID=")){var n=new Date;n.setTime(n.getTime()+6048e5);var s="; expires="+n.toUTCString(),a=Math.random().toString(36).substr(2,16);document.cookie="OFTB-ID="+a+s+"; path="+t.options.cookie_path+"; domain="+t.options.cookie_domain+";SameSite=Strict;"}t._initDragDrop(),e(t.element).on("click","button.upload-add-description",function(o){var i=e(this).closest(".fileupload-table-row").attr("data-id"),n=t.queue[i];t._dialogAddDescription(n)}),t.in_form&&t._initFormActions()},_initFormActions:function(){var t=this;t.element.addClass("-is-formfield"),t._addFormSubmitButton(),t._updateRequiredUI(),t._initCustomFolderNames(),t.options.auto_upload=t.element.hasClass("auto_upload")||t.element.hasClass("force_auto_upload")||!1,t.element.on("outofthebox-add-upload outofthebox-upload-removed",function(){t._updateRequiredUI()}),t.form_element.find("input, textarea").on("input change",function(){setTimeout(function(){t._updateRequiredUI()},100)}),t.element.find(".fileupload-filelist").on("change",function(){t.options.main.element.parent().nextAll(".fileupload-input-filelist").val(e(this).val())}),!1===t.options.auto_upload&&t.element.on("outofthebox-upload-finished",function(){e(".OutoftheBox .-is-uploading").length>0||t.form_upload_button.trigger("click")});var o=e(t.element).closest(".wpcf7");o.length>0&&o.get(0).addEventListener("wpcf7submit",function(e){t.form_element.removeClass("-is-submitting")},!1);var i=e(t.element).closest(".wpforms-form");i.length>0&&(t.form_element.on("invalid-form wpformsAjaxSubmitError wpformsAjaxSubmitFailed",function(e){t.form_element.removeClass("-is-submitting")}),t.form_element.on("wpformsPageChange",function(e,o,i){t.form_element.removeClass("-is-submitting"),t.form_upload_button.removeClass("-wpcp-submit-done"),t.form_submit_button.addClass("-wpcp-submit-hidden"),t._refreshView()})),jQuery(document).on("frmFormComplete frmFormErrors",function(e,o,i){t.form_element.removeClass("-is-submitting")}),jQuery(document).on("frmFormComplete",function(e,o,i){t._clear()}),jQuery(document).on("frmPageChanged",function(e,o,i){t.form_element.removeClass("-is-submitting"),t.form_upload_button.removeClass("-wpcp-submit-done"),t.form_submit_button.addClass("-wpcp-submit-hidden"),t._refreshView()}),t.form_element.on("reset",function(){t._clear()}),t._prefillQueue()},_updateRequiredUI:function(){var e=this;if(!1!==e.in_form){var t=e.element.closest(".gfield_contains_required, .wpcf7-validates-as-required, .frm_required_field");t=t.add(e.element.closest(".wpforms-field").find(".wpforms-required-label")),t=t.add(e.element.closest(".ff-el-group").find(".ff-el-is-required")),e.options.is_required=t.length,e.options.is_required&&e.element.addClass("-is-required"),e.element.removeClass("-is-hidden-by-conditional-logic"),t.is(":hidden")&&e.element.addClass("-is-hidden-by-conditional-logic"),e.element.hasClass("-is-uploading")||(e.element.removeClass("-need-files -has-files"),e.options.is_required&&!1===e.element.hasClass("-is-hidden-by-conditional-logic")&&0===e.element.find(".-upload-waiting").length&&0===Object.keys(e.finished_uploads).length?(e.element.addClass("-need-files"),e.form_upload_button.prop("disabled",!0)):(e.element.addClass("-has-files"),e.form_upload_button.prop("disabled",!1)))}},_addFormSubmitButton:function(){var e=this;e.form_submit_button.addClass("wpcp-submit-original -wpcp-submit-hidden"),e.form_upload_button=e.form_submit_button.clone().attr("id","wpcp_submit_replacement_"+e.options.listtoken).attr("onclick",null).attr("onkeypress",null).prop("onclick",null).prop("onkeypress",null).off().addClass("wpcp-upload-submit wpcf7-submit").removeClass("wpcp-submit-original -wpcp-submit-hidden").insertBefore(e.form_submit_button).on("click",function(t){e._formSubmitEvent(t)})},_formSubmitEvent:function(t){var o=this;if(t.stopPropagation(),t.preventDefault(),e.isFunction(o.form_element.valid)&&!1===o.form_element.valid())return!1;var i=!1;if(Object.keys(o.queue).length>0&&Object.keys(o.queue).forEach(function(e){var t=o.queue[e];!1!==t.error&&(i=!0,o._scrollToFile(t))}),i)return o._dialogRemoveFromQueue(),!1;if(o.element.removeClass("-need-files"),o.options.is_required&&!1===o.element.hasClass("-is-hidden-by-conditional-logic")&&0===o.element.find(".-upload-waiting").length&&0===Object.keys(o.finished_uploads).length)return o.element.addClass("-need-files"),e("html, body").animate({scrollTop:o.element.offset().top},1500),!1;if(o.form_upload_button.prop("disabled",!1).removeClass("-wpcp-submit-active"),o.element.find(".-upload-waiting").length>0&&!1===o.element.hasClass("-is-hidden-by-conditional-logic"))return o.element.trigger("outofthebox-upload-start"),!1;if(o.element.find(".-upload-waiting").length>0||o.element.find(".-need-files").length>0||e(".OutoftheBox .-is-uploading").length>0)return!1;if(o.form_upload_button.val(o.form_submit_button.val()).html(o.form_submit_button.html()).addClass("-wpcp-submit-done"),o.form_upload_button.next(".wpcp-upload-submit").length>0)o.form_upload_button.next(".wpcp-upload-submit").trigger("click");else{var n=[];if(o.form_element.find(".upload-input").each(function(){n.push({parent:e(this).parent(),input:e(this).clone(!0)}),e(this).remove()}),o.element.hasClass("-is-submitting"))return!1;o.form_element.addClass("-is-submitting"),o.form_submit_button.removeClass("-wpcp-submit-hidden").trigger("click"),e("html, body").animate({scrollTop:o.form_submit_button.offset().top},1500),e.each(n,function(){this.parent.append(this.input)})}},_prefillQueue:function(){var t=this,o=t.element.find('input[name="fileupload-filelist_'+t.options.listtoken+'"]'),i=t.options.main.element.parent().nextAll(".fileupload-input-filelist");if(0===o.val().length){if(0===i.length||0===i.val().length)return;o.val(i.val())}t.finished_uploads=JSON.parse(o.val()),e.each(t.finished_uploads,function(e,o){t.queue[o.hash]=o,t.queue[o.hash].status={type:"upload-finished",progress:100,progressbar:null,request:null},t.queue[o.hash].upload_event=null,t.queue[o.hash].size=t.options.main._helperReturnBytes(o.size),t.queue[o.hash].error=!1,t.queue[o.hash].element=t.addFileToQueueTable(o),t.queue_size+=o.size,t.queue_length++,t.element.trigger("outofthebox-add-upload",[o,[],t]),t.updateFileInQueueTable(o)}),t._refreshView()},_initCustomFolderNames:function(){var t=this,o=t.form_element.find("input.outofthebox_private_folder_name, select.outofthebox_private_folder_name, .outofthebox_private_folder_name input:last-of-type, .outofthebox_private_folder_name select").not('[id*="gforms_calendar"]');0!==o.length&&(null===t.block_upload_element&&(t.block_upload_element=e("<div>").attr("class","fileupload-box-block").html("<div>"+t.options.str_uploading_required_data+"</div>"),t.block_upload_element.insertBefore(t.element.css("position","relative"))),t.block_upload_element.show(),o.on("change keyup",function(){var i="",n=!0;o.each(function(){"radio"!==e(this).attr("type")||!1!==e(this).is(":checked")?e(this).is("select")&&!1===e(this).is(":visible")||e(this).is("input[type=text]")&&!1===e(this).is(":visible")||(""===e(this).val()&&(n=!1),i+=e(this).val()+"|"):e(this).is(":visible")&&0===e('input[name="'+this.name+'"]:checked').length&&(n=!1)}),i=i.length>0?i.slice(0,-1):i,n&&i.length>2?(t.block_upload_element.fadeOut(),document.cookie="WPCP-FORM-NAME-"+t.options.listtoken+"="+i+"; path="+t.options.cookie_path+"; domain="+t.options.cookie_domain+";SameSite=Strict;"):t.block_upload_element.fadeIn()}),o.trigger("keyup"))},_initDragDrop:function(){var t=this;e(document).on("dragover",function(o){if(null===t.block_upload_element||!t.block_upload_element.is(":visible")){var i=t.options.dropzone,n=t.dropZoneTimeout;n?clearTimeout(n):i.addClass("in");var s=!1,a=o.target;do{if(e(a).is(i)){s=!0;break}a=a.parentNode}while(null!==a);s?e(a).addClass("hover"):i.removeClass("hover"),t.dropZoneTimeout=setTimeout(function(){t.dropZoneTimeout=null,i.removeClass("in hover")},100)}}),e(document).on("drop dragover",function(e){e.preventDefault()})},_scrollToFile:function(e){var t=this,o=t.options.queue_table.scrollTop();o+=t.queue[e.hash].element.position().top,clearTimeout(t.tablescroller),t.tablescroller=setTimeout(function(){t.options.queue_table.animate({scrollTop:o},800)},500)},_getThumbnail:function(e){var t,o=this,i=o.options.icons_set+"128x128/"
;return void 0===e.thumbnail||null===e.thumbnail||""===e.thumbnail?(t=void 0===e.type||null===e.type?"unknown":e.type.indexOf("word")>=0?"application-msword":e.type.indexOf("excel")>=0||e.type.indexOf("spreadsheet")>=0?"application-vnd.ms-excel":e.type.indexOf("powerpoint")>=0||e.type.indexOf("presentation")>=0?"application-vnd.ms-powerpoint":e.type.indexOf("access")>=0||e.type.indexOf("mdb")>=0?"application-vnd.ms-access":e.type.indexOf("image")>=0?"image-x-generic":e.type.indexOf("audio")>=0?"audio-x-generic":e.type.indexOf("video")>=0?"video-x-generic":e.type.indexOf("pdf")>=0?"application-pdf":e.type.indexOf("zip")>=0||e.type.indexOf("archive")>=0||e.type.indexOf("tar")>=0||e.type.indexOf("compressed")>=0?"application-zip":e.type.indexOf("html")>=0?"text-xml":e.type.indexOf("application/exe")>=0||e.type.indexOf("application/x-msdownload")>=0||e.type.indexOf("application/x-exe")>=0||e.type.indexOf("application/x-winexe")>=0||e.type.indexOf("application/msdos-windows")>=0||e.type.indexOf("application/x-executable")>=0?"application-x-executable":e.type.indexOf("text")>=0?"text-x-generic":"unknown",i+t+".png"):e.thumbnail},_dialogAddDescription:function(t){var o=this;e("#outofthebox-modal-action").remove();var i="";i+='<button class="button outofthebox-modal-cancel-btn secondary" data-action="cancel" type="button" onclick="modal_action.close();" title="'+this.options.main.options.str_cancel_title+'" >'+this.options.main.options.str_cancel_title+"</button>",i+='<button class="button outofthebox-modal-confirm-btn" data-action="adddescription" type="button" title="'+this.options.main.options.str_save_title+'" >'+this.options.main.options.str_save_title+"</button>";var n=e('<a tabindex="0" class="close-button" title="'+this.options.main.options.str_close_title+'" onclick="modal_action.close();"><i class="eva eva-close eva-lg" aria-hidden="true"></i></a></div>'),s=e('<div class="outofthebox-modal-body" tabindex="0" ><textarea id="outofthebox-modal-description-input" name="outofthebox-modal-description-input" style="width:100%" rows="8" placeholder="'+t.name+" | "+this.options.main.options.str_add_description+'"></textarea></div>'),a=e('<div class="outofthebox-modal-footer"><div class="outofthebox-modal-buttons">'+i+"</div></div>"),l=e('<div id="outofthebox-modal-action" class="OutoftheBox outofthebox-modal '+this.options.main.options.content_skin+'"><div class="modal-dialog"><div class="modal-content"></div></div></div>');e("body").append(l),e("#outofthebox-modal-action .modal-content").append(n,s,a),e("#outofthebox-modal-description-input").val(t.description.replace(/<br\s?\/?>/g,"\r")),e("#outofthebox-modal-action #outofthebox-modal-description-input").on("keyup",function(t){13!=t.which&&13!=t.keyCode||e("#outofthebox-modal-action .outofthebox-modal-description-btn").trigger("click")}),e("#outofthebox-modal-action .outofthebox-modal-confirm-btn").on("click",function(i){t.description=e("#outofthebox-modal-description-input").val(),o.queue[t.hash]=t,o.updateFileInQueueTable(t),u.close()});var u=new RModal(document.getElementById("outofthebox-modal-action"),{bodyClass:"rmodal-open",dialogOpenClass:"animated slideInDown",dialogCloseClass:"animated slideOutUp",escapeClose:!0});return document.addEventListener("keydown",function(e){u.keydown(e)},!1),u.open(),window.modal_action=u,!1},_dialogFailedUploads:function(t,o){e("#outofthebox-modal-action").remove();var i=this,n="";e.each(t,function(t,o){var i=o.element.find("img:first()"),s=e('<div class="outofthebox-modal-file-icon">');i.length>0&&i.clone().appendTo(s),n+="<li>"+s.html()+"<span>"+o.name+"</span></li>"});var s="";s+='<button class="button outofthebox-modal-confirm-btn" data-action="confirm" type="button" title="'+i.options.str_close_title+'" >'+i.options.str_close_title+"</button>";var a=e('<a tabindex="0" class="close-button" title="'+i.options.str_close_title+'" onclick="modal_action.close();"><i class="eva eva-close eva-lg" aria-hidden="true"></i></a></div>'),l=e('<div class="outofthebox-modal-body" tabindex="0" >'+i.options.str_uploading_failed_msg+'<br/><br/><ul class="files">'+n+"</ul></div>"),u=e('<div class="outofthebox-modal-footer"><div class="outofthebox-modal-buttons">'+s+"</div></div>"),r=e('<div id="outofthebox-modal-action" class="OutoftheBox outofthebox-modal '+i.options.content_skin+'"><div class="modal-dialog"><div class="modal-content"></div></div></div>');e("body").append(r),e("#outofthebox-modal-action .modal-content").append(a,l,u),e("#outofthebox-modal-action .outofthebox-modal-confirm-btn").on("click",function(e){d.close()});var d=new RModal(document.getElementById("outofthebox-modal-action"),{bodyClass:"rmodal-open",dialogOpenClass:"animated slideInDown",dialogCloseClass:"animated slideOutUp",escapeClose:!0});return document.addEventListener("keydown",function(e){d.keydown(e)},!1),d.open(),window.modal_action=d,!1},_dialogRemoveFromQueue:function(t){e("#outofthebox-modal-action").remove();var o=this,i="";i+='<button class="button outofthebox-modal-confirm-btn" data-action="confirm" type="button" title="'+o.options.str_close_title+'" >'+o.options.str_close_title+"</button>";var n=e('<a tabindex="0" class="close-button" title="'+o.options.str_close_title+'" onclick="modal_action.close();"><i class="eva eva-close eva-lg" aria-hidden="true"></i></a></div>'),s=e('<div class="outofthebox-modal-body" tabindex="0" >'+o.options.str_uploading_failed_in_form+"</div>"),a=e('<div class="outofthebox-modal-footer"><div class="outofthebox-modal-buttons">'+i+"</div></div>"),l=e('<div id="outofthebox-modal-action" class="OutoftheBox outofthebox-modal '+o.options.content_skin+'"><div class="modal-dialog"><div class="modal-content"></div></div></div>');e("body").append(l),e("#outofthebox-modal-action .modal-content").append(n,s,a),e("#outofthebox-modal-action .outofthebox-modal-confirm-btn").on("click",function(e){u.close()});var u=new RModal(document.getElementById("outofthebox-modal-action"),{bodyClass:"rmodal-open",dialogOpenClass:"animated slideInDown",dialogCloseClass:"animated slideOutUp",escapeClose:!0});return document.addEventListener("keydown",function(e){u.keydown(e)},!1),u.open(),window.modal_action=u,!1}})});