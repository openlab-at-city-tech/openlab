{"version":3,"file":"editor.js","mappings":"4OAAkB,oBAAPA,SAA6C,IAAhBA,GAAGC,UACvCD,GAAGC,UAAS,WAER,GAA8C,cAA3CC,kBAAkBC,OAAOC,eAAmF,IAAlDF,kBAAkBC,OAAOC,cAAcC,OAApG,CAKA,IAAIC,EAA0B,UACW,IAA9BC,OAAOC,qBACdF,EAA0BC,OAAOC,oBAGL,OAA5BF,GAEAA,EAAwBG,MAAK,WACzB,IAA8D,IAA1DP,kBAAkBQ,kBAAkBC,kBAAxC,CAKA,IAAIC,EAAc,GACdC,EAAiB,GACjBC,GAAgB,EAEhBX,EAASH,GAAGG,OAAOY,gBACjBC,EAAc,CAChBZ,cAAea,OAAOC,OAAOhB,kBAAkBC,OAAOC,eACtDe,gBAAiBF,OAAOC,OAAOhB,kBAAkBC,OAAOgB,kBAG5D,IAAK,IAAIC,KAASjB,EAAQ,CACtB,IAAIkB,EAAgB,GAChBC,EAAY,CACZC,KAAMpB,EAAOiB,GAAOG,KACpBC,KAAMrB,EAAOiB,GAAOI,KAAKC,IACzBC,MAAOvB,EAAOiB,GAAOM,MACrBC,SAAUxB,EAAOiB,GAAOO,SACxBC,OAAQzB,EAAOiB,GAAOQ,QAGtBC,EAAc1B,EAAOiB,GAAOI,KAAKC,IAAMtB,EAAOiB,GAAOI,KAAKC,IAAMtB,EAAOiB,GAAOI,UAE5CM,IAAlC3B,EAAOiB,GAAOI,KAAKO,aAA0BT,EAAUU,UAAY7B,EAAOiB,GAAOI,KAAKO,YAEjE,mBAAdF,OAC2B,IAAxBA,EAAUI,WAChBX,EAAUE,KAAOxB,GAAGkC,QAAQC,eAAenC,GAAGkC,QAAQE,cAAcP,IACpEP,EAAUE,KAAOF,EAAUE,KAAKa,QAAQ,aAAc,cACtDf,EAAUE,KAAOF,EAAUE,KAAKa,QAAQ,eAAgB,kBAExDhB,EAAgBrB,GAAGkC,QAAQE,cAAcpC,GAAGsC,WAAWC,SAAU,CAACf,KAAM,kBACxEF,EAAUE,KAAOxB,GAAGkC,QAAQC,eAAed,IAEnB,WAArBmB,EAAOX,IACdP,EAAUE,KAAOxB,GAAGkC,QAAQC,eAAeN,GAC3CP,EAAUE,KAAOF,EAAUE,KAAKa,QAAQ,aAAc,cACtDf,EAAUE,KAAOF,EAAUE,KAAKa,QAAQ,eAAgB,iBAC5B,iBAAdR,IACdR,EAAgBrB,GAAGkC,QAAQE,cAAcpC,GAAGsC,WAAWC,SAAU,CAACf,KAAMK,IACxEP,EAAUE,KAAOxB,GAAGkC,QAAQC,eAAed,IAE/CT,EAAY6B,KAAKnB,GAIbN,EAAYZ,cAAcsC,QAAQvC,EAAOiB,GAAOG,OAAS,EAEzDV,EAAe4B,KAAKtC,EAAOiB,GAAOG,MAC3BP,EAAYG,gBAAgBuB,QAAQvC,EAAOiB,GAAOG,OAAS,IAIlEV,EAAe4B,KAAKtC,EAAOiB,GAAOG,MAClCT,GAAgB,EAExB,CAEA,GAAIA,EAAe,MACCgB,IAAZa,cAA2Cb,IAAlBa,QAAQC,OAEjCD,QAAQE,IAAI,kDAMhBC,YAAY,WACR9C,GAAG+C,KAAKC,SAAS,eAAeC,qBAAqB,CACjDtC,kBAAmBE,GAE3B,GAAG,KAEH,IAAIqC,EAAkBlD,GAAGG,OAAOgD,gBAEhC,IAEIC,OAAOC,KAAK,CACRC,IAAKpD,kBAAkBqD,QACvBC,OAAQ,OACRT,KAAM,CACFU,OAAQ,2BACRC,WAAYC,KAAKC,UAAUhD,GAC3BiD,eAAgBF,KAAKC,UAAUV,GAC/BY,MAAO5D,kBAAkB4D,OAE7BC,QAAS,SAAUhB,GACf,GAGZ,CAAE,MAAOiB,GACL,CAER,CA9FA,CA+FJ,GA5GJ,CA8GJ,G","sources":["webpack://advanced-gutenberg/./assets/js/editor.jsx"],"sourcesContent":["if (typeof wp !== 'undefined' && typeof wp.domReady !== 'undefined'){\n    wp.domReady(()=>{\n\n        if(advgb_blocks_vars.blocks.active_blocks === 'undefined' || advgb_blocks_vars.blocks.active_blocks.length === 0) {\n            // No Block Access defined for this role, so we stop the process here\n            return;\n        }\n\n        let gutenberg_init_function = null;\n        if (typeof window._wpLoadBlockEditor !== 'undefined') {\n            gutenberg_init_function = window._wpLoadBlockEditor;\n        }\n\n        if (gutenberg_init_function !== null) {\n            // Wait for Gutenberg editor to be ready\n            gutenberg_init_function.then(() => {\n                if (advgb_blocks_vars.original_settings.allowedBlockTypes !== true) {\n                    // allowed_block_types filter has been used, in this case we do nothing as we don't know why blocks have been filtered\n                    return;\n                }\n\n                let list_blocks = [];\n                let granted_blocks = [];\n                let missing_block = false;\n                // Retrieve all registered blocks\n                let blocks = wp.blocks.getBlockTypes();\n                const savedBlocks = {\n                    active_blocks: Object.values(advgb_blocks_vars.blocks.active_blocks),\n                    inactive_blocks: Object.values(advgb_blocks_vars.blocks.inactive_blocks),\n                };\n\n                for (let block in blocks) {\n                    var blockItemIcon = '';\n                    var blockItem = {\n                        name: blocks[block].name,\n                        icon: blocks[block].icon.src,\n                        title: blocks[block].title,\n                        category: blocks[block].category,\n                        parent: blocks[block].parent\n                    };\n\n                    var savedIcon = !!blocks[block].icon.src ? blocks[block].icon.src : blocks[block].icon;\n\n                    if (blocks[block].icon.foreground !== undefined) blockItem.iconColor = blocks[block].icon.foreground;\n\n                    if (typeof savedIcon === 'function') {\n                        if(typeof savedIcon.prototype !== 'undefined') {\n                            blockItem.icon = wp.element.renderToString(wp.element.createElement(savedIcon));\n                            blockItem.icon = blockItem.icon.replace(/stopcolor/g, 'stop-color');\n                            blockItem.icon = blockItem.icon.replace(/stopopacity/g, 'stop-opacity');\n                        } else {\n                            blockItemIcon = wp.element.createElement(wp.components.Dashicon, {icon: 'block-default'});\n                            blockItem.icon = wp.element.renderToString(blockItemIcon);\n                        }\n                    } else if (typeof savedIcon === 'object') {\n                        blockItem.icon = wp.element.renderToString(savedIcon);\n                        blockItem.icon = blockItem.icon.replace(/stopcolor/g, 'stop-color');\n                        blockItem.icon = blockItem.icon.replace(/stopopacity/g, 'stop-opacity');\n                    } else if (typeof savedIcon === 'string') {\n                        blockItemIcon = wp.element.createElement(wp.components.Dashicon, {icon: savedIcon});\n                        blockItem.icon = wp.element.renderToString(blockItemIcon);\n                    }\n                    list_blocks.push(blockItem);\n\n\n                    // Compare current block with the list of blocks we have\n                    if (savedBlocks.active_blocks.indexOf(blocks[block].name) >= 0) {\n                        // Block is active\n                        granted_blocks.push(blocks[block].name);\n                    } else if (savedBlocks.inactive_blocks.indexOf(blocks[block].name) >= 0) {\n                        // Block is inactive\n                    } else {\n                        // This block is not in our database yet, but by default we allow the usage\n                        granted_blocks.push(blocks[block].name);\n                        missing_block = true;\n                    }\n                }\n\n                if (missing_block) {\n                    if (console !== undefined && console.error !== undefined) {\n                        // Let's output as log instead of error\n                        console.log('Reloading editor by PublishPress Blocks plugin');\n                    }\n\n                    /* It seems the best approach to update editor settings, however is overriden\n                     * https://github.com/WordPress/gutenberg/issues/15993#issuecomment-1487007071\n                     * We're adding 3 seconds delay to bypass the override */\n                    setTimeout( function() {\n                        wp.data.dispatch('core/editor').updateEditorSettings({\n                            allowedBlockTypes: granted_blocks\n                        });\n                    }, 3000 );\n\n                    var list_categories = wp.blocks.getCategories();\n\n                    try {\n                        // Use this ajax query to update the block list in db\n                        jQuery.ajax({\n                            url: advgb_blocks_vars.ajaxurl,\n                            method: 'POST',\n                            data: {\n                                action: 'advgb_update_blocks_list',\n                                blocksList: JSON.stringify(list_blocks),\n                                categoriesList: JSON.stringify(list_categories),\n                                nonce: advgb_blocks_vars.nonce\n                            },\n                            success: function (data) {\n                                //console.log(data);\n                            }\n                        });\n                    } catch (e) {\n                        //console.log(e);\n                    }\n                }\n            });\n        }\n    });\n\n}\n"],"names":["wp","domReady","advgb_blocks_vars","blocks","active_blocks","length","gutenberg_init_function","window","_wpLoadBlockEditor","then","original_settings","allowedBlockTypes","list_blocks","granted_blocks","missing_block","getBlockTypes","savedBlocks","Object","values","inactive_blocks","block","blockItemIcon","blockItem","name","icon","src","title","category","parent","savedIcon","undefined","foreground","iconColor","prototype","element","renderToString","createElement","replace","components","Dashicon","_typeof","push","indexOf","console","error","log","setTimeout","data","dispatch","updateEditorSettings","list_categories","getCategories","jQuery","ajax","url","ajaxurl","method","action","blocksList","JSON","stringify","categoriesList","nonce","success","e"],"sourceRoot":""}