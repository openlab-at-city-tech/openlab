"use strict";!function(s){var o={},e={onReady:function(){this.setupDOM(),this.eventListeners(),this.initializeDependencies()},setupDOM:function(){o.changeSelectType=s(".zvc-hacking-select"),o.dateTimePicker=s("#datetimepicker"),o.reportsDatePicker=s("#reports_date"),o.zoomAccountDatepicker=s(".zoom_account_datepicker"),o.meetingListDTable=s("#zvc_users_list_table, #zvc_meetings_list_table"),o.meetingListTableCheck=s("#zvc_meetings_list_table"),o.usersListTable=s("#vczapi-get-host-users-wp"),o.meetingListTbl=o.meetingListTableCheck.find("input[type=checkbox]"),o.cover=s("#zvc-cover"),o.togglePwd=s(".toggle-api"),o.toggleSecret=s(".toggle-secret"),o.changeMeetingState=s(".vczapi-meeting-state-change"),o.show_on_meeting_delete_error=s(".show_on_meeting_delete_error"),this.adminHostSelectPostType=s(".vczapi-admin-post-type-host-selector")},eventListeners:function(){o.meetingListTableCheck.find("#checkall").on("click",this.meetingListTableCheck),s("#bulk_delete_meeting_listings").on("click",this.bulkDeleteMeetings),s(".zvc-meetings-form").find('input[name="password"]').on("keypress",this.meetingPassword),s(".delete-meeting").on("click",this.deleteMetting),o.togglePwd.on("click",this.toggleAPISettings.bind(this)),o.toggleSecret.on("click",this.toggleSecretSettings.bind(this)),s(".zvc-dismiss-message").on("click",this.dismissNotice.bind(this)),s(".check-api-connection").on("click",this.checkConnection.bind(this)),s(o.changeMeetingState).on("click",this.meetingStateChange.bind(this))},initializeDependencies:function(){0<o.changeSelectType.length&&o.changeSelectType.select2(),this.datePickers(),0<o.meetingListDTable.length&&o.meetingListDTable.dataTable({pageLength:25,columnDefs:[{targets:0,orderable:!1}]}),0<o.usersListTable.length&&o.usersListTable.dataTable({pageLength:25,columnDefs:[{targets:0,orderable:!0}],ajax:{url:ajaxurl+"?action=get_assign_host_id"},columns:[{data:"id"},{data:"email"},{data:"name"},{data:"host_id"}]}),0<s("#vczapi-select-wp-user-for-host").length&&s("#vczapi-select-wp-user-for-host").select2({ajax:{url:ajaxurl+"?action=vczapi_get_wp_users",type:"GET",dataType:"json"},placeholder:"Select a WordPress User",width:"300px"})},datePickers:function(){var e,t,i,n,c,a;0<o.dateTimePicker.length&&(t=(e=new Date).getMonth()+1,i=e.getDate(),n=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),c=e.getFullYear()+"-"+(t<10?"0":"")+t+"-"+(i<10?"0":"")+i+" "+n,(a=o.dateTimePicker.data("existingdate"))&&(c=a),o.dateTimePicker.datetimepicker({value:c,step:15,minDate:0,format:"Y-m-d H:i"})),0<o.reportsDatePicker.length&&o.reportsDatePicker.datepicker({changeMonth:!0,changeYear:!1,showButtonPanel:!0,dateFormat:"MM yy"}).focus(function(){var i=s(this);s(".ui-datepicker-calendar").detach(),s(".ui-datepicker-close").click(function(){var e=s("#ui-datepicker-div .ui-datepicker-month :selected").val(),t=s("#ui-datepicker-div .ui-datepicker-year").html();i.datepicker("setDate",new Date(t,e,1))})}),0<o.zoomAccountDatepicker.length&&o.zoomAccountDatepicker.datepicker({dateFormat:"yy-mm-dd"})},meetingListTableCheck:function(){s(this).is(":checked")?o.meetingListTbl.each(function(){s(this).prop("checked",!0)}):o.meetingListTbl.each(function(){s(this).prop("checked",!1)})},bulkDeleteMeetings:function(){if(1!=confirm("Confirm bulk delete these Meeting?"))return!1;var e=[];o.meetingListTableCheck.find("input.checkthis").each(function(){s(this).is(":checked")&&e.push(s(this).val())});var t,i=s(this).data("type");e&&(t={meetings_id:e,type:i,action:"zvc_bulk_meetings_delete",security:zvc_ajax.zvc_security},o.cover.show(),s.post(zvc_ajax.ajaxurl,t).done(function(e){o.cover.fadeOut("slow"),1==e.error?o.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(o.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())}))},meetingPassword:function(e){if(!/([a-zA-Z0-9])+/.test(String.fromCharCode(e.which)))return!1;var t=s(this).val(),i=s(this).data("maxlength");0<i&&s(this).val(t.substr(0,i))},deleteMetting:function(){var e=s(this).data("meetingid"),t=s(this).data("type");if(1!=confirm("Confirm Delete this Meeting?"))return!1;var i={meeting_id:e,type:t,action:"zvc_delete_meeting",security:zvc_ajax.zvc_security};o.cover.show(),s.post(zvc_ajax.ajaxurl,i).done(function(e){o.cover.fadeOut("slow"),1==e.error?o.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(o.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())})},toggleAPISettings:function(){var e=s("#zoom_api_key");"Show"===o.togglePwd.html()?(o.togglePwd.html("Hide"),e.attr("type","text")):(o.togglePwd.html("Show"),e.attr("type","password"))},toggleSecretSettings:function(){var e=s("#zoom_api_secret");"Show"===o.toggleSecret.html()?(o.toggleSecret.html("Hide"),e.attr("type","text")):(o.toggleSecret.html("Show"),e.attr("type","password"))},dismissNotice:function(e){e.preventDefault(),s(e.currentTarget).closest(".notice-success").hide(),s.post(zvc_ajax.ajaxurl,{action:"zoom_dimiss_notice"}).done(function(e){console.log(e)})},checkConnection:function(e){e.preventDefault(),o.cover.show(),s.post(zvc_ajax.ajaxurl,{action:"check_connection",security:zvc_ajax.zvc_security}).done(function(e){o.cover.hide(),alert(e)})},meetingStateChange:function(e){e.preventDefault();var t=s(e.currentTarget).data("state"),i=s(e.currentTarget).data("postid"),n={id:s(e.currentTarget).data("id"),state:t,type:s(e.currentTarget).data("type"),post_id:i||!1,action:"state_change",accss:zvc_ajax.zvc_security};if("resume"===t)this.changeState(n);else if("end"===t){if(!confirm(zvc_ajax.lang.confirm_end))return;this.changeState(n)}},changeState:function(e){s.post(zvc_ajax.ajaxurl,e).done(function(e){location.reload()})}},c={init:function(){this.cacheDOM(),this.evntHandlers()},cacheDOM:function(){this.notificationWrapper=s(".vczapi-status-notification"),this.syncUserId=s(".vczapi-sync-user-id")},evntHandlers:function(){this.syncUserId.on("change",this.fetchMeetingsByUser.bind(this))},fetchMeetingsByUser:function(e){e.preventDefault();var t=this,n=s(this.syncUserId).val(),i={user_id:n,action:"vczapi_sync_user",type:"check"},c=s(".results");c.html("<p>"+vczapi_sync_i10n.before_sync+"</p>"),s.post(ajaxurl,i).done(function(e){var i;e.success?(i='<div class="vczapi-sync-details">',i+="<p><strong>"+vczapi_sync_i10n.total_records_found+":</strong> "+e.data.total_records+"</p>",i+="<p><strong>"+vczapi_sync_i10n.total_not_synced_records+":</strong> "+_.size(e.data.meetings)+" (Only listing Scheduled Meetings)</p>",i+='<select class="vczapi-choose-meetings-to-sync-select2" name="sync-meeting-ids[]" multiple="multiple">',s(e.data.meetings).each(function(e,t){i+='<option value="'+t.id+'">'+t.topic+"</option>"}),i+="</select>",setTimeout(function(){s(".vczapi-choose-meetings-to-sync-select2").select2({maximumSelectionLength:10,placeholder:vczapi_sync_i10n.select2_placeholder})},100),i+='<p><a href="javascript:void(0);" class="vczapi-sync-meeting button button-primary" data-userid="'+n+'">'+vczapi_sync_i10n.sync_btn+"</a></p>",i+="</div>",c.html(i),s(".vczapi-sync-meeting").on("click",t.syncMeeting.bind(t))):c.html("<p>"+e.data+"</p>")})},syncMeeting:function(e){e.preventDefault(),s(e.currentTarget).attr("disabled","disabled");var t=s(".vczapi-choose-meetings-to-sync-select2").val();0<_.size(t)?(this.notificationWrapper.show().html("<p>"+vczapi_sync_i10n.sync_start+"</p>").removeClass("vczapi-error"),this.doSync(0,t)):(this.notificationWrapper.show().html("<p>"+vczapi_sync_i10n.sync_error+"</p>").addClass("vczapi-error"),s(e.currentTarget).removeAttr("disabled"))},doSync:function(t,i){var n=this,e={action:"vczapi_sync_user",type:"sync",meeting_id:i[t]};s.post(ajaxurl,e).done(function(e){t++,n.notificationWrapper.show().append("<p> "+e.data.msg+"</p>"),t<_.size(i)?c.doSync(t,i):(e.success?n.notificationWrapper.show().append("<p>"+vczapi_sync_i10n.sync_completed+"</p>"):n.notificationWrapper.show().append("<p>"+e.data.msg+"</p>"),s(".vczapi-sync-meeting").removeAttr("disabled"))})}},t={init:function(){this.cacheDOM(),this.evntHandlers()},cacheDOM:function(){this.meetingSelector=s("#vczapi-admin-meeting-ype"),this.hideOnWebinarSelector=s(".vczapi-admin-hide-on-webinar"),this.showOnWebinarSelector=s(".vczapi-admin-show-on-webinar")},evntHandlers:function(){this.meetingSelector.on("change",this.webinarElementsShow.bind(this))},webinarElementsShow:function(e){"2"===s(e.currentTarget).val()?(this.hideOnWebinarSelector.hide(),this.showOnWebinarSelector.show()):(this.hideOnWebinarSelector.show(),this.showOnWebinarSelector.hide())}};s(function(){e.onReady(),c.init(),t.init()})}(jQuery);