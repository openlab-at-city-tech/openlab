!function(a){"use strict";var t={counts:0,upgraderResumeOffset:0,completed:0,ajaxRequests:[],ajaxStarted:1,ajaxTimeout:null,ajax:ajaxurl,entries:0,requestsNumber:0,init:function(){a(document).on("click","button#dlm-upgrade-db,a.dlm-db-upgrade-link",function(e){e.preventDefault(),a(this).prop("disabled",!0),a("body").find(".dlm-upgrade-db-notice").addClass("started");e={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_db_log_entries",nonce:dlm_upgrader.nonce},success:function(e){"0"!==e&&"0"!==e.entries?(t.entries=e.entries,e.offset,0!==parseInt(e.offset)&&(t.upgraderResumeOffset=parseInt(e.offset),e={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_upgrade_db_clear_offset",nonce:dlm_upgrader.nonce,offset:parseInt(e.offset)},success:function(){console.log("previous offset cleared")}},a.ajax(e))):t.entries=0,t.processAjax(),s.init(Math.ceil(1e6*t.upgraderResumeOffset/t.entries))}};a.ajax(e)})},processAjax:function(){if(0<t.entries-1e4*t.upgraderResumeOffset){t.requestsNumber=1e4<=t.entries?parseInt(Math.ceil(t.entries/1e4)):1;for(let e=0;e<=t.requestsNumber-t.upgraderResumeOffset;e++){var a={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_upgrade_db",nonce:dlm_upgrader.nonce,offset:t.counts+t.upgraderResumeOffset},success:function(){t.ajaxStarted=t.ajaxStarted-1,t.completed=t.completed+1,s.progressHandler(100*(t.completed+t.upgraderResumeOffset)/t.requestsNumber)}};t.counts+=1,t.ajaxRequests.push(a)}}var e={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_alter_download_log",nonce:dlm_upgrader.nonce},success:function(){t.ajaxStarted=t.ajaxStarted-1,t.completed=t.completed+1,0<t.entries?s.progressHandler(100*(t.completed+t.upgraderResumeOffset)/t.requestsNumber):s.progressHandler(100*(t.completed+t.upgraderResumeOffset)),jQuery("#dlm_progress-bar").parent().find(".dlm-progress-label").text("Upgrade completed!"),jQuery("#dlm_progress-bar").addClass("completed")}};t.ajaxRequests.push(e),t.runAjaxs()},runAjaxs:function(){for(var e;t.ajaxStarted<2&&0<t.ajaxRequests.length;)t.ajaxStarted=t.ajaxStarted+1,e=t.ajaxRequests.shift(),a.ajax(e);0<t.ajaxRequests.length&&(t.ajaxTimeout=setTimeout(function(){console.log("Delayed 1s"),t.runAjaxs()},1e3))}};const s={el:{},label:{},init:(e=0)=>{s.el=jQuery("#dlm_progress-bar"),s.label=jQuery("#dlm_progress-bar").parent().find(".dlm-progress-label"),s.label.text(Math.ceil(e)+"%"),s.el.progressbar({value:e,change:()=>{s.label.text(s.el.progressbar("value")+"%")},complete:()=>{}})},progressHandler:e=>{s.el.progressbar("value",Math.ceil(e))}};a(document).ready(function(){t.init()})}(jQuery);